{"version":3,"file":"1227.3d83a4f0752b64a0.js","sources":["webpack://knx-frontend/./homeassistant-frontend/src/dialogs/config-flow/previews/flow-preview-generic.ts"],"sourcesContent":["import type { HassEntity, UnsubscribeFunc } from \"home-assistant-js-websocket\";\nimport { LitElement, html } from \"lit\";\nimport type { nothing, TemplateResult } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport type { FlowType } from \"../../../data/data_entry_flow\";\nimport type { GenericPreview } from \"../../../data/preview\";\nimport { subscribePreviewGeneric } from \"../../../data/preview\";\nimport type { HomeAssistant } from \"../../../types\";\nimport \"./entity-preview-row\";\nimport { debounce } from \"../../../common/util/debounce\";\nimport { fireEvent } from \"../../../common/dom/fire_event\";\nimport \"../../../components/ha-alert\";\n\n@customElement(\"flow-preview-generic\")\nexport class FlowPreviewGeneric extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ attribute: false }) public flowType!: FlowType;\n\n  public handler!: string;\n\n  @property() public domain!: string;\n\n  @property({ attribute: false }) public stepId!: string;\n\n  @property({ attribute: false }) public flowId!: string;\n\n  @property({ attribute: false }) public stepData!: Record<string, any>;\n\n  @state() protected _preview?: HassEntity;\n\n  @state() protected _error?: string;\n\n  private _unsub?: Promise<UnsubscribeFunc>;\n\n  disconnectedCallback(): void {\n    super.disconnectedCallback();\n    if (this._unsub) {\n      this._unsub.then((unsub) => unsub());\n      this._unsub = undefined;\n    }\n  }\n\n  willUpdate(changedProps) {\n    if (changedProps.has(\"stepData\")) {\n      this._debouncedSubscribePreview();\n    }\n  }\n\n  protected render(): TemplateResult | typeof nothing {\n    if (this._error) {\n      return html`<ha-alert alert-type=\"error\">${this._error}</ha-alert>`;\n    }\n    return html`<entity-preview-row\n      .hass=${this.hass}\n      .stateObj=${this._preview}\n    ></entity-preview-row>`;\n  }\n\n  private _setPreview = (preview: GenericPreview) => {\n    if (preview.error) {\n      this._error = preview.error;\n      this._preview = undefined;\n      return;\n    }\n    const now = new Date().toISOString();\n    this._preview = {\n      entity_id: `${this.stepId}.___flow_preview___`,\n      last_changed: now,\n      last_updated: now,\n      context: { id: \"\", parent_id: null, user_id: null },\n      ...preview,\n    };\n  };\n\n  private _debouncedSubscribePreview = debounce(() => {\n    this._subscribePreview();\n  }, 250);\n\n  private async _subscribePreview() {\n    if (this._unsub) {\n      (await this._unsub)();\n      this._unsub = undefined;\n    }\n    if (\n      this.flowType !== \"config_flow\" &&\n      this.flowType !== \"options_flow\" &&\n      this.flowType !== \"config_subentries_flow\"\n    ) {\n      return;\n    }\n    this._error = undefined;\n    try {\n      this._unsub = subscribePreviewGeneric(\n        this.hass,\n        this.domain,\n        this.flowId,\n        this.flowType,\n        this.stepData,\n        this._setPreview\n      );\n      await this._unsub;\n      fireEvent(this, \"set-flow-errors\", { errors: {} });\n    } catch (err: any) {\n      if (typeof err.message === \"string\") {\n        this._error = err.message;\n      } else {\n        this._error = undefined;\n        fireEvent(this, \"set-flow-errors\", err.message);\n      }\n      this._unsub = undefined;\n      this._preview = undefined;\n    }\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"flow-preview-generic\": FlowPreviewGeneric;\n  }\n}\n"],"names":["FlowPreviewGeneric","LitElement","disconnectedCallback","super","this","_unsub","then","unsub","undefined","willUpdate","changedProps","has","_debouncedSubscribePreview","render","_error","html","_t","_","_t2","hass","_preview","_subscribePreview","flowType","subscribePreviewGeneric","domain","flowId","stepData","_setPreview","fireEvent","errors","err","message","args","preview","error","now","Date","toISOString","Object","assign","entity_id","stepId","last_changed","last_updated","context","id","parent_id","user_id","debounce","attribute"],"mappings":"+XAcO,MAAPA,UAAAC,EAAAA,GAqBEC,oBAAAA,GACEC,MAAAD,uBACIE,KAAJC,SACED,KAAAC,OAAAC,MAAAC,GAAAA,MACAH,KAAAC,YAAAG,EAEJ,CAEAC,UAAAA,CAAAC,GACEA,EAAAC,IAAA,aACEP,KAAAQ,4BAEJ,CAEUC,MAAAA,GACR,OAAIT,KAAJU,QACEC,EAAAA,EAAAA,IAAAC,IAAAA,EAAAC,CAAA,qDAAAH,SAEFC,EAAAA,EAAAA,IAAAG,IAAAA,EAAAD,CAAA;cAAA;kBAAA;6BACQ,KAAAE,KACI,KAAAC,SAEd,CAsBA,uBAAAC,GAKE,GAJIjB,KAAJC,gBACG,KAAAA,UACDD,KAAAC,YAAAG,GAEF,gBAAI,KAAJc,UAAA,sBAAAA,UAAA,gCAAAA,SAAA,CAOAlB,KAAAU,YAAAN,EACA,IACEJ,KAAAC,QAAAkB,EAAAA,EAAAA,GAAAnB,KAAAe,KAAAf,KAAAoB,OAAApB,KAAAqB,OAAArB,KAAAkB,SAAAlB,KAAAsB,SAAAtB,KAAAuB,mBAQMvB,KAANC,QACAuB,EAAAA,EAAAA,GAAA,wBAAqCC,OAAA,IACvC,CAAE,MAAFC,GACE,iBAAAA,EAAAC,QACE3B,KAAAU,OAAAgB,EAAAC,SAEA3B,KAAAU,YAAAN,GACAoB,EAAAA,EAAAA,GAAA,uBAAAE,EAAAC,UAEF3B,KAAAC,YAAAG,EACAJ,KAAAgB,cAAAZ,CACF,CAtBA,CAuBF,C,kBAnGK,SAAAwB,GAAA,KAAAL,YAAAM,IA8CH,GAAAA,EAAAC,MAGE,OAFA9B,KAAAU,OAAAmB,EAAAC,WACA9B,KAAAgB,cAAAZ,GAGF,MAAA2B,GAAA,IAAAC,MAAAC,cACAjC,KAAAgB,SAAAkB,OAAAC,OAAA,CACEC,UAAA,QAAAC,4BACAC,aAAAP,EACAQ,aAAAR,EACAS,QAAA,CAAWC,GAAA,GAAQC,UAAA,KAAiBC,QAAA,OACpCd,EACF,EACF,KAAArB,4BAAAoC,EAAAA,EAAAA,IAAA,KAGE5C,KAAAiB,mBAAA,GACC,I,8BA9DS4B,WAAA,K,uDAEAA,WAAA,K,sHAMAA,WAAA,K,yDAEAA,WAAA,K,yDAEAA,WAAA,K"}