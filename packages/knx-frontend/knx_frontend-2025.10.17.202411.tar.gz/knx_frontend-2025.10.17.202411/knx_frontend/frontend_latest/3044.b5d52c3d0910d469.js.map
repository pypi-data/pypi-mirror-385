{"version":3,"file":"3044.b5d52c3d0910d469.js","sources":["webpack://knx-frontend/./homeassistant-frontend/src/components/ha-form/ha-form-optional_actions.ts"],"sourcesContent":["import { mdiPlus } from \"@mdi/js\";\nimport type { PropertyValues, TemplateResult } from \"lit\";\nimport { css, html, LitElement, nothing } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport memoizeOne from \"memoize-one\";\nimport { stopPropagation } from \"../../common/dom/stop_propagation\";\nimport type { LocalizeFunc } from \"../../common/translations/localize\";\nimport type { HomeAssistant } from \"../../types\";\nimport \"../ha-button\";\nimport \"../ha-list-item\";\nimport \"../ha-svg-icon\";\nimport \"./ha-form\";\nimport type {\n  HaFormDataContainer,\n  HaFormElement,\n  HaFormOptionalActionsSchema,\n  HaFormSchema,\n} from \"./types\";\n\nconst NO_ACTIONS = [];\n\n@customElement(\"ha-form-optional_actions\")\nexport class HaFormOptionalActions extends LitElement implements HaFormElement {\n  @property({ attribute: false }) public localize?: LocalizeFunc;\n\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ attribute: false }) public data!: HaFormDataContainer;\n\n  @property({ attribute: false }) public schema!: HaFormOptionalActionsSchema;\n\n  @property({ type: Boolean }) public disabled = false;\n\n  @property({ attribute: false }) public computeLabel?: (\n    schema: HaFormSchema,\n    data?: HaFormDataContainer\n  ) => string;\n\n  @property({ attribute: false }) public computeHelper?: (\n    schema: HaFormSchema\n  ) => string;\n\n  @property({ attribute: false }) public localizeValue?: (\n    key: string\n  ) => string;\n\n  @state() private _displayActions?: string[];\n\n  public async focus() {\n    await this.updateComplete;\n    this.renderRoot.querySelector(\"ha-form\")?.focus();\n  }\n\n  protected updated(changedProps: PropertyValues): void {\n    super.updated(changedProps);\n    if (changedProps.has(\"data\")) {\n      const displayActions = this._displayActions ?? NO_ACTIONS;\n      const hiddenActions = this._hiddenActions(\n        this.schema.schema,\n        displayActions\n      );\n      this._displayActions = [\n        ...displayActions,\n        ...hiddenActions.filter((name) => name in this.data),\n      ];\n    }\n  }\n\n  private _hiddenActions = memoizeOne(\n    (schema: readonly HaFormSchema[], displayActions: string[]): string[] =>\n      schema\n        .map((item) => item.name)\n        .filter((name) => !displayActions.includes(name))\n  );\n\n  private _displaySchema = memoizeOne(\n    (\n      schema: readonly HaFormSchema[],\n      displayActions: string[]\n    ): HaFormSchema[] =>\n      schema.filter((item) => displayActions.includes(item.name))\n  );\n\n  public render(): TemplateResult {\n    const displayActions = this._displayActions ?? NO_ACTIONS;\n\n    const schema = this._displaySchema(\n      this.schema.schema,\n      this._displayActions ?? []\n    );\n\n    const hiddenActions = this._hiddenActions(\n      this.schema.schema,\n      displayActions\n    );\n\n    const schemaMap = new Map<string, HaFormSchema>(\n      this.computeLabel\n        ? this.schema.schema.map((item) => [item.name, item])\n        : []\n    );\n\n    return html`\n      ${schema.length > 0\n        ? html`\n            <ha-form\n              .hass=${this.hass}\n              .data=${this.data}\n              .schema=${schema}\n              .disabled=${this.disabled}\n              .computeLabel=${this.computeLabel}\n              .computeHelper=${this.computeHelper}\n              .localizeValue=${this.localizeValue}\n            ></ha-form>\n          `\n        : nothing}\n      ${hiddenActions.length > 0\n        ? html`\n            <ha-button-menu\n              @action=${this._handleAddAction}\n              fixed\n              @closed=${stopPropagation}\n            >\n              <ha-button slot=\"trigger\" appearance=\"filled\" size=\"small\">\n                <ha-svg-icon .path=${mdiPlus} slot=\"start\"></ha-svg-icon>\n                ${this.localize?.(\"ui.components.form-optional-actions.add\") ||\n                \"Add interaction\"}\n              </ha-button>\n              ${hiddenActions.map((action) => {\n                const actionSchema = schemaMap.get(action);\n                return html`\n                  <ha-list-item>\n                    ${this.computeLabel && actionSchema\n                      ? this.computeLabel(actionSchema)\n                      : action}\n                  </ha-list-item>\n                `;\n              })}\n            </ha-button-menu>\n          `\n        : nothing}\n    `;\n  }\n\n  private _handleAddAction(ev: CustomEvent) {\n    const hiddenActions = this._hiddenActions(\n      this.schema.schema,\n      this._displayActions ?? NO_ACTIONS\n    );\n    const index = ev.detail.index;\n    const action = hiddenActions[index];\n    this._displayActions = [...(this._displayActions ?? []), action];\n  }\n\n  static styles = css`\n    :host {\n      display: flex !important;\n      flex-direction: column;\n      gap: 24px;\n    }\n    :host ha-form {\n      display: block;\n    }\n  `;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-form-optional_actions\": HaFormOptionalActions;\n  }\n}\n"],"names":["NO_ACTIONS","HaFormOptionalActions","LitElement","focus","this","updateComplete","renderRoot","querySelector","updated","changedProps","super","has","displayActions","_displayActions","hiddenActions","_hiddenActions","schema","filter","name","data","render","_displaySchema","schemaMap","Map","computeLabel","map","item","html","length","hass","disabled","computeHelper","localizeValue","nothing","_handleAddAction","stopPropagation","mdiPlus","localize","action","actionSchema","get","ev","detail","index","args","memoizeOne","includes","styles","css","attribute","type","Boolean"],"mappings":"wYAmBAA,EAAA,GAGO,MAAPC,UAAAC,EAAAA,GA0BE,WAAAC,SACQC,KAANC,eACAD,KAAAE,WAAAC,cAAA,YAAAJ,OACF,CAEUK,OAAAA,CAAAC,GAER,GADAC,MAAAF,QAAAC,GACAA,EAAAE,IAAA,SACE,MAAAC,EAAA,KAAAC,iBAAAb,EACAc,EAAA,KAAAC,eAAA,KAAAC,OAAAA,OAAAJ,GAIAR,KAAAS,gBAAA,IACKD,KACAE,EAAAG,QAAAC,GAAAA,KAAA,KAAAC,OAEP,CACF,CAiBOC,MAAAA,GACL,MAAAR,EAAA,KAAAC,iBAAAb,EAEAgB,EAAA,KAAAK,eAAA,KAAAL,OAAAA,OAAA,KAAAH,iBAAA,IAKAC,EAAA,KAAAC,eAAA,KAAAC,OAAAA,OAAAJ,GAKAU,EAAA,IAAAC,IAAA,KAAAC,aAAA,KAAAR,OAAAA,OAAAS,KAAAC,GAAA,CAEwCA,EAAAR,KAAWQ,KAAK,IAIxD,OAAAC,EAAAA,EAAA;QACEX,EAAAY,OAAA,EAAAD,EAAAA,EAAA;;sBAGc,KAAAE;sBACA,KAAAV;wBACEH;0BACE,KAAAc;8BACI,KAAAN;+BACC,KAAAO;+BACA,KAAAC;;YAEnBC,EAAAA;QAEJnB,EAAAc,OAAA,EAAAD,EAAAA,EAAA;;wBAGgB,KAAAO;;wBAEAC,EAAAA;;;qCAGaC;kBACnB,KAAAC,WAAA;;gBAGFvB,EAAAW,KAAAa,IACE,MAAAC,EAAAjB,EAAAkB,IAAAF,GACA,OAAAX,EAAAA,EAAA;;sBAEI,KAAAH,cAAAe,EAAA,KAAAf,aAAAe,GAAAD;;iBAIJ;;YAGNL,EAAAA;KAGR,CAEQC,gBAAAA,CAAAO,GACN,MAKAH,EALA,KAAAvB,eAAA,KAAAC,OAAAA,OAAA,KAAAH,iBAAAb,GAIAyC,EAAAC,OAAAC,OAEAvC,KAAAS,gBAAA,IAA4BT,KAAAS,iBAAA,GAA6ByB,EAC3D,C,kBAlIK,SAAAM,GAAA,KAAAd,UAAA,OAAAf,gBAAA8B,EAAAA,EAAAA,IAAA,CAAA7B,EAAAJ,IAAAI,EAAAS,KAAAC,GAAAA,EAAAR,OAAAD,QAAAC,IAAAN,EAAAkC,SAAA5B,OAAA,KAAAG,gBAAAwB,EAAAA,EAAAA,IAAA,CAAA7B,EAAAJ,IAAAI,EAAAC,QAAAS,GAAAd,EAAAkC,SAAApB,EAAAR,S,EAAMjB,EAAA8C,OAAAC,EAAAA,EAAA;;;;;;;;;gCACCC,WAAA,K,2DAEAA,WAAA,K,uDAEAA,WAAA,K,uDAEAA,WAAA,K,yDAEAC,KAAAC,W,2DAEAF,WAAA,K,+DAKAA,WAAA,K,gEAIAA,WAAA,K"}