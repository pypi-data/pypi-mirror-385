%% Retail AI System Architecture
%% Main Flow Diagram
graph TD
    %% Main Flow
    subgraph MainFlow[Main System Flow]
        User([User]) --> Input[User Input]
        Input --> ValidateMsg[Message Validation]
        ValidateMsg --> Router[Router Node]
        
        %% Router to Agents
        Router --> GeneralA[General Agent]
        Router --> ProductA[Product Agent]
        Router --> InventoryA[Inventory Agent]
        Router --> OrdersA[Orders Agent]
        Router --> DIYA[DIY Agent]
        Router --> CompareA[Comparison Agent]
        Router --> RecommendA[Recommendation Agent]
        Router --> ImgProcess[Image Processing]
        
        %% Agents to Output
        GeneralA --> Output[Response]
        ProductA --> Output
        InventoryA --> Output
        OrdersA --> Output
        DIYA --> Output
        CompareA --> Output
        RecommendA --> Output
        ImgProcess --> Router
        
        Output --> User
        
        %% State Management
        State[(Shared State)] --> Router
        State --> GeneralA
        State --> ProductA
        State --> InventoryA
        State --> OrdersA
        State --> DIYA
        State --> CompareA
        State --> RecommendA
        
        %% Tools
        Tools[Tools & Integrations] --> GeneralA
        Tools --> ProductA
        Tools --> InventoryA
        Tools --> OrdersA
        Tools --> DIYA
        Tools --> CompareA
        Tools --> RecommendA
    end
    
    %% Styling
    classDef default fill:#f9f9f9,stroke:#333,stroke-width:2px;
    classDef agent fill:#e1f3d8,stroke:#82c91e,stroke-width:2px;
    classDef state fill:#fff9db,stroke:#fcc419,stroke-width:2px;
    classDef process fill:#e3fafc,stroke:#15aabf,stroke-width:2px;
    classDef io fill:#f8f0fc,stroke:#ae3ec9,stroke-width:2px;
    
    class GeneralA,ProductA,InventoryA,OrdersA,DIYA,CompareA,RecommendA agent;
    class State state;
    class ValidateMsg,Router,ImgProcess process;
    class Input,Output io;

%% Single Agent Structure Diagram
graph TD
    %% Single Agent Structure
    subgraph AgentStructure[Single Agent Structure]
        Prompt[Prompt Template] --> LLM[LLM Model]
        Config[Configuration] --> LLM
        LLM --> Tools[Agent Tools]
        Tools --> VSearch[Vector Search]
        LLM --> Response[Response Generation]
        Response --> Guardrail[Guardrail Check]
        Guardrail -->|Pass| FinalResp[Final Response]
        Guardrail -->|Refine| LLM
    end
    
    %% Styling
    classDef default fill:#f9f9f9,stroke:#333,stroke-width:2px;
    classDef llm fill:#dbe4ff,stroke:#4c6ef5,stroke-width:2px;
    classDef config fill:#fff9db,stroke:#fcc419,stroke-width:2px;
    classDef tool fill:#e1f3d8,stroke:#82c91e,stroke-width:2px;
    classDef guard fill:#ffe3e3,stroke:#ff6b6b,stroke-width:2px;
    
    class LLM llm;
    class Config,Prompt config;
    class Tools,VSearch tool;
    class Guardrail guard;

%% Tools and State Management Diagram
graph TD
    %% Tools & Integrations Detail
    subgraph ToolSystem[Tools System]
        DBricks[Databricks LLM] --> VSearch[Vector Search]
        UCat[Unity Catalog] --> PSearch[Product Search]
        VSearch --> Tools[Agent Tools]
        PSearch --> Tools
        
        Tools --> GeneralT[General Tools]
        Tools --> ProductT[Product Tools]
        Tools --> InventoryT[Inventory Tools]
        Tools --> OrdersT[Order Tools]
    end
    
    %% State Management Detail
    subgraph StateSystem[State Management]
        Messages[Message History] --> SharedState[Shared State]
        UserCtx[User Context] --> SharedState
        Route[Route Decision] --> SharedState
        Docs[Retrieved Documents] --> SharedState
        Config[Configuration] --> SharedState
    end
    
    %% Styling
    classDef default fill:#f9f9f9,stroke:#333,stroke-width:2px;
    classDef tool fill:#e1f3d8,stroke:#82c91e,stroke-width:2px;
    classDef state fill:#fff9db,stroke:#fcc419,stroke-width:2px;
    classDef integration fill:#dbe4ff,stroke:#4c6ef5,stroke-width:2px;
    
    class DBricks,UCat integration;
    class Tools,GeneralT,ProductT,InventoryT,OrdersT tool;
    class Messages,UserCtx,Route,Docs,Config,SharedState state; 