[build-system]
requires = ["setuptools >= 77.0.3"]
build-backend = "setuptools.build_meta"

[project]
name = "share-links"
version = "1.1.0"
authors = [
    { name="Corentin Bettiol", email="corentin@244466666.xyz" },
]
description = "Simple and efficient django app for storing, organizing, and sharing links."
readme = "README.md"
requires-python = ">=3.9"
classifiers = [
    "Programming Language :: Python :: 3",
    "Operating System :: OS Independent",
]
dependencies = [
    "asgiref==3.*",
    "Django==5.*",
    "django-contrib-comments==2.*",
    "django-markdownify==0.*",
    "django-simple-math-captcha==2.*",
    "django-parler==2.*",
    "python-Levenshtein==0.27.*",
    "django-filter==25.*",
]
license = "WTFPL"
license-files = ["LICENSE"]

[project.urls]
Homepage = "https://share-links.l3m.in/"
Documentation = "https://doc.share-links.l3m.in/"
Source = "https://gitlab.com/sodimel/share-links/"
Issues = "https://gitlab.com/sodimel/share-links/-/issues"


[project.optional-dependencies]
PDF = ["weasyprint==65.*"]
dev = [
    "ruff",
    "pre-commit",
    "pytest-django",
    "pytest-cov",
    "django-debug-toolbar",
    "bump-my-version",
    "mkdocs",
    "pymdown-extensions",
    "git-cliff",
    "twine",
]

[tool.setuptools.packages.find]
where = ["."]
include = ["share_links**"]

[tool.setuptools.package-data]
"*" = ["*.html", "*.json", "*.css", "*.js", "*.png", "*.po", "*.mo"]

[tool.ruff]
exclude = [
    ".git",
    ".pytest_cache",
    ".ruff_cache",
    ".venv",
    "build",
    "dist",
    "node_modules",
    "site-packages",
    "venv",
]
line-length = 88
indent-width = 4
target-version = "py312"

[tool.ruff.lint]
select = ["E4", "E7", "E9", "F", "I001"]
ignore = ["E501"]
fixable = ["ALL"]
unfixable = []
dummy-variable-rgx = "^(_+|(_+[a-zA-Z0-9_]*[a-zA-Z0-9]+?))$"

[tool.ruff.lint.per-file-ignores]
"__init__.py" = ["E402"]

[tool.ruff.format]
quote-style = "double"
indent-style = "space"
skip-magic-trailing-comma = false
line-ending = "auto"

[tool.pytest.ini_options]
minversion = "6.0"
addopts = "-ra -q"
testpaths = [
    "tests",
]
console_output_style = "progress"

[tool.coverage.run]
omit = [
    "tests/*",
]

[tool.bumpversion]
current_version = "1.1.0"
parse = """(?x)
    (?P<major>0|[1-9]\\d*)\\.
    (?P<minor>0|[1-9]\\d*)\\.
    (?P<patch>0|[1-9]\\d*)
    (?:
        -
        (?P<pre_l>[a-zA-Z-]+)
        (?P<pre_n>0|[1-9]\\d*)
    )?
"""
serialize = [
    "{major}.{minor}.{patch}-{pre_l}{pre_n}",
    "{major}.{minor}.{patch}",
]

search = "{current_version}"
replace = "{new_version}"
commit = true
tag = true
tag_name = "v{new_version}"
tag_message = "Bump version: {current_version} ‚Üí {new_version}"
message = "Bump version: {current_version} ‚Üí {new_version}"

[tool.bumpversion.parts.pre_l]
values = ["rc", "final"]
optional_value = "final"

[[tool.bumpversion.files]]
filename = "share_links/__version__.py"
[[tool.bumpversion.files]]
filename = "docs/index.md"
[[tool.bumpversion.files]]
filename = "README.md"

[tool.git-cliff]
[tool.git-cliff.changelog]
header = """
# Changelog\n
> All notable changes to this project will be documented in this file.

> *The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
> and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).*\n
"""
body = """
{% if version %}\
    {% if previous.version %}
        ## {{ version | trim_start_matches(pat="v") }} - {{ timestamp | date(format="%Y-%m-%d") }}
        > *[compare {{ previous.version }}..{{ version }}]($REPOcompare/{{ previous.version }}..{{ version }})*
    {% else %}\
        ## [{{ version | trim_start_matches(pat="v") }}] - {{ timestamp | date(format="%Y-%m-%d") }}
    {% endif %}\
{% else %}\
    ## [unreleased]
{% endif -%}
{% for group, commits in commits | group_by(attribute="group") %}
    ### {{ group | upper_first }}
    {% for commit in commits %}
        - {{ commit.message | split(pat="\n") | first | upper_first | trim }}{%- if commit.links %} ({% for link in commit.links %}[{{link.text}}]({{link.href}}){% if not loop.last %}, {% endif %}{% endfor %}){% endif %}\
    {% endfor %}
{% endfor %}\n
"""
footer = """
<!-- generated by git-cliff -->
"""
trim = true
postprocessors = [
    { pattern = '\$REPO', replace = "https://gitlab.com/sodimel/share-links/" },
]

[tool.git-cliff.git]
conventional_commits = true
filter_unconventional = false
filter_commits = false
topo_order = false
sort_commits = "newest"
commit_parsers = [
    { message = "^FEAT", group = "<!-- 0 -->üöÄ Features"},
    { message = "^MAINT", group = "<!-- 1 -->üõ†Ô∏è Maintenance"},
    { message = "^FIX", group = "<!-- 1 -->üêõ Bug Fixes"},
    { message = "^DOC", group = "<!-- 2 -->üìú Documentation"},
    { message = "^TEST", group = "<!-- 3 -->üß™ Tests"},
]
tag_prefix = "v"
link_parsers = [
    { pattern = "#(\\d+)", href = "https://gitlab.com/sodimel/share-links/-/issues/$1"},
]
[tool.git-cliff.remote.gitlab]
owner = "sodimel"
repo = "share-links"
