"use strict";(self.webpackChunkflash=self.webpackChunkflash||[]).push([[57],{384:(t,e,s)=>{s.r(e),s.d(e,{default:()=>h});var n=s(295),i=s.n(n),r=function(t,e){if(!(this instanceof r))return new r(t,e);this.url=t,e=e||{},this.headers=e.headers||{},this.payload=void 0!==e.payload?e.payload:"",this.method=e.method||(this.payload?"POST":"GET"),this.withCredentials=!!e.withCredentials,this.debug=!!e.debug,this.FIELD_SEPARATOR=":",this.listeners={},this.xhr=null,this.readyState=r.INITIALIZING,this.progress=0,this.chunk="",this.lastEventId="",this.addEventListener=function(t,e){void 0===this.listeners[t]&&(this.listeners[t]=[]),-1===this.listeners[t].indexOf(e)&&this.listeners[t].push(e)},this.removeEventListener=function(t,e){if(void 0===this.listeners[t])return;const s=[];this.listeners[t].forEach(function(t){t!==e&&s.push(t)}),0===s.length?delete this.listeners[t]:this.listeners[t]=s},this.dispatchEvent=function(t){if(!t)return!0;this.debug&&console.debug(t),t.source=this;const e="on"+t.type;return(!this.hasOwnProperty(e)||(this[e].call(this,t),!t.defaultPrevented))&&(!this.listeners[t.type]||this.listeners[t.type].every(function(e){return e(t),!t.defaultPrevented}))},this._markClosed=function(){this.xhr=null,this.progress=0,this.chunk="",this._setReadyState(r.CLOSED)},this._setReadyState=function(t){const e=new CustomEvent("readystatechange");e.readyState=t,this.readyState=t,this.dispatchEvent(e)},this._onStreamFailure=function(t){const e=new CustomEvent("error");e.responseCode=t.currentTarget.status,e.data=t.currentTarget.response,this.dispatchEvent(e),this._markClosed()},this._onStreamAbort=function(){this.dispatchEvent(new CustomEvent("abort")),this._markClosed()},this._onStreamProgress=function(t){if(!this.xhr)return;if(this.xhr.status<200||this.xhr.status>=300)return void this._onStreamFailure(t);const e=this.xhr.responseText.substring(this.progress);this.progress+=e.length;const s=(this.chunk+e).split(/(\r\n\r\n|\r\r|\n\n)/g),n=s.pop();s.forEach(function(t){t.trim().length>0&&this.dispatchEvent(this._parseEventChunk(t))}.bind(this)),this.chunk=n},this._onStreamLoaded=function(t){this._onStreamProgress(t),this.dispatchEvent(this._parseEventChunk(this.chunk)),this.chunk="",this._markClosed()},this._parseEventChunk=function(t){if(!t||0===t.length)return null;this.debug&&console.debug(t);const e={id:null,retry:null,data:null,event:null};t.split(/\n|\r\n|\r/).forEach(function(t){const s=t.indexOf(this.FIELD_SEPARATOR);let n,i;if(s>0){const e=" "===t[s+1]?2:1;n=t.substring(0,s),i=t.substring(s+e)}else{if(!(s<0))return;n=t,i=""}n in e&&("data"===n&&null!==e[n]?e.data+="\n"+i:e[n]=i)}.bind(this)),null!==e.id&&(this.lastEventId=e.id);const s=new CustomEvent(e.event||"message");return s.id=e.id,s.data=e.data||"",s.lastEventId=this.lastEventId,s},this._onReadyStateChange=function(){if(this.xhr&&this.xhr.readyState===XMLHttpRequest.HEADERS_RECEIVED){const t={},e=this.xhr.getAllResponseHeaders().trim().split("\r\n");for(const s of e){const[e,...n]=s.split(":"),i=n.join(":").trim();t[e.trim().toLowerCase()]=t[e.trim().toLowerCase()]||[],t[e.trim().toLowerCase()].push(i)}const s=new CustomEvent("open");s.responseCode=this.xhr.status,s.headers=t,this.dispatchEvent(s),this._setReadyState(r.OPEN)}},this.stream=function(){if(!this.xhr){this._setReadyState(r.CONNECTING),this.xhr=new XMLHttpRequest,this.xhr.addEventListener("progress",this._onStreamProgress.bind(this)),this.xhr.addEventListener("load",this._onStreamLoaded.bind(this)),this.xhr.addEventListener("readystatechange",this._onReadyStateChange.bind(this)),this.xhr.addEventListener("error",this._onStreamFailure.bind(this)),this.xhr.addEventListener("abort",this._onStreamAbort.bind(this)),this.xhr.open(this.method,this.url);for(let t in this.headers)this.xhr.setRequestHeader(t,this.headers[t]);this.lastEventId.length>0&&this.xhr.setRequestHeader("Last-Event-ID",this.lastEventId),this.xhr.withCredentials=this.withCredentials,this.xhr.send(this.payload)}},this.close=function(){this.readyState!==r.CLOSED&&this.xhr.abort()},(void 0===e.start||e.start)&&this.stream()};r.INITIALIZING=-1,r.CONNECTING=0,r.OPEN=1,r.CLOSED=2,"undefined"!=typeof exports&&(exports.SSE=r);const h=function(t){var e=t.url,s=t.options,h=t.concat,a=void 0===h||h,o=t.setProps,d=t.done,u=t.update_component,l=(0,n.useState)(""),c=l[0],f=l[1],p=(0,n.useState)(d||!1),E=p[0],v=p[1];return(0,n.useEffect)(function(){if(v(!1),f(""),e){var t=new r(e,s);return t.onmessage=function(e){var s;if("[DONE]"===e.data)return v(!0),void t.close();var n=null===(s=window.dash_clientside)||void 0===s?void 0:s.set_props;if(u&&n)try{var i=JSON.parse(e.data);if(Array.isArray(i)){var r=i[0],h=i[1],a=i[2];switch(r){case"[ERROR]":a.handle_error&&window.alert("Error from SSE stream: ".concat(a.error)),a.reset_props&&a.reset_props.forEach(function(t){if(Array.isArray(t)&&2===t.length){var e=t[0],s=t[1];n(e,s)}}),t.close();break;case"[SINGLE]":n(h,a);break;case"[BATCH]":Array.isArray(a)&&a.forEach(function(t){if(Array.isArray(t)&&2===t.length){var e=t[0],s=t[1];n(e,s)}});break;default:console.warn("Unknown stream type:",r)}}}catch(t){console.log("Not a JSON message, ignoring for update_component",e.data)}},t.onerror=function(e){console.log("Unhandled SSE ERROR",e),t.close()},function(){t.close()}}},[e,s,a]),(0,n.useEffect)(function(){o&&o({value:c,done:E})},[c,E,o]),i().createElement(i().Fragment,null)}}}]);