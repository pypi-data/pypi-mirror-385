[tox]
envlist =
    py{310,311,312}-django42
    py{310,311,312,313}-django{51,52}
    lint
    type

[testenv]
deps =
    django42: django>=4.2,<5.0
    django51: django>=5.1,<5.2
    django52: django>=5.2,<5.3
    pytest>=8.0.0
    pytest-django>=4.8.0
    pytest-recording>=0.13.0
    requests>=2.32.5
    freezegun>=1.5.5
    responses>=0.25.0
    wagtail>=6.3
    beautifulsoup4>=4.12.0
setenv =
    DJANGO_SETTINGS_MODULE = tests.settings
    PYTHONPATH = {toxinidir}
commands = pytest --block-network {posargs}

[testenv:lint]
deps =
    ruff==0.12.9
commands =
    ruff check .
    ruff format --check .

[testenv:type]
deps =
    pyright>=1.1.400
    django>=4.2
    django-types>=0.19.1
    wagtail>=6.3
    beautifulsoup4>=4.12.0
    requests>=2.32.5
    pytest>=8.0.0
    pytest-django>=4.8.0
    freezegun>=1.5.5
    responses>=0.25.0
commands = pyright

[testenv:py313-django52-postgres-loaders]
deps =
    django>=5.2,<5.3
    pytest>=8.0.0
    pytest-django>=4.8.0
    pytest-recording>=0.13.0
    requests>=2.32.5
    freezegun>=1.5.5
    responses>=0.25.0
    wagtail>=6.3
    beautifulsoup4>=4.12.0
    psycopg[binary]>=3.1.0
setenv =
    DJANGO_SETTINGS_MODULE = tests.settings_postgres
    PYTHONPATH = {toxinidir}
commands = pytest -m database_backend --block-network --allowed-hosts=localhost,127.0.0.1,::1 -p no:warnings {posargs}

[testenv:py313-django52-mysql-loaders]
deps =
    django>=5.2,<5.3
    pytest>=8.0.0
    pytest-django>=4.8.0
    pytest-recording>=0.13.0
    requests>=2.32.5
    freezegun>=1.5.5
    responses>=0.25.0
    wagtail>=6.3
    beautifulsoup4>=4.12.0
    mysqlclient>=2.2.0
setenv =
    DJANGO_SETTINGS_MODULE = tests.settings_mysql
    PYTHONPATH = {toxinidir}
commands = pytest -m database_backend --block-network --allowed-hosts=localhost,127.0.0.1,::1 -p no:warnings {posargs}

[gh-actions]
python =
    3.10: py310
    3.11: py311
    3.12: py312
    3.13: py313

[gh-actions:env]
DJANGO_VERSION =
    4.2: django42
    5.1: django51
    5.2: django52
