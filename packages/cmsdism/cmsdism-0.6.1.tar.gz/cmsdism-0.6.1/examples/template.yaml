TemplateFormatVersion: "2025-03-31"
Description: Deploy multiple models to spot anomalies in the JME METSig monitoring element
Resources:
  CustomBackendTorch:
    Type: InferenceService::Tritonserver::Python
    Workspace: jetmet
    Properties:
      Description: Custom backend to run PyTorch models
      Name: metsig-custom-backend
      Image: test/triton-torch-cpu
      MetricKey: output_1
      BuiltinThreshold: false
      AnomalyThreshold: 0.1
      MaxBatchSize: 0
      InputSignature:
        - Name: input_0
          MonitoringElement: JetMET/MET/pfMETT1/Cleaned/METSig
          DataType: FP32
          Dims:
            - -1
            - 51
      OutputSignature:
        - Name: output_0
          DataType: FP32
          Dims:
            - -1
            - 51
        - Name: output_1
          DataType: FP32
          Dims:
            - -1
      CodeUri: examples/models/custom_backend_triton/backend
      ModelUri: examples/models/custom_backend_triton/model.pt
  MetSigPyTorchAutoEncoder:
    Type: InferenceService::Tritonserver::Torchscript
    Workspace: jetmet
    Properties:
      Description: Spot anomalies in the MetSig distribution
      Name: metsig-torchscript-autoencoder
      MetricKey: output_1
      BuiltinThreshold: false
      AnomalyThreshold: 0.1
      InputSignature:
        - Name: input_0
          MonitoringElement: JetMET/MET/pfMETT1/Cleaned/METSig
          DataType: FP32
          Dims:
            - -1
            - 51
      OutputSignature:
        - Name: output_0
          DataType: FP32
          Dims:
            - -1
            - 51
        - Name: output_1
          DataType: FP32
          Dims:
            - -1
      MaxBatchSize: 0
      ModelUri: examples/models/torchscript/model.pt
      Tags:
        - Name: trained-run
          Value: "398407"
      Resources:
        Requests:
          cpu: "0.1m"
          memory: "250m"
        Limits:
          cpu: "1"
          memory: "2Gi"
  MetSigTensorflowAutoEncoder:
    Type: InferenceService::Tritonserver::TensorflowSavedModel
    Workspace: jetmet
    Properties:
      Description: Spot anomalies in the MetSig distribution
      Name: metsig-tensorflow-autoencoder
      MetricKey: output_1
      BuiltinThreshold: false
      AnomalyThreshold: 0.1
      InputSignature:
        - Name: input_0
          MonitoringElement: JetMET/MET/pfMETT1/Cleaned/METSig
          DataType: FP32
          Dims:
            - -1
            - 51
      OutputSignature:
        - Name: output_0
          DataType: FP32
          Dims:
            - -1
            - 51
        - Name: output_1
          DataType: FP32
          Dims:
            - -1
      MaxBatchSize: 0
      SavedModelUri: examples/models/tensorflow/
      Resources:
        Requests:
          cpu: "0.1m"
          memory: "250m"
        Limits:
          cpu: "1"
          memory: "2Gi"
  MetSigOnnxAutoEncoder:
    Type: InferenceService::Tritonserver::ONNX
    Workspace: jetmet
    Properties:
      Description: Spot anomalies in the MetSig distribution
      Name: metsig-onnx-autoencoder
      MetricKey: Identity_1:0
      BuiltinThreshold: false
      AnomalyThreshold: 0.1
      InputSignature:
        - Name: input_0
          MonitoringElement: JetMET/MET/pfMETT1/Cleaned/METSig
          DataType: FP32
          Dims:
            - -1
            - 51
      OutputSignature:
        - Name: "Identity:0"
          DataType: FP32
          Dims:
            - -1
            - 51
        - Name: "Identity_1:0"
          DataType: FP32
          Dims:
            - -1
      MaxBatchSize: 0
      ModelUri: examples/models/onnx/model.onnx
      Resources:
        Requests:
          cpu: "0.1m"
          memory: "250m"
        Limits:
          cpu: "1"
          memory: "2Gi"
  MetSigXGBoostRegressor:
    Type: InferenceService::MLServer::XGBoost
    Workspace: jetmet
    Properties:
      Description: Spot anomalies in the MetSig distribution
      Name: metsig-xgboost-autoencoder
      MetricKey: output_1
      BuiltinThreshold: false
      AnomalyThreshold: 0.1
      InputSignature:
        - Name: input_0
          MonitoringElement: JetMET/MET/pfMETT1/Cleaned/METSig
          DataType: FP32
          Dims:
            - -1
            - 51
      OutputSignature:
        - Name: output_0
          DataType: FP32
          Dims:
            - -1
            - 51
        - Name: output_1
          DataType: FP32
          Dims:
            - -1
      CodeUri: examples/models/xgboost/
      Handler: app.Handler
      ModelUri: examples/models/xgboost/0001.ubj
      Resources:
        Requests:
          cpu: "0.1m"
          memory: "250m"
        Limits:
          cpu: "1"
          memory: "2Gi"
  MetSigLightGBMRegressor:
    Type: InferenceService::MLServer::SKLearn
    Workspace: jetmet
    Properties:
      Description: Spot anomalies in the MetSig distribution
      Name: metsig-lightgbm-autoencoder
      MetricKey: output_1
      BuiltinThreshold: false
      AnomalyThreshold: 0.1
      InputSignature:
        - Name: input_0
          MonitoringElement: JetMET/MET/pfMETT1/Cleaned/METSig
          DataType: FP32
          Dims:
            - -1
            - 51
      OutputSignature:
        - Name: output_0
          DataType: FP32
          Dims:
            - -1
            - 51
        - Name: output_1
          DataType: FP32
          Dims:
            - -1
      CodeUri: examples/models/sklearn_lightgbm/
      Handler: app.Handler
      ModelUri: examples/models/sklearn_lightgbm/model.joblib
      Image: registry.cern.ch/docker.io/seldonio/mlserver:1.5.0
      Resources:
        Requests:
          cpu: "0.1m"
          memory: "250m"
        Limits:
          cpu: "1"
          memory: "2Gi"
  MetSigNMFRegressor:
    Type: InferenceService::MLServer::SKLearn
    Workspace: jetmet
    Properties:
      Description: Spot anomalies in the MetSig distribution
      Name: metsig-nmf-autoencoder
      MetricKey: output_1
      BuiltinThreshold: false
      AnomalyThreshold: 0.1
      InputSignature:
        - Name: input_0
          MonitoringElement: JetMET/MET/pfMETT1/Cleaned/METSig
          DataType: FP32
          Dims:
            - -1
            - 51
      OutputSignature:
        - Name: output_0
          DataType: FP32
          Dims:
            - -1
            - 51
        - Name: output_1
          DataType: FP32
          Dims:
            - -1
      CodeUri: examples/models/sklearn_nmf/
      Handler: app.Handler
      ModelUri: examples/models/sklearn_nmf/model.joblib
      Resources:
        Requests:
          cpu: "0.1m"
          memory: "250m"
        Limits:
          cpu: "1"
          memory: "2Gi"
