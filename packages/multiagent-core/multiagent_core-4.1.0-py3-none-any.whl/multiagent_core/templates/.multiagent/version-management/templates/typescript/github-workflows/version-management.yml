# GitHub Actions Workflow Template - TypeScript/Node.js Semantic Versioning
# Purpose: Automated version management with semantic-release for TypeScript/Node.js projects
# Variables: {{PROJECT_NAME}}, {{PACKAGE_NAME}}, {{NODE_VERSION}}, {{BRANCH_NAME}}
# Generated by: version-management subsystem
# Template location: ~/.multiagent/version-management/templates/typescript/github-workflows/version-management.yml
#
# This workflow automatically:
# - Analyzes commits using Conventional Commits format
# - Bumps version (major/minor/patch) based on commit types
# - Updates VERSION file and package.json
# - Builds and publishes package to npm
# - Creates GitHub release with changelog
#
# Required secrets:
# - GITHUB_TOKEN (automatically provided)
# - NPM_TOKEN (must be configured manually)

name: {{PROJECT_NAME}} Version Management & Release

on:
  push:
    branches:
      - {{BRANCH_NAME}}

permissions:
  contents: write
  issues: write
  pull-requests: write

jobs:
  release:
    name: Release
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '{{NODE_VERSION}}'

      - name: Install dependencies
        run: npm ci

      - name: Build
        run: npm run build

      - name: Run tests
        run: npm test

      - name: Release
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          NPM_TOKEN: ${{ secrets.NPM_TOKEN }}
        run: npx semantic-release

      - name: {{PROJECT_NAME}} version management complete
        if: always()
        run: |
          echo "âœ… {{PROJECT_NAME}} version management workflow completed"
          echo "ðŸ“¦ Current version: $(node -p \"require('./package.json').version\" 2>/dev/null || echo 'unknown')"
          echo ""
          echo "ðŸš€ Project uses semantic versioning with conventional commits"
          echo "ðŸ“– Install/update with: npm install {{PACKAGE_NAME}}@latest"
          echo "ðŸ“¦ Published to npm automatically on version bump"
