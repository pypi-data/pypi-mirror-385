#!/usr/bin/env python3
"""
Sample Data Analysis Examples

This script shows how to use the Vulnerability Analyzer with the provided sample files.
"""

import os
import sys
from pathlib import Path

# Add the src directory to Python path
project_root = Path(__file__).parent.parent
sys.path.insert(0, str(project_root / 'src'))

import vulnerability_analyzer


def example_basic_usage():
    """Example: Basic analyzer initialization and database info"""
    print("Example: Basic Analyzer Usage")
    print("-" * 40)
    
    # Initialize the analyzer
    analyzer = vulnerability_analyzer.VulnerabilityAnalyzer()
    
    # Get database information
    info = analyzer.get_database_info()
    stats = info['statistics']
    print(f"Database contains {stats['total_vulnerabilities']:,} vulnerabilities")
    print(f"Sources: {', '.join(stats.get('by_source', {}).keys())}")
    print(f"Database type: {info.get('database_type', 'Unknown')}")
    print()


def example_service_analysis():
    """Example: Analyzing services for vulnerabilities"""
    print("Example: Service Vulnerability Analysis")
    print("-" * 40)
    
    # Initialize analyzer
    analyzer = vulnerability_analyzer.VulnerabilityAnalyzer()
    
    # Example services (based on sample data)
    sample_services = [
        {'port': 22, 'service': 'ssh', 'product': 'OpenSSH', 'version': '6.2'},
        {'port': 80, 'service': 'http', 'product': 'Apache httpd', 'version': '2.4.16'},
        {'port': 3306, 'service': 'mysql', 'product': 'MySQL', 'version': '5.0.54'}
    ]
    
    # Analyze vulnerabilities
    host_ip = "192.168.1.10"
    results = analyzer.analyze_service_vulnerabilities(host_ip, sample_services)
    
    print(f"Analyzed host: {host_ip}")
    print(f"   Services checked: {len(sample_services)}")
    print(f"   Vulnerabilities found: {results.get('vulnerabilities_found', 0)}")
    print(f"   Risk score: {results.get('risk_score', 0):.1f}/10")
    
    # Show vulnerabilities
    vulnerabilities = results.get('vulnerabilities', [])
    if vulnerabilities:
        print("   Sample vulnerabilities:")
        for vuln in vulnerabilities[:3]:
            cve = vuln.get('cve_id', 'No CVE')
            severity = vuln.get('severity', 'Unknown')
            service = vuln.get('service', 'Unknown')
            print(f"     - {cve} ({severity}) affecting {service}")
    
    print()


def example_quick_assessment():
    """Example: Quick comprehensive assessment"""
    print("âš¡ Example: Quick Assessment")
    print("-" * 40)
    
    # Sample network data
    sample_hosts = [
        {
            'ip': '192.168.1.10',
            'services': [
                {'port': 22, 'service': 'ssh', 'product': 'OpenSSH', 'version': '6.2'},
                {'port': 80, 'service': 'http', 'product': 'Apache httpd', 'version': '2.4.16'}
            ]
        }
    ]
    
    sample_traffic = [
        {
            'src_ip': '192.168.1.100',
            'dst_ip': '192.168.1.10', 
            'protocol': 'HTTP',
            'suspicious_indicators': ['exploit_attempt']
        }
    ]
    
    # Perform quick assessment
    results = vulnerability_analyzer.quick_scan(target_hosts=sample_hosts, traffic_data=sample_traffic)
    
    print(f"Quick assessment completed")
    print(f"   Overall risk score: {results.get('overall_risk_score', 0):.1f}/10") 
    print(f"   Hosts analyzed: {results.get('hosts_analyzed', 0)}")
    print(f"   Total vulnerabilities: {results.get('total_vulnerabilities', 0)}")
    print(f"   Threats detected: {results.get('threats_detected', 0)}")
    
    print()


def main():
    """Run all examples"""
    print("VULNERABILITY ANALYZER - SAMPLE DATA EXAMPLES")
    print("=" * 60)
    print("This demo shows how to use the Vulnerability Analyzer")
    print("with sample data similar to the provided files.")
    print("=" * 60)
    print()
    
    # Run examples
    example_basic_usage()
    example_service_analysis()
    example_quick_assessment()
    
    print("All examples completed!")
    print()
    print("ðŸ“š Next Steps:")
    print("- Run comprehensive_demo.py for advanced testing")
    print("- Check the sample_data/ directory for input files")
    print("- Review the generated reports and outputs")


if __name__ == "__main__":
    main()