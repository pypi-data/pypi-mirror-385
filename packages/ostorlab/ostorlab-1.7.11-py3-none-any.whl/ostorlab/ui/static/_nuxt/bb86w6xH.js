import{Y as z,c as W,_ as X}from"./BaCn2Olm.js";import{d as M,x as u,y as n,B as a,C as s,a4 as V,z as o,A as f,ai as C,g as m,a0 as q,aO as Z,b9 as D,aG as I,D as r,Z as b,aL as T,a1 as H,aN as y,a2 as v,T as c,_ as h,ba as J,ah as Q,aj as _,X as x}from"#entry";import{d as O,V as w,D as ee,O as te,e as N,u as ae,b as R,a as se}from"./vRc2BJuY.js";import{s as ie,V as ne,a as le}from"./B0MvoCbX.js";import{S as oe}from"./BOdr3NOm.js";import{r as re,D as de}from"./9jHEIiRU.js";import{_ as E}from"./DlAUqK2U.js";import{V as ue}from"./CiZyL2M5.js";import{u as pe}from"./DIRTgmGz.js";import{D as ce}from"./waNOlr4q.js";import{V as P}from"./BqivZogD.js";import{V as L}from"./D2lCyhx0.js";import{V as A}from"./DicsgTSm.js";import"./Debz9GBs.js";import"./D4UZsoDo.js";import"./EcQIca6j.js";const me={info:1,important:2,secure:3,hardening:4,potentially:5,low:6,medium:7,high:8,critical:9},ge=M({name:"VulnzTable",components:{DfRisk:O},props:{vulnz:{type:Array,required:!0,default:()=>[]},vulnerabilityPreviewLoading:{type:Boolean,default:!1},selectedVulnerabilityKey:{type:String,required:!0}},emits:["goToDetail","goToDetailNewTab","showVulnDetails"],data(){return{headers:[{title:"Show",value:"show",align:"left",width:"4%"},{title:"Risk | CVSS",value:"risk",align:"left",width:"7%"},{title:"Title",value:"title",align:"left",minWidth:"350"},{title:"Short description",value:"description",align:"left"}]}},computed:{kbVulnerabilities(){const e=[];for(const t of this.vulnz)if(t?.kb?.title==="Use of Outdated Vulnerable Component"){let k=!1;for(const d of t.vulnerabilities.vulnerabilities)if(d?.metadata===null||d?.metadata===void 0)k||(e.push({key:d?.id,goToVulnId:!1,risk:d?.customRiskRating,title:t.kb.title,securityIssue:t.kb.securityIssue,privacyIssue:t.kb.privacyIssue,targetedByMalware:t.kb.targetedByMalware,targetedByRansomware:t.kb.targetedByRansomware,targetedByNationState:t.kb.targetedByNationState,hasPublicExploit:t.kb.hasPublicExploit,cvssV3:t.highestCvssV3BaseScore,description:t.kb.shortDescription,descriptionFormat:t.kb.shortDescriptionFormat,kb:t.kb}),k=!0);else{const S=d?.metadata?.find(p=>p.name==="dependency_name").value,$=d?.metadata?.find(p=>p.name==="dependency_version").value;e.push({key:d.id,goToVulnId:!0,risk:d.customRiskRating,cvssV3:d.customCvssV3BaseScore,title:`${t.kb.title} for ${S} version ${$}`,securityIssue:t.kb.securityIssue,privacyIssue:t.kb.privacyIssue,targetedByMalware:t.kb.targetedByMalware,targetedByRansomware:t.kb.targetedByRansomware,targetedByNationState:t.kb.targetedByNationState,hasPublicExploit:t.kb.hasPublicExploit,description:t.kb.shortDescription,descriptionFormat:t.kb.shortDescriptionFormat,kb:t.kb})}}else e.push({key:t?.kb?.title,goToVulnId:!1,risk:t.highestRiskRating,title:t?.kb?.title,securityIssue:t?.kb?.securityIssue,privacyIssue:t?.kb?.privacyIssue,targetedByMalware:t?.kb?.targetedByMalware,targetedByRansomware:t?.kb?.targetedByRansomware,targetedByNationState:t?.kb?.targetedByNationState,hasPublicExploit:t?.kb?.hasPublicExploit,cvssV3:t.highestCvssV3BaseScore,description:t?.kb?.shortDescription,descriptionFormat:t?.kb?.shortDescriptionFormat,kb:t.kb});return ie(e).by([{desc:t=>me[t?.risk?.toLocaleLowerCase()||""]},{desc:t=>t.cvssV3}])}},methods:{goToDetail(e){this.$emit("goToDetail",e)},goToDetailNewTab(e){this.$emit("goToDetailNewTab",e)},showVulnDetails(e){this.$emit("showVulnDetails",e)}}}),fe=["onClick","onMouseup"],be=["onClick","onMouseup"];function ye(e,t,k,d,S,$){const p=m("DfRisk");return n(),u("div",null,[a(re,{hover:"",headers:e.headers,items:e.kbVulnerabilities,"items-per-page":-1},{"item.risk":s(({item:i})=>[a(p,{"cvss-score":i.cvssV3,risk:i.risk,class:"cursor-pointer",onClick:g=>e.goToDetail(i),onMouseup:C(g=>e.goToDetailNewTab(i),["middle"])},null,8,["cvss-score","risk","onClick","onMouseup"])]),"item.title":s(({item:i})=>[o("div",{class:"cursor-pointer",onClick:g=>e.goToDetail(i),onMouseup:C(g=>e.goToDetailNewTab(i),["middle"])},f(i.title),41,fe)]),"item.description":s(({item:i})=>[o("div",{class:"cursor-pointer",onClick:g=>e.goToDetail(i),onMouseup:C(g=>e.goToDetailNewTab(i),["middle"])},f(i.description),41,be)]),"item.show":s(({item:i})=>[a(V,{size:"small",variant:"text",disabled:e.vulnerabilityPreviewLoading===!0&&i.key!==e.selectedVulnerabilityKey,loading:e.vulnerabilityPreviewLoading===!0&&i.key===e.selectedVulnerabilityKey,icon:"mdi-magnify",onClick:g=>e.showVulnDetails(i)},null,8,["disabled","loading","onClick"])]),_:2},1032,["headers","items"])])}const ve=E(ge,[["render",ye]]),he=M({name:"VulnerabilityDetailDialog",components:{VulnerabilityDetail:ne},props:{modelValue:{type:Boolean,default:!1},vuln:{type:Object,default:null},scanId:{type:Number,required:!0},scanner:{type:Object,required:!0}},emits:["update:modelValue","update:loading","afterLeave"],data(){return{loading:!1,dialog:!1}},computed:{vulnKey(){return this.vuln?.key}},watch:{modelValue:{immediate:!0,handler(e){this.dialog=e}},dialog(e){this.$emit("update:modelValue",e)},loading(e){this.$emit("update:loading",e),this.vuln!==null&&this.vuln!==void 0&&(e===!0?this.dialog=!1:this.dialog=!0)}}}),ke={id:"vulnerability-detail-container"};function De(e,t,k,d,S,$){const p=m("VulnerabilityDetail");return n(),u("div",ke,[a(ue,{ref:"dialogRef",modelValue:e.dialog,"onUpdate:modelValue":t[1]||(t[1]=i=>e.dialog=i),scrollable:"",attach:"",eager:"","max-width":"50%",transition:"slide-x-transition",class:"ml-auto",onAfterLeave:t[2]||(t[2]=i=>e.$emit("afterLeave"))},{default:s(()=>[a(w,{class:"dialog-card pa-2",loading:e.loading,style:{"min-height":"100vh"}},{default:s(()=>[a(p,{loading:e.loading,"onUpdate:loading":t[0]||(t[0]=i=>e.loading=i),"vuln-title":e.vulnKey,"scan-id":e.scanId,scanner:e.scanner,"show-breadcrumbs":!1},null,8,["loading","vuln-title","scan-id","scanner"])]),_:1},8,["loading"])]),_:1},8,["modelValue"])])}const Ve=E(he,[["render",De]]),B=1,we=M({name:"Index",components:{DfRisk:O,OXOAssets:te,DfScanProgress:ce,DfConfirmationModal:de,VulnzTable:ve,VunerabilityDetailDialog:Ve,DfBreadcrumbs:ee},data(){return{scanner:{endpoint:"",name:"",apiKey:""},vulenrabilityLoading:!1,vulnDetailsDialog:!1,selectedVulnerability:null,options:{page:1,itemsPerPage:15},vulnerabilityService:new le(this.$axios),scanService:new oe(this.$axios),kb:null,title:"",progress:"UNKNOWN",riskRating:"UNKNOWN",vulns:[],loadingDialog:!0,stopBtnLoading:!1,deleteScanDialog:!1,archiveBtnLoading:!1,stopScanDialog:!1,assets:[],agentGroup:null,show:!1,editorLanguage:"yaml",editorOptions:{theme:"vs",wordWrap:"on",wordWrapColumn:"on",fontFamily:"Fira Code",automaticLayout:!0,minimap:{enabled:!1},readOnly:!0},breadcrumbs:[{text:"scans",disabled:!1,to:"/scan/list",exact:!0},{text:"Scan",disabled:!1,to:`/scan/${(this._.provides[D]||this.$route).params.scan}`,exact:!0,scans:[]}]}},computed:{...Z(pe,["scanners"]),scanId(){return(this._.provides[D]||this.$route).params.scan===void 0||(this._.provides[D]||this.$route).params.scan===null?(this.reportError("Scan ID not provided"),0):parseInt((this._.provides[D]||this.$route).params.scan)},AgentGroupYaml(){const e=this.agentGroup?.yamlSource;return e==null?"No agent group found":`# Agent Group ID: ${this.agentGroup?.id}
${z.stringify(z.parse(e))}`},totalVulnerabilities(){return this.vulns?.length||0}},async mounted(){const e=this.scanners.find(t=>N(t.endpoint)===(this._.provides[D]||this.$route).params.scanner);e===void 0?(this.reportError("Scanner not found"),this.$router.push({name:"scan-list"})):(this.scanner=e,await Promise.allSettled([this.fetchKBVulnerabilities(),this.fetchScans()]),this.updateBreadcrumbs())},methods:{...q(ae,["reportError","reportInfo","reportSuccess"]),async fetchKBVulnerabilities(){try{this.loadingDialog=!0;const e=await this.vulnerabilityService.getKBVulnerabilities(this.scanner,this.scanId);this.kb=e,this.vulns=e?.kbVulnerabilities||[],this.title=e?.title,this.assets=e?.assets,this.progress=e?.progress?.toLowerCase(),this.riskRating=e?.riskRating?.toLowerCase(),this.agentGroup=e?.agentGroup}catch(e){this.reportError(`An error was encountered while fetching the scan: ${e}`)}finally{this.loadingDialog=!1}},showVulnDetails(e){this.selectedVulnerability=e,this.vulnDetailsDialog=!0},goToDetail(e){this.$router.push({name:"scan-scanner-scan-vuln-vuln",params:{scan:this.scanId,scanner:N(this.scanner.endpoint),vuln:e.key??e.kb.id}})},goToDetailNewTab(e){const t=this.$router.resolve(`/scan/${N(this.scanner.endpoint)}/${this.scanId}/vuln/${e.key??e.kb.id}`);window.open(t.href,"_blank")},async fetchScans(){this.breadcrumbs[B].scans=await this.scanService.getScans(this.scanner,{page:1,numberElements:20})},updateBreadcrumbs(){(this.breadcrumbs[B]?.scans||[])?.find(t=>t.id===this.kb?.id)===void 0&&(this.breadcrumbs[B].scans=[...this.breadcrumbs[B]?.scans||[],this.kb])},async stopScan(){try{this.stopBtnLoading=!0,await this.scanService.stopScans(this.scanner,[this.scanId]),await this.fetchKBVulnerabilities()}catch(e){this.reportError(e?.message||"Error Stopping scan.")}finally{this.stopBtnLoading=!1}},async deleteScan(){try{this.loadingDialog=!0,await this.scanService.deleteScans(this.scanner,[this.scanId]),this.reportSuccess("Scan deleted successfully"),this.$router.push("/scan/list")}catch(e){this.reportError(`An error occurred while deleting the scan: ${e.message}`)}finally{this.loadingDialog=!1}},async exportScan(){try{this.loadingDialog=!0,this.reportInfo("Scan export in progress, this process may take some time."),await this.scanService.exportScan(this.scanner,this.scanId),this.reportSuccess("Scan exported successfully")}catch(e){this.reportError(e?.message||"An error occurred while exporting the scan")}finally{this.loadingDialog=!1}}}}),Se=W(X),$e={key:0,class:"mb-0"},Te={key:1},Be={key:1},Ce={key:0,class:"mb-0"},Ie={key:1},Ne={key:1},Re={key:0},Le={key:1};function Ae(e,t,k,d,S,$){const p=m("DfConfirmationModal"),i=m("VunerabilityDetailDialog"),g=m("DfBreadcrumbs"),G=m("OXOAssets"),K=m("DfScanProgress"),U=m("DfRisk"),Y=Se,F=m("VulnzTable");return n(),u("div",null,[a(p,{modelValue:e.deleteScanDialog,"onUpdate:modelValue":t[0]||(t[0]=l=>e.deleteScanDialog=l),title:"Are you sure you would like to archive this scan?","cancel-button-text":"Cancel","confirm-button-text":"Delete","cancel-icon":"mdi-close","confirm-icon":"mdi-check","confirm-button-color":"secondary","card-icon":"mdi-archive-arrow-down-outline",onConfirm:e.deleteScan},null,8,["modelValue","onConfirm"]),a(p,{modelValue:e.stopScanDialog,"onUpdate:modelValue":t[1]||(t[1]=l=>e.stopScanDialog=l),title:"Are you sure you would like to stop the scan?",description:"A stopped scan cannot be resumed.","cancel-button-text":"Cancel","confirm-button-text":"Stop","cancel-icon":"mdi-close","confirm-icon":"mdi-check","confirm-button-color":"secondary","card-icon":"mdi-stop-circle-outline",onConfirm:e.stopScan},null,8,["modelValue","onConfirm"]),a(i,{loading:e.vulenrabilityLoading,"onUpdate:loading":t[2]||(t[2]=l=>e.vulenrabilityLoading=l),"model-value":e.vulnDetailsDialog,"onUpdate:modelValue":t[3]||(t[3]=l=>e.vulnDetailsDialog=l),vuln:e.selectedVulnerability,"scan-id":e.scanId,scanner:e.scanner,onAfterLeave:t[4]||(t[4]=l=>e.selectedVulnerability=null)},null,8,["loading","model-value","vuln","scan-id","scanner"]),a(g,{"scan-id":e.scanId,breadcrumbs:e.breadcrumbs,scanner:e.scanner,class:"mb-5"},null,8,["scan-id","breadcrumbs","scanner"]),a(w,{class:"d-flex pl-3 py-3 mt-3",variant:"outlined"},{default:s(()=>[a(L,{bottom:""},{activator:s(({props:l})=>[a(V,I({disabled:e.progress==="stopped"||e.progress==="done"||e.loadingDialog===!0,loading:e.stopBtnLoading,class:"mr-2"},l,{onClick:t[5]||(t[5]=j=>e.stopScanDialog=!0)}),{default:s(()=>[a(b,{start:""},{default:s(()=>[...t[9]||(t[9]=[r(" mdi-stop-circle-outline ",-1)])]),_:1}),t[10]||(t[10]=r(" Stop ",-1))]),_:1},16,["disabled","loading"])]),default:s(()=>[t[11]||(t[11]=o("span",null,"Stops scan. Stopped scans can't be restarted.",-1))]),_:1}),a(L,{bottom:""},{activator:s(({props:l})=>[a(V,I({loading:e.archiveBtnLoading,class:"mr-2"},l,{onClick:t[6]||(t[6]=j=>e.deleteScanDialog=!0)}),{default:s(()=>[a(b,{start:""},{default:s(()=>[...t[12]||(t[12]=[r(" mdi-delete-outline ",-1)])]),_:1}),t[13]||(t[13]=r(" Delete ",-1))]),_:1},16,["loading"])]),default:s(()=>[t[14]||(t[14]=o("span",null,"Archives scan and removes all findings and artifacts.",-1))]),_:1}),a(L,{bottom:""},{activator:s(({props:l})=>[a(V,I({class:"mr-2"},l,{onClick:e.exportScan}),{default:s(()=>[a(b,{start:""},{default:s(()=>[...t[15]||(t[15]=[r(" mdi-file-export-outline ",-1)])]),_:1}),t[16]||(t[16]=r(" Export ",-1))]),_:1},16,["onClick"])]),default:s(()=>[t[17]||(t[17]=o("span",null,"Exports scan to a zip file.",-1))]),_:1})]),_:1}),a(P,{class:"mt-4 align-stretch"},{default:s(()=>[a(A,{cols:"12",lg:"12"},{default:s(()=>[a(w,{loading:e.loadingDialog,height:"100%",variant:"outlined"},{default:s(()=>[a(R,null,{default:s(()=>[a(b,{start:""},{default:s(()=>[...t[18]||(t[18]=[r(" mdi-shield-check-outline ",-1)])]),_:1}),t[19]||(t[19]=r(" Scan Details ",-1))]),_:1}),a(T),a(H,null,{default:s(()=>[a(y,null,{default:s(()=>[a(v,{class:"d-flex align-center"},{default:s(()=>[t[20]||(t[20]=o("p",{class:"mb-0 mr-2"}," Title: ",-1)),e.title!==null&&e.title!==""?(n(),u("p",$e,f(e.title),1)):(n(),u("div",Te,[e.loadingDialog===!0?(n(),c(h,{key:0,variant:"tonal",size:"small",label:"",style:{width:"80px"}})):(n(),u("span",Be,"-"))]))]),_:1})]),_:1}),a(y,null,{default:s(()=>[a(v,{class:"d-flex align-center"},{default:s(()=>[t[21]||(t[21]=o("p",{class:"mb-0 mr-2"}," Targets: ",-1)),e.loadingDialog===!0?(n(),c(h,{key:0,variant:"tonal",label:"",style:{width:"90px"}})):(n(),c(G,{key:1,assets:e.assets},null,8,["assets"]))]),_:1})]),_:1}),a(y,null,{default:s(()=>[a(v,{class:"d-flex align-center"},{default:s(()=>[t[22]||(t[22]=o("p",{class:"mb-0 mr-2"}," Progress: ",-1)),e.loadingDialog===!0?(n(),c(h,{key:0,variant:"tonal",size:"small",label:"",style:{width:"60px"}})):(n(),c(K,{key:1,progress:e.progress},null,8,["progress"]))]),_:1})]),_:1}),a(y,null,{default:s(()=>[a(v,{class:"d-flex align-center"},{default:s(()=>[t[23]||(t[23]=o("p",{class:"mb-0 mr-2"}," Risk Rating: ",-1)),e.loadingDialog===!0?(n(),c(h,{key:0,variant:"tonal",size:"small",label:"",style:{width:"60px"}})):(n(),c(U,{key:1,risk:e.riskRating},null,8,["risk"]))]),_:1})]),_:1}),a(y,null,{default:s(()=>[a(v,{class:"d-flex align-center"},{default:s(()=>[t[24]||(t[24]=o("p",{class:"mb-0 mr-2"}," Date: ",-1)),e.loadingDialog===!1&&e.kb!==null?(n(),u("p",Ce,f(e.$moment(e.kb.createdTime).format("MMMM Do YYYY, k:mm:ss")),1)):(n(),u("div",Ie,[e.loadingDialog===!0?(n(),c(h,{key:0,variant:"tonal",size:"x-small",label:"",style:{width:"180px"}})):(n(),u("span",Ne,"-"))]))]),_:1})]),_:1}),a(y,null,{default:s(()=>[a(v,{class:"d-flex align-center"},{default:s(()=>[t[26]||(t[26]=o("p",{class:"mb-0 mr-2"}," Scanner: ",-1)),o("div",null,[(e.scanner.name||"").trim()!==""?(n(),u("p",Re,[r(f(e.scanner.name)+" (",1),o("code",null,f(e.scanner.endpoint),1),t[25]||(t[25]=r(") ",-1))])):(n(),u("code",Le,f(e.scanner.endpoint),1))])]),_:1})]),_:1})]),_:1})]),_:1},8,["loading"])]),_:1})]),_:1}),a(w,{class:"mt-12",variant:"outlined"},{default:s(()=>[a(R,{class:"cursor-pointer",onClick:t[7]||(t[7]=l=>e.show=!e.show)},{default:s(()=>[a(P,{align:"center",justify:"space-between",class:"w-100"},{default:s(()=>[a(A,{class:"d-flex align-center"},{default:s(()=>[a(b,{start:""},{default:s(()=>[...t[27]||(t[27]=[r(" mdi-format-list-group ",-1)])]),_:1}),t[28]||(t[28]=o("span",null,"Agent Group",-1))]),_:1}),a(A,{class:"d-flex justify-end"},{default:s(()=>[a(V,{icon:e.show?"mdi-chevron-up":"mdi-chevron-down",elevation:"0"},null,8,["icon"])]),_:1})]),_:1})]),_:1}),a(T),a(J,null,{default:s(()=>[Q(o("div",null,[a(T),a(se,null,{default:s(()=>[a(Y,{modelValue:e.AgentGroupYaml,"onUpdate:modelValue":t[8]||(t[8]=l=>e.AgentGroupYaml=l),lang:e.editorLanguage,options:e.editorOptions,style:{"min-height":"300px"}},null,8,["modelValue","lang","options"])]),_:1})],512),[[_,e.show]])]),_:1})]),_:1}),a(w,{loading:e.loadingDialog,class:"mt-12",justify:"space-around",variant:"outlined"},{default:s(()=>[a(R,null,{default:s(()=>[a(b,{start:""},{default:s(()=>[...t[29]||(t[29]=[r(" mdi-bug-outline ",-1)])]),_:1}),t[30]||(t[30]=r(" Vulnerabilities ",-1)),e.totalVulnerabilities!==null?(n(),c(h,{key:0,size:"small",class:"ml-2"},{default:s(()=>[r(f(e.totalVulnerabilities),1)]),_:1})):x("",!0)]),_:1}),a(T),a(F,{"vulnerability-preview-loading":e.vulenrabilityLoading,vulnz:e.vulns,"selected-vulnerability-key":e.selectedVulnerability!==null?e.selectedVulnerability.key:null,onGoToDetail:e.goToDetail,onGoToDetailNewTab:e.goToDetailNewTab,onShowVulnDetails:e.showVulnDetails},null,8,["vulnerability-preview-loading","vulnz","selected-vulnerability-key","onGoToDetail","onGoToDetailNewTab","onShowVulnDetails"])]),_:1},8,["loading"])])}const Je=E(we,[["render",Ae],["__scopeId","data-v-e8c5b85a"]]);export{Je as default};
