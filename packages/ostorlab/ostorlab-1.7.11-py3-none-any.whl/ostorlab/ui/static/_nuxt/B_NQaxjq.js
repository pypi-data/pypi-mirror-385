import{d as F,a0 as re,J as ie,K as de,k as A,au as p,aJ as ce,aK as ue,B as t,aG as P,ac as me,V as k,aL as H,x as y,y as d,g as f,C as a,a4 as w,D as r,Z as B,_ as pe,A as v,aM as fe,a1 as ge,U,T as D,aN as he,z as Se,a2 as be,aO as ve,X as ye}from"#entry";import{d as De,O as ke,e as Ve,u as Pe,V as $,b as _,D as we,f as Ce}from"./vRc2BJuY.js";import{S as Te}from"./BOdr3NOm.js";import{D as Ae}from"./waNOlr4q.js";import{D as Be,c as $e,a as Re,b as Ee,d as Le,u as Ie,p as Oe,e as Ne,f as Me,g as Ge,h as Fe,i as He,V as I,j as O,k as N,l as M,m as Ue,n as _e,o as Xe,q as Ye}from"./9jHEIiRU.js";import{_ as X}from"./DlAUqK2U.js";import{S as je}from"./kh6oSBUy.js";import{u as qe}from"./DIRTgmGz.js";import{V as ze}from"./BqivZogD.js";import{V as G}from"./DicsgTSm.js";import"./D2lCyhx0.js";import"./EcQIca6j.js";import"./CiZyL2M5.js";const Je=[{title:"Target",align:"left",sortable:!1,key:"asset"},{title:"Title",align:"left",sortable:!1,key:"title",width:"24%"},{title:"Created time (UTC)",align:"left",sortable:!1,key:"CreatedTime",width:"14%"},{title:"Progress",align:"left",sortable:!1,key:"Progress",width:"8%"},{title:"Risk Rating",align:"left",sortable:!1,key:"RiskRating",width:"10%"}],Ke=F({components:{OXOAssets:ke,DfScanProgress:Ae,DfRisk:De,DfConfirmationModal:Be},props:{scanner:{type:Object,required:!0}},data(){return{selected:[],service:new Te(this.$axios),scans:[],deleteScanDialog:!1,loading:!0,options:{itemsPerPage:15,page:1,sortDesc:[!0],sortBy:[{key:"CreatedTime",order:"desc"}]},onActionScan:null,stopDialog:!1,headers:Je,currentPage:0}},watch:{options:{handler(){this.fetchScans()},deep:!0}},methods:{...re(Pe,["reportSuccess","reportError"]),goToScan(e,s){this.$router.push({name:"scan-scanner-scan",params:{scan:s.item.id,scanner:Ve(this.scanner.endpoint)}})},stopScans(e){this.onActionScan=e,this.stopDialog=!0},async confirmStopSelectedScans(){try{await this.service.stopScans(this.scanner,this.selected),await this.fetchScans()}catch(e){this.reportError(e?.message||"An error occurred while stopping the scans")}finally{this.onActionScan=null,this.selected=[]}},deleteScans(e){this.onActionScan=e,this.deleteScanDialog=!0},async confirmDeleteSelectedScans(){if(!(this.onActionScan===null||this.onActionScan===void 0)){try{this.loading=!0,await this.service.deleteScans(this.scanner,this.selected),this.reportSuccess("Scans deleted successfully")}catch(e){this.reportError(`An error occurred while deleting the scan: ${e?.message}`)}finally{this.onActionScan=null,this.loading=!1,this.selected=[]}await this.fetchScans()}},async fetchScans(){this.loading=!0;try{if(!this.scanner)return;this.scans=await this.service.getScans(this.scanner,{numberElements:this.options.itemsPerPage,page:this.options.page})}catch(e){this.reportError(`An error occurred while fetching scans from: ${this.scanner.name||this.scanner.endpoint}: ${e.message}`)}finally{this.loading=!1}}}}),We=de({itemsLength:{type:[Number,String],required:!0},...Xe(),..._e(),...Ue()},"VDataTableServer"),Ze=ie()({name:"VDataTableServer",props:We(),emits:{"update:modelValue":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:groupBy":e=>!0},setup(e,s){let{attrs:C,slots:n}=s;const{groupBy:g}=$e(e),{sortBy:m,multiSort:h,mustSort:S}=Re(e),{page:c,itemsPerPage:u}=Ee(e),o=A(()=>parseInt(e.itemsLength,10)),{columns:l,headers:V}=Le(e,{groupBy:g,showSelect:p(e,"showSelect"),showExpand:p(e,"showExpand")}),{items:b}=Ie(e,l),{toggleSort:R}=Ye({sortBy:m,multiSort:h,mustSort:S,page:c}),{opened:Y,isGroupOpen:j,toggleGroup:q,extractRows:z}=Oe({groupBy:g,sortBy:m}),{pageCount:J,setItemsPerPage:K}=Ne({page:c,itemsPerPage:u,itemsLength:o}),{flatItems:E}=Me(b,g,Y),{isSelected:W,select:Z,selectAll:Q,toggleSelect:x,someSelected:ee,allSelected:te}=Ge(e,{allItems:b,currentPage:b}),{isExpanded:ae,toggleExpand:se}=Fe(e),L=A(()=>z(b.value));He({page:c,itemsPerPage:u,sortBy:m,groupBy:g,search:p(e,"search")}),me("v-data-table",{toggleSort:R,sortBy:m}),ce({VDataTableRows:{hideNoData:p(e,"hideNoData"),noDataText:p(e,"noDataText"),loading:p(e,"loading"),loadingText:p(e,"loadingText")}});const i=A(()=>({page:c.value,itemsPerPage:u.value,sortBy:m.value,pageCount:J.value,toggleSort:R,setItemsPerPage:K,someSelected:ee.value,allSelected:te.value,isSelected:W,select:Z,selectAll:Q,toggleSelect:x,isExpanded:ae,toggleExpand:se,isGroupOpen:j,toggleGroup:q,items:L.value.map(T=>T.raw),internalItems:L.value,groupedItems:E.value,columns:l.value,headers:V.value}));ue(()=>{const T=I.filterProps(e),oe=O.filterProps(e),ne=N.filterProps(e),le=M.filterProps(e);return t(M,P({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},le),{top:()=>n.top?.(i.value),default:()=>n.default?n.default(i.value):t(k,null,[n.colgroup?.(i.value),!e.hideDefaultHeader&&t("thead",{key:"thead",class:"v-data-table__thead",role:"rowgroup"},[t(O,P(oe,{sticky:e.fixedHeader}),n)]),n.thead?.(i.value),!e.hideDefaultBody&&t("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[n["body.prepend"]?.(i.value),n.body?n.body(i.value):t(N,P(C,ne,{items:E.value}),n),n["body.append"]?.(i.value)]),n.tbody?.(i.value),n.tfoot?.(i.value)]),bottom:()=>n.bottom?n.bottom(i.value):!e.hideDefaultFooter&&t(k,null,[t(H,null,null),t(I,T,{prepend:n["footer.prepend"]})])})})}}),Qe={class:"d-flex align-center"};function xe(e,s,C,n,g,m){const h=f("DfConfirmationModal"),S=f("DfScanProgress"),c=f("DfRisk"),u=f("OXOAssets");return d(),y("div",null,[t(h,{modelValue:e.stopDialog,"onUpdate:modelValue":s[0]||(s[0]=o=>e.stopDialog=o),title:"Are you sure you would like to stop the selected scans?",description:"A stopped scan cannot be resumed.","cancel-button-text":"Cancel","confirm-button-text":"Stop","cancel-icon":"mdi-close","confirm-icon":"mdi-check","confirm-button-color":"secondary","card-icon":"mdi-stop-circle-outline",onConfirm:e.confirmStopSelectedScans},null,8,["modelValue","onConfirm"]),t(h,{modelValue:e.deleteScanDialog,"onUpdate:modelValue":s[1]||(s[1]=o=>e.deleteScanDialog=o),title:"Are you sure you would like to archive the selected scans?","cancel-button-text":"Cancel","confirm-button-text":"Delete","cancel-icon":"mdi-close","confirm-icon":"mdi-check","confirm-button-color":"secondary","card-icon":"mdi-archive-arrow-down-outline",onConfirm:e.confirmDeleteSelectedScans},null,8,["modelValue","onConfirm"]),t($,{variant:"outlined",class:"mb-5"},{default:a(()=>[t(w,{icon:e.mdi-e.refresh,disabled:e.selected.length===0,class:"mx-1 my-1",onClick:e.stopScans},{default:a(()=>[t(B,{start:""},{default:a(()=>[...s[4]||(s[4]=[r(" mdi-stop-circle-outline ",-1)])]),_:1}),s[5]||(s[5]=r("Stop ",-1))]),_:1},8,["icon","disabled","onClick"]),t(w,{disabled:e.selected.length===0,class:"mx-1 my-1",onClick:e.deleteScans},{default:a(()=>[t(B,{start:""},{default:a(()=>[...s[6]||(s[6]=[r(" mdi-trash-can-outline ",-1)])]),_:1}),s[7]||(s[7]=r("Delete ",-1))]),_:1},8,["disabled","onClick"])]),_:1}),t($,{variant:"outlined"},{default:a(()=>[t(_,{class:"pt-2 pl-2"},{default:a(()=>[t(pe,{label:""},{default:a(()=>[r(v(e.scanner.name||e.scanner.endpoint),1)]),_:1})]),_:1}),t(Ze,{options:e.options,"onUpdate:options":s[2]||(s[2]=o=>e.options=o),modelValue:e.selected,"onUpdate:modelValue":s[3]||(s[3]=o=>e.selected=o),hover:"","show-select":"",headers:e.headers,items:e.scans,"items-length":e.service.totalScans,loading:e.loading,"items-per-page-options":[15,50,200,-1],"items-per-page":e.options.itemsPerPage,density:"comfortable","onClick:row":e.goToScan},{"item.Progress":a(({item:o})=>[t(S,{progress:o.progress||"unknown"},null,8,["progress"])]),"item.RiskRating":a(({item:o})=>[t(c,{risk:o.riskRating||"unknown"},null,8,["risk"])]),"item.CreatedTime":a(({item:o})=>[r(v(e.$moment(o.createdTime).format("MMMM Do YYYY, k:mm:ss")),1)]),"item.Action":a(({item:o})=>[t(fe,{bottom:"",left:"","offset-y":""},{activator:a(({props:l})=>[t(w,P({icon:"mdi-dots-vertical"},l,{variant:"flat",size:"small"}),null,16)]),default:a(()=>[t(ge,{density:"compact"},{default:a(()=>[(d(!0),y(k,null,U(e.actions,(l,V)=>(d(),y(k,null,[l.divider!==void 0?(d(),D(H,{key:`divider-${V}`,class:"mb-2 mt-2"})):(d(),D(he,{key:`item-${V}`,density:"compact",disabled:l.disabled?l.disabled(o):!1,onClick:b=>l.action&&l.action(o)},{default:a(()=>[Se("div",Qe,[t(B,{start:""},{default:a(()=>[r(v(l.icon),1)]),_:2},1024),t(be,null,{default:a(()=>[r(v(l.title),1)]),_:2},1024)])]),_:2},1032,["disabled","onClick"]))],64))),256))]),_:2},1024)]),_:2},1024)]),"item.asset":a(({item:o})=>[t(u,{assets:o.assets||[]},null,8,["assets"])]),"item.title":a(({item:o})=>[r(v(o.title||"-"),1)]),_:2},1032,["options","modelValue","headers","items","items-length","loading","items-per-page","onClick:row"])]),_:1})])}const et=X(Ke,[["render",xe]]),tt=F({components:{ScanList:et,DfBreadcrumbs:we,SvgLoader:je},data(){return{loading:!0,breadcrumbs:[{text:"Scans",to:"/scan/list",exact:!0,disabled:!0}]}},computed:{...ve(qe,["scanners"])},mounted(){this.loading=!1}});function at(e,s,C,n,g,m){const h=f("DfBreadcrumbs"),S=f("SvgLoader"),c=f("scan-list");return d(),y("div",null,[t(h,{breadcrumbs:e.breadcrumbs,class:"mb-5"},null,8,["breadcrumbs"]),t(ze,{justify:"center"},{default:a(()=>[e.loading===!0?(d(),D(S,{key:0})):e.loading===!1&&e.scanners.length>0?(d(!0),y(k,{key:1},U(e.scanners,u=>(d(),D(G,{key:u.endpoint,cols:"12"},{default:a(()=>[t(c,{scanner:u},null,8,["scanner"])]),_:2},1024))),128)):e.loading===!1&&e.scanners.length===0?(d(),D(G,{key:2,content:"center","align-self":"center"},{default:a(()=>[t($,{variant:"outlined"},{default:a(()=>[t(_,null,{default:a(()=>[...s[0]||(s[0]=[r("No scanners found",-1)])]),_:1}),t(Ce,null,{default:a(()=>[t(w,{variant:"elevated",color:"accent",to:"/scanners"},{default:a(()=>[...s[1]||(s[1]=[r(" Add Scanner ",-1)])]),_:1})]),_:1})]),_:1})]),_:1})):ye("",!0)]),_:1})])}const ht=X(tt,[["render",at]]);export{ht as default};
