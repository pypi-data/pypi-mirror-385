import{d as _,a0 as M,aO as D,x as m,y as r,B as t,T as i,X as g,g as d,C as o,a4 as v,Z as C,aM as N,a1 as V,V as G,U as k,aN as w,a2 as T,D as c,A as b,_ as S,aL as E}from"#entry";import{u as I,V as f,D as P,a as Y,b as K,f as R}from"./vRc2BJuY.js";import{Y as z}from"./BaCn2Olm.js";import{A as O}from"./Dw7RWyOH.js";import{A as U}from"./BPg7fJxw.js";import{D as W,r as X}from"./9jHEIiRU.js";import{u as $}from"./DIRTgmGz.js";import{_ as F}from"./DlAUqK2U.js";import{S as Z}from"./kh6oSBUy.js";import{V as j}from"./DicsgTSm.js";import"./D2lCyhx0.js";import"./DPQgZEES.js";import"./CiZyL2M5.js";import"./EcQIca6j.js";const q=_({components:{DfConfirmationModal:W,AgentGroupForm:O},data(){return{loading:!0,agentGroupService:new U(this.$axios),agentGroups:[],headers:[{title:"Key",align:"left",sortable:!1,key:"key",width:"10%"},{title:"Description",align:"left",sortable:!1,key:"description",width:"14%"},{title:"Agents",align:"left",sortable:!1,key:"agents",width:"20%"},{title:"Actions",align:"left",sortable:!1,key:"actions",width:"5%"}],onActionAgentGroup:null,itemsPerPage:15,editorLanguage:"yaml",editorOptions:{theme:"vs",wordWrap:"on",wordWrapColumn:"on",fontFamily:"Fira Code",automaticLayout:!0,minimap:{enabled:!1}},deleteAgentGroupDialog:!1,showForm:!1,selectedAgentGroup:null,expandedItem:null}},computed:{...D($,["scanners"]),actions(){return[{title:"Edit",action:e=>this.updateAgentGroup(e),icon:"mdi-pencil-outline",color:"primary",divider:!0},{title:"Delete",action:e=>this.deleteAgentGroup(e),icon:"mdi-delete",color:"red"}]}},watch:{selectedAgentGroup(e){this.selectedAgentGroup=e}},mounted(){this.fetchAgentGroups()},methods:{...M(I,["reportSuccess","reportError"]),async fetchAgentGroups(){this.agentGroups=[],this.loading=!0;try{const e=this.scanners.map(async n=>{try{const a=await this.agentGroupService.getAgentGroups(n);Array.isArray(a)==!0&&this.agentGroups.push(...a.map(l=>({...l,scanner:n})))}catch(a){this.reportError(a?.message||"Error fetching agent groups")}});await Promise.allSettled(e)}finally{this.loading=!1}},parseYaml(e){try{return z.parse(e).agents||[]}catch{return[]}},getVisibleAgents(e){return this.parseYaml(e).slice(0,4)},getRemainingCount(e){const n=this.parseYaml(e);return Math.max(0,n.length-4)},deleteAgentGroup(e){this.onActionAgentGroup=e,this.deleteAgentGroupDialog=!0},async confirmDeleteAgentGroup(){if(this.onActionAgentGroup!=null)try{this.loading=!0,this.onActionAgentGroup!==null&&this.onActionAgentGroup.id!==void 0&&(await this.agentGroupService.deleteAgentGroup(this.onActionAgentGroup.scanner,parseInt(this.onActionAgentGroup.id)),this.reportSuccess("Agent group deleted successfully"),this.agentGroups=this.agentGroups.filter(e=>e.id!==this.onActionAgentGroup?.id))}catch(e){this.reportError(e?.message||"An error occurred while deleting the agent group")}finally{this.onActionAgentGroup=null,this.loading=!1}},updateAgentGroup(e){this.selectedAgentGroup=e,this.showForm=!0,window.scrollTo({top:0,behavior:"smooth"})},onCloseForm(){this.showForm=!1,this.selectedAgentGroup=null,this.loading=!0,this.fetchAgentGroups()},formatAgentKey(e){const n=e.split("/"),a=n[1],l=n[2];return a==="ostorlab"?`@${l}`:`@${a}/${l}`},createAgentGroup(e){return e!==null&&e.id!==null&&e.id!==void 0?{id:e.id,name:e.name,key:e.key,yamlSource:e.yamlSource,description:e.description,agents:{agents:[]}}:null}}});function H(e,n,a,l,L,B){const h=d("DfConfirmationModal"),A=d("AgentGroupForm"),y=d("v-list-item-content");return r(),m("div",null,[t(h,{modelValue:e.deleteAgentGroupDialog,"onUpdate:modelValue":n[0]||(n[0]=s=>e.deleteAgentGroupDialog=s),title:"Are you sure you would like to delete this Agent group?","cancel-button-text":"Cancel","confirm-button-text":"Delete","cancel-icon":"mdi-close","confirm-icon":"mdi-check","confirm-button-color":"secondary","card-icon":"mdi-delete-outline",onConfirm:e.confirmDeleteAgentGroup},null,8,["modelValue","onConfirm"]),e.showForm===!0?(r(),i(f,{key:0,variant:"outlined",class:"pa-4 mb-4"},{default:o(()=>[t(A,{"agent-group":e.createAgentGroup(e.selectedAgentGroup),scanner:e.selectedAgentGroup?.scanner,"is-edit-mode":!0,onCloseForm:e.onCloseForm},null,8,["agent-group","scanner","onCloseForm"])]),_:1})):g("",!0),t(f,{variant:"outlined"},{default:o(()=>[t(X,{loading:e.loading,hover:"",headers:e.headers,items:e.agentGroups,"items-per-page-options":[15,50,200,-1],"items-per-page":e.itemsPerPage,density:"comfortable"},{"item.agents":o(({item:s})=>[t(V,{dense:""},{default:o(()=>[t(w,null,{default:o(()=>[t(y,null,{default:o(()=>[t(T,{class:"chip-container"},{default:o(()=>[(r(!0),m(G,null,k(e.getVisibleAgents(s.yamlSource),(u,p)=>(r(),i(S,{key:p,class:"mr-1"},{default:o(()=>[c(b(e.formatAgentKey(u.key)),1)]),_:2},1024))),128)),e.getRemainingCount(s.yamlSource)>0?(r(),i(S,{key:0,class:"mr-1",color:"grey lighten-2","text-color":"black",style:{"min-width":"50px",padding:"0 12px"}},{default:o(()=>[c(" +"+b(e.getRemainingCount(s.yamlSource)),1)]),_:2},1024)):g("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),"item.actions":o(({item:s})=>[t(v,{variant:"text",size:"small",icon:!0},{default:o(()=>[t(C,{icon:"mdi-dots-vertical"}),t(N,{activator:"parent",location:"bottom"},{default:o(()=>[t(V,{density:"compact",class:"py-0"},{default:o(()=>[(r(!0),m(G,null,k(e.actions,(u,p)=>(r(),m(G,{key:`item-${u.title}-${p}`},[t(w,{onClick:ee=>u.action(s)},{default:o(()=>[t(C,{start:"",size:"small",icon:u.icon},null,8,["icon"]),c(" "+b(u.title),1)]),_:2},1032,["onClick"]),p!==e.actions.length-1?(r(),i(E,{key:0})):g("",!0)],64))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["loading","headers","items","items-per-page"])]),_:1})])}const J=F(q,[["render",H],["__scopeId","data-v-f579388a"]]),Q=_({components:{AgentGroupsList:J,DfBreadcrumbs:P,SvgLoader:Z},data(){return{loading:!0,breadcrumbs:[{text:"Agent Groups",to:"/agent-groups/list",exact:!0,disabled:!0}],showForm:!1}},computed:{...D($,["scanners"])},mounted(){this.loading=!1}});function x(e,n,a,l,L,B){const h=d("DfBreadcrumbs"),A=d("SvgLoader"),y=d("AgentGroupsList");return r(),m("div",null,[t(h,{breadcrumbs:e.breadcrumbs,class:"mb-5"},null,8,["breadcrumbs"]),t(f,{variant:"outlined",class:"my-4"},{default:o(()=>[t(Y,null,{default:o(()=>[t(v,{color:"accent","prepend-icon":"mdi-plus",to:"/agent-groups/new"},{default:o(()=>[...n[0]||(n[0]=[c(" New ",-1)])]),_:1})]),_:1})]),_:1}),e.loading===!0?(r(),i(A,{key:0})):e.loading===!1&&e.scanners.length>0?(r(),i(y,{key:1})):e.loading===!1&&e.scanners.length===0?(r(),i(j,{key:2,content:"center","align-self":"center"},{default:o(()=>[t(f,{variant:"outlined"},{default:o(()=>[t(K,null,{default:o(()=>[...n[1]||(n[1]=[c("No scanners found",-1)])]),_:1}),t(R,null,{default:o(()=>[t(v,{variant:"elevated",color:"accent",to:"/scanners"},{default:o(()=>[...n[2]||(n[2]=[c(" Add Scanner ",-1)])]),_:1})]),_:1})]),_:1})]),_:1})):g("",!0)])}const fe=F(Q,[["render",x]]);export{fe as default};
