import{_ as C,af as j,v as i,b as n,a as c,C as b,x as g,y as u,a7 as I,F as f,B as p,d as K,D as w,G as h,I as B,w as _,q as y,cm as L,cn as P,co as D,aO as E,cp as v,be as x,bf as G,E as N,A as R}from"./main-BYF-1NPs.js";import{V}from"./VTable-w4hUrOLl.js";import{C as U}from"./confirm-dialog-CtMdLhNl.js";import{c as z}from"./copy-to-clipboard-DoUvDJVx.js";import{useAdminStore as T}from"./admin-BD6zNNYf.js";import"./forwardRefs-BJr0Q13I.js";import"./VDialog-CyxhTz_Z.js";const F={name:"StatsTable",props:{title:{type:String,required:!0},items:{type:Object,required:!0}},data(){return{}},methods:{valueTable(e){return e&&typeof e=="object"?e:{}},tdClasses(e){return{indent:e[0]==="+"}},tdLabel(e){return e.replace(/^\+/,"")},nf(e){return typeof e=="number"?j.format(e):e}}},$={class:"statBlock"},q={key:0},H={colspan:"2",class:"subtitleRow"},M={key:1},X={class:"indent"};function Y(e,t,a,s,l,o){return u(),i("div",$,[n("h3",null,b(a.title),1),c(V,{class:"highlight-table"},{default:g(()=>[(u(!0),i(f,null,p(Object.entries(a.items),([r,d])=>(u(),i("tbody",{key:r},[typeof d=="object"?(u(),i("tr",q,[n("th",H,b(r),1)])):(u(),i("tr",M,[n("td",{class:K(o.tdClasses(r))},b(o.tdLabel(r)),3),n("td",null,b(o.nf(d)),1)])),(u(!0),i(f,null,p(Object.entries(o.valueTable(d)),([m,A])=>(u(),i("tr",{key:m},[n("td",X,b(m),1),n("td",null,b(o.nf(A)),1)]))),128))]))),128)),I(e.$slots,"default",{},void 0,!0)]),_:3})])}const J=C(F,[["render",Y],["__scopeId","data-v-4bb3ecd9"]]),O={topGroup:E,orderBy:D,fitTo:P,readingDirection:L},S={authGroupCount:"Authorization Groups",libraryCount:"Libraries",userAnonymousCount:"Anonymous Users",userRegisteredCount:"Registered Users"};Object.freeze(S);Object.freeze(O);const k=new Set(["creditPersonsCount","creditRolesCount","identifierSourcesCount","storyArcNumbersCount"]);Object.freeze(k);const Q={name:"AdminTasksTab",components:{ConfirmDialog:U,StatsTable:J},data(){return{showTooltip:{show:!1},schemaHref:globalThis.CODEX.API_V3_PATH+"#/api/api_v3_admin_stats_retrieve"}},computed:{...h(N,{}),...h(T,{stats:e=>e.stats}),clipBoardEnabled(){return location.prototcal=="https:"},apiTooltip(){return this.clipBoardEnabled},clipBoardIcon(){return this.showTooltip?x:G},platformTable(){const e={};for(const[t,a]of Object.entries(this.stats?.platform)){const s=this.keyToLabel(t),l=t==="system"?`${a.name} ${a.release}`:a;e[s]=l}return e},configTable(){const e={};let t="";for(const[a,s]of Object.entries(this.stats?.config)){let l;if(a=="apiKey"){t=s;continue}else l=S[a];e[l]=s}return e["API Key"]=t,e},userSettingsTable(){const e={};for(const[t,a]of Object.entries(this.stats?.sessions)){const s={},l=O[t];for(const[r,d]of Object.entries(a)){let m;m=l?l[v(r)]:r,s[m]=d}const o=this.keyToLabel(t);e[o]=s}return e},browserGroupsTable(){const e={};for(const[t,a]of Object.entries(this.stats?.groups)){let s=this.keyToLabel(t);s!=="Series"&&(s+="s"),e[s]=a}return e},fileTypesTable(){const e={};for(const[t,a]of Object.entries(this.stats?.fileTypes)){const s=t==="unknown"?y(t):this.keyToLabel(t).toUpperCase();e[s]=a}return e},metadataTable(){const e={};for(const[t,a]of Object.entries(this.stats?.metadata)){let s=t==="countryCount"?"Countries":this.keyToLabel(t)+"s";k.has(t)&&(s=s.replace(/^\w+ /,"+")),e[s]=a}return e}},created(){this.loadStats()},methods:{...w(T,["loadStats","updateAPIKey"]),regenAPIKey(){this.updateAPIKey().then(this.loadStats).catch(console.warn)},onClickAPIKey(){this.clipBoardEnabled&&z(this.stats.config.apiKey,this.showTooltip)},keyToLabel(e){return e=e.replace(/Count$/,""),y(e)}}},W={key:0,id:"stats"},Z={id:"schemaDoc"},ee={colspan:"2"},te=["href"],se={colspan:"2"};function ae(e,t,a,s,l,o){const r=_("StatsTable"),d=_("ConfirmDialog");return e.stats?(u(),i("div",W,[c(r,{title:"Platform",items:o.platformTable},null,8,["items"]),c(r,{title:"Config",items:o.configTable},{default:g(()=>[n("tbody",null,[n("tr",Z,[n("td",ee,[t[0]||(t[0]=R(" The only endpoint accessible by API Key is ",-1)),n("a",{href:l.schemaHref,target:"_blank"},"/admin/stats",8,te)])]),n("tr",null,[n("td",se,[c(d,{"button-text":"Regenerate API Key","title-text":"Regenerate",text:"API Key","confirm-text":"Regenerate",onConfirm:o.regenAPIKey},null,8,["onConfirm"])])])])]),_:1},8,["items"]),c(r,{title:"User Settings",items:o.userSettingsTable},null,8,["items"]),c(r,{title:"Browser Groups",items:o.browserGroupsTable},null,8,["items"]),c(r,{title:"File Types",items:o.fileTypesTable},null,8,["items"]),c(r,{title:"Metadata",items:o.metadataTable},null,8,["items"])])):B("",!0)}const de=C(Q,[["render",ae],["__scopeId","data-v-b8d4ace0"]]);export{de as default};
