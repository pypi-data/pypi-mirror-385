import{u as ke,t as S,e as Ce,f as we,m as Ie,a as Se,V as Fe,b as De,g as Pe,d as Ae}from"./VSelect-E5kKkuai.js";import{u as Re,c as j,q as Ee}from"./VSelectionControl-DeWPIIPX.js";import{u as Me,f as Te,p as Le,k as W,l as Ne}from"./forwardRefs-ChIujdCb.js";import{u as _e,m as Be,h as Ke}from"./filter-D8MAlk56.js";import{g as Oe,p as Ue,aD as ze,r as _,aV as F,e as G,bG as $e,c as y,aZ as D,bH as qe,aW as P,bI as J,u as He,a as d,m as k,o as je,bJ as We,bK as Z,bL as Ge,b as C,bM as Je,F as z,bN as Ze,n as Qe,d as Xe,A as Ye}from"./main-D4SEGtZa.js";import{a as Q,g as el}from"./VDialog-DqZpNQj0.js";import{a as ll}from"./VDivider-DVXAM-o1.js";import{V as al}from"./VCheckboxBtn-CrWaiahS.js";const tl=Ue({alwaysFilter:Boolean,autoSelectFirst:{type:[Boolean,String]},clearOnSelect:{type:Boolean,default:!0},delimiters:Array,...Be({filterKeys:["title"]}),...Ie({hideNoData:!0,returnObject:!0}),...je(Ee({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...Le({transition:!1})},"VCombobox"),dl=Oe()({name:"VCombobox",props:tl(),emits:{"update:focused":e=>!0,"update:modelValue":e=>!0,"update:search":e=>!0,"update:menu":e=>!0},setup(e,X){let{emit:Y,slots:r}=X;const{t:ee}=ze(),m=_(),h=F(!1),x=F(!0),B=F(!1),$=_(),A=_(),n=F(-1);let R=!1;const{items:q,transformIn:le,transformOut:ae}=ke(e),{textColorClasses:te,textColorStyles:ue}=Me(()=>m.value?.color),u=G(e,"modelValue",[],l=>le($e(l)),l=>{const o=ae(l);return e.multiple?o:o[0]??null}),E=Re(e),M=y(()=>!!(e.chips||r.chip)),g=y(()=>M.value||!!r.selection),p=F(!e.multiple&&!g.value?u.value[0]?.title??"":""),c=y({get:()=>p.value,set:async l=>{if(p.value=l??"",!e.multiple&&!g.value&&(u.value=[S(e,l)],D(()=>A.value?.scrollToIndex(0))),l&&e.multiple&&e.delimiters?.length){const o=e.delimiters.map(qe).join("|"),i=l.split(new RegExp(`(?:${o})+`));if(i.length>1){for(let a of i)a=a.trim(),a&&(b(S(e,a)),await D());p.value=""}}l||(n.value=-1),x.value=!l}}),ne=y(()=>typeof e.counterValue=="function"?e.counterValue(u.value):typeof e.counterValue=="number"?e.counterValue:e.multiple?u.value.length:c.value.length),{filteredItems:T,getMatches:oe}=_e(e,q,()=>e.alwaysFilter||!x.value?c.value:""),V=y(()=>e.hideSelected?T.value.filter(l=>!u.value.some(o=>o.value===l.value)):T.value),L=y(()=>e.hideNoData&&!V.value.length||E.isReadonly.value||E.isDisabled.value),K=G(e,"menu"),s=y({get:()=>K.value,set:l=>{K.value&&!l&&$.value?.Î¨openChildren.size||l&&L.value||(K.value=l)}}),{menuId:ie,ariaExpanded:se,ariaControls:re,ariaLabel:H}=Ce(e,s);P(p,l=>{R?D(()=>R=!1):h.value&&!s.value&&(s.value=!0),Y("update:search",l)}),P(u,l=>{!e.multiple&&!g.value&&(p.value=l[0]?.title??"")});const ce=y(()=>u.value.map(l=>l.value)),O=y(()=>(e.autoSelectFirst===!0||e.autoSelectFirst==="exact"&&c.value===V.value[0]?.title)&&V.value.length>0&&!x.value&&!B.value),U=_(),ve=we(U,m);function de(l){R=!0,D(()=>R=!1),e.openOnClear&&(s.value=!0)}function fe(){L.value||(s.value=!0)}function me(l){L.value||(h.value&&(l.preventDefault(),l.stopPropagation()),s.value=!s.value)}function be(l){(Z(l)||l.key==="Backspace")&&m.value?.focus()}function he(l){if(We(l)||E.isReadonly.value)return;const o=m.value?.selectionStart,i=u.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(l.key)&&l.preventDefault(),["Enter","ArrowDown"].includes(l.key)&&(s.value=!0),["Escape"].includes(l.key)&&(s.value=!1),["Enter","Escape","Tab"].includes(l.key)&&(O.value&&["Enter","Tab"].includes(l.key)&&!u.value.some(a=>{let{value:t}=a;return t===V.value[0].value})&&b(T.value[0]),x.value=!0),l.key==="ArrowDown"&&O.value&&U.value?.focus("next"),l.key==="Enter"&&c.value&&(b(S(e,c.value)),g.value&&(p.value="")),["Backspace","Delete"].includes(l.key)){if(!e.multiple&&g.value&&u.value.length>0&&!c.value)return b(u.value[0],!1);if(~n.value){l.preventDefault();const a=n.value;b(u.value[n.value],!1),n.value=a>=i-1?i-2:a}else l.key==="Backspace"&&!c.value&&(n.value=i-1);return}if(e.multiple)if(l.key==="ArrowLeft"){if(n.value<0&&o&&o>0)return;const a=n.value>-1?n.value-1:i-1;u.value[a]?n.value=a:(n.value=-1,m.value?.setSelectionRange(c.value.length,c.value.length))}else if(l.key==="ArrowRight"){if(n.value<0)return;const a=n.value+1;u.value[a]?n.value=a:(n.value=-1,m.value?.setSelectionRange(0,0))}else~n.value&&Z(l)&&(n.value=-1)}function ge(){e.eager&&A.value?.calculateVisibleItems()}function ye(){h.value&&(x.value=!0,m.value?.focus())}function b(l){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!l||l.props.disabled))if(e.multiple){const i=u.value.findIndex(t=>(e.valueComparator||J)(t.value,l.value)),a=o??!~i;if(~i){const t=a?[...u.value,l]:[...u.value];t.splice(i,1),u.value=t}else a&&(u.value=[...u.value,l]);e.clearOnSelect&&(c.value="")}else{const i=o!==!1;u.value=i?[l]:[],p.value=i&&!g.value?l.title:"",D(()=>{s.value=!1,x.value=!0})}}function xe(l){h.value=!0,setTimeout(()=>{B.value=!0})}function pe(l){B.value=!1}function Ve(l){(l==null||l===""&&!e.multiple&&!g.value)&&(u.value=[])}return P(h,(l,o)=>{if(!(l||l===o)&&(n.value=-1,s.value=!1,c.value)){if(e.multiple){b(S(e,c.value));return}if(!g.value)return;u.value.some(i=>{let{title:a}=i;return a===c.value})?p.value="":b(S(e,c.value))}}),P(s,()=>{if(!e.hideSelected&&s.value&&u.value.length){const l=V.value.findIndex(o=>u.value.some(i=>(e.valueComparator||J)(i.value,o.value)));Ge&&window.requestAnimationFrame(()=>{l>=0&&A.value?.scrollToIndex(l)})}}),P(q,(l,o)=>{s.value||h.value&&!o.length&&l.length&&(s.value=!0)}),He(()=>{const l=!!(!e.hideNoData||V.value.length||r["prepend-item"]||r["append-item"]||r["no-data"]),o=u.value.length>0,i=j.filterProps(e);return d(j,k({ref:m},i,{modelValue:c.value,"onUpdate:modelValue":[a=>c.value=a,Ve],focused:h.value,"onUpdate:focused":a=>h.value=a,validationValue:u.externalValue,counterValue:ne.value,dirty:o,class:["v-combobox",{"v-combobox--active-menu":s.value,"v-combobox--chips":!!e.chips,"v-combobox--selection-slot":!!g.value,"v-combobox--selecting-index":n.value>-1,[`v-combobox--${e.multiple?"multiple":"single"}`]:!0},e.class],style:e.style,readonly:E.isReadonly.value,placeholder:o?void 0:e.placeholder,"onClick:clear":de,"onMousedown:control":fe,onKeydown:he,"aria-expanded":se.value,"aria-controls":re.value}),{...r,default:()=>C(z,null,[d(Se,k({id:ie.value,ref:$,modelValue:s.value,"onUpdate:modelValue":a=>s.value=a,activator:"parent",contentClass:"v-combobox__content",disabled:L.value,eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterEnter:ge,onAfterLeave:ye},e.menuProps),{default:()=>[l&&d(Fe,k({ref:U,filterable:!0,selected:ce.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:a=>a.preventDefault(),selectable:!0,onKeydown:be,onFocusin:xe,onFocusout:pe,tabindex:"-1","aria-live":"polite",color:e.itemColor??e.color},ve,e.listProps),{default:()=>[r["prepend-item"]?.(),!V.value.length&&!e.hideNoData&&(r["no-data"]?.()??d(Q,{key:"no-data",title:ee(e.noDataText)},null)),d(De,{ref:A,renderless:!0,items:V.value,itemKey:"value"},{default:a=>{let{item:t,index:v,itemRef:N}=a;const w=k(t.props,{ref:N,key:t.value,active:O.value&&v===0?!0:void 0,onClick:()=>b(t,null)});return t.type==="divider"?r.divider?.({props:t.raw,index:v})??d(ll,k(t.props,{key:`divider-${v}`}),null):t.type==="subheader"?r.subheader?.({props:t.raw,index:v})??d(Pe,k(t.props,{key:`subheader-${v}`}),null):r.item?.({item:t,index:v,props:w})??d(Q,k(w,{role:"option"}),{prepend:I=>{let{isSelected:f}=I;return C(z,null,[e.multiple&&!e.hideSelected?d(al,{key:t.value,modelValue:f,ripple:!1,tabindex:"-1"},null):void 0,t.props.prependAvatar&&d(el,{image:t.props.prependAvatar},null),t.props.prependIcon&&d(W,{icon:t.props.prependIcon},null)])},title:()=>x.value?t.title:Ke("v-combobox",t.title,oe(t)?.title)})}}),r["append-item"]?.()]})]}),u.value.map((a,t)=>{function v(f){f.stopPropagation(),f.preventDefault(),b(a,!1)}const N={"onClick:close":v,onKeydown(f){f.key!=="Enter"&&f.key!==" "||(f.preventDefault(),f.stopPropagation(),v(f))},onMousedown(f){f.preventDefault(),f.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},w=M.value?!!r.chip:!!r.selection,I=w?Ze(M.value?r.chip({item:a,index:t,props:N}):r.selection({item:a,index:t})):void 0;if(!(w&&!I))return C("div",{key:a.value,class:Xe(["v-combobox__selection",t===n.value&&["v-combobox__selection--selected",te.value]]),style:Qe(t===n.value?ue.value:{})},[M.value?r.chip?d(Ne,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:a.title}}},{default:()=>[I]}):d(Ae,k({key:"chip",closable:e.closableChips,size:"small",text:a.title,disabled:a.props.disabled},N),null):I??C("span",{class:"v-combobox__selection-text"},[a.title,e.multiple&&t<u.value.length-1&&C("span",{class:"v-combobox__selection-comma"},[Ye(",")])])])})]),"append-inner":function(){for(var a=arguments.length,t=new Array(a),v=0;v<a;v++)t[v]=arguments[v];return C(z,null,[r["append-inner"]?.(...t),(!e.hideNoData||e.items.length)&&e.menuIcon?d(W,{class:"v-combobox__menu-icon",color:m.value?.fieldIconColor,icon:e.menuIcon,onMousedown:me,onClick:Je,"aria-label":H.value,title:H.value,tabindex:"-1"},null):void 0])}})}),Te({isFocused:h,isPristine:x,menu:s,search:c,selectionIndex:n,filteredItems:T,select:b},m)}});export{dl as V};
