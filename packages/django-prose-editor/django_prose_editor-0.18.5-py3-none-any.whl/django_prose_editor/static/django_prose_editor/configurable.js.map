{"version":3,"file":"configurable.js","sources":["webpack://pm/./src/configurable.js"],"sourcesContent":["import * as editorModule from \"django-prose-editor/editor\"\nimport {\n  createTextareaEditor,\n  initializeEditors,\n} from \"django-prose-editor/editor\"\n\nconst marker = \"data-django-prose-editor-configurable\"\n\nconst EXTENSIONS = { ...editorModule }\n\nconst moduleLoadPromises = new Map()\n\nasync function loadExtensionModules(moduleUrls) {\n  if (!moduleUrls || !moduleUrls.length) return\n\n  const loadPromises = moduleUrls.map((url) => {\n    if (moduleLoadPromises.has(url)) {\n      return moduleLoadPromises.get(url)\n    }\n\n    const loadPromise = import(url)\n      .then((module) => {\n        Object.assign(EXTENSIONS, module)\n      })\n      .catch((error) => {\n        console.error(`Error loading extension module from ${url}:`, error)\n        // Remove failed modules from cache\n        moduleLoadPromises.delete(url)\n      })\n\n    moduleLoadPromises.set(url, loadPromise)\n    return loadPromise\n  })\n\n  // Wait for all modules to load\n  await Promise.all(loadPromises)\n}\n\nasync function createEditorAsync(textarea, config = null) {\n  if (textarea.closest(\".prose-editor\")) return null\n\n  config = config || JSON.parse(textarea.getAttribute(marker) || \"{}\")\n\n  if (config.js_modules?.length) {\n    await loadExtensionModules(config.js_modules)\n  }\n\n  const extensions = []\n\n  // Process all extensions from the config\n  for (const [extensionName, extensionConfig] of Object.entries(\n    config.extensions,\n  )) {\n    const extension = EXTENSIONS[extensionName]\n    if (extension) {\n      // If the extension has a configuration object (not empty), pass it to the extension\n      if (typeof extensionConfig === \"object\") {\n        extensions.push(extension.configure(extensionConfig))\n      } else {\n        extensions.push(extension)\n      }\n    }\n  }\n\n  return createTextareaEditor(textarea, extensions)\n}\n\n// Track pending editor initializations\nconst pendingEditors = new WeakMap()\n\n// Function for the initializeEditors callback\nfunction createEditor(textarea, config = null) {\n  // Check if we already have a pending initialization for this textarea\n  if (pendingEditors.has(textarea)) {\n    return pendingEditors.get(textarea)\n  }\n\n  // Create a promise for the editor initialization\n  const editorPromise = createEditorAsync(textarea, config)\n    .then((editor) => {\n      // The editor is initialized and ready to use\n      if (editor) {\n        const event = new CustomEvent(\"prose-editor:ready\", {\n          detail: { editor, textarea },\n          bubbles: true,\n        })\n        textarea.dispatchEvent(event)\n      }\n      // Remove from pending tracking once complete\n      pendingEditors.delete(textarea)\n      return editor\n    })\n    .catch((error) => {\n      console.error(\"Error initializing prose editor:\", error)\n      // Remove from pending tracking on error\n      pendingEditors.delete(textarea)\n      return null\n    })\n\n  // Track this pending initialization\n  pendingEditors.set(textarea, editorPromise)\n\n  // Return the promise\n  return editorPromise\n}\n\n// Initialize all editors with the configurable marker\ninitializeEditors(createEditor, `[${marker}]`)\n\n// Export utility functions for external use\nexport { createEditor }\n"],"names":["marker","EXTENSIONS","editorModule","moduleLoadPromises","Map","loadExtensionModules","moduleUrls","loadPromises","url","loadPromise","module","Object","error","console","Promise","createEditorAsync","textarea","_config_js_modules","config","JSON","extensions","extensionName","extensionConfig","extension","createTextareaEditor","pendingEditors","WeakMap","createEditor","editorPromise","editor","event","CustomEvent","initializeEditors"],"mappings":"6CAMA,IAAMA,EAAS,wCAETC,EAAa,CAAE,GAAGC,CAAY,AAAC,EAE/BC,EAAqB,IAAIC,IAE/B,eAAeC,EAAqBC,CAAU,EAC5C,GAAI,CAACA,GAAc,CAACA,EAAW,MAAM,CAAE,OAEvC,IAAMC,EAAeD,EAAW,GAAG,CAAC,AAACE,IACnC,GAAIL,EAAmB,GAAG,CAACK,GACzB,OAAOL,EAAmB,GAAG,CAACK,GAGhC,IAAMC,EAAc,MAAM,CAACD,GACxB,IAAI,CAAC,AAACE,IACLC,OAAO,MAAM,CAACV,EAAYS,EAC5B,GACC,KAAK,CAAC,AAACE,IACNC,QAAQ,KAAK,CAAC,CAAC,oCAAoC,EAAEL,EAAI,CAAC,CAAC,CAAEI,GAE7DT,EAAmB,MAAM,CAACK,EAC5B,GAGF,OADAL,EAAmB,GAAG,CAACK,EAAKC,GACrBA,CACT,EAGA,OAAMK,QAAQ,GAAG,CAACP,EACpB,CAEA,eAAeQ,EAAkBC,CAAQ,MAKnCC,E,IALqCC,EAAAA,UAAAA,MAAAA,CAAAA,GAAAA,AAAAA,KAAAA,IAAAA,SAAAA,CAAAA,EAAAA,CAAAA,SAAAA,CAAAA,EAAAA,CAAS,KAClD,GAAIF,EAAS,OAAO,CAAC,iBAAkB,OAAO,IAI1C,QAAAC,CAAAA,EAAAA,AAFJC,CAAAA,EAASA,GAAUC,KAAK,KAAK,CAACH,EAAS,YAAY,CAAChB,IAAW,KAAI,EAExD,UAAU,AAAD,EAAhBiB,KAAAA,EAAAA,EAAmB,MAAM,AAAD,GAC1B,MAAMZ,EAAqBa,EAAO,UAAU,EAG9C,IAAME,EAAa,EAAE,CAGrB,IAAK,GAAM,CAACC,EAAeC,EAAgB,GAAIX,OAAO,OAAO,CAC3DO,EAAO,UAAU,EAChB,CACD,IAAMK,EAAYtB,CAAU,CAACoB,EAAc,CACvCE,IAEE,AAA2B,UAA3B,OAAOD,EACTF,EAAW,IAAI,CAACG,EAAU,SAAS,CAACD,IAEpCF,EAAW,IAAI,CAACG,GAGtB,CAEA,MAAOC,AAAAA,GAAAA,EAAAA,oBAAAA,AAAAA,EAAqBR,EAAUI,EACxC,CAGA,IAAMK,EAAiB,IAAIC,QAG3B,SAASC,EAAaX,CAAQ,E,IAAEE,EAAAA,UAAAA,MAAAA,CAAAA,GAAAA,AAAAA,KAAAA,IAAAA,SAAAA,CAAAA,EAAAA,CAAAA,SAAAA,CAAAA,EAAAA,CAAS,KAEvC,GAAIO,EAAe,GAAG,CAACT,GACrB,OAAOS,EAAe,GAAG,CAACT,GAI5B,IAAMY,EAAgBb,EAAkBC,EAAUE,GAC/C,IAAI,CAAC,AAACW,IAEL,GAAIA,EAAQ,CACV,IAAMC,EAAQ,IAAIC,YAAY,qBAAsB,CAClD,OAAQ,CAAEF,OAAAA,EAAQb,SAAAA,CAAS,EAC3B,QAAS,EACX,GACAA,EAAS,aAAa,CAACc,EACzB,CAGA,OADAL,EAAe,MAAM,CAACT,GACfa,CACT,GACC,KAAK,CAAC,AAACjB,IACNC,QAAQ,KAAK,CAAC,mCAAoCD,GAElDa,EAAe,MAAM,CAACT,GACf,OAOX,OAHAS,EAAe,GAAG,CAACT,EAAUY,GAGtBA,CACT,CAGAI,AAAAA,GAAAA,EAAAA,iBAAAA,AAAAA,EAAkBL,EAAc,CAAC,CAAC,EAAE3B,EAAO,CAAC,CAAC,S"}