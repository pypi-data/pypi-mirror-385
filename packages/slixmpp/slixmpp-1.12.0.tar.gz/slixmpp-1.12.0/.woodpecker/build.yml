when:
  event: [ tag ]

steps:
  build-and-publish:
    image: ghcr.io/pyo3/maturin
    environment:
      TOKEN:
        from_secret: codeberg_package_nicoco
    commands:
    - maturin publish -i $TAG --username nicoco --password $TOKEN --repository-url https://codeberg.org/api/packages/poezio/pypi/ --no-sdist
    depends_on: []

  build-and-publish-musl:
    image: codeberg.org/poezio/maturin-musllinux:${ARCH}
    environment:
      TOKEN:
        from_secret: codeberg_package_nicoco
    commands:
    - maturin publish -i $TAG --username nicoco --password $TOKEN --repository-url https://codeberg.org/api/packages/poezio/pypi/ --no-sdist
    depends_on: []

matrix:
  TAG:
    - "3.9"
    - "3.10"
    - "3.11"
    - "3.12"
    - "3.13"
    - "3.14"
  ARCH:
    - amd64
    - arm64

labels:
  platform: linux/${ARCH}
