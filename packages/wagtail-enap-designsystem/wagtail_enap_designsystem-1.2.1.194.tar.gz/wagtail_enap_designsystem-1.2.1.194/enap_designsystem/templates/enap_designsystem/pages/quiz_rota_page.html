{% extends "enap_designsystem/base.html" %}
{% load static %}
{% load wagtailcore_tags wagtailimages_tags %}

{% block title %}
    <title>{{ page.page_title }}</title>
{% endblock %}

{%block govnavbar %}
    <div style="background-color: #071E41;">
        <div class="menu">
            <div class="logo">
                <img style="width: 51px; height: 18px;" src="{% static 'enap_designsystem/icons/logo-white.png' %}" alt="Logo GovBR" height="40">
            </div>
            <a href="https://www.gov.br/secom/pt-br/acesso-a-informacao/comunicabr">Comunica BR</a>
            <div class="separator"></div>
            <a href="https://www.gov.br/acessoainformacao/pt-br">Acesso à informação</a>
            <div class="separator"></div>
            <a href="https://www.gov.br/pt-br/participacao-social/">Participe</a>
            <div class="separator"></div>
            <a href="https://www4.planalto.gov.br/legislacao/">Legislação</a>
            <div class="separator"></div>
            <a href="https://www.gov.br/pt-br/orgaos-do-governo">Órgãos do Governo</a>
        </div>
    </div>
{% endblock %}

{% block navbar %}
    {% if page.navbar %}
        {% include "enap_designsystem/blocks/navbar/navbar_block.html" with navbar=page.navbar %}
    {% else %}
        <p style="color: red;">DEBUG: Nenhuma Navbar foi definida.</p>
    {% endif %}
{% endblock %}

{% block extra_css %}
<style>
    /* ============================================
       DESIGN SYSTEM ENAP - MINIMALISTA
       ============================================ */
    :root {
        --cor-azul-govbr: #1351B4;
        --cor-azul-escuro: #071E41;
        --cor-azul-claro: #E4EEF8;
        --cor-verde: #168821;
        --cor-erro: #E52207;
        --cor-branco: #FFFFFF;
        --cor-cinza-1: #F8F8F8;
        --cor-cinza-2: #E6E6E6;
        --cor-cinza-3: #CCCCCC;
        --cor-cinza-4: #888888;
        --cor-cinza-5: #555555;
        --cor-preto: #333333;
        --fonte-principal: 'Rawline', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }
    
    .quiz-container,
    .resultado-rotas {
        font-family: var(--fonte-principal) !important;
    }
    
    /* ============================================
       CONTAINER - BEM DISCRETO
       ============================================ */
    .quiz-container {
        max-width: 800px !important;
        margin: 0 auto !important;
        padding: 32px 20px !important;
    }
    
    /* ============================================
       CABEÇALHO - MINIMALISTA
       ============================================ */
    .quiz-header {
        text-align: center !important;
        margin-bottom: 48px !important;
        padding: 0 !important;
    }
    
    .quiz-header h1 {
        font-size: 1.5rem !important;
        font-weight: 600 !important;
        color: var(--cor-preto) !important;
        margin-bottom: 8px !important;
        line-height: 1.3 !important;
    }
    
    .quiz-header p {
        font-size: 0.875rem !important;
        color: var(--cor-cinza-4) !important;
        font-weight: 400 !important;
    }
    
    /* ============================================
       BARRA DE PROGRESSO - DISCRETA
       ============================================ */
    .quiz-progress {
        max-width: 100% !important;
        margin: 0 auto 32px !important;
    }
    
    .progress-bar {
        height: 3px !important;
        background: var(--cor-cinza-2) !important;
        border-radius: 100px !important;
        overflow: hidden !important;
        margin-bottom: 6px !important;
    }
    
    .progress-fill {
        height: 100% !important;
        background: var(--cor-azul-govbr) !important;
        transition: width 0.4s ease !important;
        border-radius: 100px !important;
    }
    
    .progress-text {
        text-align: center !important;
        display: block !important;
        color: var(--cor-cinza-4) !important;
        font-size: 0.75rem !important;
        font-weight: 400 !important;
    }
    
    /* ============================================
       CARD DE PERGUNTA - MUITO DISCRETO
       ============================================ */
    .pergunta-card {
        background: transparent !important;
        border-radius: 0 !important;
        padding: 0 !important;
        box-shadow: none !important;
        margin-bottom: 24px !important;
        border: none !important;
        animation: fadeIn 0.3s ease !important;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    
    .pergunta-texto {
        font-size: 1.125rem !important;
        font-weight: 500 !important;
        color: var(--cor-preto) !important;
        margin-bottom: 6px !important;
        line-height: 1.4 !important;
    }
    
    .pergunta-ajuda {
        color: var(--cor-cinza-4) !important;
        font-size: 0.8125rem !important;
        margin-bottom: 20px !important;
        line-height: 1.5 !important;
        font-weight: 400 !important;
    }
    
    /* ============================================
       GRID DE OPÇÕES - COMPACTO
       ============================================ */
    .opcoes-grid {
        display: grid !important;
        grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)) !important;
        gap: 12px !important;
        margin-top: 16px !important;
    }
    
    /* ============================================
       CARDS DE OPÇÃO - MINIMALISTA
       ============================================ */
       /* ============================================
       CARDS DE OPÇÃO - ULTRA MINIMALISTA
       ============================================ */
    .opcao-card {
        all: unset !important;
        background: transparent !important;
        border: 1px solid var(--cor-cinza-2) !important;
        border-radius: 4px !important;
        padding: 12px 16px !important;
        cursor: pointer !important;
        transition: all 0.15s ease !important;
        text-align: left !important;
        display: block !important;
        width: 100% !important;
        box-sizing: border-box !important;
    }
    
    .opcao-card:hover {
        border-color: var(--cor-azul-govbr) !important;
        background: var(--cor-cinza-1) !important;
    }
    
    .opcao-card:focus {
        outline: 2px solid var(--cor-azul-govbr) !important;
        outline-offset: 2px !important;
    }
    
    .opcao-card.selecionado {
        border-color: var(--cor-azul-govbr) !important;
        background: var(--cor-azul-claro) !important;
        border-width: 2px !important;
    }
    
    .opcao-card i {
        display: none !important;
    }
    
    .opcao-card h3 {
        font-size: 0.9375rem !important;
        font-weight: 500 !important;
        color: var(--cor-preto) !important;
        margin: 0 !important;
        line-height: 1.3 !important;
    }
    
    .opcao-card p {
        display: none !important;
    }
    /* ============================================
       RESUMO - DISCRETO
       ============================================ */
    .escolhas-resumo {
        background: var(--cor-cinza-1) !important;
        border-left: 3px solid var(--cor-azul-govbr) !important;
        padding: 16px !important;
        border-radius: 4px !important;
        margin-top: 24px !important;
    }
    
    .escolhas-resumo h4 {
        margin: 0 0 12px 0 !important;
        color: var(--cor-preto) !important;
        font-weight: 600 !important;
        font-size: 0.875rem !important;
    }
    
    .escolhas-resumo ul {
        list-style: none !important;
        padding: 0 !important;
        margin: 0 !important;
    }
    
    .escolhas-resumo li {
        padding: 6px 0 !important;
        border-bottom: 1px solid var(--cor-cinza-2) !important;
        font-size: 0.8125rem !important;
        color: var(--cor-cinza-5) !important;
    }
    
    .escolhas-resumo li:last-child {
        border-bottom: none !important;
    }
    
    .escolhas-resumo strong {
        color: var(--cor-azul-govbr) !important;
        font-weight: 600 !important;
    }
    
    /* ============================================
       BOTÕES - SIMPLES
       ============================================ */
    .btn {
        display: inline-flex !important;
        align-items: center !important;
        justify-content: center !important;
        padding: 10px 20px !important;
        border-radius: 6px !important;
        text-decoration: none !important;
        font-weight: 600 !important;
        font-size: 0.875rem !important;
        transition: all 0.2s ease !important;
        border: none !important;
        cursor: pointer !important;
    }
    
    .btn-primary {
        background: var(--cor-azul-govbr) !important;
        color: var(--cor-branco) !important;
    }
    
    .btn-primary:hover {
        background: #0C326F !important;
    }
    
    .btn-secondary {
        background: var(--cor-cinza-5) !important;
        color: var(--cor-branco) !important;
    }
    
    .btn-secondary:hover {
        background: var(--cor-preto) !important;
    }
    
    .btn-lg {
        padding: 12px 24px !important;
        font-size: 0.9375rem !important;
    }
    
    .btn-recomecar {
        display: inline-flex !important;
        align-items: center !important;
        padding: 8px 16px !important;
        background: var(--cor-cinza-5) !important;
        color: var(--cor-branco) !important;
        border: none !important;
        border-radius: 6px !important;
        cursor: pointer !important;
        text-decoration: none !important;
        transition: all 0.2s !important;
        margin-top: 16px !important;
        font-weight: 600 !important;
        font-size: 0.8125rem !important;
    }
    
    .btn-recomecar:hover {
        background: var(--cor-preto) !important;
    }
    
    /* ============================================
       PÁGINA DE RESULTADO
       ============================================ */
    .resultado-rotas {
        padding: 32px 0 !important;
    }
    
    .resultado-rotas .container {
        max-width: 1000px !important;
        margin: 0 auto !important;
        padding: 0 20px !important;
    }
    
    .resultado-header {
        text-align: center !important;
        margin-bottom: 40px !important;
    }
    
    .resultado-header h1 {
        color: var(--cor-preto) !important;
        font-size: 1.75rem !important;
        font-weight: 600 !important;
        margin-bottom: 16px !important;
        line-height: 1.3 !important;
    }
    
    .resultado-header h3 {
        font-size: 0.9375rem !important;
        color: var(--cor-cinza-5) !important;
        font-weight: 500 !important;
        margin-bottom: 12px !important;
    }
    
    .badges-respostas {
        display: flex !important;
        gap: 8px !important;
        justify-content: center !important;
        flex-wrap: wrap !important;
        list-style: none !important;
        padding: 0 !important;
        margin: 16px 0 !important;
    }
    
    .badge {
        background: var(--cor-cinza-2) !important;
        color: var(--cor-cinza-5) !important;
        padding: 6px 14px !important;
        border-radius: 100px !important;
        font-size: 0.75rem !important;
        font-weight: 500 !important;
    }
    
    .badge-prioridade {
        display: inline-block !important;
        padding: 4px 10px !important;
        border-radius: 4px !important;
        font-size: 0.6875rem !important;
        font-weight: 600 !important;
        text-transform: uppercase !important;
        margin-bottom: 10px !important;
        letter-spacing: 0.3px !important;
    }
    
    .badge-obrigatorio {
        background: var(--cor-erro) !important;
        color: var(--cor-branco) !important;
    }
    
    .badge-recomendado {
        background: var(--cor-verde) !important;
        color: var(--cor-branco) !important;
    }
    
    .acoes-resultado {
        display: flex !important;
        gap: 12px !important;
        justify-content: center !important;
        margin: 32px 0 !important;
        flex-wrap: wrap !important;
    }
    
    /* ============================================
       CÁPSULAS - MINIMALISTA
       ============================================ */
    .capsulas-recomendadas h2 {
        text-align: center !important;
        font-size: 1.25rem !important;
        font-weight: 600 !important;
        color: var(--cor-preto) !important;
        margin-bottom: 24px !important;
    }
    
    .capsulas-grid {
        display: grid !important;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)) !important;
        gap: 20px !important;
        margin-top: 24px !important;
    }
    
    .capsula-card {
        border: 1px solid var(--cor-cinza-2) !important;
        border-radius: 6px !important;
        padding: 20px !important;
        transition: all 0.2s ease !important;
        background: var(--cor-branco) !important;
        display: flex !important;
        flex-direction: column !important;
    }
    
    .capsula-card:hover {
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08) !important;
        border-color: var(--cor-cinza-3) !important;
    }
    
    .capsula-card.obrigatorio {
        border-left: 3px solid var(--cor-erro) !important;
    }
    
    .capsula-card.recomendado {
        border-left: 3px solid var(--cor-verde) !important;
    }
    
    .capsula-card h3 {
        margin: 10px 0 !important;
        color: var(--cor-preto) !important;
        font-size: 1rem !important;
        font-weight: 600 !important;
        line-height: 1.4 !important;
    }
    
    .capsula-card h3 a {
        text-decoration: none !important;
        color: inherit !important;
        transition: color 0.2s !important;
    }
    
    .capsula-card h3 a:hover {
        color: var(--cor-azul-govbr) !important;
    }
    
    .capsula-resumo {
        color: var(--cor-cinza-5) !important;
        line-height: 1.5 !important;
        margin: 10px 0 !important;
        flex-grow: 1 !important;
        font-size: 0.8125rem !important;
    }
    
    .capsula-tags {
        display: flex !important;
        gap: 6px !important;
        flex-wrap: wrap !important;
        margin: 10px 0 !important;
    }
    
    .tag {
        background: var(--cor-cinza-1) !important;
        padding: 3px 10px !important;
        border-radius: 100px !important;
        font-size: 0.6875rem !important;
        color: var(--cor-cinza-5) !important;
        font-weight: 500 !important;
    }
    
    .btn-ler-capsula {
        display: inline-flex !important;
        align-items: center !important;
        margin-top: 10px !important;
        color: var(--cor-azul-govbr) !important;
        text-decoration: none !important;
        font-weight: 600 !important;
        font-size: 0.8125rem !important;
        transition: all 0.2s !important;
    }
    
    .btn-ler-capsula:hover {
        color: #0C326F !important;
        text-decoration: underline !important;
    }
    
    .btn-ler-capsula::after {
        content: '→' !important;
        margin-left: 4px !important;
    }
    
    .sem-resultados {
        text-align: center !important;
        padding: 48px 20px !important;
        background: var(--cor-cinza-1) !important;
        border-radius: 8px !important;
        margin-top: 24px !important;
    }
    
    .sem-resultados p {
        font-size: 0.9375rem !important;
        color: var(--cor-cinza-5) !important;
        margin-bottom: 16px !important;
    }
    
    .texto-resultado {
        max-width: 700px !important;
        margin: 16px auto !important;
        font-size: 0.875rem !important;
        color: var(--cor-cinza-5) !important;
        line-height: 1.6 !important;
    }
    
    /* ============================================
       IMPRESSÃO
       ============================================ */
    @media print {
        .acoes-resultado,
        nav,
        footer,
        .btn,
        .quiz-progress,
        .btn-recomecar,
        .menu {
            display: none !important;
        }
        
        .capsulas-grid {
            display: block !important;
        }
        
        .capsula-card {
            page-break-inside: avoid !important;
            margin-bottom: 20px !important;
        }
    }
    
    /* ============================================
       RESPONSIVO
       ============================================ */
    @media (max-width: 768px) {
        .quiz-container {
            padding: 24px 16px !important;
        }
        
        .quiz-header h1,
        .resultado-header h1 {
            font-size: 1.25rem !important;
        }
        
        .pergunta-texto {
            font-size: 1rem !important;
        }
        
        .opcoes-grid {
            grid-template-columns: 1fr !important;
        }
        
        .capsulas-grid {
            grid-template-columns: 1fr !important;
        }
        
        .acoes-resultado {
            flex-direction: column !important;
        }
    }
</style>
{% endblock %}

{% block content %}

{% if e_resultado %}
    <div class="resultado-rotas">
        <div class="container">
            
            <header class="resultado-header">
                <h1>✅ Suas Recomendações Personalizadas</h1>
                
                <div class="resumo-respostas">
                    <h3>Com base no seu perfil:</h3>
                    <ul class="badges-respostas">
                        {% for chave, resposta in respostas.items %}
                            <li class="badge">
                                {{ resposta.texto }}
                            </li>
                        {% endfor %}
                    </ul>
                </div>
                
                {% if page.texto_resultado %}
                    <div class="texto-resultado">
                        {{ page.texto_resultado|richtext }}
                    </div>
                {% endif %}
            </header>
            
            <div class="acoes-resultado">
                <button onclick="window.print()" class="btn btn-primary btn-lg">
                    📄 Salvar / Imprimir PDF
                </button>
                
                <a href="{{ page.url }}" class="btn btn-secondary">
                    🔄 Fazer novo quiz
                </a>
            </div>
            
            <section class="capsulas-recomendadas">
                <h2>
                    Encontramos {{ total_capsulas }} 
                    {% if total_capsulas == 1 %}cápsula{% else %}cápsulas{% endif %}
                    para você
                </h2>
                
                {% if capsulas_recomendadas %}
                    <div class="capsulas-grid">
                        {% for capsula in capsulas_recomendadas %}
                            <article class="capsula-card {% if capsula.prioridade == 'obrigatorio' %}obrigatorio{% else %}recomendado{% endif %}">
                                
                                <span class="badge-prioridade {% if capsula.prioridade == 'obrigatorio' %}badge-obrigatorio{% else %}badge-recomendado{% endif %}">
                                    {% if capsula.prioridade == 'obrigatorio' %}
                                        ⚠️ Obrigatório
                                    {% else %}
                                        ✨ Recomendado
                                    {% endif %}
                                </span>
                                
                                <h3>
                                    <a href="{{ capsula.url }}">{{ capsula.title }}</a>
                                </h3>
                                
                                {% if capsula.resumo_card %}
                                    <p class="capsula-resumo">
                                        {{ capsula.resumo_card }}
                                    </p>
                                {% endif %}
                                
                                {% if capsula.tipos_deficiencia %}
                                    <div class="capsula-tags">
                                        {% for tipo in capsula.tipos_deficiencia %}
                                            <span class="tag">{{ tipo }}</span>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                                
                                <a href="{{ capsula.url }}" class="btn-ler-capsula">
                                    Ler cápsula completa
                                </a>
                            </article>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="sem-resultados">
                        <p>Não encontramos cápsulas específicas para este perfil ainda.</p>
                        <a href="{{ page.url }}" class="btn btn-primary">Tentar novamente</a>
                    </div>
                {% endif %}
            </section>
            
        </div>
    </div>

{% else %}
    <div class="quiz-container">
        
        <header class="quiz-header">
            <h1>{{ page.title }}</h1>
            {% if page.introducao %}
                {{ page.introducao|richtext }}
            {% endif %}
        </header>
        
        <div class="quiz-progress">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 33%"></div>
            </div>
            <span class="progress-text" id="progressText">Pergunta 1 de 3</span>
        </div>
        
        <div id="quizArea">
            
            <div class="pergunta-card" id="pergunta1" style="display: block;">
                <h2 class="pergunta-texto">Qual é o seu perfil profissional?</h2>
                <p class="pergunta-ajuda">Selecione a opção que melhor descreve sua função principal</p>
                
                <div class="opcoes-grid">
                    <button class="opcao-card" onclick="responderPergunta1('designer_instrucional', 'Designer Instrucional')">
                        <i>🎨</i>
                        <h3>Designer Instrucional</h3>
                        <p>Criar e estruturar conteúdos educacionais</p>
                    </button>
                    
                    <button class="opcao-card" onclick="responderPergunta1('designer_grafico', 'Designer Gráfico')">
                        <i>🖼️</i>
                        <h3>Designer Gráfico</h3>
                        <p>Criação de elementos visuais</p>
                    </button>
                    
                    <button class="opcao-card" onclick="responderPergunta1('docente', 'Docente')">
                        <i>👨‍🏫</i>
                        <h3>Docente</h3>
                        <p>Ministrar aulas e eventos educacionais</p>
                    </button>
                    
                    <button class="opcao-card" onclick="responderPergunta1('implementador_web', 'Implementador Web', true)">
                        <i>💻</i>
                        <h3>Implementador Web</h3>
                        <p>Implementar sistemas e plataformas</p>
                    </button>
                    
                    <button class="opcao-card" onclick="responderPergunta1('editor_video', 'Editor de Vídeo', true)">
                        <i>🎬</i>
                        <h3>Editor de Vídeo</h3>
                        <p>Edição e produção audiovisual</p>
                    </button>
                    
                    <button class="opcao-card" onclick="responderPergunta1('curador_conteudo', 'Curador de Conteúdo')">
                        <i>📁</i>
                        <h3>Curador de Conteúdo</h3>
                        <p>Selecionar e organizar conteúdos</p>
                    </button>
                    
                    <button class="opcao-card" onclick="responderPergunta1('conteudista', 'Conteudista')">
                        <i>✍️</i>
                        <h3>Conteudista</h3>
                        <p>Criar textos e materiais didáticos</p>
                    </button>
                </div>
            </div>
            
            <div class="pergunta-card" id="pergunta2a" style="display: none;">
                <h2 class="pergunta-texto">Com qual tipo de recurso você trabalha?</h2>
                <p class="pergunta-ajuda">Escolha o tipo de material que você mais produz ou edita</p>
                
                <div class="opcoes-grid">
                    <button class="opcao-card" onclick="responderPergunta2a('imagem', 'Imagem')">
                        <i>🖼️</i>
                        <h3>Imagem</h3>
                        <p>Fotos e ilustrações</p>
                    </button>
                    
                    <button class="opcao-card" onclick="responderPergunta2a('video', 'Vídeo')">
                        <i>▶️</i>
                        <h3>Vídeo</h3>
                        <p>Conteúdos em vídeo</p>
                    </button>
                    
                    <button class="opcao-card" onclick="responderPergunta2a('tabela', 'Tabela')">
                        <i>📊</i>
                        <h3>Tabela</h3>
                        <p>Dados tabulados</p>
                    </button>
                    
                    <button class="opcao-card" onclick="responderPergunta2a('grafico', 'Gráfico')">
                        <i>📈</i>
                        <h3>Gráfico</h3>
                        <p>Visualizações de dados</p>
                    </button>
                    
                    <button class="opcao-card" onclick="responderPergunta2a('texto', 'Texto')">
                        <i>📝</i>
                        <h3>Texto</h3>
                        <p>Materiais escritos</p>
                    </button>
                    
                    <button class="opcao-card" onclick="responderPergunta2a('audio', 'Áudio')">
                        <i>🎧</i>
                        <h3>Áudio</h3>
                        <p>Podcasts e áudio</p>
                    </button>
                    
                    <button class="opcao-card" onclick="responderPergunta2a('botao', 'Botão/Interface')">
                        <i>🖱️</i>
                        <h3>Botão/Interface</h3>
                        <p>Elementos de interface</p>
                    </button>
                    
                    <button class="opcao-card" onclick="responderPergunta2a('hiperlink', 'Hiperlink')">
                        <i>🔗</i>
                        <h3>Hiperlink</h3>
                        <p>Links e navegação</p>
                    </button>
                    
                    <button class="opcao-card" onclick="responderPergunta2a('videoconferencia', 'Videoconferência')">
                        <i>📹</i>
                        <h3>Videoconferência</h3>
                        <p>Reuniões online</p>
                    </button>
                </div>
            </div>
            
            <div class="pergunta-card" id="pergunta2b" style="display: none;">
                <h2 class="pergunta-texto">Qual formato de ação você trabalha?</h2>
                <p class="pergunta-ajuda">Selecione a modalidade de ensino</p>
                
                <div class="opcoes-grid">
                    <button class="opcao-card" onclick="responderPergunta2b('distancia_sincrono', 'A distância síncrono')">
                        <i>💻</i>
                        <h3>A distância síncrono</h3>
                        <p>Eventos online em tempo real</p>
                    </button>
                    
                    <button class="opcao-card" onclick="responderPergunta2b('distancia_assincrono', 'A distância assíncrono')">
                        <i>📚</i>
                        <h3>A distância assíncrono</h3>
                        <p>Conteúdo sob demanda</p>
                    </button>
                    
                    <button class="opcao-card" onclick="responderPergunta2b('presencial', 'Presencial')">
                        <i>🏫</i>
                        <h3>Presencial</h3>
                        <p>Eventos presenciais</p>
                    </button>
                    
                    <button class="opcao-card" onclick="responderPergunta2b('semipresencial', 'Semipresencial')">
                        <i>🔀</i>
                        <h3>Semipresencial</h3>
                        <p>Presencial e online</p>
                    </button>
                </div>
            </div>
            
        </div>
        
        <aside class="escolhas-resumo" id="escolhasResumo" style="display: none;">
            <h4>Suas escolhas:</h4>
            <ul id="listaEscolhas"></ul>
        </aside>
        
        <a href="{{ page.url }}" class="btn-recomecar" style="display: none;" id="btnRecomecar">
            ← Recomeçar
        </a>
        
    </div>

{% endif %}

<script>
    let respostas = {};
    
    function construirUrlResultado() {
        let params = new URLSearchParams();
        
        if (respostas.perfil_profissional) {
            params.append('perfil', respostas.perfil_profissional.valor);
            params.append('perfil_texto', respostas.perfil_profissional.texto);
        }
        
        if (respostas.tipo_recurso) {
            params.append('recurso', respostas.tipo_recurso.valor);
            params.append('recurso_texto', respostas.tipo_recurso.texto);
        }
        
        if (respostas.formato_acao) {
            params.append('formato', respostas.formato_acao.valor);
            params.append('formato_texto', respostas.formato_acao.texto);
        }
        
        params.append('resultado', '1');
        
        return '{{ page.url }}?' + params.toString();
    }
    
    function atualizarProgresso(atual, total) {
        const percentual = (atual / total) * 100;
        document.getElementById('progressFill').style.width = percentual + '%';
        document.getElementById('progressText').textContent = `Pergunta ${atual} de ${total}`;
    }
    
    function atualizarResumo() {
        const resumo = document.getElementById('escolhasResumo');
        const lista = document.getElementById('listaEscolhas');
        const btnRecomecar = document.getElementById('btnRecomecar');
        
        lista.innerHTML = '';
        
        if (Object.keys(respostas).length > 0) {
            for (let [chave, resposta] of Object.entries(respostas)) {
                const li = document.createElement('li');
                const chaveFormatada = chave.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                li.innerHTML = `<strong>${chaveFormatada}:</strong> ${resposta.texto}`;
                lista.appendChild(li);
            }
            resumo.style.display = 'block';
            btnRecomecar.style.display = 'inline-block';
        }
    }
    
    function responderPergunta1(valor, texto, irParaResultado = false) {
        respostas['perfil_profissional'] = {
            valor: valor,
            texto: texto
        };
        
        event.target.closest('.opcao-card').classList.add('selecionado');
        
        setTimeout(() => {
            document.getElementById('pergunta1').style.display = 'none';
            
            atualizarResumo();
            
            if (irParaResultado) {
                window.location.href = construirUrlResultado();
            } else if (valor === 'docente') {
                atualizarProgresso(2, 2);
                document.getElementById('pergunta2b').style.display = 'block';
            } else {
                atualizarProgresso(2, 2);
                document.getElementById('pergunta2a').style.display = 'block';
            }
        }, 300);
    }
    
    function responderPergunta2a(valor, texto) {
        respostas['tipo_recurso'] = {
            valor: valor,
            texto: texto
        };
        
        event.target.closest('.opcao-card').classList.add('selecionado');
        
        setTimeout(() => {
            atualizarResumo();
            window.location.href = construirUrlResultado();
        }, 300);
    }
    
    function responderPergunta2b(valor, texto) {
        respostas['formato_acao'] = {
            valor: valor,
            texto: texto
        };
        
        event.target.closest('.opcao-card').classList.add('selecionado');
        
        setTimeout(() => {
            atualizarResumo();
            window.location.href = construirUrlResultado();
        }, 300);
    }
    
    document.addEventListener('DOMContentLoaded', function() {
        atualizarProgresso(1, 2);
    });
</script>
{% endblock %}