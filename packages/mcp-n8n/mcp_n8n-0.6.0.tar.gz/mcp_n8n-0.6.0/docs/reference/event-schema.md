---
title: "Event Schema Reference"
type: reference
audience: all
version: 0.4.0
test_extraction: yes
category: schema
source: "src/mcp_n8n/memory/trace.py, src/mcp_n8n/memory/event_log.py, src/mcp_n8n/gateway.py"
last_updated: 2025-10-21
---

# Event Schema Reference

## Overview

Complete reference for mcp-n8n event structure, event types, and telemetry schema.

**Status:** ✅ Stable
**Version:** 0.4.0 (Schema version 1.0)
**Last Updated:** 2025-10-21

---

## Event Structure

All events follow the Chora ecosystem event schema format:

```json
{
  "timestamp": "2025-10-21T14:32:10.123456+00:00",
  "trace_id": "550e8400-e29b-41d4-a716-446655440000",
  "status": "success",
  "schema_version": "1.0",
  "event_type": "gateway.started",
  "source": "mcp-n8n",
  "metadata": {
    "version": "0.4.0",
    "backend_count": 2,
    "event_monitoring_enabled": true
  }
}
```

---

## Field Definitions

### timestamp

**Type:** string (ISO 8601 format with timezone)
**Required:** Yes
**Description:** UTC timestamp when event was emitted

**Format:** `YYYY-MM-DDTHH:MM:SS.ffffff+00:00`

**Example:**
```json
"timestamp": "2025-10-21T14:32:10.123456+00:00"
```

**Generated by:** [trace.py:84](../../src/mcp_n8n/memory/trace.py#L84)

---

### trace_id

**Type:** string (UUID v4)
**Required:** Yes
**Description:** Unique identifier for correlating related events across services

**Format:** UUID v4 (e.g., `550e8400-e29b-41d4-a716-446655440000`)

**Example:**
```json
"trace_id": "550e8400-e29b-41d4-a716-446655440000"
```

**Propagation:**
- Set via `CHORA_TRACE_ID` environment variable
- Automatically propagated to backend subprocesses
- Preserved across tool calls in a workflow

**See:** [TraceContext](#tracecontext) for usage

---

### status

**Type:** string (enum)
**Required:** Yes
**Valid Values:** `"success"`, `"failure"`, `"pending"`
**Description:** Outcome status of the event

**Values:**
- `"success"` - Operation completed successfully
- `"failure"` - Operation failed (check metadata.error)
- `"pending"` - Operation still in progress (rare)

**Example:**
```json
"status": "success"
```

---

### schema_version

**Type:** string
**Required:** Yes
**Current Version:** `"1.0"`
**Description:** Event schema version for compatibility

**Example:**
```json
"schema_version": "1.0"
```

**Stability:** Version 1.0 is stable. Breaking changes will increment the version.

---

### event_type

**Type:** string
**Required:** Yes
**Format:** `{category}.{action}` (dot-separated namespacing)
**Description:** Semantic event type identifier

**Examples:**
```json
"event_type": "gateway.started"
"event_type": "gateway.backend_registered"
"event_type": "gateway.tool_call"
```

**See:** [Event Types](#event-types) for complete list

---

### source

**Type:** string
**Required:** Yes
**Default:** `"mcp-n8n"`
**Description:** System component that emitted the event

**Values:**
- `"mcp-n8n"` - Gateway-level events
- `"chora-composer"` - Chora Composer backend events (when forwarded)
- `"coda-mcp"` - Coda MCP backend events (when forwarded)
- `"workflow:{name}"` - Workflow-specific events

**Example:**
```json
"source": "mcp-n8n"
```

---

### metadata

**Type:** object (key-value pairs)
**Required:** Yes (can be empty)
**Description:** Event-specific contextual data

**Structure:** Varies by event type

**Common Fields:**
- `error` (string) - Error message for failure status
- `duration_ms` (number) - Operation duration in milliseconds
- `backend_name` (string) - Backend involved in operation
- `tool_name` (string) - Tool name for tool-related events

**Example:**
```json
"metadata": {
  "version": "0.4.0",
  "backend_count": 2,
  "event_monitoring_enabled": true
}
```

---

## Event Types

### Gateway Lifecycle Events

#### gateway.started

**Description:** Gateway initialization completed
**Status:** Always `"success"`
**Emitted by:** [gateway.py:81](../../src/mcp_n8n/gateway.py#L81)

**Metadata:**
- `version` (string) - Gateway version (e.g., "0.4.0")
- `backend_count` (integer) - Number of configured backends
- `event_monitoring_enabled` (boolean) - Whether EventWatcher is active

**Example:**
```json
{
  "timestamp": "2025-10-21T14:32:10.123456+00:00",
  "trace_id": "550e8400-e29b-41d4-a716-446655440000",
  "status": "success",
  "schema_version": "1.0",
  "event_type": "gateway.started",
  "source": "mcp-n8n",
  "metadata": {
    "version": "0.4.0",
    "backend_count": 2,
    "event_monitoring_enabled": true
  }
}
```

---

#### gateway.stopped

**Description:** Gateway shutdown completed
**Status:** Always `"success"`
**Emitted by:** [gateway.py:147](../../src/mcp_n8n/gateway.py#L147)

**Metadata:** (empty)

**Example:**
```json
{
  "timestamp": "2025-10-21T16:45:22.654321+00:00",
  "trace_id": "550e8400-e29b-41d4-a716-446655440000",
  "status": "success",
  "schema_version": "1.0",
  "event_type": "gateway.stopped",
  "source": "mcp-n8n",
  "metadata": {}
}
```

---

### Backend Events

#### gateway.backend_registered

**Description:** Backend registered in BackendRegistry
**Status:** `"success"` or `"failure"`
**Emitted by:** [gateway.py:95](../../src/mcp_n8n/gateway.py#L95), [gateway.py:104](../../src/mcp_n8n/gateway.py#L104)

**Metadata (success):**
- `backend_name` (string) - Backend identifier
- `namespace` (string) - Tool namespace (e.g., "chora", "coda")
- `capabilities` (list) - Capability categories

**Metadata (failure):**
- `backend_name` (string) - Backend identifier
- `error` (string) - Error message

**Example (success):**
```json
{
  "timestamp": "2025-10-21T14:32:11.234567+00:00",
  "trace_id": "550e8400-e29b-41d4-a716-446655440000",
  "status": "success",
  "schema_version": "1.0",
  "event_type": "gateway.backend_registered",
  "source": "mcp-n8n",
  "metadata": {
    "backend_name": "chora-composer",
    "namespace": "chora",
    "capabilities": ["artifacts", "content_generation"]
  }
}
```

---

#### gateway.backend_started

**Description:** Backend subprocess started and initialized
**Status:** `"success"` or `"failure"`
**Emitted by:** [gateway.py:118](../../src/mcp_n8n/gateway.py#L118)

**Metadata:**
- `backend_name` (string) - Backend identifier
- `namespace` (string) - Tool namespace
- `tool_count` (integer) - Number of tools discovered

**Example:**
```json
{
  "timestamp": "2025-10-21T14:32:12.345678+00:00",
  "trace_id": "550e8400-e29b-41d4-a716-446655440000",
  "status": "success",
  "schema_version": "1.0",
  "event_type": "gateway.backend_started",
  "source": "mcp-n8n",
  "metadata": {
    "backend_name": "chora-composer",
    "namespace": "chora",
    "tool_count": 4
  }
}
```

---

### Tool Execution Events

#### gateway.tool_call

**Description:** MCP tool invocation (start or result)
**Status:** `"success"`, `"failure"`, or `"pending"`
**Source:** Varies (gateway, workflows)

**Metadata:**
- `tool_name` (string) - Full tool name with namespace (e.g., "chora:generate_content")
- `backend_name` (string) - Backend handling the tool
- `arguments` (object, optional) - Tool arguments (in pending events)
- `result` (object, optional) - Tool result (in success events)
- `error` (string, optional) - Error message (in failure events)
- `duration_ms` (number, optional) - Execution time

**Example:**
```json
{
  "timestamp": "2025-10-21T14:33:05.567890+00:00",
  "trace_id": "550e8400-e29b-41d4-a716-446655440000",
  "status": "success",
  "schema_version": "1.0",
  "event_type": "gateway.tool_call",
  "source": "mcp-n8n",
  "metadata": {
    "tool_name": "chora:generate_content",
    "backend_name": "chora-composer",
    "duration_ms": 1234
  }
}
```

---

### Workflow Events

#### workflow.started

**Description:** Workflow execution began
**Status:** Always `"pending"`
**Source:** `workflow:{workflow_name}`

**Metadata:**
- `workflow_name` (string) - Workflow identifier
- `parameters` (object) - Workflow input parameters

---

#### workflow.completed

**Description:** Workflow execution finished successfully
**Status:** Always `"success"`
**Source:** `workflow:{workflow_name}`

**Metadata:**
- `workflow_name` (string) - Workflow identifier
- `duration_ms` (number) - Total execution time
- `result_summary` (object) - Workflow-specific results

---

#### workflow.failed

**Description:** Workflow execution failed
**Status:** Always `"failure"`
**Source:** `workflow:{workflow_name}`

**Metadata:**
- `workflow_name` (string) - Workflow identifier
- `error` (string) - Failure reason
- `duration_ms` (number) - Time until failure

---

## TraceContext

**Purpose:** Manage trace ID scope for correlated events

**Usage:**
```python
from mcp_n8n.memory import TraceContext, emit_event

# Create new trace
with TraceContext() as trace_id:
    emit_event("workflow.started", trace_id=trace_id, workflow_name="daily_report")
    # ... perform operations ...
    emit_event("workflow.completed", trace_id=trace_id, duration_ms=1500)
```

**Implementation:** [trace.py:32-60](../../src/mcp_n8n/memory/trace.py#L32-L60)

**Features:**
- Generates UUID v4 trace IDs automatically
- Propagates via `CHORA_TRACE_ID` environment variable
- Context manager restores previous trace ID on exit
- Subprocesses inherit parent trace ID

---

## Event Storage

### File Structure

Events are stored in monthly partitions with dual indexing:

```
.chora/memory/events/
├── 2025-10/
│   ├── events.jsonl              # All events (chronological)
│   └── traces/
│       ├── {trace-id-1}.jsonl    # Events for trace 1
│       ├── {trace-id-2}.jsonl    # Events for trace 2
│       └── ...
├── 2025-11/
│   ├── events.jsonl
│   └── traces/
│       └── ...
└── ...
```

**Format:** JSONL (one JSON event per line)

**Indexing:**
1. **Chronological** - `events.jsonl` for time-range queries
2. **By Trace** - `traces/{trace_id}.jsonl` for trace correlation

**Implementation:** [trace.py:99-128](../../src/mcp_n8n/memory/trace.py#L99-L128)

---

## Querying Events

### Via get_events Tool

**MCP Tool:** `get_events` (gateway tool, no namespace)

**Parameters:**
- `trace_id` (string, optional) - Filter by trace ID
- `event_type` (string, optional) - Filter by event type
- `status` (string, optional) - Filter by status
- `since` (string, optional) - Time range (e.g., "24h", "7d", ISO timestamp)
- `limit` (integer, optional) - Max results (default: 100, max: 1000)

**Example:**
```json
{
  "tool": "get_events",
  "arguments": {
    "event_type": "gateway.backend_started",
    "status": "success",
    "since": "24h",
    "limit": 10
  }
}
```

**See:** [Tools Reference](tools.md#get_events) for full documentation

### Via EventLog API

**Python API:**
```python
from mcp_n8n.memory import EventLog

log = EventLog()

# Get all events for a trace
events = log.get_by_trace("550e8400-e29b-41d4-a716-446655440000")

# Query with filters
from datetime import datetime, timedelta, UTC
events = log.query(
    event_type="gateway.tool_call",
    status="success",
    since=datetime.now(UTC) - timedelta(hours=24),
    limit=100
)
```

**Implementation:** [event_log.py:13-200](../../src/mcp_n8n/memory/event_log.py#L13-L200)

---

## Event Retention

**Default:** 7 days (configurable via future environment variable)

**Storage Location:** `.chora/memory/events/` (local filesystem)

**Partitioning:** Monthly directories (e.g., `2025-10/`, `2025-11/`)

**Cleanup:** Manual (automatic cleanup planned for future release)

**Backup:** Events persist on disk; back up `.chora/` directory to preserve history

---

## Event Forwarding

### n8n Webhook Integration

Events can be forwarded to an n8n webhook for real-time monitoring:

**Configuration:**
```bash
export N8N_EVENT_WEBHOOK_URL="https://your-n8n.com/webhook/events"
```

**Forwarding:**
- All events sent via HTTP POST to webhook URL
- Payload: Full event JSON (same schema as above)
- Async (non-blocking) - gateway doesn't wait for webhook response
- Retries: None (fire-and-forget)

**Use Cases:**
- Real-time dashboards
- Alert on failures
- Usage analytics
- Workflow triggers

**Implementation:** EventWatcher forwards events from `var/telemetry/events.jsonl` to webhook

---

## Examples

### Example 1: Query Recent Failures

Get all failed events from the last 24 hours:

```python
from mcp_n8n.memory import query_events

failures = query_events(
    status="failure",
    since_hours=24
)

for event in failures:
    print(f"{event['timestamp']}: {event['event_type']} - {event['metadata'].get('error')}")
```

**Expected Output:**
```
2025-10-21T14:30:12+00:00: gateway.backend_registered - Backend not found
2025-10-21T15:45:33+00:00: gateway.tool_call - Tool execution timeout
```

---

### Example 2: Trace a Workflow

Get all events for a specific workflow trace:

```python
from mcp_n8n.memory import EventLog

log = EventLog()
trace_events = log.get_by_trace("550e8400-e29b-41d4-a716-446655440000")

print(f"Found {len(trace_events)} events for trace")
for event in trace_events:
    print(f"  {event['event_type']} ({event['status']})")
```

**Expected Output:**
```
Found 5 events for trace
  workflow.started (pending)
  gateway.tool_call (success)
  gateway.tool_call (success)
  gateway.tool_call (success)
  workflow.completed (success)
```

---

### Example 3: Aggregate Tool Usage

Count tool calls by backend:

```python
from mcp_n8n.memory import EventLog
from datetime import datetime, timedelta, UTC

log = EventLog()
stats = log.aggregate(
    group_by="event_type",
    metric="count",
    since=datetime.now(UTC) - timedelta(days=7)
)

print("Tool usage (last 7 days):")
for event_type, count in sorted(stats.items(), key=lambda x: x[1], reverse=True):
    if "tool_call" in event_type:
        print(f"  {event_type}: {count}")
```

**Expected Output:**
```
Tool usage (last 7 days):
  gateway.tool_call: 42
```

---

## Schema Evolution

**Current Version:** 1.0

**Compatibility:**
- Minor changes (new optional fields) - No version bump
- Breaking changes (field removal, type changes) - Major version bump

**Future Additions (planned):**
- `parent_span_id` - For nested spans within a trace
- `span_id` - Unique identifier for this span
- `duration_ms` - Standardized duration field (currently in metadata)
- Event-specific schemas (subtypes of gateway.tool_call, etc.)

---

## Related Documentation

- [Tools Reference](tools.md#get_events) - get_events tool documentation
- [Configuration Reference](configuration.md) - N8N_EVENT_WEBHOOK_URL setting
- [How-To: Query Events](../how-to/query-events.md) - Querying guide
- [Explanation: Memory System](../explanation/memory-system.md) - Architecture overview

---

**Source:** [src/mcp_n8n/memory/trace.py](../../src/mcp_n8n/memory/trace.py), [src/mcp_n8n/memory/event_log.py](../../src/mcp_n8n/memory/event_log.py), [src/mcp_n8n/gateway.py](../../src/mcp_n8n/gateway.py)
**Test Extraction:** Yes (from event monitoring tests)
**Last Updated:** 2025-10-21
