{% extends "base.html" %}
{% block content %}
<style>
    .level-info {
        color: forestgreen;
    }

    .level-warning {
        color: yellow
    }

    .level-error {
        color: red
    }

    ul {
      list-style-type: none;
      padding: 0;
      margin: 0;
    }

    li {
      display: flex;
      align-items: baseline;
    }

    li .number {
      width: 50px;
      text-align: right;
      font-family: monospace;
      padding-right: 10px;
    }

    li .text {
      flex: 1;
    }

    .event-text {
        word-wrap: break-word;
        word-break: break-all;
    }

    .event-text-word-break {
        word-wrap: break-word;
        word-break: break-word;
    }
</style>
<div class="row">
    <div class="col-md-12">
        <div style="padding: '10px'; display: 'grid'; justify-items: 'center'; align-items: 'center'; width: '100%';">
            <div style="display: grid; justify-items: center; align-items: center;">
                <h2>Security Plan Processing Results for Source Document "{{ filename }}"</h2>
                <br>
                <h1>System Security Plan Created!</h1>
                <h3 style="padding: 5px;"><i>"{{result_output.ssp_title}}" (# {{ result_output.ssp_id }}) in
                        RegScale</i></h3>
                <br>
                <a href="{{ site_info.domain }}/form/securityplans/{{ result_output.ssp_id }}"
                   target="_blank"
                   style="text-align: center;"
                   rel="noopener"
                >
                <button type="button" class="btn btn-primary" target="_blank">
                    View Security Plan In RegScale &#x2197;
                </button>
                </a>
            </div>
            <p>&nbsp;</p>
            <div class="col-md-12 border bg-light" style="padding: 20px; border-radius: 10px;">
                <h2 class="level-info">Summary</h2>
                <div style="padding: 10px; border-radius: 10px;">
                    <h2><b>{{ results.Info + results.Error }}</b> Items in source document processed</h2>
                    <ul style="font-size: 1.25em;">
                        <li><span class="number"><b>{{ results.Info }}</b></span><span class="text">Items successfully mapped to created Security Plan</span></li>
                        <li><span class="number"><b>{{ results.Error }}</b></span><span class="text">Items failed to map to created Security Plan</span></li>
                        <li><span class="number"><b>{{ result_output.implementations_loaded }}</b></span><span class="text">Control items successfully mapped to created Security Plan<span class="text"></li>
                    </ul>
                    <hr>
                    <h3>{{ (results.Info / (results.Info + results.Error) *
                        100)|round(1)}}% <i>Item processing success rate</i>
                    </h3>
                </div>
            </div>
            <p>&nbsp;</p>
            <div class="col-md-12 border bg-light" style="padding: 20px; border-radius: 10px;">
                <h2 class="level-info">Items by Category</h2>
                <ul>
                    {% for item in category_counts.items() %}
                    <li><span class="number">{{ item[1] }}</span><span class="text">{{ item[0] }}</span></li>
                    {% endfor %}
                </ul>
                <br>

            </div>
        </div>
        <p>&nbsp;</p>
        <div class="col-md-12">
            <div class="p-12 border bg-light" style="padding: 10px; border-radius: 10px;">

                {% for level, rows in csv_data_grouped.items()%}
                <h2 class="level-{{ level|lower }}">{{ level }} Results</h2>
                <caption><i>The {{ level|lower }} statements found processing source document.</i></caption>
                <table style="table-layout: fixed; width: 100%;">
                  <thead>
                    <tr style="text-align: left;">
                      <th class="event-text-word-break" style="width: 20%;">NIST Model Layer Item</th>
                      <th style="width: 20%;">Record Type</th>
                      <th style="width: 60%;">Event</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for row in rows %}
                    <tr>
                      <td class="event-text-word-break">{{ row['model_layer'] }}</td>
                      <td class="event-text-word-break">{{ row['record_type'] }}</td>
                      <td class="event-text">{{ row['event'] }}</td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
                {% endfor %}

            </div>
        </div>

    </div>

    {% endblock %}