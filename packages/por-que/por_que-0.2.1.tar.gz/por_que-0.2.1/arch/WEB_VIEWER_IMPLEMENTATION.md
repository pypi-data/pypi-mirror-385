# Por-Que Web Viewer Planning and Implementation Guide

## Overview
A static web application for visualizing Parquet file structure and metadata from JSON exports generated by the `por-que` CLI tool.

## Goals
- **Pure static webapp** - no server required
- **File-agnostic** - loads any por-que JSON export
- **Focus on structure** - not data values
- **Educational** - helps users understand Parquet internals
- **Performance insights** - identify optimization opportunities

## JSON Export Specification

### Required JSON Structure
```json
{
  "version": "1.0",
  "file": {
    "path": "data.parquet",
    "size": 1024000,
    "created_at": "2024-01-01T00:00:00Z",
    "magic": {
      "offset": 0,
      "length": 4,
      "value": "PAR1"
    },
    "footer": {
      "offset": 1023992,
      "length": 8,
      "metadata_length": 1200
    }
  },
  "metadata": {
    "offset": 1022792,
    "length": 1200,
    "version": 1,
    "created_by": "parquet-mr version 1.12.0",
    "num_rows": 1000000,
    "key_value_metadata": {
      "pandas": "{\"index_columns\": [], ...}"
    }
  },
  "schema": {
    "name": "schema",
    "type": "group",
    "repetition": "required",
    "fields": [
      {
        "name": "user_id",
        "type": "int64",
        "repetition": "required",
        "logical_type": "INT_64"
      },
      {
        "name": "profile",
        "type": "group",
        "repetition": "optional",
        "fields": [
          {
            "name": "email",
            "type": "byte_array",
            "repetition": "optional",
            "logical_type": "STRING"
          },
          {
            "name": "created_at",
            "type": "int64",
            "repetition": "required",
            "logical_type": "TIMESTAMP_MICROS"
          }
        ]
      }
    ]
  },
  "row_groups": [
    {
      "index": 0,
      "offset": 4,
      "total_byte_size": 512000,
      "num_rows": 500000,
      "columns": [
        {
          "name": "user_id",
          "path": ["user_id"],
          "type": "INT64",
          "file_offset": 4,
          "meta_data": {
            "encodings": ["PLAIN", "RLE"],
            "codec": "SNAPPY",
            "num_values": 500000,
            "null_count": 0,
            "compressed_size": 50000,
            "uncompressed_size": 80000,
            "compression_ratio": 1.6,
            "data_page_offset": 4,
            "dictionary_page_offset": null,
            "statistics": {
              "min": 1,
              "max": 500000,
              "null_count": 0,
              "distinct_count": 500000
            }
          }
        },
        {
          "name": "profile.email",
          "path": ["profile", "email"],
          "type": "BYTE_ARRAY",
          "file_offset": 50004,
          "meta_data": {
            "encodings": ["PLAIN", "RLE", "RLE_DICTIONARY"],
            "codec": "SNAPPY",
            "num_values": 500000,
            "null_count": 150000,
            "compressed_size": 120000,
            "uncompressed_size": 400000,
            "compression_ratio": 3.33,
            "data_page_offset": 51028,
            "dictionary_page_offset": 50004,
            "statistics": {
              "min": "a@example.com",
              "max": "zzz@example.com",
              "null_count": 150000,
              "distinct_count": 320000
            }
          }
        },
        {
          "name": "profile.created_at",
          "path": ["profile", "created_at"],
          "type": "INT64",
          "file_offset": 170004,
          "meta_data": {
            "encodings": ["PLAIN", "RLE"],
            "codec": "SNAPPY",
            "num_values": 350000,
            "null_count": 0,
            "compressed_size": 35000,
            "uncompressed_size": 56000,
            "compression_ratio": 1.6,
            "data_page_offset": 170004,
            "dictionary_page_offset": null,
            "statistics": {
              "min": 1577836800000000,
              "max": 1704067200000000,
              "null_count": 0,
              "distinct_count": null
            }
          }
        }
      ]
    },
    {
      "index": 1,
      "offset": 512004,
      "total_byte_size": 510788,
      "num_rows": 500000,
      "columns": [
        {
          "name": "user_id",
          "path": ["user_id"],
          "type": "INT64",
          "file_offset": 512004,
          "meta_data": {
            "encodings": ["PLAIN", "RLE"],
            "codec": "SNAPPY",
            "num_values": 500000,
            "null_count": 0,
            "compressed_size": 50000,
            "uncompressed_size": 80000,
            "compression_ratio": 1.6,
            "data_page_offset": 512004,
            "dictionary_page_offset": null,
            "statistics": {
              "min": 500001,
              "max": 1000000,
              "null_count": 0,
              "distinct_count": 500000
            }
          }
        }
      ]
    }
  ],
  "statistics": {
    "total_rows": 1000000,
    "total_columns": 3,
    "total_row_groups": 2,
    "compression": {
      "total_uncompressed": 10485760,
      "total_compressed": 5242880,
      "ratio": 2.0,
      "space_saved_percent": 50.0
    },
    "row_group_size": {
      "min": 450000,
      "max": 550000,
      "avg": 500000
    }
  }
}
```

## Webapp Architecture

### Technology Stack
- **Framework**: **Vue 3**, used directly via a CDN link (no build step). Chosen to declaratively manage the state of the interactive UI components (e.g., selections, filters, sorts) and ensure the view stays in sync with the data.
- **Visualization**: D3.js for interactive charts, integrated within Vue components where necessary.
- **Dependency Pinning**: To ensure long-term stability without a build step, all external libraries (e.g., Vue, D3.js) must be loaded from a CDN using links that specify an exact version number.
- **UI Components**: Custom CSS or lightweight framework (Pico.css)
- **Icons**: Lucide icons (tree-friendly SVGs)
- **File Handling**: Native File API with drag-and-drop, managed within a Vue component.

### Project Structure
```
webapp/
├── index.html           # Main application
├── css/
│   ├── main.css        # Core styles
│   └── components.css  # Component-specific styles
├── js/
│   ├── app.js          # Main application logic
│   ├── parser.js       # JSON parsing and validation
│   ├── views/
│   │   ├── schema.js   # Schema tree visualization
│   │   ├── rowgroups.js # Row group charts
│   │   ├── stats.js    # Statistics dashboard
│   │   └── metadata.js # Metadata explorer
│   └── utils/
│       ├── formatters.js # Byte formatting, etc.
│       └── colors.js    # Color schemes
├── assets/
│   └── icons/          # SVG icons
└── README.md
```

## Core Features

### 1. File Input
- **Drag-and-drop** zone for JSON files
- **File picker** button as fallback
- **URL input** for hosted JSON files
- **Recent files** list (localStorage)

### 2. Navigation
- **Tab-based interface** with sections:
  - Overview
  - Schema
  - Row Groups
  - Columns
  - Metadata
  - Structure Map

### 3. Overview Dashboard
- **File summary** card
  - Filename, size, row count
  - Created by, version
  - Compression statistics
- **Quick stats** visualization
  - Pie chart of compressed vs uncompressed
  - Row group distribution
  - Column type breakdown

### 4. Schema Explorer
- **Interactive tree view**
  - Expand/collapse groups
  - Type badges (INT64, STRING, etc.)
  - Repetition level indicators
  - Logical type annotations
- **Search functionality**
  - Find columns by name
  - Filter by type
  - Highlight matches
- **Schema statistics**
  - Depth of nesting
  - Total fields count
  - Type distribution

### 5. Row Group Analysis
- **Row group table**
  - Byte offset and size
  - Row count, compression ratio
  - Sortable columns
  - Expandable for column details
- **Visualizations**
  - Bar chart of row group sizes
  - Compression efficiency chart
  - Row distribution timeline
  - Byte offset timeline
- **Performance insights**
  - Identify skewed distributions
  - Flag potential issues

### 6. Column Deep Dive
- **Column selector** dropdown/search
- **Column details panel**
  - File offset and size
  - Encoding chain
  - Compression statistics
  - Null count and percentage
  - Min/max values (if available)
  - Page offset information
- **Column comparison** view
  - Compare multiple columns side-by-side
  - Identify optimization opportunities

### 7. Metadata Explorer
- **Key-value browser**
  - Searchable/filterable
  - JSON pretty-printer for complex values
  - Copy-to-clipboard functionality
- **Standard metadata** highlighting
  - Created by
  - Schema versions
  - Tool-specific metadata

### 8. Structure Map Visualization
- **File layout diagram**
  - Visual representation of byte ranges
  - Magic bytes, row groups, metadata, footer
  - Interactive hover for details
  - Zoom and pan for large files
- **Byte offset table**
  - Complete listing of all structures
  - Start offset, end offset, size
  - Click to highlight in diagram

## UI/UX Design Principles

### Visual Design
- **Clean, modern interface** - focus on data
- **Consistent color coding**
  - Types: Blue for numeric, green for string, orange for complex
  - Performance: Red for warnings, yellow for cautions, green for optimal
  - Structure: Different colors for different file sections
- **Dark/light mode** toggle
- **Responsive design** - works on tablets/phones

### Interaction Patterns
- **Progressive disclosure** - start simple, reveal complexity
- **Contextual help** - tooltips explaining Parquet concepts
- **Keyboard shortcuts** - for power users
- **Shareable state** - URL updates with current view

### Initial View / Empty State
- Before a file is loaded, the application will display a clean, welcoming interface.
- This initial view will feature a prominent drag-and-drop zone as the primary call to action.
- A secondary file picker button will be available for users who prefer browsing.
- The interface will be free of clutter, focusing the user's attention on the task of loading a JSON export.

## Implementation Phases

### Phase 1: MVP (1-2 weeks)
- [ ] Basic file input (drag-and-drop)
- [ ] JSON parsing and validation
- [ ] Simple overview display
- [ ] Schema tree view (static)
- [ ] Basic styling

### Phase 2: Core Features (2-3 weeks)
- [ ] Tab navigation system
- [ ] Row group table with byte offsets
- [ ] Schema search/filter
- [ ] Column detail view with offsets
- [ ] Metadata browser

### Phase 3: Visualizations (2-3 weeks)
- [ ] D3.js integration
- [ ] Compression charts
- [ ] Row group visualizations
- [ ] Column comparison view
- [ ] Performance insights
- [ ] Basic structure map diagram

### Phase 4: Polish (1-2 weeks)
- [ ] Dark mode
- [ ] Export functionality (PNG, SVG)
- [ ] Keyboard shortcuts
- [ ] Help system/tour
- [ ] Error handling improvements
- [ ] Mobile responsive design

### Phase 5: Advanced Features (Optional)
- [ ] Multiple file comparison
- [ ] Schema diff visualization
- [ ] Performance recommendations
- [ ] Shareable visualizations
- [ ] Advanced structure map with zoom/pan

## Technical Considerations

### Browser Compatibility
- Target modern browsers (Chrome, Firefox, Safari, Edge)
- ES6+ JavaScript (no IE11 support)
- CSS Grid and Flexbox

### Performance
- Lazy loading for large schemas
- Virtual scrolling for long lists
- Web Workers for heavy computations
- Debounced search/filter

### State Management
- URL-based state for shareability
- LocalStorage for preferences
- Session storage for temporary data

### Error Handling
- Graceful JSON validation errors
- Clear error messages
- Fallback views for missing data

## Development Workflow

### Setup
```bash
# No build step required
cd webapp
python -m http.server 8000
# Open http://localhost:8000
```

### Testing
- Unit tests for parsers/utilities
- Visual regression tests for charts
- Manual testing with various JSON files

### Distribution
- Single ZIP file with all assets
- Host on GitHub Pages
- NPM package (optional)

## Implementation Checklist

### Setup and Infrastructure
- [ ] Create webapp directory structure
- [ ] Set up basic HTML template
- [ ] Configure CSS framework/reset
- [ ] Set up JavaScript module structure
- [ ] Create development server script

### File Input Implementation
- [ ] Implement drag-and-drop zone
- [ ] Add file picker input
- [ ] Create JSON parser with validation
- [ ] Add error handling for invalid JSON
- [ ] Implement recent files storage

### Overview Dashboard
- [ ] Create file summary component
- [ ] Implement basic statistics display
- [ ] Add compression ratio visualization
- [ ] Create row group summary chart
- [ ] Add column type breakdown

### Schema Explorer
- [ ] Implement tree data structure
- [ ] Create expandable tree UI
- [ ] Add type badges and icons
- [ ] Implement search functionality
- [ ] Add schema statistics panel

### Row Group Analysis
- [ ] Create row group table component
- [ ] Add sorting functionality
- [ ] Implement expandable rows
- [ ] Create size visualization chart
- [ ] Add compression efficiency chart
- [ ] Implement byte offset display

### Column Deep Dive
- [ ] Create column selector UI
- [ ] Implement detail panel
- [ ] Add encoding display
- [ ] Show compression statistics
- [ ] Display offset information
- [ ] Create comparison view

### Metadata Explorer
- [ ] Create key-value display
- [ ] Implement search/filter
- [ ] Add JSON pretty-printer
- [ ] Implement copy functionality
- [ ] Highlight standard metadata

### Structure Map
- [ ] Design file layout visualization
- [ ] Implement byte range calculations
- [ ] Create interactive diagram
- [ ] Add hover tooltips
- [ ] Implement offset table
- [ ] Add zoom/pan controls

### Polish and UX
- [ ] Implement dark mode
- [ ] Add loading states
- [ ] Create error boundaries
- [ ] Add keyboard shortcuts
- [ ] Implement help tooltips
- [ ] Create onboarding tour

### Testing and Documentation
- [ ] Write unit tests
- [ ] Create test JSON files
- [ ] Document API format
- [ ] Write user guide
- [ ] Create example visualizations

## Success Metrics
- **Usability**: Can load and explore file in < 30 seconds
- **Performance**: Handles files with 1000+ columns smoothly
- **Education**: Users understand their file structure better
- **Actionable**: Identifies optimization opportunities

## Future Enhancements
- Integration with por-que CLI (auto-export + open)
- Parquet file optimization suggestions
- Export "report" functionality
- Community schema library
- WebAssembly-based Parquet parser for direct file loading

## Resources Needed
- Sample JSON exports of various complexity
- UI mockups/wireframes
- Icon set for file types
- Color palette for data types
- Documentation/help content

This webapp would make `por-que` a powerful tool for understanding and optimizing Parquet files without requiring any server infrastructure or complex setup.
