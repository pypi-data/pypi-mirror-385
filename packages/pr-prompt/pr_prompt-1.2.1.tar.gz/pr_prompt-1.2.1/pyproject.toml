[project]
name = "pr-prompt"
version = "1.2.1"
description = "A tool to generate pull request prompts using git cli commands."
authors = [{ name = "Oskar Bonde", email = "oskar.bonde@gmail.com" }]
license = "MIT"
readme = "README.md"
requires-python = ">=3.9"
dependencies = [
    "gitpython>=3.1.45",
    "typer>=0.19.1",
    'tomli >= 1.1.0 ; python_version < "3.11"',
]

[dependency-groups]
dev = [
    "bump-my-version",
    "mypy",
    "pytest",
    "pytest-cov",
    "pytest-randomly",
    "ruff",
]

[project.scripts]
pr-prompt = "pr_prompt.cli:main"

[build-system]
requires = ["uv_build>=0.8.20"]
build-backend = "uv_build"

# ===================== bumpversion =====================
[tool.bumpversion]
current_version = "1.2.1"

[[tool.bumpversion.files]]
filename = "src/pr_prompt/__init__.py"
search = "__version__ = \"{current_version}\""
replace = "__version__ = \"{new_version}\""

# ==================== pytest ====================

[tool.pytest.ini_options]
addopts = "-ra -q"
testpaths = ["tests"]

# ===================== ruff =====================

[tool.ruff]
target-version = "py39"

[tool.ruff.lint]
select = ["ALL"]
ignore = [
    "ANN204", # missing return type special method
    "COM",    # missing trailing comma
    "D1",     # missing docstring
    "D203",   # 1 blank line required before class docstring
    "D212",   # multi-line docstring summary should start at the second line
    "D413",   # missing blank line after last section in docstring
    "E501",   # line too long
    "EXE002", # executable python files must have a shebang line like `#!/usr/bin/env python`
    "FA100",
    "TD",     # flake8-todos
    "TID252", # prefer absolute imports over relative imports from parent modules
    "TRY003", # avoid specifying long messages outside the exception class
    "UP045",  # use `X | None` for type annotations instead of `Optional[X]`
]
pylint.max-args = 7
explicit-preview-rules = true

[tool.ruff.lint.per-file-ignores]
"**/tests/**" = [
    "ARG",  # Unused argument. False positive in tests.
    "C901", # McCabe name complexity
    "S",    # bandit
    "T20",  # print is not allowed
]

[tool.ruff.format]
docstring-code-format = true
docstring-code-line-length = "dynamic"

# ===================== mypy =====================

[tool.mypy]
python_version = "3.9"
show_error_codes = true
pretty = true
disallow_untyped_defs = true

# ===================== pr-prompt =====================
[tool.pr-prompt]
blacklist_patterns = ["pyproject.toml"]
default_base_branch = "main"
fetch_base = false
