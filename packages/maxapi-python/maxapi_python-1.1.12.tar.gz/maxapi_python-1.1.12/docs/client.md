# üöÄ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ MaxClient

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –ù–∞—Å—Ç—Ä–æ–π–∫–∞](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞-–∏-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
- [–û—Å–Ω–æ–≤–Ω—ã–µ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏](#–æ—Å–Ω–æ–≤–Ω—ã–µ-–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏)
- [–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º](#—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º)
- [–†–∞–±–æ—Ç–∞ —Å –î–∞–Ω–Ω—ã–º–∏](#—Ä–∞–±–æ—Ç–∞-—Å-–¥–∞–Ω–Ω—ã–º–∏)
- [–õ—É—á—à–∏–µ –ü—Ä–∞–∫—Ç–∏–∫–∏](#–ª—É—á—à–∏–µ-–ø—Ä–∞–∫—Ç–∏–∫–∏)

## ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ {#—É—Å—Ç–∞–Ω–æ–≤–∫–∞-–∏-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞}

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ö–ª–∏–µ–Ω—Ç–∞

!!! info "MaxClient"
    –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å WebSocket API —Å–µ—Ä–≤–∏—Å–∞ Max.

```python
client = MaxClient(
    phone: str,
    uri: str = Constants.WEBSOCKET_URI.value,
    headers: dict[str, Any] | None = Constants.DEFAULT_USER_AGENT.value,
    token: str | None = None,
    send_fake_telemetry: bool = True,
    host: str = Constants.HOST.value,
    port: int = Constants.PORT.value,
    work_dir: str = ".",
    logger: logging.Logger | None = None,
)
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|----------|-----|----------|---------------|
| `phone` | `str` | –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ | - |
| `uri` | `str` | URI WebSocket —Å–µ—Ä–≤–µ—Ä–∞ | `Constants.WEBSOCKET_URI.value` |
| `headers` | `dict[str, Any] \| None` | –ó–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è | `Constants.DEFAULT_USER_AGENT.value` |
| `token` | `str \| None` | –¢–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ | `None` |
| `send_fake_telemetry` | `bool` | –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏ | `True` |
| `host` | `str` | –•–æ—Å—Ç API —Å–µ—Ä–≤–µ—Ä–∞ | `Constants.HOST.value` |
| `port` | `int` | –ü–æ—Ä—Ç API —Å–µ—Ä–≤–µ—Ä–∞ | `Constants.PORT.value` |
| `work_dir` | `str` | –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –ë–î | `"."` |
| `logger` | `logging.Logger \| None` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ª–æ–≥–≥–µ—Ä | `None` |

**–ü—Ä–∏–º–µ—Ä –±–∞–∑–æ–≤–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏**
```python
from pymax import MaxClient

client = MaxClient(
    phone="+79001234567",
    work_dir="./data"
)
```

**–ü—Ä–∏–º–µ—Ä —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**
```python
import logging

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–≥–µ—Ä–∞
logger = logging.getLogger("max_bot")
logger.setLevel(logging.DEBUG)

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
client = MaxClient(
    phone="+79001234567",
    token="your_saved_token",  # –ï—Å–ª–∏ –µ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω
    work_dir="./data",
    logger=logger,
    send_fake_telemetry=False
)
```

## üîë –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ {#–æ—Å–Ω–æ–≤–Ω—ã–µ-–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏}

### –°–≤–æ–π—Å—Ç–≤–∞ –ö–ª–∏–µ–Ω—Ç–∞

#### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

!!! info "–°—Ç–∞—Ç—É—Å –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è"
    | –°–≤–æ–π—Å—Ç–≤–æ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
    |----------|-----|----------|
    | `is_connected` | `bool` | –°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è |
    | `phone` | `str` | –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ |
    | `me` | `Me \| None` | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ |

#### –î–æ—Å—Ç—É–ø –∫ –î–∞–Ω–Ω—ã–º

!!! info "–ß–∞—Ç—ã –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏"
    | –°–≤–æ–π—Å—Ç–≤–æ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
    |----------|-----|----------|
    | `chats` | `list[Chat]` | –í—Å–µ —á–∞—Ç—ã |
    | `dialogs` | `list[Dialog]` | –õ–∏—á–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏ |
    | `channels` | `list[Channel]` | –ö–∞–Ω–∞–ª—ã |

## üîå –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º {#—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º}

### –ó–∞–ø—É—Å–∫ –∏ –û—Å—Ç–∞–Ω–æ–≤–∫–∞

```python
async def start() -> None
```

!!! info "–ó–∞–ø—É—Å–∫ –∫–ª–∏–µ–Ω—Ç–∞"
    –ú–µ—Ç–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç:
    1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ WebSocket
    2. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á
    4. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**
```python
async def main():
    client = MaxClient(phone="+79001234567")
    try:
        await client.start()
        print("–ö–ª–∏–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω")
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞: {e}")

asyncio.run(main())
```

```python
async def close() -> None
```

!!! warning "–ó–∞–∫—Ä—ã—Ç–∏–µ –∫–ª–∏–µ–Ω—Ç–∞"
    –ú–µ—Ç–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç:
    1. –û—Å—Ç–∞–Ω–æ–≤–∫—É —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á
    2. –ó–∞–∫—Ä—ã—Ç–∏–µ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
    3. –û—á–∏—Å—Ç–∫—É —Ä–µ—Å—É—Ä—Å–æ–≤

**–ü—Ä–∏–º–µ—Ä –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è**
```python
async def main():
    async with MaxClient(phone="+79001234567") as client:
        await client.start()
        # –í–∞—à –∫–æ–¥ –∑–¥–µ—Å—å
    # –ö–ª–∏–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä–æ–µ—Ç—Å—è
```

## üì® –†–∞–±–æ—Ç–∞ —Å –°–æ–æ–±—â–µ–Ω–∏—è–º–∏

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –°–æ–æ–±—â–µ–Ω–∏–π

!!! tip "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤"
    ```python
    @client.on_message()
    async def handle_message(message: Message):
        print(f"–ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ: {message.text}")

        if message.attaches:
            print("–ï—Å—Ç—å –≤–ª–æ–∂–µ–Ω–∏—è!")

        if message.sender:
            user = await client.get_user(message.sender)
            if user:
                print(f"–û—Ç: {user.names[0].name}")
    ```

### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –°–æ–æ–±—â–µ–Ω–∏–π

!!! example "–ü—Ä–∏–º–µ—Ä—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤"
    ```python
    # –¢–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
    @client.on_message(Filter(chat_id=0))
    async def handle_text(message: Message):
        print(f"–¢–µ–∫—Å—Ç: {message.text}")
    ```

## üíæ –†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ {#—Ä–∞–±–æ—Ç–∞-—Å-–¥–∞–Ω–Ω—ã–º–∏}

### –î–æ—Å—Ç—É–ø –∫ –ß–∞—Ç–∞–º

!!! info "–¢–∏–ø—ã —á–∞—Ç–æ–≤"
    ```python
    # –í—Å–µ —á–∞—Ç—ã
    for chat in client.chats:
        print(f"–ß–∞—Ç: {chat.title}")

    # –õ–∏—á–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏
    for dialog in client.dialogs:
        user = await client.get_user(dialog.owner)
        if user:
            print(f"–î–∏–∞–ª–æ–≥ —Å {user.names[0].name}")

    # –ö–∞–Ω–∞–ª—ã
    for channel in client.channels:
        print(f"–ö–∞–Ω–∞–ª: {channel.title}")
    ```

### –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ

!!! example "–†–∞–±–æ—Ç–∞ —Å —Ç–µ–∫—É—â–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º"
    ```python
    me = client.me
    if me:
        name = me.names[0] if me.names else None
        print(f"–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∫–∞–∫: {name.name if name else me.phone}")
        print(f"ID: {me.id}")
        print(f"–°—Ç–∞—Ç—É—Å: {me.account_status}")
    ```

## üíΩ –•—Ä–∞–Ω–µ–Ω–∏–µ –î–∞–Ω–Ω—ã—Ö

### –ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö

!!! info "–õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ"
    - **–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: `{work_dir}/session.db`
    - **–•—Ä–∞–Ω–∏—Ç**:
        - –¢–æ–∫–µ–Ω—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
        - –î–∞–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏
    - **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
        - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
        - –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ
        - –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤

## üìö –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ {#–ª—É—á—à–∏–µ-–ø—Ä–∞–∫—Ç–∏–∫–∏}

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

!!! tip "–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä"
    ```python
    async def main():
        async with MaxClient(phone="+79001234567") as client:
            await client.start()
            # –í–∞—à –∫–æ–¥ –∑–¥–µ—Å—å
        # –ö–ª–∏–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä–æ–µ—Ç—Å—è
    ```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –û—à–∏–±–æ–∫

!!! warning "–û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π"
    ```python
    try:
        await client.start()
    except WebSocketNotConnectedError:
        print("–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è")
    except Exception as e:
        print(f"–ù–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞: {e}")
    ```

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

!!! tip "–°–æ–≤–µ—Ç—ã –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏"
    1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∏–ª—å—Ç—Ä—ã —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏
    2. –ü—Ä–∏–º–µ–Ω—è–π—Ç–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ `get_cached_user`
    3. –ì—Ä—É–ø–ø–∏—Ä—É–π—Ç–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
    4. –ü—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–∫—Ä—ã–≤–∞–π—Ç–µ —Ä–µ—Å—É—Ä—Å—ã

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–æ—Ç–∞

!!! example "–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞"
    ```python
    from pymax import MaxClient

    class MyBot:
        def __init__(self, phone: str):
            self.client = MaxClient(phone=phone)

        async def setup(self):
            # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
            @self.client.on_message()
            async def handle_message(message: Message):
                await self.process_message(message)

            @self.client.on_start()
            async def handle_start():
                await self.on_ready()

        async def process_message(self, message: Message):
            # –í–∞—à–∞ –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
            pass

        async def on_ready(self):
            print("–ë–æ—Ç –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!")

        async def run(self):
            await self.client.start()

    # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
    bot = MyBot(phone="+79001234567")
    asyncio.run(bot.run())
    ```
