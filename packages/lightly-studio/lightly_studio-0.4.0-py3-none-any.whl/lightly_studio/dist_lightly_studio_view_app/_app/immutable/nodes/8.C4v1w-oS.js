import{p as z,f as E,n as Xt,a as F,w as Et,m as pt,$ as ht,g as t,b as n,c as p,r as g,s as M,t as q,am as Ct,u as ta,al as Bt,Z as at}from"../chunks/C3xJX0nD.js";import{n as aa}from"../chunks/BaFFwDFr.js";import{u as It}from"../chunks/BOmrKuMn.js";import"../chunks/CWj6FrbW.js";import{c as Q,a as u,f as B,t as Dt,d as ea}from"../chunks/CAPx0Bfm.js";import{i as H,s as j,a as W}from"../chunks/DmGM9V9Q.js";import{e as bt}from"../chunks/SiegjVo0.js";import{c as ot,e as na,g as oa,u as sa,k as ia,b as ra,t as da}from"../chunks/DthpwYR_.js";import{g as nt,c as la,a as ca}from"../chunks/D8ZGoCPm.js";import{I as ua,w as va,r as st,G as ma,H as fa,J as ga,K as _a,o as xt,M as Rt,N as pa,C as Lt,B as jt,O as ha,n as Tt,v as ba,D as xa,q as Ia}from"../chunks/CWuDkrMZ.js";import"../chunks/ClzkJBWk.js";import{p as U}from"../chunks/DUtlYNuP.js";import"../chunks/69_IOA4Y.js";import{S as Aa}from"../chunks/BiGQqqJP.js";import"../chunks/gBp1tBnA.js";import{r as K}from"../chunks/ChlxSwqI.js";import{B as $a,a as wa,b as et,c as gt,H as Sa,d as _t,D as ya,e as Ma,Z as ka,g as Pa,u as Na}from"../chunks/BsaJCCG_.js";import{S as Ca}from"../chunks/DNJnBfHs.js";import{s as V}from"../chunks/CpbA3HU7.js";import{C as Ba}from"../chunks/BtXGzlpP.js";import{s as Da}from"../chunks/DoEId1MK.js";import{s as Ra,r as Ea}from"../chunks/xQhUoIl9.js";function La(l,a){z(a,!0);/**
 * @license @lucide/svelte v0.482.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 */let e=Ea(a,["$$slots","$$events","$$legacy"]);const v=[["path",{d:"M5 3a2 2 0 0 0-2 2"}],["path",{d:"M19 3a2 2 0 0 1 2 2"}],["path",{d:"M21 19a2 2 0 0 1-2 2"}],["path",{d:"M5 21a2 2 0 0 1-2-2"}],["path",{d:"M9 3h1"}],["path",{d:"M9 21h1"}],["path",{d:"M14 3h1"}],["path",{d:"M14 21h1"}],["path",{d:"M3 9v1"}],["path",{d:"M21 9v1"}],["path",{d:"M3 14v1"}],["path",{d:"M21 14v1"}]];ua(l,Ra({name:"square-dashed"},()=>e,{get iconNode(){return v},children:(o,r)=>{var i=Q(),b=E(i);Da(b,()=>a.children??Xt),u(o,i)},$$slots:{default:!0}})),F()}const ja=({annotationIndex:l,...a})=>{const e=Et({isLoading:!1});return(async()=>{e.update(o=>({...o,isLoading:!0}));try{const{data:o}=await aa({path:{dataset_id:a.dataset_id},query:{cursor:l>0?l-1:0,limit:3,annotation_label_ids:a.annotation_label_ids,tag_ids:a.tag_ids}});if(!o){e.update(s=>({...s,isLoading:!1,error:"No annotations data received",data:void 0}));return}const{setAnnotationsTotalCount:r}=It();r(o.total_count);let i;const b=l>0?o.data[0]:void 0;o.data.length>1&&(i=l===0?o.data[1]:o.data[2]),e.update(s=>({...s,isLoading:!1,error:void 0,data:{annotationNext:i,annotationPrevious:b}}))}catch(o){e.update(r=>({...r,isLoading:!1,error:String(o)}))}})(),e},Ta=async({parent:l,params:{dataset_id:a,annotationId:e,annotationIndex:v}})=>{const{annotationsSelectedTagsIds:o,annotationsSelectedAnnotationLabelsIds:r,dataset:i}=await l(),b=parseInt(v,10),s=Et();if(!i)throw new Error("Dataset data not found");return ja({annotationIndex:b,dataset_id:a,currentAnnotationId:e,annotation_label_ids:Array.from(pt(r)),tag_ids:Array.from(pt(o))}).subscribe(({data:S})=>{s.set(S)}),{annotationAdjacents:s,annotationIndex:b,annotationId:e,dataset:i}},Be=Object.freeze(Object.defineProperty({__proto__:null,load:Ta},Symbol.toStringTag,{value:"Module"}));function Ha(l,a){z(a,!0);const e=()=>j(t(i),"$annotationAdjacents",v),[v,o]=W(),r=n(()=>U.data.annotationIndex),i=n(()=>U.data.annotationAdjacents),b=()=>{e().annotationNext&&nt(K.toSampleWithAnnotation({datasetId:e().annotationNext.dataset_id,sampleId:e().annotationNext.sample_id,annotationId:e().annotationNext.annotation_id,annotationIndex:t(r)+1}),{invalidateAll:!0})},s=()=>{e().annotationPrevious&&nt(K.toSampleWithAnnotation({datasetId:e().annotationPrevious.dataset_id,sampleId:e().annotationPrevious.sample_id,annotationId:e().annotationPrevious.annotation_id,annotationIndex:t(r)-1}),{invalidateAll:!0})},S=_=>{switch(_.key){case"ArrowRight":b();break;case"ArrowLeft":s();break}};var k=Q();bt("keydown",ht,S);var I=E(k);{var R=_=>{{let A=n(()=>!!e().annotationPrevious),$=n(()=>!!e().annotationNext);Ca(_,{get hasPrevious(){return t(A)},get hasNext(){return t($)},onPrevious:s,onNext:b})}};H(I,_=>{e()&&_(R)})}u(l,k),F(),o()}const Ua={object_detection:"Object Detection",instance_segmentation:"Instance Segmentation",semantic_segmentation:"Semantic Segmentation",classification:"Classification"};var za=B('<span class="text-sm"> </span> <span class="break-all text-sm"> </span>',1);function Fa(l,a){var e=za(),v=E(e),o=p(v,!0);g(v);var r=M(v,2),i=p(r,!0);g(r),q(()=>{V(o,a.label),ot(r,"data-testid",`annotation-metadata-${a.id}`),V(i,a.value)}),u(l,e)}var Oa=B('<span class="break-all text-sm"> </span>'),Ga=B('<span class="text-sm"> </span> <!>',1);function Ka(l,a){z(a,!0);const e=()=>j(i,"$result",o),v=()=>j(a.isEditingMode,"$isEditingMode",o),[o,r]=W(),i=va(),{updateAnnotation:b}=st({datasetId:a.datasetId,annotationId:a.annotationId,onUpdate:a.onUpdate}),s=n(()=>ga(e().data||[])),S=n(()=>{const w=t(s).find(d=>d.value===a.value);return w||{value:a.value,label:a.value}});var k=Ga(),I=E(k),R=p(I,!0);g(I);var _=M(I,2);{var A=w=>{{const d=(P,m)=>{let C=()=>m==null?void 0:m().inputValue;fa(P,{get label(){return C()}})};let h=n(()=>t(s).find(P=>{var m;return P.value===((m=t(S))==null?void 0:m.value)}));ma(w,{get items(){return t(s)},get selectedItem(){return t(h)},name:"annotation-label",placeholder:"Select or create a label",onSelect:P=>{b({annotation_id:a.annotationId,dataset_id:a.datasetId,label_name:P.value})},notFound:d,$$slots:{notFound:!0}})}},$=w=>{var d=Oa();ot(d,"data-testid","annotation-metadata-label");var h=p(d,!0);g(d),q(()=>V(h,a.value)),u(w,d)};H(_,w=>{v()?w(A):w($,!1)})}q(()=>V(R,a.label)),u(l,k),F(),r()}var qa=B('<div class="flex flex-col gap-4"><div class="grid grid-cols-[6rem_1fr] gap-y-3 text-diffuse-foreground"></div></div>');function Wa(l,a){z(a,!0);const e=()=>j(t(b),"$annotationResp",v),[v,o]=W(),{datasetId:r}=U.data,i=n(()=>st({datasetId:r,annotationId:a.annotationId})),b=n(()=>t(i).annotation);let s=n(()=>e().data);const S=n(()=>{var $,w;if(!t(s))return[];let A=[{id:"label",label:"Label:",value:(w=($=t(s))==null?void 0:$.annotation_label)==null?void 0:w.annotation_label_name},{id:"type",label:"Type:",value:Ua[t(s).annotation_type]||"Unknown"}];if(t(s)&&!_a(t(s))){const{height:d,width:h}=xt(t(s));A=[{id:"height",label:"Height:",value:Rt(Math.round(d))+"px"},{id:"width",label:"Width:",value:Rt(Math.round(h))+"px"},...A]}return A}),{isEditingMode:k}=U.data.globalStorage;var I=Q(),R=E(I);{var _=A=>{pa(A,{title:"Annotation details",children:($,w)=>{var d=qa(),h=p(d);na(h,21,()=>t(S),({label:P,value:m,id:C})=>P,(P,m)=>{let C=()=>t(m).label,y=()=>t(m).value,f=()=>t(m).id;var x=Q(),L=E(x);{var T=D=>{Ka(D,{get onUpdate(){return a.onUpdate},get annotationId(){return a.annotationId},get datasetId(){return r},get label(){return C()},get value(){return y()},get isEditingMode(){return k}})},c=D=>{Fa(D,{get label(){return C()},get id(){return f()},get value(){return y()}})};H(L,D=>{f()==="label"&&k?D(T):D(c,!1)})}u(P,x)}),g(h),g(d),u($,d)}})};H(R,A=>{t(S).length>0&&A(_)})}u(l,I),F(),o()}var Za=B('<!> <h2 class="py-2 text-lg font-semibold"><a>Check all sample annotations</a></h2>',1),Va=B('<div class="flex h-full w-full items-center justify-center"><!></div>'),Ja=B('<div class="flex h-full min-h-0 flex-col space-y-4 overflow-hidden dark:[color-scheme:dark]"><!> <!></div>');function Ya(l,a){z(a,!0);const e=()=>j(t(b),"$annotationResp",v),[v,o]=W(),{datasetId:r}=U.data,i=n(()=>st({datasetId:r,annotationId:a.annotationId})),b=n(()=>t(i).annotation);let s=n(()=>e().data),S=n(()=>{var _;return(_=t(s))==null?void 0:_.sample});const k=oa(),[I,R]=k;Lt(l,{className:"h-full",children:(_,A)=>{jt(_,{className:"h-full flex flex-col",children:($,w)=>{var d=Ja(),h=p(d);Wa(h,{get annotationId(){return a.annotationId},get onUpdate(){return a.onUpdate}});var P=M(h,2);{var m=y=>{var f=Za(),x=E(f);ha(x,{get sample(){return t(S)},showCustomMetadata:!1});var L=M(x,2),T=p(L);g(L),q(c=>ot(T,"href",c),[()=>I(K.toSample({sampleId:t(S).sample_id,datasetId:t(S).dataset_id}),void 0)]),u(y,f)},C=y=>{var f=Va(),x=p(f);Tt(x,{size:"large",align:"center"}),g(f),u(y,f)};H(P,y=>{t(S)?y(m):y(C,!1)})}g(d),u($,d)},$$slots:{default:!0}})},$$slots:{default:!0}}),F(),o()}var Qa=B('<!> <span class="hidden sm:inline">Home</span>',1),Xa=B('<!> <span class="max-w-[150px] truncate"> </span>',1),te=B('<!> <span class="hidden sm:inline">Annotations</span>',1),ae=B('<!> <span class="max-w-[200px] truncate"><!></span>',1),ee=B("<!> <!> <!> <!> <!> <!> <!>",1);function ne(l,a){z(a,!0);const e=()=>j(r,"$annotationsTotalCount",v),[v,o]=W(),{annotationsTotalCount:r}=It();$a(l,{class:"mb-2",children:(i,b)=>{wa(i,{children:(s,S)=>{var k=ee(),I=E(k);et(I,{children:(h,P)=>{{let m=n(()=>K.toHome());gt(h,{get href(){return t(m)},class:"flex items-center gap-2",children:(C,y)=>{var f=Qa(),x=E(f);Sa(x,{class:"h-4 w-4"}),Ct(2),u(C,f)},$$slots:{default:!0}})}},$$slots:{default:!0}});var R=M(I,2);_t(R,{});var _=M(R,2);et(_,{children:(h,P)=>{{let m=n(()=>K.toAnnotations(a.dataset.dataset_id));gt(h,{get href(){return t(m)},class:"flex items-center gap-2",children:(C,y)=>{var f=Xa(),x=E(f);ya(x,{class:"h-4 w-4"});var L=M(x,2),T=p(L,!0);g(L),q(()=>V(T,a.dataset.name)),u(C,f)},$$slots:{default:!0}})}},$$slots:{default:!0}});var A=M(_,2);_t(A,{});var $=M(A,2);et($,{children:(h,P)=>{{let m=n(()=>K.toAnnotations(a.dataset.dataset_id));gt(h,{get href(){return t(m)},class:"flex items-center gap-2",children:(C,y)=>{var f=te(),x=E(f);Ba(x,{class:"h-4 w-4"}),Ct(2),u(C,f)},$$slots:{default:!0}})}},$$slots:{default:!0}});var w=M($,2);_t(w,{});var d=M(w,2);et(d,{children:(h,P)=>{Ma(h,{class:"flex items-center gap-2",children:(m,C)=>{var y=ae(),f=E(y);La(f,{class:"h-4 w-4"});var x=M(f,2),L=p(x);{var T=D=>{var O=Dt();q(()=>V(O,`Annotation ${a.annotationIndex+1} of ${e()??""}`)),u(D,O)},c=D=>{var O=Dt("Annotation");u(D,O)};H(L,D=>{a.annotationIndex!==void 0?D(T):D(c,!1)})}g(x),u(m,y)},$$slots:{default:!0}})},$$slots:{default:!0}}),u(s,k)},$$slots:{default:!0}})},$$slots:{default:!0}}),F(),o()}var oe=ea("<image></image><g><!></g>",1),se=B('<div class="h-full w-full overflow-hidden"><div class="sample relative h-full w-full"><div class="absolute right-4 top-2 z-30"><!></div> <!> <!></div></div>'),ie=B('<div class="flex h-full w-full items-center justify-center"><!></div>'),re=B('<div class="flex h-full w-full flex-col space-y-4"><div class="flex w-full items-center"><!></div> <!> <div class="flex min-h-0 flex-1 gap-4"><div class="flex-1"><!></div> <div class="relative w-[375px]"><!></div></div></div>');function de(l,a){z(a,!0);const e=()=>j(Ht,"$isEditingMode",i),v=()=>j(t(f),"$annotationResp",i),o=()=>j(S,"$selectedSampleAnnotationCropIds",i),r=()=>j(R,"$isHidden",i),[i,b]=W(),{toggleSampleAnnotationCropSelection:s,selectedSampleAnnotationCropIds:S,clearReversibleActionsByGroupId:k,addReversibleAction:I}=It(),{isHidden:R,handleKeyEvent:_}=ba(),{settingsStore:A}=sa(),$=" ",w=pt(A).key_go_back;let d=Bt(!1);const h=()=>{var N;(N=a.sample)!=null&&N.dataset_id?nt(K.toAnnotations(a.sample.dataset_id)):nt("/")},P=N=>{switch(N.key){case w:h();break;case" ":N.preventDefault(),e()?at(d,!0):s(a.annotationId);break;case $:N.preventDefault(),s(a.annotationId);break}_(N)},m=N=>{N.key===" "&&at(d,!1),_(N)},C=U.data.datasetId,y=n(()=>st({datasetId:C,annotationId:a.annotationId})),f=n(()=>t(y).annotation),x=n(()=>t(y).updateAnnotation),L="bbox-change-annotation-details";la(()=>{k(L)});const T=N=>{if(t(c)){const J={annotation_id:t(c).annotation_id,dataset_id:t(c).dataset_id,bounding_box:N},lt=xt(t(c)),St=async()=>{const Y={annotation_id:t(c).annotation_id,dataset_id:t(c).dataset_id,bounding_box:lt};await t(x)(Y)};(async()=>{try{await t(x)(J),I({id:`bbox-change-${t(c).annotation_id}-${Date.now()}`,description:`Revert bounding box change for annotation ${t(c).annotation_id}`,execute:St,timestamp:new Date,groupId:L})}catch(Y){da.error("Failed to update annotations:"+Y.message)}})()}};let c=n(()=>v().data),D=n(()=>{var N,J;return Pa(((J=(N=t(c))==null?void 0:N.sample)==null?void 0:J.sample_id)||"")}),O=n(()=>t(c)?xt(t(c)):void 0);const{isEditingMode:Ht}=U.data.globalStorage,Ut=n(()=>t(d)?"grab":"auto"),zt=n(()=>e()&&!t(d));let X=Bt(void 0);ta(()=>{!t(X)&&t(O)&&at(X,t(O),!0)}),ca(()=>{at(X,void 0)});var it=re();bt("keydown",ht,P),bt("keyup",ht,m);var rt=p(it),Ft=p(rt);ne(Ft,{get dataset(){return a.dataset},get annotationIndex(){return a.annotationIndex}}),g(rt);var At=M(rt,2);Aa(At,{class:"mb-4 bg-border-hard"});var $t=M(At,2),dt=p($t),Ot=p(dt);Lt(Ot,{className:"h-full",children:(N,J)=>{jt(N,{className:"h-full",children:(lt,St)=>{var ct=Q(),Y=E(ct);{var Kt=Z=>{var G=se(),tt=p(G),ut=p(tt),Wt=p(ut);{let Mt=n(()=>o().has(a.annotationId));xa(Wt,{onSelect:()=>s(a.annotationId),get isSelected(){return t(Mt)}})}g(ut);var yt=M(ut,2);Ha(yt,{});var Zt=M(yt,2);ka(Zt,{get width(){return t(c).sample.width},get height(){return t(c).sample.height},get cursor(){return t(Ut)},get boundingBox(){return t(X)},zoomableContent:(Vt,vt)=>{let Jt=()=>vt==null?void 0:vt().scale;var kt=oe(),Pt=E(kt),mt=M(Pt);let Nt;var Yt=p(mt);ia(Yt,()=>v().dataUpdatedAt,ft=>{{let Qt=n(()=>({x:0,y:0,width:t(c).sample.width,height:t(c).sample.height}));Ia(ft,{get annotation(){return t(c)},showLabel:!0,get scale(){return Jt()},get imageWidth(){return t(c).sample.width},get isResizable(){return t(zt)},onBoundingBoxChanged:T,get constraintBox(){return t(Qt)}})}}),g(mt),q(ft=>{ot(Pt,"href",t(D)),Nt=ra(mt,0,"",null,Nt,ft)},[()=>({invisible:r()})]),u(Vt,kt)},$$slots:{zoomableContent:!0}}),g(tt),g(G),u(Z,G)},qt=Z=>{var G=ie(),tt=p(G);Tt(tt,{size:"large",align:"center"}),g(G),u(Z,G)};H(Y,Z=>{t(c)?Z(Kt):Z(qt,!1)})}u(lt,ct)},$$slots:{default:!0}})},$$slots:{default:!0}}),g(dt);var wt=M(dt,2),Gt=p(wt);Ya(Gt,{get annotationId(){return a.annotationId}}),g(wt),g($t),g(it),u(l,it),F(),b()}var le=B('<div class="flex h-full w-full space-x-4 px-4 pb-4" data-testid="annotation-details"><div class="h-full w-full space-y-6 rounded-[1vw] bg-card p-4"><!></div></div>');function De(l,a){z(a,!0);const e=()=>j(t(k),"$sample",v),[v,o]=W(),r=n(()=>a.data.annotationId),i=n(()=>a.data.dataset),b=n(()=>a.data.annotationIndex),s=n(()=>U.params.sampleId),S=n(()=>Na({sampleId:t(s),datasetId:t(i).dataset_id})),k=n(()=>t(S).sample);var I=le(),R=p(I),_=p(R);{var A=$=>{de($,{get annotationId(){return t(r)},get annotationIndex(){return t(b)},get dataset(){return t(i)},get sample(){return e().data}})};H(_,$=>{e().data&&t(r)&&t(i)&&$(A)})}g(R),g(I),u(l,I),F(),o()}export{De as component,Be as universal};
