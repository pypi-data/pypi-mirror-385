import"../chunks/CWj6FrbW.js";import{p as gt,f as _,n as le,a as ht,am as te,g as t,b as r,s as h,c as I,r as A,t as mt,m as ft,u as He,Z as s,al as $,ab as ee,$ as ae}from"../chunks/C3xJX0nD.js";import{c as Q,a as c,f as tt,t as ne,d as $t}from"../chunks/CAPx0Bfm.js";import{s as It}from"../chunks/DoEId1MK.js";import{i as Y,s as G,a as Nt}from"../chunks/DmGM9V9Q.js";import{p as yt}from"../chunks/DUtlYNuP.js";import{I as ie,o as Fe,p as ze,q as Ne,r as Xe,t as At,v as Ye,w as Ze,_ as Ue,x as Ke,y as Oe,z as je,C as Ge,B as Ve,D as We,R as qe,n as Je,E as Qe,F as ta}from"../chunks/CWuDkrMZ.js";import{u as de}from"../chunks/BOmrKuMn.js";import{u as ce,k as ea,t as ut,c as H,e as aa,b as na}from"../chunks/DthpwYR_.js";import"../chunks/ClzkJBWk.js";import"../chunks/BaFFwDFr.js";import"../chunks/69_IOA4Y.js";import{a as oa,g as sa}from"../chunks/D8ZGoCPm.js";import"../chunks/gBp1tBnA.js";import{e as oe}from"../chunks/SiegjVo0.js";import{s as ue,r as me,p as ra,b as se}from"../chunks/xQhUoIl9.js";import{S as la}from"../chunks/BiGQqqJP.js";import{r as St}from"../chunks/ChlxSwqI.js";import{s as re}from"../chunks/CpbA3HU7.js";import{B as ia,a as da,b as wt,c as Ft,H as ca,d as zt,D as ua,e as ma,u as ge,Z as ga,g as ha}from"../chunks/BsaJCCG_.js";import{a as va,b as fa,d as pa,e as _a}from"../chunks/DyIcJj6J.js";function ba(u,e){gt(e,!0);/**
 * @license @lucide/svelte v0.482.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 */let m=me(e,["$$slots","$$events","$$legacy"]);const l=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4"}],["circle",{cx:"10",cy:"12",r:"2"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22"}]];ie(u,ue({name:"file-image"},()=>m,{get iconNode(){return l},children:(n,i)=>{var d=Q(),p=_(d);It(p,()=>e.children??le),c(n,d)},$$slots:{default:!0}})),ht()}function xa(u,e){gt(e,!0);/**
 * @license @lucide/svelte v0.482.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 */let m=me(e,["$$slots","$$events","$$legacy"]);const l=[["path",{d:"M18 22H4a2 2 0 0 1-2-2V6"}],["path",{d:"m22 13-1.296-1.296a2.41 2.41 0 0 0-3.408 0L11 18"}],["circle",{cx:"12",cy:"8",r:"2"}],["rect",{width:"16",height:"16",x:"6",y:"2",rx:"2"}]];ie(u,ue({name:"images"},()=>m,{get iconNode(){return l},children:(n,i)=>{var d=Q(),p=_(d);It(p,()=>e.children??le),c(n,d)},$$slots:{default:!0}})),ht()}var wa=tt('<!> <span class="hidden sm:inline">Home</span>',1),ya=tt('<!> <span class="max-w-[150px] truncate"> </span>',1),Sa=tt('<!> <span class="hidden sm:inline">Samples</span>',1),$a=tt('<!> <span class="max-w-[200px] truncate"><!></span>',1),Ia=tt("<!> <!> <!> <!> <!> <!> <!>",1);function Aa(u,e){gt(e,!0);const m=()=>G(i,"$samplesTotalCount",l),[l,n]=Nt(),{samplesTotalCount:i}=de();ia(u,{class:"mb-2","data-testid":"sample-details-breadcrumb",children:(d,p)=>{da(d,{children:(et,ot)=>{var F=Ia(),w=_(F);wt(w,{children:(P,V)=>{{let g=r(()=>St.toHome());Ft(P,{get href(){return t(g)},class:"flex items-center gap-2",children:(M,T)=>{var b=wa(),y=_(b);ca(y,{class:"h-4 w-4"}),te(2),c(M,b)},$$slots:{default:!0}})}},$$slots:{default:!0}});var z=h(w,2);zt(z,{});var C=h(z,2);wt(C,{children:(P,V)=>{{let g=r(()=>St.toSamples(e.dataset.dataset_id));Ft(P,{get href(){return t(g)},class:"flex items-center gap-2",children:(M,T)=>{var b=ya(),y=_(b);ua(y,{class:"h-4 w-4"});var B=h(y,2),at=I(B,!0);A(B),mt(()=>re(at,e.dataset.name)),c(M,b)},$$slots:{default:!0}})}},$$slots:{default:!0}});var Z=h(C,2);zt(Z,{});var N=h(Z,2);wt(N,{children:(P,V)=>{{let g=r(()=>St.toSamples(e.dataset.dataset_id));Ft(P,{get href(){return t(g)},class:"flex items-center gap-2",children:(M,T)=>{var b=Sa(),y=_(b);xa(y,{class:"h-4 w-4"}),te(2),c(M,b)},$$slots:{default:!0}})}},$$slots:{default:!0}});var st=h(N,2);zt(st,{});var rt=h(st,2);wt(rt,{children:(P,V)=>{ma(P,{class:"flex items-center gap-2",children:(g,M)=>{var T=$a(),b=_(T);ba(b,{class:"h-4 w-4"});var y=h(b,2),B=I(y);{var at=W=>{var lt=ne();mt(()=>re(lt,`Sample ${e.sampleIndex+1} of ${m()??""}`)),c(W,lt)},Pt=W=>{var lt=ne("Sample");c(W,lt)};Y(B,W=>{e.sampleIndex!==void 0?W(at):W(Pt,!1)})}A(y),c(g,T)},$$slots:{default:!0}})},$$slots:{default:!0}}),c(et,F)},$$slots:{default:!0}})},$$slots:{default:!0}}),ht(),n()}function Pa(u,e){gt(e,!0);const m=()=>G(t(F),"$annotationResp",i),l=()=>G(t(Z),"$sample",i),n=()=>G(et,"$showAnnotationTextLabelsStore",i),[i,d]=Nt(),p=ra(e,"isResizable",3,!1),{showAnnotationTextLabelsStore:et}=ce(),ot=r(()=>Xe({datasetId:e.datasetId,annotationId:e.annotationId})),F=r(()=>t(ot).annotation),w=r(()=>t(ot).updateAnnotation);let z=r(()=>m().data);const C=r(()=>ge({sampleId:e.sampleId,datasetId:e.datasetId})),Z=r(()=>t(C).sample);let N=r(()=>m().data?Fe(m().data):void 0);const st=g=>{(async()=>{try{await t(w)({annotation_id:e.annotationId,dataset_id:e.datasetId,bounding_box:g})}catch(T){console.error("Failed to update annotation:",T.message)}})()};var rt=Q(),P=_(rt);{var V=g=>{var M=Q(),T=_(M);ea(T,()=>t(N),b=>{ze(b,{get groupId(){return t(z).annotation_id},get onSelect(){return e.toggleAnnotationSelection},get box(){return t(N)},get isSelected(){return e.isSelected},children:(y,B)=>{{let at=r(()=>({x:0,y:0,width:l().data.width,height:l().data.height}));Ne(y,{get annotation(){return t(z)},get showLabel(){return n()},get imageWidth(){return l().data.width},get constraintBox(){return t(at)},get isResizable(){return p()},onBoundingBoxChanged:st})}},$$slots:{default:!0}})}),c(g,M)};Y(P,g=>{t(z)&&l().data&&t(N)&&g(V)})}c(u,rt),ht(),d()}const Ma=({datasetId:u})=>{const e=At(va());return e.subscribe(()=>{}),{createAnnotation:l=>new Promise((n,i)=>{ft(e).mutate({path:{dataset_id:u},body:l},{onSuccess:d=>{n(d)},onError:d=>{i(d)}})})}},Ba=()=>{const u=At(fa());return u.subscribe(()=>{}),{createLabel:m=>new Promise((l,n)=>{ft(u).mutate({body:m},{onSuccess:i=>{l(i)},onError:i=>{n(i)}})})}},ka=({datasetId:u})=>{const e=At(pa());return e.subscribe(()=>{}),{deleteAnnotation:l=>new Promise((n,i)=>{ft(e).mutate({path:{dataset_id:u,annotation_id:l}},{onSuccess:()=>{n()},onError:d=>{i(d)}})})}},Ea=({datasetId:u})=>{const e=At(_a());return e.subscribe(()=>{}),{removeTagFromSample:(l,n)=>new Promise((i,d)=>{ft(e).mutate({path:{dataset_id:u,sample_id:l,tag_id:n}},{onSuccess:()=>i(),onError:p=>d(p)})})}};var Ra=$t('<line x1="0" stroke-width="1" vector-effect="non-scaling-stroke" stroke-dasharray="5,5" opacity="0.6"></line><line y1="0" vector-effect="non-scaling-stroke" stroke-width="1" stroke-dasharray="5,5" opacity="0.6"></line>',1),Ca=$t('<rect class="select-none" fill="transparent" role="button" style="outline: 0;cursor: crosshair;" tabindex="0"></rect>'),Ta=$t("<g><!><!><!></g><!>",1),Da=$t("<image></image><!>",1),La=tt('<div class="h-full w-full overflow-hidden"><div class="sample relative h-full w-full"><div class="absolute right-4 top-2 z-30"><!></div> <!> <!></div></div>'),Ha=tt('<div class="flex h-full w-full flex-col space-y-4"><div class="flex w-full items-center"><!></div> <!> <div class="flex min-h-0 flex-1 gap-4"><div class="flex-1"><!></div> <div class="relative w-[375px]"><!></div></div></div>');function Fa(u,e){gt(e,!0);const m=()=>G(T,"$labels",p),l=()=>G(y,"$isEditingMode",p),n=()=>G(t(V),"$sample",p),i=()=>G(ot,"$selectedSampleIds",p),d=()=>G(z,"$isHidden",p),[p,et]=Nt(),{selectedSampleIds:ot,toggleSampleSelection:F}=de(),w=e.dataset.dataset_id,{isHidden:z,handleKeyEvent:C}=Ye(),{settingsStore:Z}=ce(),{deleteAnnotation:N}=ka({datasetId:w}),{removeTagFromSample:st}=Ea({datasetId:w}),rt=()=>{sa(St.toSamples(w))},P=r(()=>ge({sampleId:e.sampleId,datasetId:w})),V=r(()=>t(P).sample),g=r(()=>t(P).refetch),{createAnnotation:M}=Ma({datasetId:w}),T=Ze(),{createLabel:b}=Ba(),{isEditingMode:y}=yt.data.globalStorage;let B=$(!1);const at=async({x:a,y:o,width:k,height:D,labelName:v})=>{if(!m().data)return;let E=m().data.find(x=>x.annotation_label_name===v);E||(E=await b({annotation_label_name:v}));try{const x=await M({sample_id:e.sampleId,annotation_type:"object_detection",x:Math.round(a),y:Math.round(o),width:Math.round(k),height:Math.round(D),annotation_label_id:E.annotation_label_id});return t(g)(),s(U,x.annotation_id,!0),ut.success("Annotation created successfully"),x}catch(x){ut.error("Failed to create annotation. Please try again."),console.error("Error creating annotation:",x);return}},Pt=a=>{switch(a.key){case ft(Z).key_go_back:rt();break;case" ":a.preventDefault(),a.stopPropagation(),console.log("space pressed in sample details"),l()?s(B,!0):F(e.sampleId);break}C(a)},W=a=>{a.key===" "&&s(B,!1),C(a)};let lt=r(()=>ha(e.sampleId)),U=$(void 0),Xt=$(void 0);oa(()=>{var a;s(U,void 0),s(Zt,void 0),(a=t(Xt))==null||a(),s(vt,!1),s(O,void 0)});const Yt=a=>{t(B)||(t(U)===a?s(U,void 0):s(U,a,!0))};let Zt=$(void 0),it=$(!1),S=$(null),q=$(null),K=$(null);const he=()=>{s(it,!1),s(S,null),s(K,null)};let vt=$(!1);const Ut=10,ve=()=>{if(!t(q))return;const a=Oe(t(q));let o=null;const k=je().on("start",D=>{if(!t(vt))return;s(it,!0);const v=t(q).getBoundingClientRect(),E=D.sourceEvent.clientX,x=D.sourceEvent.clientY,L=(E-v.left)/v.width*n().data.width,R=(x-v.top)/v.height*n().data.height;o={x:L,y:R},s(S,{x:L,y:R,width:0,height:0},!0),s(K,{x:L,y:R},!0)}).on("drag",D=>{if(!t(S)||!t(it)||!o)return;const v=t(q).getBoundingClientRect(),E=D.sourceEvent.clientX,x=D.sourceEvent.clientY;let L=(E-v.left)/v.width*n().data.width,R=(x-v.top)/v.height*n().data.height;const Et=n().data.width,Rt=n().data.height;L=Math.max(0,Math.min(L,Et)),R=Math.max(0,Math.min(R,Rt));const nt=Math.min(o.x,L),dt=Math.min(o.y,R),Ct=Math.abs(L-o.x),jt=Math.abs(R-o.y);s(S,{x:nt,y:dt,width:Ct,height:jt},!0),s(K,{x:L,y:R},!0)}).on("end",()=>{!t(S)||!t(it)||(t(S).width>Ut&&t(S).height>Ut&&t(O)&&at({x:t(S).x,y:t(S).y,width:t(S).width,height:t(S).height,labelName:t(O).label}),he(),o=null)});return a.call(k),a.on("mousemove",pe),()=>{k.on("start",null).on("drag",null).on("end",null)}},fe=a=>{if(!t(q)||t(it))return;const o=t(q).getBoundingClientRect(),k=a.clientX,D=a.clientY,v=(k-o.left)/o.width*n().data.width,E=(D-o.top)/o.height*n().data.height;s(K,{x:v,y:E},!0),a.stopPropagation(),a.preventDefault()},pe=Ue.throttle(fe,50);He(()=>{ve(),t(V).subscribe(a=>{if(a.isSuccess&&a.data){let o=Ke(a.data);s(Mt,o,!0)}else s(Mt,[],!0)})});let O=$(void 0),Mt=$(ee([])),pt=$(ee(new Set));const _e=a=>{const o=new Set(t(pt));o.has(a)?o.delete(a):o.add(a),s(pt,o,!0)},be=r(()=>t(Mt).filter(a=>!t(pt).has(a.annotation_id))),Bt=r(()=>t(O)?Qe(t(O).label,1).color:"blue"),xe=async a=>{if(!n().data)return;(async()=>{try{await N(a),ut.success("Annotation deleted successfully"),t(g)(),t(U)===a&&s(U,void 0)}catch(k){ut.error("Failed to delete annotation. Please try again."),console.error("Error deleting annotation:",k)}})()},we=async a=>{try{await st(e.sampleId,a),ut.success("Tag removed successfully"),t(g)()}catch(o){ut.error("Failed to remove tag. Please try again."),console.error("Error removing tag from sample:",o)}},ye=r(()=>t(B)?"grab":t(kt)?"crosshair":"auto"),Se=r(()=>l()&&!t(B)),kt=r(()=>t(vt)&&!t(B)&&t(O)!==void 0);let Kt=$(null);var Ot=Q();oe("keydown",ae,Pt),oe("keyup",ae,W);var $e=_(Ot);{var Ie=a=>{var o=Ha(),k=I(o),D=I(k);Aa(D,{get dataset(){return e.dataset},get sampleIndex(){return e.sampleIndex}}),A(k);var v=h(k,2);la(v,{class:"mb-4 bg-border-hard"});var E=h(v,2),x=I(E),L=I(x);Ge(L,{className:"h-full",children:(nt,dt)=>{Ve(nt,{className:"h-full",children:(Ct,jt)=>{var Tt=La(),Dt=I(Tt),Lt=I(Dt),Pe=I(Lt);{let J=r(()=>i().has(e.sampleId));We(Pe,{onSelect:()=>F(e.sampleId),get isSelected(){return t(J)}})}A(Lt);var Gt=h(Lt,2);{var Me=J=>{var ct=Q(),_t=_(ct);It(_t,()=>e.children),c(J,ct)};Y(Gt,J=>{e.children&&J(Me)})}var Be=h(Gt,2);ga(Be,{get width(){return n().data.width},get height(){return n().data.height},get cursor(){return t(ye)},get boundingBox(){return t(Zt)},registerResetFn:ct=>s(Xt,ct,!0),zoomableContent:ct=>{var _t=Da(),Vt=_(_t),ke=h(Vt);{var Ee=Ht=>{var Wt=Ta(),bt=_(Wt);let qt;var Jt=I(bt);aa(Jt,17,()=>t(be),f=>f.annotation_id,(f,X)=>{{let j=r(()=>t(U)===t(X).annotation_id);Pa(f,{get annotationId(){return t(X).annotation_id},get sampleId(){return e.sampleId},get datasetId(){return w},get isResizable(){return t(Se)},get isSelected(){return t(j)},toggleAnnotationSelection:Yt})}});var Qt=h(Jt);{var Re=f=>{qe(f,{get bbox(){return t(S)},get colorStroke(){return t(Bt)},colorFill:"rgba(0, 123, 255, 0.1)",style:"outline: 0;",opacity:.8,scale:1})};Y(Qt,f=>{t(S)&&t(it)&&t(O)&&f(Re)})}var Ce=h(Qt);{var Te=f=>{var X=Ra(),j=_(X),xt=h(j);mt(()=>{H(j,"y1",t(K).y),H(j,"x2",n().data.width),H(j,"y2",t(K).y),H(j,"stroke",t(Bt)),H(xt,"x1",t(K).x),H(xt,"x2",t(K).x),H(xt,"y2",n().data.height),H(xt,"stroke",t(Bt))}),c(f,X)};Y(Ce,f=>{t(K)&&t(kt)&&f(Te)})}A(bt);var De=h(bt);{var Le=f=>{var X=Ca();se(X,j=>s(q,j),()=>t(q)),mt(()=>{H(X,"width",n().data.width),H(X,"height",n().data.height)}),c(f,X)};Y(De,f=>{t(kt)&&f(Le)})}mt(f=>qt=na(bt,0,"",null,qt,f),[()=>({invisible:d()})]),c(Ht,Wt)};Y(ke,Ht=>{n().data&&Ht(Ee)})}mt(()=>H(Vt,"href",t(lt))),c(ct,_t)},$$slots:{zoomableContent:!0}}),A(Dt),se(Dt,J=>s(Kt,J),()=>t(Kt)),A(Tt),c(Ct,Tt)},$$slots:{default:!0}})},$$slots:{default:!0}}),A(x);var R=h(x,2),Et=I(R);{var Rt=nt=>{ta(nt,{get sample(){return n().data},get annotationsIdsToHide(){return t(pt)},get selectedAnnotationId(){return t(U)},onAnnotationClick:Yt,onToggleShowAnnotation:_e,onDeleteAnnotation:xe,onRemoveTag:we,get onUpdate(){return t(g)},get addAnnotationEnabled(){return t(vt)},set addAnnotationEnabled(dt){s(vt,dt,!0)},get addAnnotationLabel(){return t(O)},set addAnnotationLabel(dt){s(O,dt,!0)}})};Y(Et,nt=>{n().data&&nt(Rt)})}A(R),A(E),A(o),c(a,o)},Ae=a=>{Je(a,{})};Y($e,a=>{n().data?a(Ie):a(Ae,!1)})}c(u,Ot),ht(),et()}var za=tt('<div class="flex h-full w-full space-x-4 px-4 pb-4" data-testid="sample-details"><div class="h-full w-full space-y-6 rounded-[1vw] bg-card p-4"><!></div></div>');function ln(u,e){gt(e,!0);const m=r(()=>yt.params.sampleId),l=yt.data.dataset,n=r(()=>Number(yt.params.sampleIndex));var i=za(),d=I(i),p=I(d);Fa(p,{get sampleId(){return t(m)},get dataset(){return l},get sampleIndex(){return t(n)},children:(et,ot)=>{var F=Q(),w=_(F);{var z=C=>{var Z=Q(),N=_(Z);It(N,()=>e.children),c(C,Z)};Y(w,C=>{e.children&&C(z)})}c(et,F)},$$slots:{default:!0}}),A(d),A(i),c(u,i),ht()}export{ln as component};
