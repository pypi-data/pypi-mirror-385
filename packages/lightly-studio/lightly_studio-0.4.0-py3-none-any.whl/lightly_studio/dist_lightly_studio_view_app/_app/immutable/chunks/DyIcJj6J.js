var lt=e=>{throw TypeError(e)};var H=(e,t,s)=>t.has(e)||lt("Cannot "+s);var n=(e,t,s)=>(H(e,t,"read from private field"),s?s.call(e):t.get(e)),y=(e,t,s)=>t.has(e)?lt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s),l=(e,t,s,a)=>(H(e,t,"write to private field"),a?a.call(e,s):t.set(e,s),s),f=(e,t,s)=>(H(e,t,"access private method"),s);import{d as Ct,e as St,g as Et,f as Qt,h as Ft,i as At,j as Mt,k as xt,l as Ut,u as Dt,m as qt,n as Tt,o as Lt,p as Kt}from"./BaFFwDFr.js";import{aN as jt,o as G,m as nt,w as Bt}from"./C3xJX0nD.js";import{u as rt}from"./BOmrKuMn.js";import{S as kt,p as ft,r as R,s as J,a as V,n as _t,i as yt,b as pt,t as Pt,f as Vt,c as zt,d as bt,e as wt,g as Nt,h as Wt}from"./CANX9QXL.js";var O,r,k,m,M,T,S,w,_,L,K,x,U,E,j,i,B,X,Y,Z,$,tt,et,st,Rt,vt,Ht=(vt=class extends kt{constructor(t,s){super();y(this,i);y(this,O);y(this,r);y(this,k);y(this,m);y(this,M);y(this,T);y(this,S);y(this,w);y(this,_);y(this,L);y(this,K);y(this,x);y(this,U);y(this,E);y(this,j,new Set);this.options=s,l(this,O,t),l(this,w,null),l(this,S,ft()),this.options.experimental_prefetchInRender||n(this,S).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(s)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(n(this,r).addObserver(this),mt(n(this,r),this.options)?f(this,i,B).call(this):this.updateResult(),f(this,i,$).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return at(n(this,r),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return at(n(this,r),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,f(this,i,tt).call(this),f(this,i,et).call(this),n(this,r).removeObserver(this)}setOptions(t,s){const a=this.options,o=n(this,r);if(this.options=n(this,O).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof R(this.options.enabled,n(this,r))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");f(this,i,st).call(this),n(this,r).setOptions(this.options),a._defaulted&&!J(this.options,a)&&n(this,O).getQueryCache().notify({type:"observerOptionsUpdated",query:n(this,r),observer:this});const u=this.hasListeners();u&&Ot(n(this,r),o,this.options,a)&&f(this,i,B).call(this),this.updateResult(s),u&&(n(this,r)!==o||R(this.options.enabled,n(this,r))!==R(a.enabled,n(this,r))||V(this.options.staleTime,n(this,r))!==V(a.staleTime,n(this,r)))&&f(this,i,X).call(this);const d=f(this,i,Y).call(this);u&&(n(this,r)!==o||R(this.options.enabled,n(this,r))!==R(a.enabled,n(this,r))||d!==n(this,E))&&f(this,i,Z).call(this,d)}getOptimisticResult(t){const s=n(this,O).getQueryCache().build(n(this,O),t),a=this.createResult(s,t);return Jt(this,a)&&(l(this,m,a),l(this,T,this.options),l(this,M,n(this,r).state)),a}getCurrentResult(){return n(this,m)}trackResult(t,s){const a={};return Object.keys(t).forEach(o=>{Object.defineProperty(a,o,{configurable:!1,enumerable:!0,get:()=>(this.trackProp(o),s==null||s(o),t[o])})}),a}trackProp(t){n(this,j).add(t)}getCurrentQuery(){return n(this,r)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const s=n(this,O).defaultQueryOptions(t),a=n(this,O).getQueryCache().build(n(this,O),s);return a.fetch().then(()=>this.createResult(a,s))}fetch(t){return f(this,i,B).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),n(this,m)))}createResult(t,s){var dt;const a=n(this,r),o=this.options,u=n(this,m),d=n(this,M),p=n(this,T),I=t!==a?t.state:n(this,k),{state:c}=t;let h={...c},F=!1,g;if(s._optimisticResults){const b=this.hasListeners(),D=!b&&mt(t,s),q=b&&Ot(t,a,s,o);(D||q)&&(h={...h,...zt(c.data,t.options)}),s._optimisticResults==="isRestoring"&&(h.fetchStatus="idle")}let{error:ot,errorUpdatedAt:ut,status:A}=h;if(s.select&&h.data!==void 0)if(u&&h.data===(d==null?void 0:d.data)&&s.select===n(this,_))g=n(this,L);else try{l(this,_,s.select),g=s.select(h.data),g=bt(u==null?void 0:u.data,g,s),l(this,L,g),l(this,w,null)}catch(b){l(this,w,b)}else g=h.data;if(s.placeholderData!==void 0&&g===void 0&&A==="pending"){let b;if(u!=null&&u.isPlaceholderData&&s.placeholderData===(p==null?void 0:p.placeholderData))b=u.data;else if(b=typeof s.placeholderData=="function"?s.placeholderData((dt=n(this,K))==null?void 0:dt.state.data,n(this,K)):s.placeholderData,s.select&&b!==void 0)try{b=s.select(b),l(this,w,null)}catch(D){l(this,w,D)}b!==void 0&&(A="success",g=bt(u==null?void 0:u.data,b,s),F=!0)}n(this,w)&&(ot=n(this,w),g=n(this,L),ut=Date.now(),A="error");const z=h.fetchStatus==="fetching",N=A==="pending",W=A==="error",ct=N&&z,ht=g!==void 0,v={status:A,fetchStatus:h.fetchStatus,isPending:N,isSuccess:A==="success",isError:W,isInitialLoading:ct,isLoading:ct,data:g,dataUpdatedAt:h.dataUpdatedAt,error:ot,errorUpdatedAt:ut,failureCount:h.fetchFailureCount,failureReason:h.fetchFailureReason,errorUpdateCount:h.errorUpdateCount,isFetched:h.dataUpdateCount>0||h.errorUpdateCount>0,isFetchedAfterMount:h.dataUpdateCount>I.dataUpdateCount||h.errorUpdateCount>I.errorUpdateCount,isFetching:z,isRefetching:z&&!N,isLoadingError:W&&!ht,isPaused:h.fetchStatus==="paused",isPlaceholderData:F,isRefetchError:W&&ht,isStale:it(t,s),refetch:this.refetch,promise:n(this,S)};if(this.options.experimental_prefetchInRender){const b=P=>{v.status==="error"?P.reject(v.error):v.data!==void 0&&P.resolve(v.data)},D=()=>{const P=l(this,S,v.promise=ft());b(P)},q=n(this,S);switch(q.status){case"pending":t.queryHash===a.queryHash&&b(q);break;case"fulfilled":(v.status==="error"||v.data!==q.value)&&D();break;case"rejected":(v.status!=="error"||v.error!==q.reason)&&D();break}}return v}updateResult(t){const s=n(this,m),a=this.createResult(n(this,r),this.options);if(l(this,M,n(this,r).state),l(this,T,this.options),n(this,M).data!==void 0&&l(this,K,n(this,r)),J(a,s))return;l(this,m,a);const o={},u=()=>{if(!s)return!0;const{notifyOnChangeProps:d}=this.options,p=typeof d=="function"?d():d;if(p==="all"||!p&&!n(this,j).size)return!0;const C=new Set(p??n(this,j));return this.options.throwOnError&&C.add("error"),Object.keys(n(this,m)).some(I=>{const c=I;return n(this,m)[c]!==s[c]&&C.has(c)})};(t==null?void 0:t.listeners)!==!1&&u()&&(o.listeners=!0),f(this,i,Rt).call(this,{...o,...t})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&f(this,i,$).call(this)}},O=new WeakMap,r=new WeakMap,k=new WeakMap,m=new WeakMap,M=new WeakMap,T=new WeakMap,S=new WeakMap,w=new WeakMap,_=new WeakMap,L=new WeakMap,K=new WeakMap,x=new WeakMap,U=new WeakMap,E=new WeakMap,j=new WeakMap,i=new WeakSet,B=function(t){f(this,i,st).call(this);let s=n(this,r).fetch(this.options,t);return t!=null&&t.throwOnError||(s=s.catch(_t)),s},X=function(){f(this,i,tt).call(this);const t=V(this.options.staleTime,n(this,r));if(yt||n(this,m).isStale||!pt(t))return;const a=Pt(n(this,m).dataUpdatedAt,t)+1;l(this,x,setTimeout(()=>{n(this,m).isStale||this.updateResult()},a))},Y=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(n(this,r)):this.options.refetchInterval)??!1},Z=function(t){f(this,i,et).call(this),l(this,E,t),!(yt||R(this.options.enabled,n(this,r))===!1||!pt(n(this,E))||n(this,E)===0)&&l(this,U,setInterval(()=>{(this.options.refetchIntervalInBackground||Vt.isFocused())&&f(this,i,B).call(this)},n(this,E)))},$=function(){f(this,i,X).call(this),f(this,i,Z).call(this,f(this,i,Y).call(this))},tt=function(){n(this,x)&&(clearTimeout(n(this,x)),l(this,x,void 0))},et=function(){n(this,U)&&(clearInterval(n(this,U)),l(this,U,void 0))},st=function(){const t=n(this,O).getQueryCache().build(n(this,O),this.options);if(t===n(this,r))return;const s=n(this,r);l(this,r,t),l(this,k,t.state),this.hasListeners()&&(s==null||s.removeObserver(this),t.addObserver(this))},Rt=function(t){wt.batch(()=>{t.listeners&&this.listeners.forEach(s=>{s(n(this,m))}),n(this,O).getQueryCache().notify({query:n(this,r),type:"observerResultsUpdated"})})},vt);function Gt(e,t){return R(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function mt(e,t){return Gt(e,t)||e.state.data!==void 0&&at(e,t,t.refetchOnMount)}function at(e,t,s){if(R(t.enabled,e)!==!1){const a=typeof s=="function"?s(e):s;return a==="always"||a!==!1&&it(e,t)}return!1}function Ot(e,t,s,a){return(e!==t||R(a.enabled,e)===!1)&&(!s.suspense||e.state.status!=="error")&&it(e,s)}function it(e,t){return R(t.enabled,e)!==!1&&e.isStaleByTime(V(t.staleTime,e))}function Jt(e,t){return!J(e.getCurrentResult(),t)}function Xt(){return Nt()}function Yt(e){return Wt()}function Zt(e){return"subscribe"in e&&typeof e.subscribe=="function"}function $t(){}function te(e,t,s){const a=Yt(),o=Xt(),u=Zt(e)?e:jt(e),d=G([u,o],([c,h])=>{const F=a.defaultQueryOptions(c);return F._optimisticResults=h?"isRestoring":"optimistic",F}),p=new t(a,nt(d));d.subscribe(c=>{p.setOptions(c,{listeners:!1})});const C=G(o,(c,h)=>{const F=c?$t:p.subscribe(wt.batchCalls(h));return p.updateResult(),F}),{subscribe:I}=G([C,d],([c,h])=>(c=p.getOptimisticResult(h),h.notifyOnChangeProps?c:p.trackResult(c)));return{subscribe:I}}function ee(e,t){return te(e,Ht)}function ge(e){return e}const Q=(e,t,s)=>{const a={_id:e,baseUrl:(t==null?void 0:t.baseUrl)||((t==null?void 0:t.client)??Ct).getConfig().baseUrl};return s&&(a._infinite=s),t!=null&&t.body&&(a.body=t.body),t!=null&&t.headers&&(a.headers=t.headers),t!=null&&t.path&&(a.path=t.path),t!=null&&t.query&&(a.query=t.query),[a]},It=(e,t)=>{const s={...e[0]};return t.body&&(s.body={...e[0].body,...t.body}),t.headers&&(s.headers={...e[0].headers,...t.headers}),t.path&&(s.path={...e[0].path,...t.path}),t.query&&(s.query={...e[0].query,...t.query}),s},se=e=>Q("readSample",e),ve=e=>({queryFn:async({queryKey:t,signal:s})=>{const{data:a}=await Mt({...e,...t[0],signal:s,throwOnError:!0});return a},queryKey:se(e)}),we=e=>({mutationFn:async s=>{const{data:a}=await Qt({...e,...s,throwOnError:!0});return a}}),ae=e=>Q("readAnnotationLabels",e),Re=e=>({queryFn:async({queryKey:t,signal:s})=>{const{data:a}=await xt({...e,...t[0],signal:s,throwOnError:!0});return a},queryKey:ae(e)}),Ie=e=>({mutationFn:async s=>{const{data:a}=await At({...e,...s,throwOnError:!0});return a}}),ne=e=>Q("readAnnotations",e,!0),Ce=e=>({queryFn:async({pageParam:t,queryKey:s,signal:a})=>{const u=It(s,typeof t=="object"?t:{query:{cursor:t}}),{data:d}=await Tt({...e,...u,signal:a,throwOnError:!0});return d},queryKey:ne(e)}),Se=e=>({mutationFn:async s=>{const{data:a}=await Ft({...e,...s,throwOnError:!0});return a}}),Ee=e=>({mutationFn:async s=>{const{data:a}=await Dt({...e,...s,throwOnError:!0});return a}}),re=e=>Q("countAnnotationsByDataset",e),Qe=e=>({queryFn:async({queryKey:t,signal:s})=>{const{data:a}=await Ut({...e,...t[0],signal:s,throwOnError:!0});return a},queryKey:re(e)}),Fe=e=>({mutationFn:async s=>{const{data:a}=await St({...e,...s,throwOnError:!0});return a}}),ie=e=>Q("getAnnotation",e),Ae=e=>({queryFn:async({queryKey:t,signal:s})=>{const{data:a}=await Lt({...e,...t[0],signal:s,throwOnError:!0});return a},queryKey:ie(e)}),oe=e=>Q("readCaptions",e,!0),Me=e=>({queryFn:async({pageParam:t,queryKey:s,signal:a})=>{const u=It(s,typeof t=="object"?t:{query:{cursor:t}}),{data:d}=await qt({...e,...u,signal:a,throwOnError:!0});return d},queryKey:oe(e)}),ue=e=>Q("get2dEmbeddings",e),xe=e=>({queryFn:async({queryKey:t,signal:s})=>{const{data:a}=await Kt({...e,...t[0],signal:s,throwOnError:!0});return a},queryKey:ue(e)}),ce=e=>Q("getMetadataInfo",e),he=e=>({queryFn:async({queryKey:t,signal:s})=>{const{data:a}=await Et({...e,...t[0],signal:s,throwOnError:!0});return a},queryKey:ce(e)}),gt=Bt(!1),de=async e=>{if(nt(gt))return;const t=he({path:{dataset_id:e}});ee(t).subscribe(a=>{if(a.data){const o=a.data,{updateMetadataBounds:u,updateMetadataValues:d,updateMetadataInfo:p}=rt(),C={},I={};o.forEach(c=>{(c.type==="integer"||c.type==="float")&&c.min!=null&&c.max!=null&&(C[c.name]={min:c.min,max:c.max},I[c.name]={min:c.min,max:c.max})}),u(C),d(I),p(o),gt.set(!0)}})},le=e=>{const t=[],{metadataBounds:s}=rt();for(const[a,o]of Object.entries(e)){const d=nt(s)[a];d&&(o.min>d.min&&t.push({key:a,value:o.min,op:">="}),o.max<d.max&&t.push({key:a,value:o.max,op:"<="}))}return t},Ue=e=>{e&&de(e);const{metadataBounds:t,metadataValues:s,metadataInfo:a,updateMetadataValues:o,updateMetadataBounds:u,updateMetadataInfo:d}=rt();return{metadataBounds:t,metadataValues:s,metadataInfo:a,updateMetadataValues:o,updateMetadataBounds:u,updateMetadataInfo:d,createMetadataFilters:le}};export{Ht as Q,Se as a,Ie as b,le as c,Fe as d,we as e,ve as f,ee as g,Ue as h,Qe as i,xe as j,te as k,Zt as l,Ee as m,$t as n,Ce as o,Re as p,Ae as q,Me as r,ge as s,Yt as u};
