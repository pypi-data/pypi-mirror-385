import{a as k}from"./chunk-GAUD627J.js";import"./chunk-43LQFSHA.js";var a={},u={};a.TextReader=class{static open(e){let t=k.open(e),s="";for(let i=0;i<4096;i++){let r=t.decode();if(s==="match")break;if(r===void 0||r==="\0"){if(s==="")return null;break}if(r<=" "){if(r!==" "&&r!==`
`&&r!=="\r"&&r!=="	")return null;continue}switch(s){case"":if(r==="{")s="{}";else if(r==="[")s="[]";else return null;break;case"[]":if(r!=='"'&&r!=="-"&&r!=="+"&&r!=="{"&&r!=="["&&(r<"0"||r>"9"))return null;s="match";break;case"{}":if(r!=='"')return null;s="match";break;default:break}}return new a.TextReader(t)}constructor(e){this._decoder=e,this._decoder.position=0,this._escape={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"}}read(){let e=[];this._decoder.position=0,this._position=0,this._char=this._decoder.decode(),this._whitespace();let t=null,s=!0;for(;;)if(Array.isArray(t)){this._whitespace();let i=this._char;if(i==="]"){if(this._next(),this._whitespace(),e.length>0){t=e.pop(),s=!1;continue}return this._char!==void 0&&this._unexpected(),t}switch(s||(this._char!==","&&this._unexpected(),this._next(),this._whitespace(),i=this._char),s=!1,i){case"{":{this._next(),e.push(t);let r={};t.push(r),t=r,s=!0;break}case"[":{this._next(),e.push(t);let r=[];t.push(r),t=r,s=!0;break}default:{t.push(i==='"'?this._string():this._literal());break}}}else if(t instanceof Object){this._whitespace();let i=this._char;if(i==="}"){if(this._next(),this._whitespace(),e.length>0){t=e.pop(),s=!1;continue}return this._char!==void 0&&this._unexpected(),t}if(s||(this._char!==","&&this._unexpected(),this._next(),this._whitespace(),i=this._char),s=!1,i==='"'){let r=this._string();switch(r){case"__proto__":throw new a.Error(`Invalid key '${r}' ${this._location()}`);default:break}switch(this._whitespace(),this._char!==":"&&this._unexpected(),this._next(),this._whitespace(),i=this._char,i){case"{":{this._next(),e.push(t);let n={};t[r]=n,t=n,s=!0;break}case"[":{this._next(),e.push(t);let n=[];t[r]=n,t=n,s=!0;break}default:{t[r]=i==='"'?this._string():this._literal();break}}this._whitespace();continue}this._unexpected()}else{let i=this._char;switch(i){case"{":{this._next(),this._whitespace(),t={},s=!0;break}case"[":{this._next(),this._whitespace(),t=[],s=!0;break}default:{let r=null;return i==='"'?r=this._string():i>="0"&&i<="9"?r=this._number():r=this._literal(),this._whitespace(),this._char!==void 0&&this._unexpected(),r}}}}_next(){this._char===void 0&&this._unexpected(),this._position=this._decoder.position,this._char=this._decoder.decode()}_whitespace(){for(;this._char===" "||this._char===`
`||this._char==="\r"||this._char==="	";)this._next()}_literal(){let e=this._char;if(e>="0"&&e<="9")return this._number();switch(e){case"t":return this._expect("true"),!0;case"f":return this._expect("false"),!1;case"n":return this._expect("null"),null;case"N":return this._expect("NaN"),NaN;case"I":return this._expect("Infinity"),1/0;case"-":return this._number();default:this._unexpected()}return null}_number(){let e="";if(this._char==="-"&&(e="-",this._next()),this._char==="I")return this._expect("Infinity"),-1/0;let t=this._char;if((t<"0"||t>"9")&&this._unexpected(),e+=t,this._next(),t==="0"){let s=this._char;s>="0"&&s<="9"&&this._unexpected()}for(;this._char>="0"&&this._char<="9";)e+=this._char,this._next();if(this._char==="."){e+=".",this._next();let s=this._char;for((s<"0"||s>"9")&&this._unexpected();this._char>="0"&&this._char<="9";)e+=this._char,this._next()}if(this._char==="e"||this._char==="E"){e+=this._char,this._next();let s=this._char;(s==="-"||s==="+")&&(e+=this._char,this._next());let i=this._char;for((i<"0"||i>"9")&&this._unexpected(),e+=this._char,this._next();this._char>="0"&&this._char<="9";)e+=this._char,this._next()}return Number(e)}_string(){let e="";for(this._next();this._char!=='"';)if(this._char==="\\")if(this._next(),this._char==="u"){this._next();let t=0;for(let s=0;s<4;s++){let i=parseInt(this._char,16);isFinite(i)||this._unexpected(),this._next(),t=t*16+i}e+=String.fromCharCode(t)}else this._escape[this._char]?(e+=this._escape[this._char],this._next()):this._unexpected();else this._char<" "?this._unexpected():(e+=this._char,this._next());return this._next(),e}_expect(e){for(let t=0;t<e.length;t++)e[t]!==this._char&&this._unexpected(),this._next()}_unexpected(){let e=this._char;if(e===void 0)throw new a.Error("Unexpected end of JSON input.");if(e==='"')e="string";else if(e>="0"&&e<="9"||e==="-")e="number";else{if(e<" "||e>"\x7F"){let t=Object.keys(this._escape).filter(s=>this._escape[s]===e);e=t.length===1?`\\${t}`:`\\u${`000${e.charCodeAt(0).toString(16)}`.slice(-4)}`}e=`token '${e}'`}throw new a.Error(`Unexpected ${e} ${this._location()}`)}_location(){let e=1,t=1;this._decoder.position=0;let s="";do{if(this._decoder.position===this._position)return`at ${e}:${t}.`;s=this._decoder.decode(),s===`
`?(e++,t=1):t++}while(s!==void 0);return`at ${e}:${t}.`}};a.BinaryReader=class{static open(e){let t=e.length,s=e instanceof Uint8Array?e:e.peek(Math.min(e.length,8)),i=new DataView(s.buffer,s.byteOffset,s.byteLength);if(s.length>=4&&i.getInt32(0,!0)===t)return new a.BinaryReader(e,"bson");let[r]=s;return r===123||r===91?new a.BinaryReader(e,"ubj"):null}constructor(e,t){this._buffer=e instanceof Uint8Array?e:e.peek(),this._format=t}read(){switch(this._format){case"bson":return this._readBson();case"ubj":return this._readUbj();default:throw new a.Error(`Unsupported binary JSON format '${this._format}'.`)}}_readBson(){let e=this._buffer,t=e.length,s=new DataView(e.buffer,e.byteOffset,e.byteLength),i=new TextDecoder("ascii"),r=new TextDecoder("utf-8"),n=0,o=_=>{if(n+=_,n>t)throw new u.Error(`Expected ${n+t} more bytes. The file might be corrupted. Unexpected end of file.`)},p=()=>{let _=n;o(4);let l=s.getInt32(_,4);if(l<5||_+l>t||e[_+l-1]!==0)throw new u.Error("Invalid file size.")};p();let x=[],f={};for(;;){o(1);let _=e[n-1];if(_===0){if(x.length===0)break;f=x.pop();continue}let l=n;n=e.indexOf(0,l)+1;let d=i.decode(e.subarray(l,n-1)),h=null;switch(_){case 1:{let c=n;o(8),h=s.getFloat64(c,!0);break}case 2:{o(4);let c=s.getInt32(n-4,!0),b=n;if(o(c),h=r.decode(e.subarray(b,n-1)),e[n-1]!==0)throw new u.Error("String missing terminal 0.");break}case 3:{p(),h={};break}case 4:{p(),h=[];break}case 5:{let c=n;o(5);let b=s.getInt32(c,!0),w=e[c+4];if(w!==0)throw new u.Error(`Unsupported binary subtype '${w}'.`);o(b),h=e.subarray(c+5,n);break}case 8:{if(o(1),h=e[n-1],h>1)throw new u.Error(`Invalid boolean value '${h}'.`);h=h===1;break}case 10:h=null;break;case 16:{let c=n;o(4),h=s.getInt32(c,!0);break}case 17:{let c=n;o(8),h=Number(s.getBigUint64(c,!0));break}case 18:{let c=n;o(8),h=Number(s.getBigInt64(c,!0));break}default:throw new u.Error(`Unsupported value type '${_}'.`)}if(Array.isArray(f)){if(f.length!==parseInt(d,10))throw new u.Error(`Invalid array index '${d}'.`);f.push(h)}else{switch(d){case"__proto__":case"constructor":case"prototype":throw new u.Error(`Invalid key '${d}' at ${n}'.`);default:break}f[d]=h}(_===3||_===4)&&(x.push(f),f=h)}if(n!==t)throw new u.Error(`Unexpected data at '${n}'.`);return f}_readUbj(){throw new a.Error("Unsupported JSON UBJ data.")}};a.Error=class extends Error{constructor(e){super(e),this.name="JSON Error"}};u.Error=class extends Error{constructor(e){super(e),this.name="BSON Error"}};var y=a.TextReader,m=a.BinaryReader;export{m as BinaryReader,y as TextReader};
