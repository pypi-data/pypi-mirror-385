var r={};r.Decoder=class{static open(t,e){if(typeof t=="string")return new r.Decoder.String(t);let o=(s,f)=>{if(s&&s!==f)throw new r.Error(`Invalid encoding '${s}'.`)},i=t instanceof Uint8Array?t:t.peek(),n=i.length;if(n>=3&&i[0]===239&&i[1]===187&&i[2]===191)return o(e,"utf-8"),new r.Decoder.Utf8(i,3,!0);if(n>=2&&i[0]===255&&i[1]===254)return o(e,"utf-16"),new r.Decoder.Utf16LE(i,2);if(n>=2&&i[0]===254&&i[1]===255)return o(e,"utf-16"),new r.Decoder.Utf16BE(i,2);if(n>=4&&i[0]===0&&i[1]===0&&i[2]===254&&i[3]===255)return o(e,"utf-32"),new r.Decoder.Utf32LE(i,2);if(n>=4&&i[0]===255&&i[1]===254&&i[2]===0&&i[3]===0)return o(e,"utf-32"),new r.Decoder.Utf32BE(i,2);if(n>=5&&i[0]===43&&i[1]===47&&i[2]===118&&i[3]===56&&i[4]===45)throw new r.Error("Unsupported UTF-7 encoding.");if(n>=4&&i[0]===43&&i[1]===47&&i[2]===118&&(i[3]===56||i[3]===57||i[3]===43||i[3]===47))throw new r.Error("Unsupported UTF-7 encoding.");if(n>=4&&i[0]===132&&i[1]===49&&i[2]===149&&i[3]===51)throw new r.Error("Unsupported GB-18030 encoding.");if(n>4&&n%2===0&&(i[0]===0||i[1]===0||i[2]===0||i[3]===0)){let s=new Uint32Array(256),f=new Uint32Array(256),u=Math.min(1024,n);for(let h=0;h<u;h+=2)s[i[h]]++,f[i[h+1]]++;if(s[0]===0&&f[0]/(n>>1)>.5)return o(e,"utf-16"),new r.Decoder.Utf16LE(i,0);if(f[0]===0&&s[0]/(n>>1)>.5)return o(e,"utf-16"),new r.Decoder.Utf16BE(i,0)}return e&&(e.startsWith("iso-8859-")||e.startsWith("latin-"))?new r.Decoder.Latin1(i,0):(o(e,"utf-8"),new r.Decoder.Utf8(i,0,e==="utf-8"))}};r.Decoder.String=class{constructor(t){this.buffer=/[\u0020-\uD800]/.test(t)?t:t.match(/[\uD800-\uDBFF][\uDC00-\uDFFF]|[^\uD800-\uDFFF]/g),this.position=0,this.length=this.buffer.length}get encoding(){return null}decode(){if(this.position<this.length)return this.buffer[this.position++]}};r.Decoder.Utf8=class{constructor(t,e,o){this.position=e||0,this.buffer=t,this.fatal=o}get encoding(){return"utf-8"}decode(){let t=this.buffer[this.position];if(t===void 0)return t;if(this.position++,t<128)return String.fromCodePoint(t);if(t>=194&&t<=223&&this.buffer[this.position]!==void 0){let e=this.buffer[this.position];return this.position++,String.fromCharCode((t&31)<<6|e&63)}if(t>=224&&t<=239&&this.buffer[this.position+1]!==void 0){let e=this.buffer[this.position];if((t!==224||e>=160)&&(t!==237||e<=159)){let o=this.buffer[this.position+1];if(o>=128&&o<251)return this.position+=2,String.fromCharCode((t&15)<<12|(e&63)<<6|(o&63)<<0)}}if(t>=240&&t<=244&&this.buffer[this.position+2]!==void 0){let e=this.buffer[this.position];if(e>=128&&e<=191){let o=this.buffer[this.position+1];if(o>=128&&o<=191){let i=this.buffer[this.position+2];if(i>=128&&i<=191){let n=(t&7)<<18|(e&63)<<12|(o&63)<<6|i&63;if(n<=1114111)return this.position+=3,String.fromCodePoint(n)}}}}if(this.fatal)throw new r.Error("Invalid utf-8 character.");return"\uFFFD"}};r.Decoder.Latin1=class{constructor(t,e){this.position=e||0,this.buffer=t}get encoding(){return"latin-1"}decode(){let t=this.buffer[this.position];return t===void 0?t:(this.position++,String.fromCodePoint(t))}};r.Decoder.Utf16LE=class{constructor(t,e){this.buffer=t,this.position=e||0,this.length=t.length}get encoding(){return"utf-16"}decode(){if(this.position+1<this.length){let t=this.buffer[this.position++]|this.buffer[this.position++]<<8;if(t<55296||t>=57343)return String.fromCharCode(t);if(t>=55296&&t<56319&&this.position+1<this.length){let e=this.buffer[this.position++]|this.buffer[this.position++]<<8;if(t>=56320||t<57343)return String.fromCodePoint(65536+((t&1023)<<10)+(e&1023))}return"\uFFFD"}}};r.Decoder.Utf16BE=class{constructor(t,e){this.buffer=t,this.position=e||0,this.length=t.length}get encoding(){return"utf-16"}decode(){if(this.position+1<this.length){let t=this.buffer[this.position++]<<8|this.buffer[this.position++];if(t<55296||t>=57343)return String.fromCharCode(t);if(t>=55296&&t<56319&&this.position+1<this.length){let e=this.buffer[this.position++]<<8|this.buffer[this.position++];if(t>=56320||t<57343)return String.fromCodePoint(65536+((t&1023)<<10)+(e&1023))}return"\uFFFD"}}};r.Decoder.Utf32LE=class{constructor(t,e){this.buffer=t,this.position=e||0,this.length=t.length}get encoding(){return"utf-32"}decode(){if(this.position+3<this.length){let t=this.buffer[this.position++]|this.buffer[this.position++]<<8||this.buffer[this.position++]<<16||this.buffer[this.position++]<<24;return t<1114111?String.fromCodePoint(t):"\uFFFD"}}};r.Decoder.Utf32BE=class{constructor(t,e){this.buffer=t,this.position=e||0,this.length=t.length}get encoding(){return"utf-32"}decode(){if(this.position+3<this.length){let t=this.buffer[this.position++]<<24||this.buffer[this.position++]<<16||this.buffer[this.position++]<<8|this.buffer[this.position++];return t<1114111?String.fromCodePoint(t):"\uFFFD"}}};r.Reader=class{constructor(t){this.decoder=r.Decoder.open(t),this.position=0,this.length=Number.MAX_SAFE_INTEGER}static open(t,e){return new r.Reader(t,e)}read(t){if(this.position>=this.length)return;let e="",o=null;for(;;){let i=this.decoder.decode();if(i===void 0){this.length=this.position;break}if(this.position++,i===t||this.position>this.length)break;e+=i,e.length>=64&&(o=o||[],o.push(e),e="")}return o?(o.push(e),o.join("")):e}};r.Error=class extends Error{constructor(t){super(t),this.name="Text Error"}};var c=r.Decoder,x=r.Reader;export{c as a,x as b};
