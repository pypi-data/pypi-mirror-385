import{a as x}from"./chunk-447NKSFT.js";import"./chunk-43LQFSHA.js";var i={};i.File=class{static open(t){if(t&&t.length>=8){let s=t instanceof Uint8Array?t:t.peek(8);if([137,72,68,70,13,10,26,10].every((o,n)=>o===s[n]))return new i.File(t)}return null}constructor(t){this.data=t}read(){if(this.data){let t=this.data;delete this.data;let s=i.Reader.open(t);s.skip(8),this._globalHeap=new i.GlobalHeap(s);let e=s.byte();switch(e){case 0:case 1:{if(this._freeSpaceStorageVersion=s.byte(),this._rootGroupEntryVersion=s.byte(),s.skip(1),this._sharedHeaderMessageVersionFormat=s.byte(),s.initialize(),s.skip(1),this._groupLeafNodeK=s.uint16(),this._groupInternalNodeK=s.uint16(),s.skip(4),e>0&&(this._indexedStorageInternalNodeK=s.uint16(),this.skip(2)),this._baseAddress=s.offset(),s.offset(),this._endOfFileAddress=s.offset(),s.offset(),this._baseAddress!==0)throw new i.Error("Base address is not zero.");let o=new i.SymbolTableEntry(s);this._rootGroup=new i.Group(s,o,null,this._globalHeap,"","");break}case 2:case 3:{s.initialize(),s.byte(),this._baseAddress=s.offset(),this._superBlockExtensionAddress=s.offset(),this._endOfFileAddress=s.offset();let o=new i.DataObjectHeader(s,s.offset());this._rootGroup=new i.Group(s,null,o,this._globalHeap,"","");break}default:throw new i.Error(`Unsupported Superblock version ${e}.`)}delete this.data}return this._rootGroup}};i.Group=class{constructor(t,s,e,o,n,a){this._reader=t,this._entry=s,this._dataObjectHeader=e,this._globalHeap=o,this._name=a,this._path=n==="/"?n+a:`${n}/${a}`}get name(){return this._name}get path(){return this._path}group(t){if(this._decodeGroups(),this._groups.has(t))return this._groups.get(t);let s=t.indexOf("/");if(s!==-1){let e=this.group(t.substring(0,s));if(e)return e.group(t.substring(s+1))}return null}get groups(){return this._decodeGroups(),this._groups}get attributes(){return this._decodeDataObject(),this._attributes}get value(){return this._decodeDataObject(),this._value}_decodeDataObject(){if(this._dataObjectHeader||(this._dataObjectHeader=new i.DataObjectHeader(this._reader,this._entry.objectHeaderAddress)),!this._attributes){this._attributes=new Map;for(let n of this._dataObjectHeader.attributes){let a=n.name,h=n.decodeValue(this._globalHeap);this._attributes.set(a,h)}this._value=null;let t=this._dataObjectHeader.datatype,s=this._dataObjectHeader.dataspace,e=this._dataObjectHeader.dataLayout,o=this._dataObjectHeader.filterPipeline;t&&s&&e&&(this._value=new i.Variable(this._reader,this._globalHeap,t,s,e,o))}this._reader.position!==0&&this._reader.seek(0)}_decodeGroups(){if(!this._groups)if(this._groups=new Map,this._entry){if(this._entry.treeAddress||this._entry.heapAddress){let t=new i.Heap(this._reader,this._entry.heapAddress),s=new i.Tree(this._reader,this._entry.treeAddress);for(let e of s.nodes)for(let o of e.entries){let n=t.getString(o.linkNameOffset),a=new i.Group(this._reader,o,null,this._globalHeap,this._path,n);this._groups.set(n,a)}}}else{this._decodeDataObject();for(let t of this._dataObjectHeader.links)if(Object.prototype.hasOwnProperty.call(t,"objectHeaderAddress")){let s=t.name,e=new i.DataObjectHeader(this._reader,t.objectHeaderAddress),o=new i.Group(this._reader,null,e,this._globalHeap,this._path,s);this._groups.set(s,o)}}}};i.Variable=class{constructor(t,s,e,o,n,a){this._reader=t,this._globalHeap=s,this._datatype=e,this._dataspace=o,this._dataLayout=n,this._filterPipeline=a}get type(){return this._datatype.type}get littleEndian(){return this._datatype.littleEndian}get shape(){return this._dataspace.shape}get value(){let t=this.data;if(t){let s=i.Reader.open(t),e=this._dataspace.read(this._datatype,s);return this._dataspace.decode(this._datatype,e,e,this._globalHeap)}return null}get data(){switch(this._dataLayout.layoutClass){case 1:if(this._dataLayout.address&&this._dataLayout.address!==-1){let t=this._reader.position;this._reader.seek(this._dataLayout.address);let s=this._reader.stream(this._dataLayout.size);return this._reader.seek(t),s}break;case 2:{let t=this._dataLayout.dimensionality,s=new i.Tree(this._reader,this._dataLayout.address,t),e=this._dataLayout.datasetElementSize,o=this._dataLayout.dimensionSizes,n=this._dataspace.shape,a=o.reduce((f,l)=>f*l,1),h=n.reduce((f,l)=>f*l,1),r=n.length-1,p=1,b=new Array(n.length);for(let f=n.length-1;f>=0;f--)b[f]=p,p*=n[f];let u=new Uint8Array(h*e);for(let f of s.nodes){let l=f.data;if(this._filterPipeline)for(let _=0;_<this._filterPipeline.filters.length;_++)f.filterMask&1<<_||(l=this._filterPipeline.filters[_].decode(l));let k=f.fields.map(_=>_.toNumber()),d=k.slice(),g=new Array(d.length).fill(0),v=d.length-1;for(let _=0;_<a;_++){for(let c=r;c>=0&&g[c]>=o[c];c--)g[c]=0,d[c]=k[c],c>0&&(g[c-1]++,d[c-1]++);let y=0,m=!0;for(let c=0;c<v;c++){let w=d[c];if(w>=n[c]){m=!1;break}y+=w*b[c]}if(m){let c=_*e,w=y*e,z=w+e;for(;w<z;)u[w++]=l[c++]}g[r]++,d[r]++}}return u}default:throw new i.Error(`Unsupported data layout class '${this.layoutClass}'.`)}return null}};i.Reader=class{static open(t){if(t instanceof i.BinaryReader||t instanceof i.StreamReader)return t;if(t instanceof Uint8Array)return new i.BinaryReader(t);if(t.length<268435456){let s=t.peek();return new i.BinaryReader(s)}return new i.StreamReader(t)}initialize(){this._offsetSize=this.byte(),this._lengthSize=this.byte()}int8(){let t=this.take(1);return this._view.getInt8(t)}byte(){let t=this.take(1);return this._view.getUint8(t)}int16(){let t=this.take(2);return this._view.getInt16(t,!0)}uint16(){let t=this.take(2);return this._view.getUint16(t,!0)}int32(){let t=this.take(4);return this._view.getInt32(t,!0)}uint32(){let t=this.take(4);return this._view.getUint32(t,!0)}int64(){let t=this.take(8);return this._view.getBigInt64(t,!0)}uint64(){let t=this.take(8);return this._view.getBigUint64(t,!0)}uint(t){switch(t){case 0:return this.byte();case 1:return this.uint16();case 2:return this.uint32();case 3:return this.uint64().toNumber();default:throw new i.Error(`Unsupported uint size '${t}'.`)}}float16(){let t=this.take(2),s=this._view.getUint16(t,!0),e=(s&32768)>>15,o=(s&31744)>>10,n=s&1023;return o===0?(e?-1:1)*Math.pow(2,-14)*(n/Math.pow(2,10)):o===31?n?NaN:(e?-1:1)*(1/0):(e?-1:1)*Math.pow(2,o-15)*(1+n/Math.pow(2,10))}float32(){let t=this.take(4);return this._view.getFloat32(t,!0)}float64(){let t=this.take(8);return this._view.getFloat64(t,!0)}offset(){switch(this._offsetSize){case 8:{let t=this.take(8),s=this._view.getBigUint64(t,!0);if(s===0xffffffffffffffffn)return-1;if(s>=Number.MAX_SAFE_INTEGER)throw new Error(`64-bit value '${s.toString(16)}' exceeds safe integer.`);return s.toNumber()}case 4:{let t=this.uint32();return t===4294967295?void 0:t}default:throw new i.Error(`Unsupported offset size '${this._offsetSize}'.`)}}length(){switch(this._lengthSize){case 8:{let t=this.take(8),s=this._view.getBigUint64(t,!0);if(s===0xffffffffffffffffn)return-1;if(s>=Number.MAX_SAFE_INTEGER)throw new Error(`64-bit value '${s.toString(16)}' exceeds safe integer.`);return s.toNumber()}case 4:{let t=this.uint32();return t===4294967295?void 0:t}default:throw new i.Error(`Unsupported length size '${this._lengthSize}'.`)}}string(t,s){(!t||t===-1)&&(t=this.size(0));let e=null;if(t<16){e=new Uint8Array(t);for(let o=0;o<t;o++)e[o]=this.byte()}else e=this.read(t);return s==="utf-8"?(i.Reader._utf8Decoder=i.Reader._utf8Decoder||new TextDecoder("utf-8"),i.Reader._utf8Decoder.decode(e).replace(/\0/g,"")):(i.Reader._asciiDecoder=i.Reader._asciiDecoder||new TextDecoder("ascii"),i.Reader._asciiDecoder.decode(e).replace(/\0/g,""))}match(t){let s=this.position;for(let e=0;e<t.length;e++)if(t.charCodeAt(e)!==this.byte())return this.seek(s),!1;return!0}expect(t){if(!this.match(t))throw new i.Error(`Invalid '${t}' block signature.`)}};i.BinaryReader=class extends i.Reader{constructor(t,s,e,o,n,a){super(),this._buffer=t,this._length=t.length,this._view=s||new DataView(t.buffer,t.byteOffset,t.byteLength),this._offset=e||0,this._position=o||0,this._offsetSize=n,this._lengthSize=a}get position(){return this._position+this._offset}take(t){let s=this._offset+this._position;return this.skip(t),s}seek(t){if(this._offset=t,this._position=0,this._offset>this._length)throw new Error(`Unexpected end of file. Expected ${this._offset-this._length} more bytes. The file might be corrupted.`)}skip(t){if(this._position+=t,this._offset+this._position>this._buffer.length)throw new i.Error(`Unexpected end of file. Expected ${this._offset+this._position-this._buffer.length} more bytes. The file might be corrupted.`)}align(t){this._position%t!==0&&(this._position=(Math.floor(this._position/t)+1)*t)}peek(t){let s=this._offset+this._position;t=t===void 0?this._buffer.length-s:t,this.take(t);let e=this._buffer.subarray(s,s+t);return this._position=s-this._offset,e}read(t){let s=this.take(t);return this._buffer.subarray(s,s+t)}stream(t){let s=this.take(t),e=this._buffer.subarray(s,s+t);return new i.BinaryReader(e)}size(t){let s=this._offset+this._position;for(;this._buffer[s]!==t;)s++;return s-this._offset-this._position+1}};i.StreamReader=class extends i.Reader{constructor(t,s,e,o,n,a,h){super(),this._stream=t,this._length=t.length,this._view=s,this._window=e||0,this._offset=o||0,this._position=n||0,this._offsetSize=a,this._lengthSize=h}get position(){return this._offset+this._position}seek(t){if(this._offset=t,this._position=0,this._offset>this._length)throw new Error(`Unexpected end of file. Expected ${this._offset-this._length} more bytes. The file might be corrupted.`)}skip(t){if(this._position+=t,this._position+this._offset>this._length)throw new i.Error(`Unexpected end of file. Expected ${this._position+this._offset-this._length} more bytes. The file might be corrupted.`)}align(t){this._position%t!==0&&(this._position=(Math.floor(this._position/t)+1)*t)}read(t){let s=this._stream.position;this._stream.seek(this._offset+this._position);let e=this._stream.read(t);return this._stream.seek(s),this.skip(t),e}stream(t){let s=this._stream.position;this._stream.seek(this._offset+this._position),this.skip(t);let e=this._stream.stream(t);return this._stream.seek(s),e}byte(){let t=this.take(1);return this._view.getUint8(t)}uint16(){let t=this.take(2);return this._view.getUint16(t,!0)}int32(){let t=this.take(4);return this._view.getInt32(t,!0)}uint32(){let t=this.take(4);return this._view.getUint32(t,!0)}int64(){let t=this.take(8);return this._view.getBigInt64(t,!0)}float32(){let t=this.take(4);return this._view.getFloat32(t,!0)}float64(){let t=this.take(8);return this._view.getFloat64(t,!0)}size(t){let s=this._position,e=0;for(;this.byte()!==t;)e++;return this._position=s,e}take(t){let s=this.position;if(s+t>this._length)throw new Error(`Expected ${s+t-this._length} more bytes. The file might be corrupted. Unexpected end of file.`);if(!this._view||s<this._window||s+t>this._window+this._view.byteLength){this._window=s;let e=this._stream.position;this._stream.seek(this._window);let o=this._stream.read(Math.min(256,this._length-this._window)).slice();this._view=new DataView(o.buffer,o.byteOffset,o.byteLength),this._stream.seek(e)}return this._position+=t,s-this._window}};i.SymbolTableNode=class{constructor(t,s){let e=t.position;t.seek(s),t.expect("SNOD");let o=t.byte();if(o===1){t.skip(1);let n=t.uint16();this.entries=[];for(let a=0;a<n;a++){let h=new i.SymbolTableEntry(t);this.entries.push(h)}}else throw new i.Error(`Unsupported symbol table node version '${o}'.`);t.seek(e)}};i.SymbolTableEntry=class{constructor(t){this.linkNameOffset=t.offset(),this.objectHeaderAddress=t.offset();let s=t.uint32();switch(t.skip(4),s){case 0:break;case 1:{let e=t.position;this.treeAddress=t.offset(),this.heapAddress=t.offset(),t.seek(e);break}default:throw new i.Error(`Unsupported cache type '${s}'.`)}t.skip(16)}};i.DataObjectHeader=class{constructor(t,s){let e=t.position;t.seek(s),this.attributes=[],this.links=[],this.continuations=[],t.match("OHDR");let o=t.byte();switch(o){case 1:{t.skip(1);let n=t.uint16();t.uint32();let a=t.uint32();t.align(8);let h=t.position+a;for(let r=0;r<n;r++){let p=t.uint16(),b=t.uint16(),u=t.byte();if(t.skip(3),t.align(8),(!this._readMessage(t,p,b,u)||t.position>=h)&&this.continuations.length>0){let l=this.continuations.shift();t.seek(l.offset),h=l.offset+l.length}else t.align(8)}break}case 2:{let n=t.byte();n&32&&(t.uint32(),t.uint32(),t.uint32(),t.uint32()),n&16&&(t.uint16(),t.uint16());let a=(n&4)!==0,h=t.uint(n&3),r=!0,p=t.position+h;for(;r&&t.position<p;){let b=t.byte(),u=t.uint16(),f=t.byte();if(t.position<p&&(a&&t.uint16(),r=this._readMessage(t,b,u,f)),(!r||t.position>=p)&&this.continuations.length>0){let l=this.continuations.shift();t.seek(l.offset),p=l.offset+l.length,t.expect("OCHK"),r=!0}}break}default:throw new i.Error(`Unsupported data object header version '${o}'.`)}t.seek(e)}_readMessage(t,s,e,o){let n=t.position;switch(s){case 0:return!1;case 1:this.dataspace=e!==4||o!==1?new i.Dataspace(t):null;break;case 2:this.linkInfo=new i.LinkInfo(t);break;case 3:this.datatype=new i.Datatype(t);break;case 4:case 5:this.fillValue=new i.FillValue(t,s);break;case 6:this.links.push(new i.Link(t));break;case 8:this.dataLayout=new i.DataLayout(t);break;case 10:this.groupInfo=new i.GroupInfo(t);break;case 11:this.filterPipeline=new i.FilterPipeline(t);break;case 12:this.attributes.push(new i.Attribute(t));break;case 13:this.comment=t.string(-1,"ascii");break;case 16:this.continuations.push(new i.ObjectHeaderContinuation(t));break;case 17:this.symbolTable=new i.SymbolTable(t);break;case 14:case 18:this.objectModificationTime=new i.ObjectModificationTime(t,s);break;case 21:this.attributeInfo=new i.AttributeInfo(t);break;default:throw new i.Error(`Unsupported message type '${s}'.`)}return t.seek(n),t.skip(e),!0}};i.Message=class{constructor(t,s,e){this._type=t,this._data=s,this._flags=e}};i.Dataspace=class{constructor(t){this._sizes=[];let s=t.byte();switch(s){case 1:this._dimensions=t.byte(),this._flags=t.byte(),t.skip(1),t.skip(4);for(let e=0;e<this._dimensions;e++)this._sizes.push(t.length());if(this._flags&1){this._maxSizes=[];for(let e=0;e<this._dimensions;e++)if(this._maxSizes.push(t.length()),this._maxSizes[e]!==this._sizes[e])throw new i.Error("Max size is not supported.")}if(this._flags&2)throw new i.Error("Permutation indices not supported.");break;case 2:this._dimensions=t.byte(),this._flags=t.byte(),this._type=t.byte();for(let e=0;e<this._dimensions;e++)this._sizes.push(t.length());if(this._flags&1){this._maxSizes=[];for(let e=0;e<this._dimensions;e++)this._maxSizes.push(t.length())}break;default:throw new i.Error(`Unsupported dataspace message version '${s}'.`)}}get shape(){return this._sizes}read(t,s){return this._dimensions===0?t.read(s):this._readArray(t,s,this._sizes,0)}_readArray(t,s,e,o){let n=[],a=e[o];if(o===e.length-1)for(let h=0;h<a;h++)n.push(t.read(s));else for(let h=0;h<a;h++)n.push(this._readArray(t,s,e,o+1));return n}decode(t,s,e){return this._dimensions===0?t.decode(s,e):this._decodeArray(t,s,e,this._sizes,0)}_decodeArray(t,s,e,o,n){let a=o[n];if(n===o.length-1)for(let h=0;h<a;h++)s[h]=t.decode(s[h],e);else for(let h=0;h<a;h++)s[h]=this._decodeArray(t,s[h],o,n+1);return s}};i.LinkInfo=class{constructor(t){let s=t.byte();switch(s){case 0:{let e=t.byte();e&1&&(this.maxCreationIndex=t.uint64()),this.fractalHeapAddress=t.offset(),this.nameIndexTreeAddress=t.offset(),e&2&&(this.creationOrderIndexTreeAddress=t.offset());break}default:throw new i.Error(`Unsupported link info message version '${s}'.`)}}};i.Datatype=class{constructor(t){let s=t.byte(),e=s>>4;switch(this._class=s&15,e){case 1:case 2:{switch(this._flags=t.byte()|t.byte()<<8|t.byte()<<16,this._size=t.uint32(),this._class){case 0:{this._bitOffset=t.uint16(),this._bitPrecision=t.uint16();break}case 8:{this._base=new i.Datatype(t),t.seek(t.position);let o=this._flags&65535;this._names=new Array(o);for(let n=0;n<o;n++)this._names[n]=t.string(-1,"ascii"),t.align(8);this._values=new Array(o);for(let n=0;n<o;n++)this._values[n]=this._base.read(t);break}default:break}break}default:throw new i.Error(`Unsupported datatype version '${e}'.`)}}get type(){switch(this._class){case 0:if(!(this._flags&65526))if((this._flags&&8)===0)switch(this._size){case 1:return"uint8";case 2:return"uint16";case 4:return"uint32";case 8:return"uint64";default:throw new i.Error(`Unsupported uint size '${this._size}'.`)}else switch(this._size){case 1:return"int8";case 2:return"int16";case 4:return"int32";case 8:return"int64";default:throw new i.Error(`Unsupported int size '${this._size}'.`)}break;case 1:if(this._size===2&&this._flags===3872)return"float16";if(this._size===4&&this._flags===7968)return"float32";if(this._size===8&&this._flags===16160)return"float64";break;case 3:return"string";case 5:return"uint8";case 6:return"compound";case 8:if(this._base.type==="int8"&&this._names.length===2&&this._names[0]==="FALSE"&&this._names[1]==="TRUE"&&this._values.length===2&&this._values[0]===0&&this._values[1]===1)return"boolean";break;case 9:if((this._flags&15)===1)return"char[]";break;default:break}throw new i.Error(`Unsupported datatype class '${this._class}'.`)}get littleEndian(){switch(this._class){case 0:case 1:return(this.flags&1)===0;default:return!0}}read(t){switch(this._class){case 0:if(this._size===1)return this._flags&8?t.int8():t.byte();if(this._size===2)return this._flags&8?t.int16():t.uint16();if(this._size===4)return this._flags&8?t.int32():t.uint32();if(this._size===8)return this._flags&8?t.int64():t.uint64();throw new i.Error("Unsupported fixed-point datatype.");case 1:if(this._size===2&&this._flags===3872)return t.float16();if(this._size===4&&this._flags===7968)return t.float32();if(this._size===8&&this._flags===16160)return t.float64();throw new i.Error("Unsupported floating-point datatype.");case 3:switch(this._flags>>8&15){case 0:return t.string(this._size,"ascii");case 1:return t.string(this._size,"utf-8");default:throw new i.Error("Unsupported character encoding.")}case 5:return t.read(this._size);case 8:return t.read(this._size);case 9:return{length:t.uint32(),globalHeapID:new i.GlobalHeapID(t)};default:throw new i.Error(`Unsupported datatype class '${this._class}'.`)}}decode(t,s){switch(this._class){case 0:return t;case 1:return t;case 3:return t;case 5:return t;case 8:return t;case 9:{let e=s.get(t.globalHeapID);if(e!==null){let o=this._flags>>8&15,n=e.reader();switch(o){case 0:return n.string(n.length(),"ascii");case 1:return n.string(n.length(),"utf-8");default:throw new i.Error("Unsupported character encoding.")}}break}default:throw new i.Error(`Unsupported datatype class '${this._class}'.`)}return null}};i.FillValue=class{constructor(t,s){switch(s){case 4:{let e=t.uint32();this.data=t.read(e);break}case 5:default:{let e=t.byte();switch(e){case 1:case 2:{t.byte(),t.byte();let o=t.byte();if(e===1||o===1){let n=t.uint32();this.data=t.read(n)}break}case 3:{if(t.byte()&32){let n=t.uint32();this.data=t.read(n)}break}default:throw new i.Error(`Unsupported fill value version '${e}'.`)}break}}}};i.Link=class{constructor(t){let s=t.byte();switch(s){case 1:{let e=t.byte();this.type=e&8?t.byte():0,e&4&&(this.creationOrder=t.uint32());let o=e&16&&t.byte()===1?"utf-8":"ascii",n=t.uint(e&3);switch(this.name=t.string(n,o),this.type){case 0:this.objectHeaderAddress=t.offset();break;case 1:break;default:throw new i.Error(`Unsupported link message type '${this.type}'.`)}break}default:throw new i.Error(`Unsupported link message version '${s}'.`)}}};i.DataLayout=class{constructor(t){let s=t.byte();switch(s){case 1:case 2:{switch(this.dimensionality=t.byte(),this.layoutClass=t.byte(),t.skip(5),this.layoutClass){case 1:this.address=t.offset(),this.dimensionSizes=[];for(let e=0;e<this.dimensionality-1;e++)this.dimensionSizes.push(t.int32());break;case 2:this.address=t.offset(),this.dimensionSizes=[];for(let e=0;e<this.dimensionality-1;e++)this.dimensionSizes.push(t.int32());this.datasetElementSize=t.int32();break;default:throw new i.Error(`Unsupported data layout class '${this.layoutClass}'.`)}break}case 3:{switch(this.layoutClass=t.byte(),this.layoutClass){case 0:this.size=t.uint16(),t.skip(2),this.address=t.position;break;case 1:this.address=t.offset(),this.size=t.length();break;case 2:this.dimensionality=t.byte(),this.address=t.offset(),this.dimensionSizes=[];for(let e=0;e<this.dimensionality-1;e++)this.dimensionSizes.push(t.int32());this.datasetElementSize=t.int32();break;default:throw new i.Error(`Unsupported data layout class '${this.layoutClass}'.`)}break}default:throw new i.Error(`Unsupported data layout version '${s}'.`)}}};i.GroupInfo=class{constructor(t){let s=t.byte();switch(s){case 0:{let e=t.byte();e&1&&(this.maxCompactLinks=t.uint16(),this.minDenseLinks=t.uint16()),e&2&&(this.estimatedEntriesNumber=t.uint16(),this.estimatedLinkNameLengthEntries=t.uint16());break}default:throw new i.Error(`Unsupported group info version '${s}'.`)}}};i.FilterPipeline=class{constructor(t){let s=t.byte();switch(s){case 1:{this.filters=[];let e=t.byte();t.skip(2),t.skip(4);for(let o=0;o<e;o++)this.filters.push(new i.Filter(t)),t.align(8);break}default:throw new i.Error(`Unsupported filter pipeline message version '${s}'.`)}}};i.Filter=class{constructor(t){this.id=t.int16();let s=t.int16();this.flags=t.int16();let e=t.int16();this.name=t.string(s,"ascii"),this.clientData=t.read(e*4)}decode(t){switch(this.id){case 1:return this._deflate(t);case 32e3:return this._lzf(t);default:throw new i.Error(`Unsupported filter '${this.id}:${this.name}'.`)}}_deflate(t){return x.open(t).entries.get("").peek()}_lzf(t){let s=0,e=0;for(;s<t.length;){let n=t[s++];if(n<32){if(n++,s+=n,e+=n,s>t.length)throw new Error("Invalid LZF compressed data.")}else{let a=n>>5;if(s>=t.length)throw new Error("Invalid LZF compressed data.");if(a===7&&(a+=t[s++],s>=t.length))throw new Error("Invalid LZF compressed data.");if(e-((n&31)<<8)-1-t[s++]<0)throw new Error("Invalid LZF compressed data.");e+=a+2}}let o=new Uint8Array(e);for(s=0,e=0;s<t.length;){let n=t[s++];if(n<32)n++,o.set(t.subarray(s,s+n),e),s+=n,e+=n;else{let a=n>>5;a===7&&(a+=t[s++]),a+=2;let h=e-((n&31)<<8)-1-t[s++];do o[e++]=o[h++];while(--a)}}return o}};i.Attribute=class{constructor(t){let s=t.byte();switch(s){case 1:{t.skip(1);let e=t.uint16(),o=t.uint16(),n=t.uint16();this.name=t.string(e,"utf-8"),t.align(8);let a=t.position;this._datatype=new i.Datatype(t),t.seek(a),t.skip(o),t.align(8);let h=t.position;this._dataspace=new i.Dataspace(t),t.seek(h),t.skip(n),t.align(8),this._data=this._dataspace.read(this._datatype,t);break}case 3:{t.byte();let e=t.uint16(),o=t.uint16(),n=t.uint16(),a=t.byte()===1?"utf-8":"ascii";this.name=t.string(e,a);let h=t.position;this._datatype=new i.Datatype(t),t.seek(h),t.skip(o);let r=t.position;this._dataspace=new i.Dataspace(t),t.seek(r),t.skip(n),this._data=this._dataspace.read(this._datatype,t);break}default:throw new i.Error(`Unsupported attribute message version '${s}'.`)}}decodeValue(t){return this._data?this._dataspace.decode(this._datatype,this._data,t):null}};i.ObjectHeaderContinuation=class{constructor(t){this.offset=t.offset(),this.length=t.length()}};i.SymbolTable=class{constructor(t){this.treeAddress=t.offset(),this.heapAddress=t.offset()}};i.ObjectModificationTime=class{constructor(t,s){switch(s){case 14:{this.year=t.uint32(),this.month=t.uint16(),this.day=t.uint16(),this.hour=t.uint16(),this.minute=t.uint16(),this.second=t.uint16(),t.skip(2);break}case 18:{let e=t.byte();switch(t.skip(3),e){case 1:this.timestamp=t.uint32();break;default:throw new i.Error(`Unsupported object modification time message version '${e}'.`)}break}default:throw new i.Error(`Unsupported object modification time message type '${s}'.`)}}};i.AttributeInfo=class{constructor(t){let s=t.byte();switch(s){case 0:{let e=t.byte();e&1&&(this.maxCreationIndex=t.uint64()),this.fractalHeapAddress=t.offset(),this.attributeNameTreeAddress=t.offset(),e&2&&(this.attributeCreationOrderTreeAddress=t.offset());break}default:throw new i.Error(`Unsupported attribute info message version '${s}'.`)}}};i.Tree=class{constructor(t,s,e){let o=t.position;t.seek(s),t.expect("TREE"),this.type=t.byte(),this.level=t.byte();let n=t.uint16();switch(t.offset(),t.offset(),this.nodes=[],this.type){case 0:{for(let a=0;a<n;a++){t.length();let h=t.offset();if(this.level===0){let r=new i.SymbolTableNode(t,h);this.nodes.push(r)}else{let r=new i.Tree(t,h);this.nodes.push(...r.nodes)}}break}case 1:{for(let a=0;a<n;a++){let h=t.int32(),r=t.int32(),p=[];for(let u=0;u<e;u++)p.push(t.uint64());let b=t.offset();if(this.level===0){let u=t.position;t.seek(b);let f=t.read(h);this.nodes.push({data:f,fields:p,filterMask:r}),t.seek(u)}else{let u=new i.Tree(t,b,e);this.nodes.push(...u.nodes)}}break}default:throw new i.Error(`Unsupported B-Tree node type '${this.type}'.`)}t.seek(o)}};i.Heap=class{constructor(t,s){let e=t.position;t.seek(s),this._reader=t,t.expect("HEAP");let o=t.byte();switch(o){case 0:{t.skip(3),this._dataSize=t.length(),this._offsetToHeadOfFreeList=t.length(),this._dataAddress=t.offset();break}default:throw new i.Error(`Unsupported Local Heap version '${o}'.`)}t.seek(e)}getString(t){let s=this._reader.position;this._reader.seek(this._dataAddress+t);let e=this._reader.string(-1,"utf-8");return this._reader.seek(s),e}};i.GlobalHeap=class{constructor(t){this._reader=t,this._collections=new Map}get(t){let s=t.address;return this._collections.has(s)||this._collections.set(s,new i.GlobalHeapCollection(this._reader,s)),this._collections.get(t.address).getObject(t.objectIndex)}};i.GlobalHeapCollection=class{constructor(t,s){let e=t.position;t.seek(s);let o=t.position;t.expect("GCOL");let n=t.byte();switch(n){case 1:{t.skip(3),this._objects=new Map;let a=t.length(),h=o+a;for(;t.position<h;){let r=t.uint16();if(r===0)break;this._objects.set(r,new i.GlobalHeapObject(t)),t.align(8)}break}default:throw new i.Error(`Unsupported global heap collection version '${n}'.`)}t.seek(e)}getObject(t){return this._objects.has(t)?this._objects.get(t):null}};i.GlobalHeapObject=class{constructor(t){t.uint16(),t.skip(4),this._position=t.position,this._reader=t;let s=t.length();t.skip(s)}reader(){return this._reader.seek(this._position),this._reader}};i.GlobalHeapID=class{constructor(t){this.address=t.offset(),this.objectIndex=t.uint32()}};i.Error=class extends Error{constructor(t){super(t),this.name="HDF5 Error"}};var U=i.File;export{U as File};
