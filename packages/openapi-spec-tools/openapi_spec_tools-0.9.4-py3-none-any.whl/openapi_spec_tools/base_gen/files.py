"""File utilities for use in CLI stuff."""
from datetime import datetime

DEFAULT_COPYRIGHT = f"""\
# Copyright {datetime.now().year}
#
# This code was generated by the openapi-spec-tools CLI generator, DO NOT EDIT
#
"""

_copyright = DEFAULT_COPYRIGHT


def set_copyright(copyright: str = DEFAULT_COPYRIGHT) -> None:
    """Set the global copyright value."""
    global _copyright  # noqa: PLW0603
    _copyright = copyright


def copyright() -> str:
    """Get the global copyright value."""
    return _copyright


def copy_and_update(src_filename: str, dst_filename: str, replacements: dict[str, str]):
    """Copy text from src to dst with replacements of current package name to the supplied value."""
    with (
        open(src_filename, "r", encoding="utf-8", newline="\n") as src_fp,
        open(dst_filename, "w", encoding="utf-8", newline="\n") as dst_fp,
    ):
        # NOTE: ignore the shebangs for now... not used to copy over executable files
        dst_fp.write(copyright())
        for line in src_fp.readlines():
            updated = line
            for old, new in replacements.items():
                updated = updated.replace(old, new)
            dst_fp.write(updated)


