Metadata-Version: 2.1
Name: xp3_tool
Version: 5.1
Summary: xp_t3_tool
Home-page: 
Author: XuPeng
Author-email: xupeng23456@126.com
License: MIT
Classifier: License :: OSI Approved :: MIT License
Classifier: Programming Language :: Python
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.6
Classifier: Programming Language :: Python :: Implementation :: CPython
Classifier: Programming Language :: Python :: Implementation :: PyPy
Requires-Python: >=3.10.0
Description-Content-Type: text/markdown
Requires-Dist: openai
Requires-Dist: pandas
Requires-Dist: oss2
Requires-Dist: python-dotenv


# Excel ä¸ OSS å¤„ç†å·¥å…·åº“

è¿™æ˜¯ä¸€ä¸ªé›†æˆäº† OpenAI API è°ƒç”¨ã€é˜¿é‡Œäº‘ OSS æ–‡ä»¶ç®¡ç†å’Œ Excel æ•°æ®å¤„ç†åŠŸèƒ½çš„ Python å·¥å…·åº“ã€‚

## åŠŸèƒ½ç‰¹æ€§

### ğŸ¤– AI å¯¹è¯åŠŸèƒ½ (CallAi ç±»)
- æ”¯æŒ OpenAI å…¼å®¹çš„ API è°ƒç”¨
- å¯è‡ªå®šä¹‰ç³»ç»Ÿæç¤ºè¯å’Œæ¨¡å‹å‚æ•°
- çµæ´»çš„å¯¹è¯é…ç½®ï¼ˆtemperatureã€top_pï¼‰

### â˜ï¸ OSS æ–‡ä»¶ç®¡ç† (ExcelOSSHandler ç±»)
- Excel æ–‡ä»¶ä¸Šä¼ åˆ°é˜¿é‡Œäº‘ OSS
- ä» OSS ä¸‹è½½ Excel æ–‡ä»¶å¹¶è½¬æ¢ä¸º pandas DataFrame
- æ”¯æŒç¯å¢ƒå˜é‡è‡ªåŠ¨é…ç½®
- å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œæ–‡ä»¶éªŒè¯

### ğŸ“§ æ•°æ®å¯¼å‡ºä¸é‚®ä»¶å‘é€ (ExportToEmail å‡½æ•°)
- å°† DataFrame å¯¼å‡ºä¸º Excel æ–‡ä»¶
- è‡ªåŠ¨é€šè¿‡é‚®ä»¶å‘é€ Excel é™„ä»¶
- æ”¯æŒ HTML æ ¼å¼çš„é‚®ä»¶å†…å®¹
- è‡ªåŠ¨æ¸…ç†ä¸´æ—¶æ–‡ä»¶

## å®‰è£…ä¾èµ–

```bash
pip install openai pandas oss2 python-dotenv openpyxl
```

## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒé…ç½®

åˆ›å»º `.env` æ–‡ä»¶é…ç½®æ•æ„Ÿä¿¡æ¯ï¼š

```env
# OpenAI é…ç½®
OPENAI_API_KEY=your-openai-api-key
OPENAI_BASE_URL=https://api.openai.com/v1

# é˜¿é‡Œäº‘ OSS é…ç½®
access_key_id=your-access-key-id
access_key_secret=your-access-key-secret
endpoint=oss-cn-hangzhou.aliyuncs.com
bucket_name=your-bucket-name

# é‚®ä»¶é…ç½®
email_sender=your-email@163.com
email_password=your-email-authorization-code
```

### 2. AI å¯¹è¯åŠŸèƒ½

```python
from your_module import CallAi

# åˆå§‹åŒ– AI å®¢æˆ·ç«¯
ai = CallAi(
    api_key="your-api-key",
    base_url="https://api.openai.com/v1",
    model="qwen-plus"  # é»˜è®¤æ¨¡å‹
)

# è®¾ç½®ç³»ç»Ÿæç¤ºè¯
ai.prompt = "ä½ æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„åŠ©æ‰‹"

# è¿›è¡Œå¯¹è¯
response = ai.chat("ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹è‡ªå·±")
print(response)
```

### 3. OSS æ–‡ä»¶ç®¡ç†ï¼ˆæ”¯æŒç¯å¢ƒå˜é‡è‡ªåŠ¨åŠ è½½ï¼‰

```python
from your_module import ExcelOSSHandler

# æ–¹å¼1ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡è‡ªåŠ¨é…ç½®
oss_handler = ExcelOSSHandler()  # è‡ªåŠ¨ä» .env æ–‡ä»¶è¯»å–é…ç½®

# æ–¹å¼2ï¼šæ‰‹åŠ¨ä¼ å…¥é…ç½®
oss_handler = ExcelOSSHandler(
    access_key_id="your-access-key-id",
    access_key_secret="your-access-key-secret",
    endpoint="https://oss-cn-hangzhou.aliyuncs.com",
    bucket_name="your-bucket-name"
)

# ä¸Šä¼  Excel æ–‡ä»¶åˆ° OSS
success = oss_handler.upload_excel_to_oss(
    local_file_path="local_file.xlsx",
    oss_file_path="oss/path/file.xlsx"
)

# ä» OSS ä¸‹è½½ Excel å¹¶è½¬æ¢ä¸º DataFrame
df = oss_handler.get_excel_from_oss("oss/path/file.xlsx")
```

### 4. æ•°æ®å¯¼å‡ºä¸é‚®ä»¶å‘é€

```python
from your_module import ExportToEmail
import pandas as pd

# åˆ›å»ºç¤ºä¾‹æ•°æ®
df = pd.DataFrame({
    'Name': ['Alice', 'Bob', 'Charlie'],
    'Age': [25, 30, 35],
    'City': ['Beijing', 'Shanghai', 'Guangzhou']
})

# æ–¹å¼1ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡è‡ªåŠ¨é…ç½®é‚®ä»¶
result = ExportToEmail(
    df=df,
    receiver="recipient@example.com",
    subject="æ•°æ®å¯¼å‡ºæŠ¥å‘Š"
)

# æ–¹å¼2ï¼šæ‰‹åŠ¨é…ç½®é‚®ä»¶
result = ExportToEmail(
    df=df,
    receiver="recipient@example.com",
    subject="æ•°æ®å¯¼å‡ºæŠ¥å‘Š",
    sender="your-email@163.com",
    password="your-email-password"
)

print(result)
```

## API å‚è€ƒ

### CallAi ç±»

#### åˆå§‹åŒ–å‚æ•°
- `api_key`: OpenAI API å¯†é’¥
- `base_url`: API åŸºç¡€åœ°å€
- `model`: æ¨¡å‹åç§°ï¼ˆé»˜è®¤ï¼š'qwen-plus'ï¼‰

#### å±æ€§
- `prompt`: ç³»ç»Ÿæç¤ºè¯ï¼ˆå¯è¯»å†™å±æ€§ï¼‰

#### æ–¹æ³•
- `chat(text, top_p=0.9, temperature=0.7)`: å‘é€å¯¹è¯è¯·æ±‚

### ExcelOSSHandler ç±»

#### åˆå§‹åŒ–å‚æ•°
æ‰€æœ‰å‚æ•°éƒ½æ˜¯å¯é€‰çš„ï¼Œå¦‚æœä¸æä¾›ä¼šè‡ªåŠ¨ä»ç¯å¢ƒå˜é‡è¯»å–ï¼š
- `access_key_id`: é˜¿é‡Œäº‘è®¿é—®å¯†é’¥ ID
- `access_key_secret`: é˜¿é‡Œäº‘è®¿é—®å¯†é’¥ Secret
- `endpoint`: OSS æœåŠ¡ç«¯ç‚¹
- `bucket_name`: å­˜å‚¨æ¡¶åç§°

#### æ–¹æ³•
- `upload_excel_to_oss(local_file_path, oss_file_path)`: ä¸Šä¼  Excel æ–‡ä»¶åˆ° OSS
- `get_excel_from_oss(oss_file_path)`: ä» OSS ä¸‹è½½ Excel æ–‡ä»¶å¹¶è½¬æ¢ä¸º DataFrame

### ExportToEmail å‡½æ•°

#### å‚æ•°
- `df`: è¦å¯¼å‡ºçš„ pandas DataFrameï¼ˆå¿…éœ€ï¼‰
- `receiver`: æ”¶ä»¶äººé‚®ç®±åœ°å€ï¼ˆé»˜è®¤ï¼š'xupeng23456@126.com'ï¼‰
- `subject`: é‚®ä»¶ä¸»é¢˜ï¼ˆå¯é€‰ï¼Œè‡ªåŠ¨ç”Ÿæˆæ—¶é—´æˆ³ï¼‰
- `sender`: å‘ä»¶äººé‚®ç®±ï¼ˆå¯é€‰ï¼Œä»ç¯å¢ƒå˜é‡è¯»å–ï¼‰
- `password`: å‘ä»¶äººé‚®ç®±å¯†ç /æˆæƒç ï¼ˆå¯é€‰ï¼Œä»ç¯å¢ƒå˜é‡è¯»å–ï¼‰

#### è¿”å›å€¼
è¿”å›åŒ…å«æ“ä½œç»“æœçš„å­—å…¸ï¼š
```python
{
    "status": "success" | "failed",
    "message": "æè¿°ä¿¡æ¯",
    "file_path": "ä¸´æ—¶æ–‡ä»¶è·¯å¾„",
    "email_sent": True | False,
    "row_count": æ•°æ®è¡Œæ•°,
    "timestamp": "æ—¶é—´æˆ³"
}
```

### å·¥å…·å‡½æ•°
- `uuid(length=16)`: ç”Ÿæˆéšæœºå­—ç¬¦ä¸² ID

## ä½¿ç”¨ç¤ºä¾‹

### å®Œæ•´å·¥ä½œæµç¨‹ç¤ºä¾‹

```python
from your_module import CallAi, ExcelOSSHandler, ExportToEmail
import pandas as pd

# 1. ä½¿ç”¨ AI ç”Ÿæˆæ•°æ®å»ºè®®
ai = CallAi(api_key="your-key", base_url="your-url")
ai.prompt = "ä½ æ˜¯ä¸€ä¸ªæ•°æ®åˆ†æä¸“å®¶"
analysis = ai.chat("åˆ†æé”€å”®æ•°æ®æ—¶åº”è¯¥å…³æ³¨å“ªäº›æŒ‡æ ‡ï¼Ÿ")

# 2. ä» OSS è·å–æ•°æ®
oss_handler = ExcelOSSHandler()  # è‡ªåŠ¨ä½¿ç”¨ç¯å¢ƒå˜é‡
df = oss_handler.get_excel_from_oss("sales/data.xlsx")

# 3. å¤„ç†æ•°æ®
processed_df = df.groupby('category').sum()

# 4. å¯¼å‡ºå¹¶å‘é€é‚®ä»¶
result = ExportToEmail(
    df=processed_df,
    receiver="team@company.com",
    subject="é”€å”®æ•°æ®æ±‡æ€»æŠ¥å‘Š"
)

print(f"æ“ä½œç»“æœ: {result['status']}")
print(f"å‘é€çŠ¶æ€: {'æˆåŠŸ' if result['email_sent'] else 'å¤±è´¥'}")
```

## é”™è¯¯å¤„ç†

æ‰€æœ‰å‡½æ•°éƒ½åŒ…å«å®Œæ•´çš„å¼‚å¸¸å¤„ç†ï¼Œä¼šè¿”å›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ï¼š

```python
# æ£€æŸ¥æ“ä½œç»“æœ
result = oss_handler.upload_excel_to_oss("nonexistent.xlsx", "oss/path/file.xlsx")
if not result:
    print("æ–‡ä»¶ä¸Šä¼ å¤±è´¥")

# æ£€æŸ¥é‚®ä»¶å‘é€ç»“æœ
email_result = ExportToEmail(df, "receiver@example.com")
if email_result["status"] == "failed":
    print(f"å‘é€å¤±è´¥: {email_result['message']}")
```

## æ³¨æ„äº‹é¡¹

1. **æ–‡ä»¶æ ¼å¼**: ä»…æ”¯æŒ `.xlsx` å’Œ `.xls` æ ¼å¼çš„ Excel æ–‡ä»¶
2. **é‚®ä»¶æœåŠ¡**: é»˜è®¤ä½¿ç”¨ 163 é‚®ç®±çš„ SMTP æœåŠ¡ï¼ˆç«¯å£ 465ï¼ŒSSLï¼‰
3. **ä¸´æ—¶æ–‡ä»¶**: è‡ªåŠ¨åˆ›å»º `./temp` ç›®å½•å­˜æ”¾ä¸´æ—¶æ–‡ä»¶ï¼Œé‚®ä»¶å‘é€æˆåŠŸåè‡ªåŠ¨æ¸…ç†
4. **ç¯å¢ƒå˜é‡**: å»ºè®®ä½¿ç”¨ `.env` æ–‡ä»¶ç®¡ç†æ•æ„Ÿä¿¡æ¯ï¼Œä¸è¦å°†å¯†é’¥ç¡¬ç¼–ç åœ¨ä»£ç ä¸­

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**OSS è¿æ¥é—®é¢˜**:
- æ£€æŸ¥ Access Key å’Œ Secret æ˜¯å¦æ­£ç¡®
- ç¡®è®¤ endpoint æ ¼å¼æ­£ç¡®ï¼ˆåŒ…å« http/httpsï¼‰
- éªŒè¯ bucket åç§°å’Œæƒé™

**é‚®ä»¶å‘é€å¤±è´¥**:
- ç¡®è®¤é‚®ç®±å¯†ç æ˜¯æˆæƒç è€Œéç™»å½•å¯†ç 
- æ£€æŸ¥å‘ä»¶äººé‚®ç®±æ˜¯å¦å¼€å¯ SMTP æœåŠ¡
- éªŒè¯ç½‘ç»œè¿æ¥å’Œé˜²ç«å¢™è®¾ç½®

**Excel æ–‡ä»¶å¤„ç†é”™è¯¯**:
- ç¡®è®¤æ–‡ä»¶æ²¡æœ‰è¢«å…¶ä»–ç¨‹åºå ç”¨
- æ£€æŸ¥ pandas å’Œ openpyxl ç‰ˆæœ¬å…¼å®¹æ€§
- éªŒè¯æ–‡ä»¶å†…å®¹æ ¼å¼æ­£ç¡®

## æ›´æ–°æ—¥å¿—

### v1.1.0
- æ–°å¢ç¯å¢ƒå˜é‡è‡ªåŠ¨åŠ è½½åŠŸèƒ½
- æ”¹è¿›é”™è¯¯å¤„ç†å’Œæ—¥å¿—è¾“å‡º
- ä¼˜åŒ–é‚®ä»¶å‘é€é€»è¾‘

## è®¸å¯è¯

MIT License
