# Timesheet MCP Server - å¿«é€Ÿå…¥é—¨æŒ‡å—

## ğŸ“‹ ç›®å½•

1. [ç®€ä»‹](#ç®€ä»‹)
2. [å®‰è£…](#å®‰è£…)
3. [é…ç½®](#é…ç½®)
4. [ä½¿ç”¨](#ä½¿ç”¨)
5. [å¯ç”¨å·¥å…·](#å¯ç”¨å·¥å…·)
6. [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)

---

## ç®€ä»‹

**Timesheet MCP Server** æ˜¯ä¸€ä¸ªåŸºäº FastMCP 2.0 çš„ Model Context Protocol æœåŠ¡å™¨ï¼Œç”¨äºä¸å·¥æ—¶ç®¡ç†ç³»ç»Ÿé›†æˆã€‚å®ƒæä¾›äº†ä¸€å¥—å®Œæ•´çš„ APIï¼Œè®©æ‚¨èƒ½å¤Ÿï¼š

- ğŸ“Š æŸ¥è¯¢ä¸ªäººå·¥æ—¶è®°å½•å’Œç»Ÿè®¡
- ğŸ‘¥ ç®¡ç†é¡¹ç›®å’Œé¡¹ç›®æˆå‘˜
- ğŸ“ˆ ç”Ÿæˆå·¥æ—¶æŠ¥è¡¨
- ğŸ” æŸ¥è¯¢ç”¨æˆ·å’Œé¡¹ç›®ä¿¡æ¯

---

## å®‰è£…

### æ–¹å¼ 1ï¼šä½¿ç”¨ pipï¼ˆæ¨èï¼‰

```bash
# ä» PyPI å®‰è£…æœ€æ–°ç‰ˆæœ¬
pip install timesheet-mcp-server

# æŒ‡å®šç‰ˆæœ¬å®‰è£…
pip install timesheet-mcp-server==1.0.0
```

### æ–¹å¼ 2ï¼šä»æºä»£ç å®‰è£…

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/yangyuezheng/ai-emp.git
cd ai-emp/timesheet-mcp-server-v2

# å®‰è£…ä¾èµ–
pip install -e .
```

### æ–¹å¼ 3ï¼šä½¿ç”¨ uvxï¼ˆæ— éœ€å®‰è£…ï¼‰

```bash
# ç›´æ¥è¿è¡Œï¼Œuvx ä¼šè‡ªåŠ¨å¤„ç†ä¾èµ–
uvx timesheet-mcp-server
```

---

## é…ç½®

### ç¯å¢ƒå˜é‡

MCP æœåŠ¡å™¨éœ€è¦ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

| å˜é‡å | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|
| `TIMESHEET_API_BASE_URL` | å·¥æ—¶ç®¡ç†ç³»ç»Ÿ API åœ°å€ | `https://tms.ktvsky.com/api` |
| `TIMESHEET_API_TOKEN` | JWT è®¤è¯ä»¤ç‰Œ | `eyJhbGc...` |

### é…ç½® Claude Desktop

ç¼–è¾‘ `~/.claude/claude_desktop_config.json`ï¼š

```json
{
  "mcpServers": {
    "timesheet": {
      "command": "uvx",
      "args": ["timesheet-mcp-server"],
      "env": {
        "TIMESHEET_API_BASE_URL": "https://tms.ktvsky.com/api",
        "TIMESHEET_API_TOKEN": "your_jwt_token_here"
      }
    }
  }
}
```

### é…ç½® Cursor IDE

ç¼–è¾‘ `.cursor/mcp.json`ï¼š

```json
{
  "mcpServers": {
    "timesheet-mcp": {
      "command": "uvx",
      "args": ["timesheet-mcp-server"],
      "env": {
        "TIMESHEET_API_BASE_URL": "https://tms.ktvsky.com/api",
        "TIMESHEET_API_TOKEN": "your_jwt_token_here"
      }
    }
  }
}
```

### ç”Ÿæˆ JWT Token

å‚è€ƒ [TOKEN_MANAGEMENT.md](TOKEN_MANAGEMENT.md) äº†è§£å¦‚ä½•ç”Ÿæˆé•¿æœŸæœ‰æ•ˆçš„ JWT Tokenã€‚

---

## ä½¿ç”¨

### åœ¨ Claude Desktop ä¸­ä½¿ç”¨

1. å¯åŠ¨ Claude Desktop
2. ç¡®ä¿ MCP æœåŠ¡å™¨å·²é…ç½®å¹¶å¯åŠ¨
3. åœ¨å¯¹è¯ä¸­ä½¿ç”¨ä»¥ä¸‹å·¥å…·ï¼š

```
@timesheet è·å–æˆ‘çš„å·¥æ—¶è®°å½•
```

### åœ¨ Cursor IDE ä¸­ä½¿ç”¨

1. æ‰“å¼€ Cursor IDE
2. ç¡®ä¿ `.cursor/mcp.json` å·²æ­£ç¡®é…ç½®
3. ä½¿ç”¨ MCP å·¥å…·æŸ¥è¯¢å·¥æ—¶ä¿¡æ¯

---

## å¯ç”¨å·¥å…·

### 1. è·å–ä¸ªäººå·¥æ—¶ç»Ÿè®¡ `get_my_time_stats`

**åŠŸèƒ½**ï¼šè·å–æŒ‡å®šæœˆä»½çš„å·¥æ—¶å¡«æŠ¥æƒ…å†µ

**å‚æ•°**ï¼š
- `year` (int, å¿…éœ€): å¹´ä»½ï¼Œå¦‚ 2025
- `month` (int, å¿…éœ€): æœˆä»½ï¼Œ1-12

**è¿”å›å€¼**ï¼š
```json
{
  "year": 2025,
  "month": 10,
  "total_workdays": 22,
  "filled_days": 20,
  "missing_days": 2,
  "total_hours": 160,
  "average_hours_per_day": 8.0,
  "project_distribution": {
    "é¡¹ç›®A": 80,
    "é¡¹ç›®B": 80
  },
  "missing_dates": ["2025-10-01", "2025-10-02"]
}
```

**ç¤ºä¾‹**ï¼š
```
è·å–æˆ‘ 2025 å¹´ 10 æœˆçš„å·¥æ—¶ç»Ÿè®¡
```

---

### 2. è·å–ä¸ªäººå·¥æ—¶è®°å½• `get_my_time_entries`

**åŠŸèƒ½**ï¼šæŸ¥è¯¢ä¸ªäººçš„å·¥æ—¶è®°å½•

**å‚æ•°**ï¼š
- `page` (int, é»˜è®¤: 1): é¡µç 
- `limit` (int, é»˜è®¤: 10): æ¯é¡µæ•°é‡
- `project_id` (int, å¯é€‰): ç‰¹å®šé¡¹ç›®çš„å·¥æ—¶
- `start_date` (str, å¯é€‰): å¼€å§‹æ—¥æœŸï¼Œæ ¼å¼ YYYY-MM-DD
- `end_date` (str, å¯é€‰): ç»“æŸæ—¥æœŸï¼Œæ ¼å¼ YYYY-MM-DD
- `status` (str, å¯é€‰): å®¡æ‰¹çŠ¶æ€ (submitted/approved/rejected)

**è¿”å›å€¼**ï¼š
```json
{
  "total": 100,
  "page": 1,
  "limit": 10,
  "data": [
    {
      "date": "2025-10-01",
      "hours": 8,
      "description": "å¼€å‘åŠŸèƒ½ X",
      "project_name": "é¡¹ç›®A",
      "status": "approved"
    }
  ]
}
```

**ç¤ºä¾‹**ï¼š
```
æŸ¥è¯¢æˆ‘ 10 æœˆä»½çš„å·¥æ—¶è®°å½•
æŸ¥è¯¢é¡¹ç›® A çš„å·¥æ—¶è®°å½•
```

---

### 3. è·å–æˆ‘å‚ä¸çš„é¡¹ç›® `get_my_projects`

**åŠŸèƒ½**ï¼šåˆ—å‡ºå½“å‰ç”¨æˆ·å‚ä¸çš„æ‰€æœ‰é¡¹ç›®

**å‚æ•°**ï¼š
- `page` (int, é»˜è®¤: 1): é¡µç 
- `limit` (int, é»˜è®¤: 20): æ¯é¡µæ•°é‡

**è¿”å›å€¼**ï¼š
```json
{
  "total": 5,
  "page": 1,
  "limit": 20,
  "data": [
    {
      "id": 123,
      "name": "é¡¹ç›®A",
      "type": "rd",
      "level": "level1",
      "business_line": "ç ”å‘éƒ¨",
      "created_at": "2025-01-01T00:00:00Z"
    }
  ]
}
```

**ç¤ºä¾‹**ï¼š
```
åˆ—å‡ºæˆ‘å‚ä¸çš„æ‰€æœ‰é¡¹ç›®
```

---

### 4. è·å–é¡¹ç›®è¯¦æƒ… `get_project_detail`

**åŠŸèƒ½**ï¼šè·å–é¡¹ç›®çš„è¯¦ç»†ä¿¡æ¯

**å‚æ•°**ï¼š
- `project_id` (int, å¿…éœ€): é¡¹ç›® ID

**è¿”å›å€¼**ï¼š
```json
{
  "id": 123,
  "name": "é¡¹ç›®A",
  "type": "rd",
  "level": "level1",
  "business_line": "ç ”å‘éƒ¨",
  "members": [
    {
      "id": 1,
      "name": "å¼ ä¸‰",
      "role": "member"
    }
  ],
  "managers": [
    {
      "id": 2,
      "name": "æå››",
      "role": "manager"
    }
  ]
}
```

**ç¤ºä¾‹**ï¼š
```
æŸ¥è¯¢é¡¹ç›® 123 çš„è¯¦æƒ…
```

---

### 5. è·å–é¡¹ç›®åˆ—è¡¨ `get_projects`

**åŠŸèƒ½**ï¼šè·å–ç³»ç»Ÿä¸­çš„æ‰€æœ‰é¡¹ç›®

**å‚æ•°**ï¼š
- `page` (int, é»˜è®¤: 1): é¡µç 
- `limit` (int, é»˜è®¤: 10): æ¯é¡µæ•°é‡
- `status` (str, å¯é€‰): é¡¹ç›®çŠ¶æ€ (active/completed/archived)
- `business_line_id` (int, å¯é€‰): ç‰¹å®šä¸šåŠ¡çº¿

**è¿”å›å€¼**ï¼š
```json
{
  "total": 50,
  "page": 1,
  "limit": 10,
  "data": [
    {
      "id": 123,
      "name": "é¡¹ç›®A",
      "type": "rd",
      "business_line": "ç ”å‘éƒ¨",
      "level": "level1",
      "created_at": "2025-01-01T00:00:00Z"
    }
  ]
}
```

---

### 6. ç”Ÿæˆå·¥æ—¶æŠ¥è¡¨ `get_time_entry_report`

**åŠŸèƒ½**ï¼šç”Ÿæˆå·¥æ—¶æŠ¥è¡¨

**å‚æ•°**ï¼š
- `start_date` (str, å¿…éœ€): å¼€å§‹æ—¥æœŸï¼Œæ ¼å¼ YYYY-MM-DD
- `end_date` (str, å¿…éœ€): ç»“æŸæ—¥æœŸï¼Œæ ¼å¼ YYYY-MM-DD
- `project_id` (int, å¯é€‰): ç‰¹å®šé¡¹ç›®
- `user_id` (int, å¯é€‰): ç‰¹å®šç”¨æˆ·

**ç¤ºä¾‹**ï¼š
```
ç”Ÿæˆ 2025 å¹´ 10 æœˆçš„å·¥æ—¶æŠ¥è¡¨
```

---

## å®æˆ˜ç¤ºä¾‹

### åœºæ™¯ 1ï¼šæŸ¥çœ‹æœ¬æœˆå·¥æ—¶å®Œæˆæƒ…å†µ

```
è¯·å¸®æˆ‘æŸ¥çœ‹ 2025 å¹´ 10 æœˆçš„å·¥æ—¶å¡«æŠ¥æƒ…å†µï¼ŒåŒ…æ‹¬åº”è¯¥å¡«å†™å¤šå°‘å¤©ï¼Œå·²ç»å¡«å†™äº†å¤šå°‘å¤©
```

**ç»“æœ**ï¼š
- æ€»å·¥ä½œæ—¥ï¼š22 å¤©
- å·²å¡«å†™ï¼š20 å¤©
- ç¼ºå¤±ï¼š2 å¤©
- ç¼ºå¤±æ—¥æœŸï¼š10 æœˆ 1 æ—¥ã€10 æœˆ 2 æ—¥

---

### åœºæ™¯ 2ï¼šæŸ¥è¯¢ç‰¹å®šé¡¹ç›®çš„å·¥æ—¶

```
æŸ¥è¯¢æˆ‘åœ¨é¡¹ç›® A çš„æ‰€æœ‰å·¥æ—¶è®°å½•
```

**ç»“æœ**ï¼š
- é¡¹ç›®åç§°ï¼šé¡¹ç›® A
- å·¥æ—¶æ€»æ•°ï¼š80 å°æ—¶
- æœ€è¿‘å·¥æ—¶è®°å½•ï¼š...

---

### åœºæ™¯ 3ï¼šäº†è§£é¡¹ç›®ä¿¡æ¯

```
æˆ‘æƒ³äº†è§£é¡¹ç›® 123 çš„è¯¦æƒ…ï¼ŒåŒ…æ‹¬é¡¹ç›®ç»ç†å’Œæˆå‘˜
```

**ç»“æœ**ï¼š
- é¡¹ç›®åç§°ã€ç±»å‹ã€ä¸šåŠ¡çº¿
- é¡¹ç›®ç»ç†åˆ—è¡¨
- é¡¹ç›®æˆå‘˜åˆ—è¡¨

---

## æ•…éšœæ’é™¤

### é—®é¢˜ 1ï¼šToken è¿‡æœŸ

**é”™è¯¯ä¿¡æ¯**ï¼š`{"error": "æ— æ•ˆæˆ–è¿‡æœŸçš„ä»¤ç‰Œ"}`

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç”Ÿæˆæ–°çš„ JWT Token
2. æ›´æ–°ç¯å¢ƒå˜é‡ `TIMESHEET_API_TOKEN`
3. é‡å¯ MCP æœåŠ¡å™¨

å‚è€ƒï¼š[TOKEN_MANAGEMENT.md](TOKEN_MANAGEMENT.md)

---

### é—®é¢˜ 2ï¼šæ— æ³•è¿æ¥åˆ° API

**é”™è¯¯ä¿¡æ¯**ï¼š`Connection refused` æˆ– `HTTP 502`

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ `TIMESHEET_API_BASE_URL` æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤ç½‘ç»œè¿æ¥
3. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

---

### é—®é¢˜ 3ï¼šPermission Denied

**é”™è¯¯ä¿¡æ¯**ï¼š`Permission denied`

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®è®¤ Token å¯¹åº”çš„ç”¨æˆ·æœ‰æƒé™
2. æ£€æŸ¥ JWT Token çš„ role å­—æ®µ

---

## æ›´å¤šèµ„æº

- ğŸ“– [è¯¦ç»†ç”¨æ³•ç¤ºä¾‹](USAGE_EXAMPLES.md)
- ğŸ” [Token ç®¡ç†æŒ‡å—](TOKEN_MANAGEMENT.md)
- ğŸ§ª [æµ‹è¯•æŒ‡å—](testing-guide.md)
- ğŸš€ [éƒ¨ç½²æŒ‡å—](deployment-guide.md)

---

## æ”¯æŒ

é‡åˆ°é—®é¢˜ï¼Ÿè¯·è®¿é—®ï¼š
- ğŸ› [GitHub Issues](https://github.com/yangyuezheng/ai-emp/issues)
- ğŸ“§ Email: yangyuezheng@example.com

---

**ç‰ˆæœ¬**: 1.0.0  
**æœ€åæ›´æ–°**: 2025å¹´10æœˆ20æ—¥

