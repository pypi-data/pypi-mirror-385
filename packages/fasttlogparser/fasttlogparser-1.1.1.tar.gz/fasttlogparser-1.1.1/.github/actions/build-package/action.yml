name: "python-setup"
description: "Composite action to set up Python and build distributions."
inputs:
  python-version:
    description: "Python version to install (e.g. 3.10)"
    required: true
  cache-dependency-path:
    description: "Path to dependency file used for cache key (e.g. pyproject.toml)"
    required: true

runs:
  using: "composite"
  steps:
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: ${{ inputs.python-version }}
        cache: "pip"
        cache-dependency-path: ${{ inputs.cache-dependency-path }}

    - name: Cache Python
      uses: actions/cache@v4
      id: cache
      with:
        path: ${{ env.pythonLocation }}
        key: ${{ runner.os }}-python-${{ env.pythonLocation }}-${{ hashFiles(inputs.cache-dependency-path) }}-test-v03

    - name: Install Dependencies
      if: steps.cache.outputs.cache-hit != 'true'
      run: pip install build auditwheel scikit-build-core pybind11
      shell: bash

    - name: Build distributions
      run: python -m build --no-isolation
      shell: bash
