import{d as ne,u as oe,A as ae,b as re,B as ie,k as M,m as se,e as u,n as v,o as m,f as e,w as l,h as a,i as y,c as A,g as c,t as s,F as I,p as T,_ as de}from"./index-CxlwjfZg.js";const ue={class:"d-flex mb-4"},me={key:1},ce={class:"d-flex mb-4"},_e={key:1},pe={class:"d-flex mb-4"},fe={key:0},ve={key:1},ye={class:"text-h5"},Ce={class:"text-h5"},ke={class:"text-h5"},xe=ne({__name:"MemoryTab",setup(Me){const{t:r}=oe(),C=ae(),d=re();ie();const b=M(!1),x=M({role:"user",content:""}),g=M(!1),p=M({}),V=M(!1),f=M({});function j(n=null){n?p.value={...n,contentStr:n.content.join(`
`)}:p.value={title:"",description:"",contentStr:""},g.value=!0}async function K(){if(!d.isConnected)return;const n=p.value,t={title:n.title,description:n.description,content:n.contentStr.split(`
`).filter(i=>i.trim()!=="")};try{n.id?await d.sendAdminWsMessage("update_core_memory_block",{block_id:n.id,...t}):await d.sendAdminWsMessage("create_core_memory_block",t),g.value=!1}catch(i){console.error("Failed to save core memory block:",i)}}function O(n=null,t=null){if(n!==null){let i=t;Array.isArray(t)?i=t.join(`
`):typeof t=="object"&&(i=JSON.stringify(t,null,2)),f.value={key:n,valueStr:i,isEditing:!0}}else f.value={key:"",valueStr:"",isEditing:!1};V.value=!0}async function P(){if(!d.isConnected||!f.value.key.trim())return;const{key:n,valueStr:t}=f.value;let i=t;try{const _=t.trim();_.startsWith("{")&&_.endsWith("}")||_.startsWith("[")&&_.endsWith("]")?i=JSON.parse(_):_.includes(`
`)&&(i=_.split(`
`).filter(S=>S.trim()!==""))}catch(_){console.warn("Could not parse value as JSON or array, saving as string.",_)}try{await d.sendAdminWsMessage("update_init_memory_item",{key:n,value:i}),V.value=!1}catch(_){console.error(`Failed to save init memory item ${n}:`,_)}}async function G(){if(!(!d.isConnected||!x.value.content.trim()))try{await d.sendAdminWsMessage("add_temp_memory",x.value),b.value=!1,x.value.content=""}catch(n){console.error("Failed to add temp memory:",n)}}async function H(n){if(d.isConnected&&confirm(r("Are you sure you want to delete this memory block?")))try{await d.sendAdminWsMessage("delete_core_memory_block",{block_id:n})}catch(t){console.error(`Failed to delete core memory block ${n}:`,t)}}async function Q(n){if(d.isConnected&&confirm(`${r("Are you sure you want to delete the key")} "${n}"?`))try{await d.sendAdminWsMessage("delete_init_memory_key",{key:n})}catch(t){console.error(`Failed to delete init memory item ${n}:`,t)}}async function X(n){if(d.isConnected)try{await d.sendAdminWsMessage("delete_temp_memory_item",{item_id:n})}catch(t){console.error(`Failed to delete temp memory item ${n}:`,t)}}async function Y(){if(d.isConnected&&confirm(r("Are you sure you want to clear all temp memory?")))try{await d.sendAdminWsMessage("clear_temp_memory")}catch(n){console.error("Failed to clear temp memory:",n)}}async function z(){if(d.isConnected)try{const n=await d.sendAdminWsMessage("get_init_memory");C.handleInitMemoryUpdate(n)}catch(n){console.error("Failed to refresh init memory:",n)}}async function q(){if(d.isConnected)try{const n=await d.sendAdminWsMessage("get_temp_memory");C.handleTempMemoryUpdate(n)}catch(n){console.error("Failed to refresh temp memory:",n)}}async function J(){if(d.isConnected)try{const n=await d.sendAdminWsMessage("get_core_memory_blocks");C.handleCoreMemoryUpdate(n)}catch(n){console.error("Failed to refresh core memory:",n)}}async function Z(){d.isConnected&&await Promise.all([z(),q(),J()])}return se(()=>{Z()}),(n,t)=>{const i=u("v-btn"),_=u("v-list-item-subtitle"),S=u("v-list-item"),R=u("v-list"),U=u("v-expansion-panel-text"),F=u("v-expansion-panel"),w=u("v-card-title"),ee=u("v-card-subtitle"),h=u("v-card-text"),$=u("v-card"),te=u("v-expansion-panels"),le=u("v-select"),W=u("v-textarea"),B=u("v-spacer"),N=u("v-card-actions"),E=u("v-dialog"),L=u("v-text-field");return m(),v("div",null,[e(te,{variant:"inset",class:"my-4"},{default:l(()=>[e(F,{title:a(r)("Init Memory")},{default:l(()=>[e(U,null,{default:l(()=>[y("div",ue,[e(i,{onClick:z,class:"mr-2"},{default:l(()=>[c(s(a(r)("Refresh")),1)]),_:1}),e(i,{onClick:t[0]||(t[0]=o=>O()),color:"primary"},{default:l(()=>[c(s(a(r)("Add")),1)]),_:1})]),Object.keys(a(C).initMemory).length>0?(m(),A(R,{key:0,lines:"one"},{default:l(()=>[(m(!0),v(I,null,T(a(C).initMemory,(o,k)=>(m(),A(S,{key:k,title:k},{append:l(()=>[e(i,{onClick:D=>O(k.toString(),o),icon:"mdi-pencil",size:"x-small",variant:"text"},null,8,["onClick"]),e(i,{onClick:D=>Q(k.toString()),icon:"mdi-delete",size:"x-small",variant:"text",color:"error"},null,8,["onClick"])]),default:l(()=>[e(_,{class:"value-display"},{default:l(()=>[y("pre",null,s(o),1)]),_:2},1024)]),_:2},1032,["title"]))),128))]),_:1})):(m(),v("p",me,s(a(r)("No init memory.")),1))]),_:1})]),_:1},8,["title"]),e(F,{title:a(r)("Temp Memory")},{default:l(()=>[e(U,null,{default:l(()=>[y("div",ce,[e(i,{onClick:q,class:"mr-2"},{default:l(()=>[c(s(a(r)("Refresh")),1)]),_:1}),e(i,{onClick:t[1]||(t[1]=o=>b.value=!0),color:"primary",class:"mr-2"},{default:l(()=>[c(s(a(r)("Add")),1)]),_:1}),e(i,{onClick:Y,color:"error"},{default:l(()=>[c(s(a(r)("Clear")),1)]),_:1})]),a(C).tempMemory.length>0?(m(),A(R,{key:0,lines:"one"},{default:l(()=>[(m(!0),v(I,null,T(a(C).tempMemory,o=>(m(),A(S,{key:o.id,title:`[${o.role}] ${o.content||o.text}`,subtitle:new Date(o.timestamp).toLocaleString()},{append:l(()=>[e(i,{onClick:k=>X(o.id),icon:"mdi-delete",size:"x-small",variant:"text",color:"error"},null,8,["onClick"])]),_:2},1032,["title","subtitle"]))),128))]),_:1})):(m(),v("p",_e,s(a(r)("No temp memory.")),1))]),_:1})]),_:1},8,["title"]),e(F,{title:a(r)("Core Memory")},{default:l(()=>[e(U,null,{default:l(()=>[y("div",pe,[e(i,{onClick:J,class:"mr-2"},{default:l(()=>[c(s(a(r)("Refresh")),1)]),_:1}),e(i,{onClick:t[2]||(t[2]=o=>j()),color:"primary"},{default:l(()=>[c(s(a(r)("Add Memory Block")),1)]),_:1})]),Object.keys(a(C).coreMemory).length>0?(m(),v("div",fe,[(m(!0),v(I,null,T(a(C).coreMemory,o=>(m(),A($,{key:o.id,class:"mb-4",variant:"outlined"},{default:l(()=>[e(w,{class:"d-flex justify-space-between"},{default:l(()=>[y("span",null,s(o.title),1),y("div",null,[e(i,{onClick:k=>j(o),icon:"mdi-pencil",size:"x-small",variant:"text"},null,8,["onClick"]),e(i,{onClick:k=>H(o.id),icon:"mdi-delete",size:"x-small",variant:"text",color:"error"},null,8,["onClick"])])]),_:2},1024),e(ee,null,{default:l(()=>[c(s(o.description),1)]),_:2},1024),e(h,null,{default:l(()=>[y("ul",null,[(m(!0),v(I,null,T(o.content,(k,D)=>(m(),v("li",{key:D},s(k),1))),128))])]),_:2},1024)]),_:2},1024))),128))])):(m(),v("p",ve,s(a(r)("No core memory.")),1))]),_:1})]),_:1},8,["title"])]),_:1}),e(E,{modelValue:b.value,"onUpdate:modelValue":t[6]||(t[6]=o=>b.value=o),"max-width":"500px"},{default:l(()=>[e($,null,{default:l(()=>[e(w,null,{default:l(()=>[y("span",ye,s(a(r)("Add Temp Memory")),1)]),_:1}),e(h,null,{default:l(()=>[e(le,{modelValue:x.value.role,"onUpdate:modelValue":t[3]||(t[3]=o=>x.value.role=o),items:["system","user","assistant"],label:a(r)("Role"),required:""},null,8,["modelValue","label"]),e(W,{modelValue:x.value.content,"onUpdate:modelValue":t[4]||(t[4]=o=>x.value.content=o),label:a(r)("Content"),required:""},null,8,["modelValue","label"])]),_:1}),e(N,null,{default:l(()=>[e(B),e(i,{color:"blue-darken-1",variant:"text",onClick:t[5]||(t[5]=o=>b.value=!1)},{default:l(()=>[c(s(a(r)("Cancel")),1)]),_:1}),e(i,{color:"blue-darken-1",variant:"text",onClick:G},{default:l(()=>[c(s(a(r)("Add")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(E,{modelValue:g.value,"onUpdate:modelValue":t[11]||(t[11]=o=>g.value=o),"max-width":"600px"},{default:l(()=>[e($,null,{default:l(()=>[e(w,null,{default:l(()=>[y("span",Ce,s(a(r)(p.value.id?"Editing":"Adding"))+" "+s(a(r)("Add/Edit Core Memory Block")),1)]),_:1}),e(h,null,{default:l(()=>[e(L,{modelValue:p.value.title,"onUpdate:modelValue":t[7]||(t[7]=o=>p.value.title=o),label:a(r)("Title"),required:""},null,8,["modelValue","label"]),e(W,{modelValue:p.value.description,"onUpdate:modelValue":t[8]||(t[8]=o=>p.value.description=o),label:a(r)("Description")},null,8,["modelValue","label"]),e(W,{modelValue:p.value.contentStr,"onUpdate:modelValue":t[9]||(t[9]=o=>p.value.contentStr=o),label:a(r)("Content (one per line)")},null,8,["modelValue","label"])]),_:1}),e(N,null,{default:l(()=>[e(B),e(i,{color:"blue-darken-1",variant:"text",onClick:t[10]||(t[10]=o=>g.value=!1)},{default:l(()=>[c(s(a(r)("Cancel")),1)]),_:1}),e(i,{color:"blue-darken-1",variant:"text",onClick:K},{default:l(()=>[c(s(a(r)("Save")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(E,{modelValue:V.value,"onUpdate:modelValue":t[15]||(t[15]=o=>V.value=o),"max-width":"600px"},{default:l(()=>[e($,null,{default:l(()=>[e(w,null,{default:l(()=>[y("span",ke,s(a(r)(f.value.isEditing?"Editing":"Adding"))+" "+s(a(r)("Add/Edit Init Memory Item")),1)]),_:1}),e(h,null,{default:l(()=>[e(L,{modelValue:f.value.key,"onUpdate:modelValue":t[12]||(t[12]=o=>f.value.key=o),label:a(r)("Key"),disabled:f.value.isEditing,required:""},null,8,["modelValue","label","disabled"]),e(W,{modelValue:f.value.valueStr,"onUpdate:modelValue":t[13]||(t[13]=o=>f.value.valueStr=o),label:a(r)("Value (String, JSON, or newline-separated array)")},null,8,["modelValue","label"])]),_:1}),e(N,null,{default:l(()=>[e(B),e(i,{color:"blue-darken-1",variant:"text",onClick:t[14]||(t[14]=o=>V.value=!1)},{default:l(()=>[c(s(a(r)("Cancel")),1)]),_:1}),e(i,{color:"blue-darken-1",variant:"text",onClick:P},{default:l(()=>[c(s(a(r)("Save")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),ge=de(xe,[["__scopeId","data-v-7332e459"]]);export{ge as default};
