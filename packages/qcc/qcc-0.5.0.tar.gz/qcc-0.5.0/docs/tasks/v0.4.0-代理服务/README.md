# QCC v0.4.0 å¼€å‘ä»»åŠ¡æ–‡æ¡£

## ğŸ“š æ–‡æ¡£ç´¢å¼•

æœ¬ç›®å½•åŒ…å« QCC v0.4.0 ç‰ˆæœ¬çš„æ‰€æœ‰å¼€å‘è®¡åˆ’å’ŒæŠ€æœ¯å®ç°æ–‡æ¡£ã€‚

### æ ¸å¿ƒæ–‡æ¡£

1. **[claude-code-proxy-development-plan.md](./claude-code-proxy-development-plan.md)** - ä¸»å¼€å‘è®¡åˆ’
   - é¡¹ç›®æ•´ä½“æ¶æ„å’Œè§„åˆ’
   - 6 å¤§æ ¸å¿ƒåŠŸèƒ½è¯¦ç»†è®¾è®¡
   - å¼€å‘é‡Œç¨‹ç¢‘å’Œæ—¶é—´çº¿
   - ä½¿ç”¨ç¤ºä¾‹å’Œæœ€ä½³å®è·µ

2. **[endpoint-reuse-implementation.md](./endpoint-reuse-implementation.md)** - Endpoint é…ç½®å¤ç”¨
   - ä»ç°æœ‰é…ç½®å¿«é€Ÿå¤ç”¨ API Key
   - ä¸‰ç§ endpoint æ·»åŠ æ–¹å¼
   - æ•°æ®æ¨¡å‹å’Œ CLI å‘½ä»¤å®ç°
   - å®Œæ•´çš„ä½¿ç”¨æµç¨‹å’Œæµ‹è¯•ç”¨ä¾‹

3. **[auto-failover-mechanism.md](./auto-failover-mechanism.md)** - è‡ªåŠ¨æ•…éšœè½¬ç§»æœºåˆ¶
   - æ™ºèƒ½é…ç½®ä¼˜å…ˆçº§ç®¡ç†
   - è‡ªåŠ¨æ•…éšœæ£€æµ‹å’Œåˆ‡æ¢
   - æ•…éšœæ¢å¤å’Œå†å²è¿½è¸ª
   - å®æ—¶ç›‘æ§å’Œå‘Šè­¦é€šçŸ¥

4. **[intelligent-health-check.md](./intelligent-health-check.md)** - æ™ºèƒ½å¥åº·æ£€æµ‹ âœ… å·²å®ç°
   - çœŸå®å¯¹è¯æµ‹è¯•å–ä»£ ping
   - å¤šç»´åº¦æ€§èƒ½è¯„ä¼°
   - åŠ¨æ€æƒé‡è‡ªåŠ¨è°ƒæ•´
   - æ€§èƒ½æŒ‡æ ‡ç»Ÿè®¡åˆ†æ

5. **[intelligent-health-check-implementation.md](./intelligent-health-check-implementation.md)** - å®ç°æŠ¥å‘Š ğŸ†•
   - å®Œæ•´çš„å®ç°ç»†èŠ‚å’Œä»£ç ç»“æ„
   - 20ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼ˆ100%é€šè¿‡ï¼‰
   - ä½¿ç”¨ç¤ºä¾‹å’Œé…ç½®æŒ‡å—
   - é›†æˆæŒ‡å—å’Œå¾…åŠäº‹é¡¹

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½æ¦‚è§ˆ

**æ³¨æ„**: æœ¬æ–‡æ¡£æè¿°çš„æ˜¯ v0.4.0 çš„è®¾è®¡è§„åˆ’ï¼Œéƒ¨åˆ†åŠŸèƒ½å¯èƒ½ä¸å½“å‰å®ç°æœ‰å·®å¼‚ã€‚

### 1. Claude Code ä»£ç†æœåŠ¡ ğŸš€
æä¾›æœ¬åœ°ä»£ç†æœåŠ¡å™¨ï¼Œæ‹¦æˆªå’Œè½¬å‘ Claude Code çš„ API è¯·æ±‚ã€‚

**å…³é”®ç‰¹æ€§:**
- æœ¬åœ° HTTP/HTTPS ä»£ç†æœåŠ¡å™¨
- æµå¼å“åº”æ”¯æŒ (SSE)
- è¯·æ±‚/å“åº”æ—¥å¿—è®°å½•
- é€æ˜ä»£ç†æ¨¡å¼

**CLI å‘½ä»¤:**
```bash
# æœ¬åœ°å¼€å‘æµ‹è¯•
uvx --from . qcc proxy start              # å¯åŠ¨ä»£ç†æœåŠ¡
uvx --from . qcc proxy stop               # åœæ­¢ä»£ç†æœåŠ¡
uvx --from . qcc proxy status             # æŸ¥çœ‹ä»£ç†çŠ¶æ€
uvx --from . qcc proxy logs               # æŸ¥çœ‹ä»£ç†æ—¥å¿—

# è¿œç¨‹å®‰è£…ä½¿ç”¨
uvx qcc proxy start              # å¯åŠ¨ä»£ç†æœåŠ¡
uvx qcc proxy stop               # åœæ­¢ä»£ç†æœåŠ¡
uvx qcc proxy status             # æŸ¥çœ‹ä»£ç†çŠ¶æ€
uvx qcc proxy logs               # æŸ¥çœ‹ä»£ç†æ—¥å¿—
```

---

### 2. å¤š API Key é…ç½®ç®¡ç† ğŸ”‘
ä¸ºæ¯ä¸ªé…ç½®æ¡£æ¡ˆæ·»åŠ å¤šä¸ª API Key å’Œ Base URLï¼Œå®ç°è´Ÿè½½å‡è¡¡ã€‚

**å…³é”®ç‰¹æ€§:**
- æ¯ä¸ªé…ç½®æ”¯æŒå¤šä¸ª endpoint
- **ä»ç°æœ‰é…ç½®å¤ç”¨** (æ–°å¢) â­
- æ”¯æŒæƒé‡å’Œä¼˜å…ˆçº§è®¾ç½®
- Endpoint å¯ç”¨/ç¦ç”¨ç®¡ç†

**ä¸‰ç§æ·»åŠ æ–¹å¼:**
1. ä»ç°æœ‰é…ç½®å¤ç”¨ï¼ˆæ¨èï¼‰
2. æ‰‹åŠ¨è¾“å…¥æ–°é…ç½®
3. ä»å‚å•†å¿«é€Ÿé…ç½®

**CLI å‘½ä»¤:**
```bash
# æœ¬åœ°å¼€å‘æµ‹è¯•
uvx --from . qcc endpoint add <config-name>           # æ·»åŠ  endpoint (äº¤äº’å¼)
uvx --from . qcc endpoint add <config-name> -f work   # ä» work é…ç½®å¤ç”¨
uvx --from . qcc endpoint list <config-name>          # æŸ¥çœ‹ endpoint åˆ—è¡¨
uvx --from . qcc endpoint remove <config-name> <id>   # åˆ é™¤ endpoint

# è¿œç¨‹å®‰è£…ä½¿ç”¨
uvx qcc endpoint add <config-name>           # æ·»åŠ  endpoint (äº¤äº’å¼)
uvx qcc endpoint add <config-name> -f work   # ä» work é…ç½®å¤ç”¨
uvx qcc endpoint list <config-name>          # æŸ¥çœ‹ endpoint åˆ—è¡¨
uvx qcc endpoint remove <config-name> <id>   # åˆ é™¤ endpoint
```

**ä½¿ç”¨ç¤ºä¾‹:**
```bash
# ä»ç°æœ‰é…ç½®å¿«é€Ÿå¤ç”¨
uvx qcc endpoint add production
# é€‰æ‹©: 1 (ä»ç°æœ‰é…ç½®å¤ç”¨)
# é€‰æ‹©é…ç½®: work
# æƒé‡: 100, ä¼˜å…ˆçº§: 1
# âœ… Endpoint æ·»åŠ æˆåŠŸï¼
```

---

### 3. ä¸»æ¬¡é…ç½®ç­–ç•¥ â­
é…ç½®ä¸‰çº§ä¼˜å…ˆçº§ä½“ç³»ï¼šPrimaryï¼ˆä¸»ï¼‰ â†’ Secondaryï¼ˆæ¬¡ï¼‰ â†’ Fallbackï¼ˆå…œåº•ï¼‰

**å…³é”®ç‰¹æ€§:**
- ä¸‰çº§ä¼˜å…ˆçº§ç®¡ç†
- é…ç½®ç»„ç®¡ç†
- **è‡ªåŠ¨æ•…éšœè½¬ç§»** (æ–°å¢) ğŸ”„
- **è‡ªåŠ¨æ¢å¤** (æ–°å¢) âœ…
- æ™ºèƒ½åˆ‡æ¢ç­–ç•¥

**æ•…éšœè½¬ç§»æµç¨‹:**
```
Primary é…ç½®å¤±è´¥
  â†“ è‡ªåŠ¨æ£€æµ‹
  â†“ è¾¾åˆ°æ•…éšœé˜ˆå€¼ï¼ˆå¦‚ 3 æ¬¡ï¼‰
  â†“ è§¦å‘æ•…éšœè½¬ç§»
Secondary é…ç½®æ¥ç®¡
  â†“ ç»§ç»­æä¾›æœåŠ¡
  â†“ ç›‘æ§ Primary æ¢å¤
Primary æ¢å¤å¥åº·
  â†“ è‡ªåŠ¨åˆ‡å›ï¼ˆå¯é€‰ï¼‰
```

**CLI å‘½ä»¤:**
```bash
# æœ¬åœ°å¼€å‘æµ‹è¯•
uvx --from . qcc priority set production primary      # è®¾ç½®ä¸ºä¸»é…ç½®
uvx --from . qcc priority set backup secondary        # è®¾ç½®ä¸ºæ¬¡é…ç½®
uvx --from . qcc priority set emergency fallback      # è®¾ç½®ä¸ºå…œåº•é…ç½®
uvx --from . qcc priority list                        # æŸ¥çœ‹ä¼˜å…ˆçº§é…ç½®
uvx --from . qcc priority switch backup               # æ‰‹åŠ¨åˆ‡æ¢é…ç½®
uvx --from . qcc priority history                     # æŸ¥çœ‹åˆ‡æ¢å†å²

# é…ç½®æ•…éšœè½¬ç§»ç­–ç•¥
uvx --from . qcc priority policy --auto-failover --auto-recovery \
  --failure-threshold 3 --cooldown 300

# è¿œç¨‹å®‰è£…ä½¿ç”¨
uvx qcc priority set production primary      # è®¾ç½®ä¸ºä¸»é…ç½®
uvx qcc priority set backup secondary        # è®¾ç½®ä¸ºæ¬¡é…ç½®
uvx qcc priority set emergency fallback      # è®¾ç½®ä¸ºå…œåº•é…ç½®
uvx qcc priority list                        # æŸ¥çœ‹ä¼˜å…ˆçº§é…ç½®
uvx qcc priority switch backup               # æ‰‹åŠ¨åˆ‡æ¢é…ç½®
uvx qcc priority history                     # æŸ¥çœ‹åˆ‡æ¢å†å²

# é…ç½®æ•…éšœè½¬ç§»ç­–ç•¥
uvx qcc priority policy --auto-failover --auto-recovery \
  --failure-threshold 3 --cooldown 300
```

**ä½¿ç”¨ç¤ºä¾‹:**
```bash
# é…ç½®ä¸‰çº§æ•…éšœè½¬ç§»
uvx qcc priority set production primary
uvx qcc priority set backup secondary
uvx qcc priority set emergency fallback

uvx qcc priority policy --auto-failover --auto-recovery

uvx qcc proxy start
# âœ“ ä»£ç†æœåŠ¡å™¨å·²å¯åŠ¨
# âœ“ æ•…éšœè½¬ç§»ç›‘æ§å·²å¯åŠ¨

# å½“ production å¤±è´¥æ—¶:
# ğŸ”„ æ•…éšœè½¬ç§»: production â†’ backup
# åŸå› : è¿ç»­ 3 æ¬¡å¥åº·æ£€æŸ¥å¤±è´¥
# âœ“ æ•…éšœè½¬ç§»å®Œæˆï¼Œå½“å‰ä½¿ç”¨é…ç½®: backup
```

---

### 4. åå°å¥åº·æ£€æµ‹æœºåˆ¶ ğŸ¥
å®šæ—¶æ£€æŸ¥æ‰€æœ‰ endpoint çš„å¥åº·çŠ¶æ€ï¼Œè‡ªåŠ¨å‘ç°å’Œæ ‡è®°å¤±è´¥ã€‚

**å…³é”®ç‰¹æ€§:**
- å®šæ—¶å¥åº·æ£€æµ‹ï¼ˆå¯é…ç½®é—´éš”ï¼‰
- å¤šå±‚æ¬¡æ£€æµ‹ï¼ˆè¿æ¥ã€APIã€æ€§èƒ½ï¼‰
- å¥åº·åº¦è¯„åˆ†ç³»ç»Ÿ
- å¥åº·çŠ¶æ€æŒä¹…åŒ–

**å¥åº·çŠ¶æ€æ¨¡å‹:**
```json
{
  "status": "healthy",
  "last_check": "2025-10-16T12:00:00Z",
  "consecutive_failures": 0,
  "success_rate": 99.5,
  "avg_response_time": 250
}
```

**CLI å‘½ä»¤:**
```bash
# æœ¬åœ°å¼€å‘æµ‹è¯•
uvx --from . qcc health check                    # ç«‹å³æ‰§è¡Œå¥åº·æ£€æŸ¥
uvx --from . qcc health status                   # æŸ¥çœ‹æ‰€æœ‰ endpoint å¥åº·çŠ¶æ€
uvx --from . qcc health history <endpoint-id>    # æŸ¥çœ‹å†å²å¥åº·è®°å½•
uvx --from . qcc health config                   # é…ç½®å¥åº·æ£€æµ‹å‚æ•°

# è¿œç¨‹å®‰è£…ä½¿ç”¨
uvx qcc health check                    # ç«‹å³æ‰§è¡Œå¥åº·æ£€æŸ¥
uvx qcc health status                   # æŸ¥çœ‹æ‰€æœ‰ endpoint å¥åº·çŠ¶æ€
uvx qcc health history <endpoint-id>    # æŸ¥çœ‹å†å²å¥åº·è®°å½•
uvx qcc health config                   # é…ç½®å¥åº·æ£€æµ‹å‚æ•°
```

---

### 5. æ•…éšœè½¬ç§»é˜Ÿåˆ— ğŸ“‹
å¤±è´¥è¯·æ±‚è‡ªåŠ¨å…¥é˜Ÿï¼Œæ”¯æŒå¤šç§é‡è¯•ç­–ç•¥ã€‚

**å…³é”®ç‰¹æ€§:**
- å¤±è´¥è¯·æ±‚è‡ªåŠ¨å…¥é˜Ÿ
- å¤šç§é‡è¯•ç­–ç•¥ï¼ˆæŒ‡æ•°é€€é¿ã€å›ºå®šé—´éš”ã€ç«‹å³é‡è¯•ï¼‰
- é˜Ÿåˆ—æŒä¹…åŒ–
- ä¼˜å…ˆçº§é˜Ÿåˆ—

**é‡è¯•ç­–ç•¥:**
- **æŒ‡æ•°é€€é¿**: 5s â†’ 10s â†’ 20s â†’ ... (æœ€å¤§ 300s)
- **å›ºå®šé—´éš”**: æ¯æ¬¡é‡è¯•é—´éš”å›ºå®š
- **ç«‹å³é‡è¯•**: å¤±è´¥åç«‹å³é‡è¯•

**CLI å‘½ä»¤:**
```bash
# æœ¬åœ°å¼€å‘æµ‹è¯•
uvx --from . qcc queue status                     # æŸ¥çœ‹é˜Ÿåˆ—çŠ¶æ€
uvx --from . qcc queue list                       # åˆ—å‡ºé˜Ÿåˆ—ä¸­çš„è¯·æ±‚
uvx --from . qcc queue retry <request-id>         # æ‰‹åŠ¨é‡è¯•æŸä¸ªè¯·æ±‚
uvx --from . qcc queue retry-all                  # é‡è¯•æ‰€æœ‰å¤±è´¥è¯·æ±‚
uvx --from . qcc queue clear                      # æ¸…ç©ºé˜Ÿåˆ—

# è¿œç¨‹å®‰è£…ä½¿ç”¨
uvx qcc queue status                     # æŸ¥çœ‹é˜Ÿåˆ—çŠ¶æ€
uvx qcc queue list                       # åˆ—å‡ºé˜Ÿåˆ—ä¸­çš„è¯·æ±‚
uvx qcc queue retry <request-id>         # æ‰‹åŠ¨é‡è¯•æŸä¸ªè¯·æ±‚
uvx qcc queue retry-all                  # é‡è¯•æ‰€æœ‰å¤±è´¥è¯·æ±‚
uvx qcc queue clear                      # æ¸…ç©ºé˜Ÿåˆ—
```

---

### 6. ç»ˆç«¯é…ç½®ç®¡ç† âš™ï¸
æ‰€æœ‰åŠŸèƒ½éƒ½å¯é€šè¿‡ç»ˆç«¯å‘½ä»¤é…ç½®å’Œç®¡ç†ã€‚

**é…ç½®é¡¹åˆ†ç±»:**
- `proxy.*` - ä»£ç†é…ç½®
- `health.*` - å¥åº·æ£€æµ‹é…ç½®
- `queue.*` - é˜Ÿåˆ—é…ç½®
- `loadbalancer.*` - è´Ÿè½½å‡è¡¡é…ç½®

**CLI å‘½ä»¤:**
```bash
# æœ¬åœ°å¼€å‘æµ‹è¯•
uvx --from . qcc config get <key>                 # è·å–é…ç½®é¡¹
uvx --from . qcc config set <key> <value>         # è®¾ç½®é…ç½®é¡¹
uvx --from . qcc config list                      # åˆ—å‡ºæ‰€æœ‰é…ç½®
uvx --from . qcc config reset [key]               # é‡ç½®é…ç½®
uvx --from . qcc config export <file>             # å¯¼å‡ºé…ç½®
uvx --from . qcc config import <file>             # å¯¼å…¥é…ç½®

# è¿œç¨‹å®‰è£…ä½¿ç”¨
uvx qcc config get <key>                 # è·å–é…ç½®é¡¹
uvx qcc config set <key> <value>         # è®¾ç½®é…ç½®é¡¹
uvx qcc config list                      # åˆ—å‡ºæ‰€æœ‰é…ç½®
uvx qcc config reset [key]               # é‡ç½®é…ç½®
uvx qcc config export <file>             # å¯¼å‡ºé…ç½®
uvx qcc config import <file>             # å¯¼å…¥é…ç½®
```

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Claude Code Client                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          QCC Proxy Server                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚    Request Router                  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚               â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚    Failover Manager (æ–°å¢)         â”‚     â”‚
â”‚  â”‚    - è‡ªåŠ¨æ•…éšœè½¬ç§»                   â”‚     â”‚
â”‚  â”‚    - è‡ªåŠ¨æ¢å¤                      â”‚     â”‚
â”‚  â”‚    - åˆ‡æ¢ç­–ç•¥ç®¡ç†                  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚               â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚    Priority Manager (æ–°å¢)         â”‚     â”‚
â”‚  â”‚    - ä¼˜å…ˆçº§ç®¡ç†                    â”‚     â”‚
â”‚  â”‚    - é…ç½®ç»„ç®¡ç†                    â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚               â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚    Load Balancer                   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚               â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚    Health Monitor                  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â†“               â†“               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Primary â”‚  â”‚Secondary â”‚  â”‚ Fallback â”‚
â”‚ Config  â”‚  â”‚  Config  â”‚  â”‚  Config  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒæ¨¡å—

```
fastcc/
â”œâ”€â”€ proxy/                     # ğŸ†• ä»£ç†æœåŠ¡æ¨¡å—
â”‚   â”œâ”€â”€ server.py              # ä»£ç†æœåŠ¡å™¨
â”‚   â”œâ”€â”€ load_balancer.py       # è´Ÿè½½å‡è¡¡å™¨
â”‚   â”œâ”€â”€ health_monitor.py      # å¥åº·ç›‘æ§å™¨
â”‚   â”œâ”€â”€ failure_queue.py       # å¤±è´¥é˜Ÿåˆ—
â”‚   â””â”€â”€ failover_manager.py    # ğŸ†• æ•…éšœè½¬ç§»ç®¡ç†å™¨
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ config.py              # é…ç½®ç®¡ç† (æ‰©å±•)
â”‚   â”œâ”€â”€ endpoint.py            # ğŸ†• Endpoint æ¨¡å‹
â”‚   â””â”€â”€ priority_manager.py    # ğŸ†• ä¼˜å…ˆçº§ç®¡ç†å™¨
â””â”€â”€ utils/
    â”œâ”€â”€ logger.py              # ğŸ†• æ—¥å¿—å·¥å…·
    â””â”€â”€ validator.py           # ğŸ†• éªŒè¯å·¥å…·
```

---

## ğŸ“… å¼€å‘è®¡åˆ’

**é¢„è®¡å®Œæˆæ—¶é—´**: 3-4 å‘¨ (åŸºäºå¤æ‚åº¦è¯„ä¼°)

### Phase 1: åŸºç¡€æ¶æ„ (5-7 å¤©)
- [ ] ä»£ç†æœåŠ¡å™¨åŸºç¡€æ¡†æ¶
- [ ] Endpoint æ•°æ®æ¨¡å‹
- [ ] åŸºæœ¬è¯·æ±‚æ‹¦æˆªå’Œè½¬å‘
- [ ] é…ç½®ç®¡ç†æ‰©å±•
- [ ] **å¼‚æ­¥è¿è¡Œæ—¶ç®¡ç†å™¨** (æ–°å¢)
- [ ] **å¹¶å‘æ§åˆ¶å™¨** (æ–°å¢)

### Phase 2: è´Ÿè½½å‡è¡¡ä¸å¥åº·æ£€æµ‹ (5-7 å¤©)
- [x] è´Ÿè½½å‡è¡¡å™¨å®ç° âœ…
- [x] **æ™ºèƒ½å¥åº·æ£€æµ‹** (å¯¹è¯æµ‹è¯•/å¤šç»´åº¦è¯„ä¼°) âœ… å·²å®Œæˆ
- [x] **Endpoint æ•°æ®æ¨¡å‹** âœ…
- [x] å¤šç§è´Ÿè½½å‡è¡¡ç­–ç•¥ âœ…
- [x] **åŠ¨æ€æƒé‡è°ƒæ•´** âœ… å·²å®Œæˆ
- [ ] **Endpoint é…ç½®å¤ç”¨åŠŸèƒ½** (CLIå‘½ä»¤å¾…å®ç°)

### Phase 3: æ•…éšœè½¬ç§»æœºåˆ¶ (7-10 å¤©)
- [ ] **Priority Manager å®ç°** (æ–°å¢)
- [ ] **Failover Manager å®ç°** (æ–°å¢)
- [ ] **è‡ªåŠ¨æ•…éšœè½¬ç§»é€»è¾‘** (æ–°å¢)
- [ ] **è‡ªåŠ¨æ¢å¤æœºåˆ¶** (æ–°å¢)
- [ ] å¤±è´¥é˜Ÿåˆ—å®ç°
- [ ] é‡è¯•ç­–ç•¥å®ç°
- [ ] **é…ç½®æ ¡éªŒå’Œå›æ»š** (æ–°å¢)

### Phase 4: å®Œå–„å’Œä¼˜åŒ– (5-7 å¤©)
- [ ] ç»ˆç«¯é…ç½®å‘½ä»¤å®Œå–„
- [ ] æ€§èƒ½ä¼˜åŒ–å’Œå‹åŠ›æµ‹è¯•
- [ ] ç›‘æ§å’Œç»Ÿè®¡
- [ ] **éƒ¨ç½²å’Œæ•…éšœæ’æŸ¥æ–‡æ¡£** (æ–°å¢)
- [ ] **uvx é›†æˆæµ‹è¯•** (å¿…éœ€)
- [ ] å…¨é¢æµ‹è¯• (è¦†ç›–ç‡ > 80%)

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®Œæ•´ä½¿ç”¨æµç¨‹

```bash
# 1. åˆå§‹åŒ–
uvx qcc init

# 2. åˆ›å»ºé…ç½®
uvx qcc add production --description "ç”Ÿäº§ç¯å¢ƒ"
uvx qcc add backup --description "å¤‡ç”¨ç¯å¢ƒ"

# 3. ä¸ºç”Ÿäº§é…ç½®æ·»åŠ å¤šä¸ª endpoint (ä»ç°æœ‰é…ç½®å¤ç”¨)
uvx qcc endpoint add production -f work      # ä» work é…ç½®å¤ç”¨
uvx qcc endpoint add production -f personal  # ä» personal é…ç½®å¤ç”¨

# 4. è®¾ç½®ä¼˜å…ˆçº§
uvx qcc priority set production primary
uvx qcc priority set backup secondary

# 5. é…ç½®æ•…éšœè½¬ç§»ç­–ç•¥
uvx qcc priority policy --auto-failover --auto-recovery

# 6. å¯åŠ¨ä»£ç†æœåŠ¡
uvx qcc proxy start
# âœ“ ä»£ç†æœåŠ¡å™¨å·²å¯åŠ¨: http://127.0.0.1:7860
# âœ“ æ•…éšœè½¬ç§»ç›‘æ§å·²å¯åŠ¨

# 7. æŸ¥çœ‹çŠ¶æ€
uvx qcc priority list
uvx qcc health status
uvx qcc queue status

# 8. é…ç½® Claude Code ä½¿ç”¨ä»£ç†
export ANTHROPIC_BASE_URL=http://127.0.0.1:7860
export ANTHROPIC_API_KEY=proxy-managed

# 9. å¯åŠ¨ Claude Code
claude
```

---

## ğŸ“Š æ ¸å¿ƒä¼˜åŠ¿

### 1. é«˜å¯ç”¨æ€§ ğŸ›¡ï¸
- ä¸‰çº§é…ç½®ä¼˜å…ˆçº§
- è‡ªåŠ¨æ•…éšœæ£€æµ‹å’Œè½¬ç§»
- å¤±è´¥è¯·æ±‚è‡ªåŠ¨é‡è¯•
- å¤š endpoint è´Ÿè½½å‡è¡¡

### 2. æ˜“ç”¨æ€§ â­
- **ä»ç°æœ‰é…ç½®å¿«é€Ÿå¤ç”¨**
- äº¤äº’å¼å‘½ä»¤è¡Œç•Œé¢
- æ¸…æ™°çš„çŠ¶æ€æ˜¾ç¤º
- è¯¦ç»†çš„æ—¥å¿—å’Œå†å²è®°å½•

### 3. çµæ´»æ€§ ğŸ”§
- å¤šç§è´Ÿè½½å‡è¡¡ç­–ç•¥
- å¯é…ç½®çš„åˆ‡æ¢ç­–ç•¥
- æ‰‹åŠ¨å’Œè‡ªåŠ¨åˆ‡æ¢
- æ”¯æŒè‡ªå®šä¹‰é€šçŸ¥

### 4. å¯é æ€§ ğŸ’ª
- å¥åº·çŠ¶æ€æŒä¹…åŒ–
- é˜Ÿåˆ—æŒä¹…åŒ–
- æ•…éšœå†å²è¿½è¸ª
- é¢‘ç‡é™åˆ¶ä¿æŠ¤

---

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•
- Endpoint æ¨¡å‹æµ‹è¯•
- Priority Manager æµ‹è¯•
- Failover Manager æµ‹è¯•
- Health Monitor æµ‹è¯•

### é›†æˆæµ‹è¯•
- ç«¯åˆ°ç«¯æ•…éšœè½¬ç§»æµ‹è¯•
- å¤š endpoint è´Ÿè½½å‡è¡¡æµ‹è¯•
- è‡ªåŠ¨æ¢å¤æµ‹è¯•
- é…ç½®å¤ç”¨æµ‹è¯•

### æ€§èƒ½æµ‹è¯•
- å¹¶å‘è¯·æ±‚æµ‹è¯•
- å“åº”æ—¶é—´æµ‹è¯•
- é•¿æ—¶é—´è¿è¡Œç¨³å®šæ€§æµ‹è¯•

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

- **ä»£ç†å»¶è¿Ÿ**: < 50ms
- **å¹¶å‘è¯·æ±‚**: > 100
- **æ•…éšœæ£€æµ‹**: < 60s
- **æ•…éšœè½¬ç§»æ—¶é—´**: < 5s
- **æµ‹è¯•è¦†ç›–ç‡**: > 80%

---

## ğŸ“ ç›¸å…³èµ„æº

- **ä¸»ä»“åº“**: https://github.com/lghguge520/qcc
- **æ–‡æ¡£**: ./claude-code-proxy-development-plan.md
- **Issues**: https://github.com/lghguge520/qcc/issues

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### 2025-10-16
- âœ… åˆ›å»ºä¸»å¼€å‘è®¡åˆ’æ–‡æ¡£
- âœ… æ·»åŠ  Endpoint é…ç½®å¤ç”¨åŠŸèƒ½è®¾è®¡
- âœ… æ·»åŠ è‡ªåŠ¨æ•…éšœè½¬ç§»æœºåˆ¶è®¾è®¡
- âœ… å®Œå–„ä½¿ç”¨ç¤ºä¾‹å’Œæµ‹è¯•ç”¨ä¾‹
- âœ… **å®ç°æ™ºèƒ½å¥åº·æ£€æµ‹ç³»ç»Ÿ** (4ä¸ªæ ¸å¿ƒæ¨¡å—)
  - âœ… å¥åº·æ£€æŸ¥æ•°æ®æ¨¡å‹ (health_check_models.py)
  - âœ… æ€§èƒ½æŒ‡æ ‡ç»Ÿè®¡ (performance_metrics.py)
  - âœ… åŠ¨æ€æƒé‡è°ƒæ•´å™¨ (weight_adjuster.py)
  - âœ… å¯¹è¯å¼å¥åº·æ£€æŸ¥å™¨ (conversational_checker.py)
- âœ… **å‡çº§å¥åº·ç›‘æ§å™¨** (health_monitor.py)
- âœ… **æ·»åŠ  health CLI å‘½ä»¤ç»„**
- âœ… **ç¼–å†™ 20 ä¸ªæµ‹è¯•ç”¨ä¾‹** (100% é€šè¿‡)
- âœ… **åˆ›å»ºæ¼”ç¤ºè„šæœ¬å’Œå®ç°æŠ¥å‘Š**

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2025-10-16
**ç»´æŠ¤è€…**: QCC Development Team
