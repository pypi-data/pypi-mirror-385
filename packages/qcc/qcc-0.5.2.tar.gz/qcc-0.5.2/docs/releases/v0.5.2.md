# QCC v0.5.2 发布说明

**发布日期**: 2025-10-18
**类型**: Bug 修复版本
**重要性**: 🔴 关键更新（v0.5.1 用户必须升级）

## 🐛 Bug 修复

###修复生产模式 Web UI 启动逻辑

这是一个**关键bug修复**，解决了 v0.5.1 中生产模式仍然无法正确启动 Web UI 的问题。

#### 问题描述

**症状**:
```bash
uvx qcc web start

❌ 前端目录不存在，请确认项目结构
已尝试查找位置:
  - /path/to/qcc-web
  - /Users/xxx/.claude/qcc-web
```

**根本原因**:
- v0.5.1 虽然修复了静态文件打包问题，但 CLI 代码仍在查找 `qcc-web` 开发目录
- 生产模式的启动逻辑没有适配新的静态文件位置
- 代码试图查找并构建前端，而不是直接使用已打包的静态文件

**影响范围**:
- v0.5.1 版本通过 `uvx` 或 `pip` 安装后，生产模式无法启动 Web UI
- 开发模式（`--dev`）不受影响

#### 修复方案

**文件**: `fastcc/cli.py`

**修改内容**:

1. **移除不必要的 qcc-web 目录查找**
   - 生产模式不再查找 `qcc-web` 开发目录
   - 直接使用打包在 `fastcc/web/static` 的静态文件

2. **简化启动流程**
   ```python
   # 修复前：查找开发目录，尝试构建
   possible_locations = [
       Path(__file__).parent.parent / 'qcc-web',
       Path.cwd() / 'qcc-web',
       ...
   ]
   # 检查 node_modules、运行 npm install、npm run build...

   # 修复后：直接检查打包的静态文件
   static_dir = Path(__file__).parent / 'web' / 'static'
   if not static_dir.exists():
       print_status("静态文件不存在，请检查包安装", "error")
       return
   ```

3. **改进错误提示**
   - 提供更清晰的错误信息
   - 区分开发环境和生产环境的使用方式

#### 验证

修复后，生产模式可以正常启动：

```bash
# 测试安装
uvx qcc web start

# 预期输出:
# ==================================================
# 🚀 QCC Web UI
# ==================================================
# ℹ️ 启动生产模式
# --------------------------------------------------
# ✅ 后端 API 服务器已启动
# ✅ 前端静态文件服务已就绪
#
# 🌐 访问地址:
#    http://127.0.0.1:8080
# 📚 API 文档:
#    http://127.0.0.1:8080/api/docs
# --------------------------------------------------
```

## 📝 详细修改

### 核心改动

#### `fastcc/cli.py` - 生产模式启动逻辑
- ❌ 移除: `qcc-web` 目录查找逻辑
- ❌ 移除: npm install 和 npm run build 步骤
- ✅ 新增: 直接检查 `fastcc/web/static` 目录
- ✅ 优化: 简化启动流程，提高启动速度

#### `fastcc/__init__.py`
- 版本号更新至 0.5.2

### 启动流程对比

**v0.5.1（错误）**:
1. 查找 `qcc-web` 开发目录
2. 检查 `node_modules`
3. 运行 `npm install`（如需要）
4. 运行 `npm run build`（如需要）
5. 启动后端服务器

**v0.5.2（正确）**:
1. 检查 `fastcc/web/static` 是否存在
2. 启动后端服务器（自动提供静态文件）

## 🔄 向后兼容性

✅ **完全兼容**:
- 所有 v0.5.0 和 v0.5.1 的功能保持不变
- 仅修复了启动逻辑
- 无需修改配置或数据

## 📦 升级方式

### 从 v0.5.0 或 v0.5.1 升级（必须）

```bash
# 使用 uvx（自动最新版）
uvx qcc web start
# 应该能正常启动

# 使用 pip
pip install --upgrade qcc
qcc web start
```

### 验证安装

```bash
# 1. 检查版本
python3 -c "import fastcc; print(fastcc.__version__)"
# 输出: 0.5.2

# 2. 启动 Web UI
uvx qcc web start

# 3. 在浏览器访问
# http://127.0.0.1:8080
```

## 🎯 受影响的功能

### 直接修复
- ✅ 生产模式启动功能
- ✅ Web UI 访问
- ✅ 静态文件服务

### 未受影响
- ✅ 开发模式（`--dev`）
- ✅ 代理服务器功能
- ✅ CLI 其他命令
- ✅ 配置管理

## 🚀 性能改进

- 🚀 生产模式启动速度显著提升
  - 无需查找目录
  - 无需安装依赖
  - 无需构建前端
  - 即时启动

## 💡 使用建议

### 生产环境
```bash
# 直接启动（推荐）
uvx qcc web start

# 或使用 pip 安装
pip install qcc
qcc web start
```

### 开发环境
```bash
# 克隆仓库后使用开发模式
git clone https://github.com/yxhpy/qcc.git
cd qcc
uvx --from . qcc web start --dev
```

## 📊 包大小

- **Wheel**: ~4.2 MB（与 v0.5.1 相同）
- **Source**: ~20.2 MB（与 v0.5.1 相同）

## 🙏 致谢

感谢用户反馈问题！

## 📅 后续计划

### v0.6.0（规划中）
- [ ] Web UI 功能增强
- [ ] 性能优化
- [ ] 用户认证
- [ ] 更多可视化功能

## 🔍 问题排查

### 如果仍然遇到问题

1. **清除缓存**
   ```bash
   rm -rf ~/.cache/uv
   ```

2. **重新安装**
   ```bash
   pip uninstall qcc -y
   pip install qcc
   ```

3. **检查版本**
   ```bash
   python3 -c "import fastcc; print(fastcc.__version__)"
   # 应该显示 0.5.2
   ```

---

**安装命令**:
```bash
uvx qcc web start
# 或
pip install --upgrade qcc
```

**完整文档**: [README.md](../../README.md)
