import{B as X,C as H,aq as G,ae as _,G as J,a as V,F as j,aB as re,K as Q,aw as oe,ad as T,as as L,r as W,O as D,av as Y,cW as ue,cv as ce,au as C,ap as ie,cC as ve,c4 as fe,D as de,a2 as me,ar as he,b as ge,a5 as F,H as pe,n as ye,J as Se,m as we,cX as Ve}from"./index-Bn2Tzsay.js";const Te=H({renderless:Boolean,...Q()},"VVirtualScrollItem"),Ie=X()({name:"VVirtualScrollItem",inheritAttrs:!1,props:Te(),emits:{"update:height":l=>!0},setup(l,a){let{attrs:v,emit:s,slots:n}=a;const{resizeRef:r,contentRect:c}=G(void 0,"border");_(()=>c.value?.height,g=>{g!=null&&s("update:height",g)}),J(()=>l.renderless?V(j,null,[n.default?.({itemRef:r})]):V("div",re({ref:r,class:["v-virtual-scroll__item",l.class],style:l.style},v),[n.default?.()]))}}),Re=-1,be=1,E=100,Oe=H({itemHeight:{type:[Number,String],default:null},itemKey:{type:[String,Array,Function],default:null},height:[Number,String]},"virtual");function Pe(l,a){const v=oe(),s=T(0);L(()=>{s.value=parseFloat(l.itemHeight||0)});const n=T(0),r=T(Math.ceil((parseInt(l.height)||v.height.value)/(s.value||16))||1),c=T(0),g=T(0),u=W(),m=W();let I=0;const{resizeRef:A,contentRect:O}=G();L(()=>{A.value=u.value});const y=D(()=>u.value===document.documentElement?v.height.value:O.value?.height||parseInt(l.height)||0),B=D(()=>!!(u.value&&m.value&&y.value&&s.value));let h=Array.from({length:a.value.length}),i=Array.from({length:a.value.length});const f=T(0);let P=-1;function Z(e){return h[e]||s.value}const k=ue(()=>{const e=performance.now();i[0]=0;const t=a.value.length;for(let o=1;o<=t-1;o++)i[o]=(i[o-1]||0)+Z(o-1);f.value=Math.max(f.value,performance.now()-e)},f),$=_(B,e=>{e&&($(),I=m.value.offsetTop,k.immediate(),S(),~P&&ie(()=>{ve&&window.requestAnimationFrame(()=>{K(P),P=-1})}))});Y(()=>{k.clear()});function ee(e,t){const o=h[e],d=s.value;s.value=d?Math.min(s.value,t):t,(o!==t||d!==s.value)&&(h[e]=t,k())}function p(e){e=C(e,0,a.value.length-1);const t=Math.floor(e),o=e%1,d=t+1,b=i[t]||0,w=i[d]||b;return b+(w-b)*o}function N(e){return ke(i,e)}let x=0,R=0,M=0;_(y,(e,t)=>{t&&(S(),e<t&&requestAnimationFrame(()=>{R=0,S()}))});let z=-1;function te(){if(!u.value||!m.value)return;const e=u.value.scrollTop,t=performance.now();t-M>500?(R=Math.sign(e-x),I=m.value.offsetTop):R=e-x,x=e,M=t,window.clearTimeout(z),z=window.setTimeout(q,500),S()}function q(){!u.value||!m.value||(R=0,M=0,window.clearTimeout(z),S())}let U=-1;function S(){cancelAnimationFrame(U),U=requestAnimationFrame(le)}function le(){if(!u.value||!y.value||!s.value)return;const e=x-I,t=Math.sign(R),o=Math.max(0,e-E),d=C(N(o),0,a.value.length),b=e+y.value+E,w=C(N(b)+1,d+1,a.value.length);if((t!==Re||d<n.value)&&(t!==be||w>r.value)){const ne=p(n.value)-p(d),se=p(w)-p(r.value);Math.max(ne,se)>E?(n.value=d,r.value=w):(d<=0&&(n.value=d),w>=a.value.length&&(r.value=w))}c.value=p(n.value),g.value=p(a.value.length)-p(r.value)}function K(e){const t=p(e);!u.value||e&&!t?P=e:u.value.scrollTop=t}const ae=D(()=>a.value.slice(n.value,r.value).map((e,t)=>{const o=t+n.value;return{raw:e,index:o,key:ce(e,l.itemKey,o)}}));return _(a,()=>{h=Array.from({length:a.value.length}),i=Array.from({length:a.value.length}),k.immediate(),S()},{deep:1}),{calculateVisibleItems:S,containerRef:u,markerRef:m,computedItems:ae,paddingTop:c,paddingBottom:g,scrollToIndex:K,handleScroll:te,handleScrollend:q,handleItemResize:ee}}function ke(l,a){let v=l.length-1,s=0,n=0,r=null,c=-1;if(l[v]<a)return v;for(;s<=v;)if(n=s+v>>1,r=l[n],r>a)v=n-1;else if(r<a)c=n,s=n+1;else return r===a?n:s;return c}const xe=H({items:{type:Array,default:()=>[]},renderless:Boolean,...Oe(),...Q(),...Se()},"VVirtualScroll"),Ae=X()({name:"VVirtualScroll",props:xe(),setup(l,a){let{slots:v}=a;const s=fe("VVirtualScroll"),{dimensionStyles:n}=de(l),{calculateVisibleItems:r,containerRef:c,markerRef:g,handleScroll:u,handleScrollend:m,handleItemResize:I,scrollToIndex:A,paddingTop:O,paddingBottom:y,computedItems:B}=Pe(l,me(()=>l.items));return he(()=>l.renderless,()=>{function h(){const f=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1)?"addEventListener":"removeEventListener";c.value===document.documentElement?(document[f]("scroll",u,{passive:!0}),document[f]("scrollend",m)):(c.value?.[f]("scroll",u,{passive:!0}),c.value?.[f]("scrollend",m))}we(()=>{c.value=Ve(s.vnode.el,!0),h(!0)}),Y(h)}),J(()=>{const h=B.value.map(i=>ge(Ie,{key:i.key,renderless:l.renderless,"onUpdate:height":f=>I(i.index,f)},{default:f=>v.default?.({item:i.raw,index:i.index,...f})}));return l.renderless?V(j,null,[V("div",{ref:g,class:"v-virtual-scroll__spacer",style:{paddingTop:F(O.value)}},null),h,V("div",{class:"v-virtual-scroll__spacer",style:{paddingBottom:F(y.value)}},null)]):V("div",{ref:c,class:ye(["v-virtual-scroll",l.class]),onScrollPassive:u,onScrollend:m,style:pe([n.value,l.style])},[V("div",{ref:g,class:"v-virtual-scroll__container",style:{paddingTop:F(O.value),paddingBottom:F(y.value)}},[h])])}),{calculateVisibleItems:r,scrollToIndex:A}}});export{Ae as V};
