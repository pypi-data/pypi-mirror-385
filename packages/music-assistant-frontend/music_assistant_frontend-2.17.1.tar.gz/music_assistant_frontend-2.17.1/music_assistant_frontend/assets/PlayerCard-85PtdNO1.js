import{r as V,O as B,ae as J,h,o as i,i as ee,g as Z,w as m,aR as ae,aB as le,b1 as C,d as Q,l as te,e as g,c as p,V as $,H as D,u as s,b9 as k,b as _,j as S,a as R,t as v,ba as F,b5 as O,v as d,bg as I,y as oe,F as ie,bf as se,aU as G,aV as P,aT as T,s as M,$ as ne,bb as Y,b2 as j,b3 as re,a_ as ue,bh as de,x as me,n as ce,aX as N,M as pe,be as ye,b7 as ve,bl as be,aG as fe,p as ge,bi as H,bj as X}from"./index-Bn2Tzsay.js";import{B as E}from"./Button-r9Wpw3CQ.js";import{M as he}from"./MediaItemThumb-B7hfZSf2.js";import{_ as W}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as _e}from"./VSlider-DnweLLtQ.js";import{V as we}from"./NowPlayingBadge.vue_vue_type_style_index_0_lang-DCLVCnPO.js";const ke={inheritAttrs:!1,props:{width:String,height:String,style:String,allowWheel:Boolean},emits:["update:model-value"],setup(e,t){const n=V(null),l=V(0),f=V(0),o=V(0),c=V(typeof t.attrs["model-value"]=="number"?t.attrs["model-value"]:0),b=B(()=>({class:"player-volume",hideDetails:!0,trackSize:2,thumbSize:12,step:2,elevation:0,style:`width: ${e.width}; height:${e.height}; display: inline-grid; ${e.style}`})),r=B(()=>{const w=t.attrs,{"model-value":A,modelValue:U,...z}=w||{};return z}),u=B(()=>({...b.value,...r.value})),a=({deltaY:w})=>{if(!e.allowWheel)return;const A=u.value.step,U=t.attrs["model-value"]??c.value,z=w<0?A:-A,q=Math.max(0,Math.min(100,U+z));c.value=q,t.emit("update:model-value",q)},y=w=>{l.value=w,f.value=0,c.value=w},L=w=>{f.value++,f.value>2&&(c.value=w)},x=w=>{const A=Date.now();if(A-o.value<250)return;o.value=A;const U=u.value.step;if(f.value>3)c.value=w,t.emit("update:model-value",w);else{const z=w>l.value?U:-U,q=Math.max(0,Math.min(100,l.value+z));c.value=q,t.emit("update:model-value",q)}f.value=0};return J(()=>t.attrs["model-value"],w=>{typeof w=="number"&&f.value===0&&(c.value=w)}),{playerVolumeProps:u,onWheel:a,sliderRef:n,onDragStart:y,onUpdateModelValue:L,onDragEnd:x,displayValue:c}}};function Ce(e,t,n,l,f,o){return i(),h(_e,le({ref:"sliderRef"},l.playerVolumeProps,{"model-value":l.displayValue,onWheel:C(l.onWheel,["prevent"]),onClick:t[0]||(t[0]=C(()=>{},["stop"])),onStart:l.onDragStart,"onUpdate:modelValue":l.onUpdateModelValue,onEnd:l.onDragEnd}),ee({_:2},[Z(e.$slots,(c,b)=>({name:b,fn:m(()=>[ae(e.$slots,b,{},void 0,!0)])}))]),1040,["model-value","onWheel","onStart","onUpdate:modelValue","onEnd"])}const K=W(ke,[["render",Ce],["__scopeId","data-v-8caff868"]]),Se={key:1,class:"text-caption volumecaption"},Ve={key:0,class:"text-caption volumecaption"},Me=Q({__name:"VolumeControl",props:{player:{},showSyncControls:{type:Boolean},showSubPlayers:{type:Boolean},showHeadingRow:{type:Boolean},showVolumeControl:{type:Boolean},allowWheel:{type:Boolean}},setup(e){const t=e,n=V([]),l=V([]),f=V(void 0),o=B(()=>t.player.group_members.length>0),c=function(r){const u=[];for(const a of r.group_members){const y=d?.players[a];y&&y.volume_control!=k&&y&&y.available&&!u.includes(y)&&u.push(y)}if(t.showSyncControls&&r.supported_features.includes(G.SET_MEMBERS))for(const a of Object.values(d?.players))a.player_id!=r.player_id&&(!r.can_group_with.includes(a.player_id)&&!r.can_group_with.includes(a.provider)||a.available&&a.type!=I.GROUP&&(a.active_group&&a.active_group!=r.player_id||a.active_source&&a.playback_state==P.PLAYING&&![r.player_id,a.player_id].includes(a.active_source)||u.includes(a)||u.push(a)));return u.sort((a,y)=>{const L=r.group_members.includes(a.player_id),x=r.group_members.includes(y.player_id);return L!==x?L?-1:1:a.name.toUpperCase()>y.name.toUpperCase()?1:-1}),u},b=async function(r,u){const a=t.player.player_id;u?(l.value.includes(r)&&(l.value=l.value.filter(y=>y!=r)),n.value.includes(r)||n.value.push(r),d.players[a].group_members.push(r)):(n.value.includes(r)&&(n.value=n.value.filter(y=>y!=r)),l.value.includes(r)||l.value.push(r),d.players[a].group_members=d.players[a].group_members.filter(y=>y!=r)),f.value!=null&&clearTimeout(f.value),!(n.value.length==0&&l.value.length==0)&&(f.value=setTimeout(async()=>{d.playerCommandSetMembers(a,n.value.length?n.value:void 0,l.value.length?l.value:void 0).catch(async()=>{d.players[a]=await d.getPlayer(a)}).finally(()=>{n.value=[],l.value=[]})},500))};return(r,u)=>(i(),h(te,{style:{overflow:"hidden",padding:"0"},lines:"two"},{default:m(()=>[e.showHeadingRow?(i(),h($,{key:0,class:"volumesliderrow heading",link:!1,style:D(e.player.powered==!1?"opacity: 0.6":"opacity: 1")},{prepend:m(()=>[_(S,{size:25,icon:e.player.icon,style:{"margin-left":"6px",opacity:"0.6"}},null,8,["icon"])]),default:m(()=>[R("h5",null,v(s(F)(e.player,27)),1)]),append:m(()=>[e.player.power_control!=s(k)?(i(),h(E,{key:0,class:"powerbtn",variant:"icon",onClick:u[0]||(u[0]=C(a=>s(d).playerCommandPowerToggle(e.player.player_id),["stop"]))},{default:m(()=>[_(S,{size:25,icon:"mdi-power"})]),_:1})):g("",!0)]),_:1},8,["style"])):g("",!0),e.showVolumeControl&&(e.player.volume_control!=s(k)||e.player.group_members.length)?(i(),h($,{key:1,class:"volumesliderrow",link:!1,style:D(e.player.powered==!1?"opacity: 0.35":"opacity: 0.75")},{prepend:m(()=>[_(E,{icon:"",style:{height:"25px"},disabled:e.player.type==s(I).GROUP||e.player.group_members.length>0||e.player.mute_control==s(k),onClick:u[1]||(u[1]=C(a=>s(d).playerCommandMuteToggle(e.player.player_id),["stop"]))},{default:m(()=>[_(S,{size:25,icon:e.player.volume_muted?"mdi-volume-mute":"mdi-volume-medium"},null,8,["icon"])]),_:1},8,["disabled"])]),default:m(()=>[e.player.volume_control!=s(k)||e.player.group_members.length?(i(),h(K,{key:0,color:"secondary",width:"100%","is-powered":e.player.powered!=!1,disabled:!e.player.available,"model-value":Math.round(e.player.group_members.length?e.player.group_volume:e.player.volume_level||0),onClick:u[2]||(u[2]=C(()=>{},["stop"])),"onUpdate:modelValue":u[3]||(u[3]=a=>e.player.group_members.length>0?s(d).playerCommandGroupVolume(e.player.player_id,a):s(d).playerCommandVolumeSet(e.player.player_id,a))},null,8,["is-powered","disabled","model-value"])):g("",!0)]),append:m(()=>[o.value&&!e.showSubPlayers?(i(),h(S,{key:0,class:"expandbtn"},{default:m(()=>[...u[7]||(u[7]=[O(" mdi-chevron-down ",-1)])]),_:1})):(i(),p("div",Se,v(Math.round(e.player.group_members.length?e.player.group_volume:e.player.volume_level||0)),1))]),_:1},8,["style"])):g("",!0),e.showSubPlayers&&(e.player.group_members.length>0||e.showSyncControls)&&c(e.player).length>0?(i(),p("div",{key:2,onClick:u[6]||(u[6]=C(()=>{},["stop"]))},[_(oe,{style:{"margin-top":"10px","margin-bottom":"15px"}}),(i(!0),p(ie,null,Z(c(e.player),a=>(i(),p("div",{key:a.player_id},[_($,{class:"volumesliderrow",link:!1,style:D(a.powered!=!1||e.showSyncControls?"opacity: 0.75":"opacity: 0.4"),onClick:u[4]||(u[4]=C(()=>{},["stop"]))},{prepend:m(()=>[_(S,{size:30,icon:a.icon,style:{"margin-left":"6px",opacity:"0.6"}},null,8,["icon"])]),default:m(()=>[R("h6",null,v(s(se)(a.name,27)),1)]),append:m(()=>[e.showSyncControls?(i(),h(we,{key:0,ripple:!1,disabled:a.player_id==e.player.player_id||e.player.static_group_members.includes(a.player_id)&&e.player.group_members.includes(a.player_id),"model-value":e.player.group_members.includes(a.player_id)||a.player_id==e.player.player_id,size:"22",class:"checkbox","onUpdate:modelValue":y=>b(a.player_id,y)},null,8,["disabled","model-value","onUpdate:modelValue"])):g("",!0)]),_:2},1032,["style"]),a.volume_control!=s(k)&&e.player.group_members.includes(a.player_id)?(i(),h($,{key:0,class:"volumesliderrow",link:!1,style:D(a.powered==!1?"opacity: 0.4":"opacity: 0.75"),onClick:u[5]||(u[5]=C(()=>{},["stop"]))},{prepend:m(()=>[_(E,{icon:"",disabled:!a.available||a.mute_control==s(k),style:{height:"25px"},onClick:y=>s(d).playerCommandMuteToggle(a.player_id)},{default:m(()=>[_(S,{size:25,icon:a.volume_muted?"mdi-volume-mute":"mdi-volume-medium"},null,8,["icon"])]),_:2},1032,["disabled","onClick"])]),default:m(()=>[a.volume_control!=s(k)?(i(),h(K,{key:0,color:"secondary",width:"100%","is-powered":a.powered!=!1,disabled:!a.available,"allow-wheel":e.allowWheel,"model-value":Math.round(a.volume_level||0),"onUpdate:modelValue":y=>s(d).playerCommandVolumeSet(a.player_id,y)},null,8,["is-powered","disabled","allow-wheel","model-value","onUpdate:modelValue"])):g("",!0)]),append:m(()=>[a.volume_control!=s(k)?(i(),p("div",Ve,v(a.volume_level),1)):g("",!0)]),_:2},1032,["style"])):g("",!0),u[8]||(u[8]=R("div",{style:{height:"14px"}},null,-1))]))),128))])):g("",!0)]),_:1}))}}),Ae=W(Me,[["__scopeId","data-v-de3acd87"]]),Te=(e,t)=>{const n=[];e?.power_control!=k&&n.push({label:e.powered?"power_off_player":"power_on_player",labelArgs:[],action:()=>{d.playerCommandPowerToggle(e.player_id)},icon:"mdi-power"}),(e?.playback_state=="playing"||e?.playback_state=="paused")&&n.push({label:"stop_playback",labelArgs:[],action:()=>{d.playerCommandStop(e.player_id)},icon:"mdi-stop"});const l=Object.values(d.players).filter(o=>o.player_id!=e.player_id&&o.available&&o.enabled&&(o.can_group_with.includes(e.provider)||o.can_group_with.includes(e.player_id))&&o.supported_features.includes(G.SET_MEMBERS)&&!o.synced_to);e.supported_features.includes(G.SET_MEMBERS)&&!e.synced_to&&e.type==I.PLAYER&&e.group_members.length==0&&l.length>0&&n.push({label:"sync_player_with",labelArgs:[],icon:"mdi-link-variant",subItems:l.map(o=>({label:o.name,labelArgs:[],action:()=>{d.playerCommandGroup(e.player_id,o.player_id)}})).sort((o,c)=>o.label.toUpperCase()>c.label?.toUpperCase()?1:-1)}),t&&n.push({label:t.shuffle_enabled?"shuffle_disable":"shuffle_enable",labelArgs:[],action:()=>{d.queueCommandShuffleToggle(t.queue_id)},icon:t.shuffle_enabled?"mdi-shuffle-disabled":"mdi-shuffle"}),t&&n.push({label:"select_repeat_mode",labelArgs:[],subItems:[{label:"repeat_mode.off",labelArgs:[],action:()=>{d.queueCommandRepeat(t.queue_id,T.OFF)},selected:t.repeat_mode==T.OFF},{label:"repeat_mode.all",labelArgs:[],action:()=>{d.queueCommandRepeat(t.queue_id,T.ALL)},selected:t.repeat_mode==T.ALL},{label:"repeat_mode.one",labelArgs:[],action:()=>{d.queueCommandRepeat(t.queue_id,T.ONE)},selected:t.repeat_mode==T.ONE}],icon:"mdi-repeat"}),t?.items&&n.push({label:"transfer_queue",icon:"mdi-swap-horizontal",subItems:Object.values(d.players).filter(o=>o.player_id!=t.queue_id&&o.player_id!=e.player_id&&o.available&&o.enabled&&!o.synced_to).map(o=>({label:o.name,labelArgs:[],action:()=>{d.queueCommandTransfer(t.queue_id,o.player_id),M.activePlayerId=o.player_id}})).sort((o,c)=>o.label.toUpperCase()>c.label?.toUpperCase()?1:-1)}),t?.items&&n.push({label:"queue_clear",labelArgs:[],action:()=>{d.queueCommandClear(t.queue_id)},icon:"mdi-cancel"});const f=e.source_list.filter(o=>!o.passive||o.id==e.active_source);return e.active_source!=e.player_id&&f.push({id:e.player_id,name:ne("music_assistant_source"),passive:!1,can_play_pause:!0,can_seek:!0,can_next_previous:!0}),!e.synced_to&&f.length>0&&n.push({label:"select_source",labelArgs:[],icon:"mdi-import",subItems:f.map(o=>({label:o.name,labelArgs:[],disabled:o.id==e.active_source,selected:o.id==e.active_source,action:()=>{d.playerCommandGroupSelectSource(e.player_id,o.id)}})).sort((o,c)=>o.label.toUpperCase()>c.label?.toUpperCase()?1:-1)}),t&&"dont_stop_the_music_enabled"in t&&n.push({label:t.dont_stop_the_music_enabled?"dont_stop_the_music_disable":"dont_stop_the_music_enable",labelArgs:[],action:()=>{d.queueCommandDontStopTheMusicToggle(t.queue_id)},icon:"mdi-all-inclusive"}),n.push({label:"open_player_settings",labelArgs:[],action:()=>{M.showFullscreenPlayer=!1,M.showPlayersMenu=!1,Y.push(`/settings/editplayer/${e.player_id}`)},icon:"mdi-cog-outline"}),e.type!==I.GROUP&&n.push({label:"open_dsp_settings",labelArgs:[],action:()=>{M.showFullscreenPlayer=!1,M.showPlayersMenu=!1,Y.push(`/settings/editplayer/${e.player_id}/dsp`)},icon:"mdi-equalizer"}),n},Be={class:"player-media-thumb"},Ee={key:1},Ue={key:2,class:"icon-thumb"},ze={key:0,style:{"margin-bottom":"3px"}},qe={key:0},$e={key:1},Pe={key:1},Re={key:0,style:{"font-size":"0.85rem","font-weight":"500","white-space":"nowrap"}},Ie={key:0},Le={key:0},De={key:1},Oe={key:2},xe={class:"v-list-item-subtitle",style:{"font-size":"0.85rem","white-space":"nowrap"}},Ne={key:0},Fe={key:1},Ge={key:2},We={key:3},Ye={key:4},je={key:5},He={key:6},Xe={key:7},Ke=Q({__name:"PlayerCard",props:{player:{},showVolumeControl:{type:Boolean},showMenuButton:{type:Boolean},showSubPlayers:{type:Boolean},showSyncControls:{type:Boolean},allowPowerControl:{type:Boolean}},emits:["click"],setup(e){const t=e,n=B(()=>{if(t.player&&t.player.active_source&&t.player.active_source in d.queues)return d.queues[t.player.active_source];if(t.player&&!t.player.active_source&&t.player.player_id in d.queues)return d.queues[t.player.player_id]}),l=B(()=>{if(n.value&&n.value.active)return n.value.current_item}),f=function(b){ge.emit("contextmenu",{items:Te(t.player,n.value),posX:b.clientX,posY:b.clientY})},o=V({0:"",1:"",2:"",3:"",4:"",5:"",lightColor:"",darkColor:""}),c=new Image;return c.src=ue.theme.current.value.dark?j:re,c.crossOrigin="Anonymous",c.addEventListener("load",function(){o.value=de(c)}),J(l,b=>{b?.media_item?c.src=H(b.media_item,X.THUMB)||"":b?c.src=H(b,X.THUMB)||"":c.src=""},{immediate:!0}),(b,r)=>(i(),h(me,{flat:"",class:ce(["panel-item",{"panel-item-selected":e.player.player_id==s(M).activePlayerId,"panel-item-idle":e.player.playback_state==s(P).IDLE,"panel-item-off":e.player.powered==!1}]),ripple:!1,disabled:!e.player.available,onClick:r[2]||(r[2]=u=>b.$emit("click",e.player))},{default:m(()=>[_($,{class:"panel-item-details",flat:"",ripple:!1},{prepend:m(()=>[R("div",Be,[e.player.powered!=!1&&l.value?(i(),h(he,{key:0,class:"media-thumb",size:"60",item:l.value,fallback:s(j)},null,8,["item","fallback"])):e.player.powered!=!1&&!n.value&&e.player.current_media?.image_url?(i(),p("div",Ee,[_(fe,{class:"media-thumb",size:"60",src:e.player.current_media.image_url},null,8,["src"])])):(i(),p("div",Ue,[_(S,{size:"24",icon:e.player.type==s(I).PLAYER&&e.player.group_members.length?"mdi-speaker-multiple":e.player.icon,style:{display:"table-cell",opacity:"0.8"}},null,8,["icon"])]))])]),title:m(()=>[s(be).player_id===e.player.player_id?(i(),p("div",ze,[e.player.name=="This Device"?(i(),p("span",qe,v(b.$t("this_device")),1)):(i(),p("span",$e,v(s(F)(e.player,27)),1)),_(S,{size:"20",class:"ml-2",icon:s(M).deviceType=="phone"?"mdi-cellphone":"mdi-monitor"},null,8,["icon"])])):(i(),p("div",Pe,v(s(F)(e.player,27)),1))]),subtitle:m(()=>[e.player.powered!=!1?(i(),p("div",Re,[l.value?.media_item?(i(),p("div",Ie,[O(v(l.value?.media_item.name)+" ",1),"version"in l.value?.media_item&&l.value?.media_item.version?(i(),p("span",Le,"("+v(l.value?.media_item.version)+")",1)):g("",!0)])):l.value?(i(),p("div",De,v(l.value?.name),1)):!n.value&&e.player.current_media?.title?(i(),p("div",Oe,v(e.player.current_media.title),1)):g("",!0)])):g("",!0)]),default:m(()=>[R("div",xe,[e.player.powered==!1?(i(),p("div",Ne,v(b.$t("off")),1)):l.value?.media_item&&l.value?.media_item?.media_type==s(pe).TRACK&&"album"in l.value?.media_item&&l.value?.media_item.album?(i(),p("div",Fe,v(s(ye)(l.value?.media_item.artists))+" • "+v(l.value?.media_item.album.name),1)):l.value?.media_item&&"artists"in l.value?.media_item&&l.value?.media_item.artists.length>0?(i(),p("div",Ge,v(l.value?.media_item.artists[0].name),1)):l.value?.streamdetails?.stream_metadata&&l.value?.streamdetails?.stream_metadata.title&&l.value?.streamdetails?.stream_metadata.artist?(i(),p("div",We,v(l.value?.streamdetails?.stream_metadata.artist)+" - "+v(l.value?.streamdetails?.stream_metadata.title),1)):l.value?.streamdetails?.stream_metadata&&l.value?.streamdetails?.stream_metadata.title?(i(),p("div",Ye,v(l.value?.streamdetails?.stream_metadata.title),1)):l.value?.media_item?.metadata.description?(i(),p("div",je,v(l.value?.media_item.metadata.description),1)):!n.value&&e.player.active_source?(i(),p("div",He,v(b.$t("external_source_active",[s(ve)(e.player)])),1)):n.value?.items==0?(i(),p("div",Xe,v(b.$t("queue_empty")),1)):g("",!0)])]),append:m(()=>[e.player.playback_state==s(P).PAUSED||e.player.playback_state==s(P).PLAYING||n.value?.items?(i(),h(E,{key:0,variant:"icon",class:"player-command-btn",onClick:r[0]||(r[0]=C(u=>{s(d).playerCommandPlayPause(e.player.player_id),s(M).activePlayerId=e.player.player_id},["stop"]))},{default:m(()=>[_(S,{size:s(N)({breakpoint:"phone"})?"30":"32",icon:e.player.playback_state==s(P).PLAYING?"mdi-pause":"mdi-play"},null,8,["size","icon"])]),_:1})):g("",!0),e.player.power_control!=s(k)&&e.allowPowerControl?(i(),h(E,{key:1,variant:"icon",class:"player-command-btn",onClick:r[1]||(r[1]=C(u=>{s(d).playerCommandPowerToggle(e.player.player_id),s(M).activePlayerId=e.player.player_id},["stop"]))},{default:m(()=>[_(S,{size:s(N)({breakpoint:"phone"})?"30":"32"},{default:m(()=>[...r[3]||(r[3]=[O("mdi-power",-1)])]),_:1},8,["size"])]),_:1})):g("",!0),e.showMenuButton?(i(),h(E,{key:2,variant:"icon",class:"player-command-btn",style:{"margin-right":"-5px"},onClick:C(f,["stop"])},{default:m(()=>[_(S,{size:s(N)({breakpoint:"phone"})?"30":"32"},{default:m(()=>[...r[4]||(r[4]=[O("mdi-dots-vertical",-1)])]),_:1},8,["size"])]),_:1})):g("",!0)]),_:1}),e.showVolumeControl?(i(),h(Ae,{key:0,player:e.player,"show-sync-controls":e.showSyncControls,"show-heading-row":!1,"show-sub-players":e.showSubPlayers,"show-volume-control":e.player.powered!=!1,"allow-wheel":!1},null,8,["player","show-sync-controls","show-sub-players","show-volume-control"])):g("",!0)]),_:1},8,["class","disabled"]))}}),ta=W(Ke,[["__scopeId","data-v-f0fdac10"]]);export{K as P,Ae as V,ta as a,Te as g};
