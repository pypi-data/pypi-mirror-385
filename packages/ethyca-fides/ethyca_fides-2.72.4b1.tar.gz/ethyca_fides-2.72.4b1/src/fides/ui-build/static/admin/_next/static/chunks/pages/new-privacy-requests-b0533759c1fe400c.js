(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9609,9676],{89987:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/new-privacy-requests",function(){return r(37776)}])},45259:function(e,t,r){"use strict";var s=r(24246),l=r(20595);let i={approved:{color:"success",label:"Approved"},complete:{color:"success",label:"Completed"},awaiting_email_send:{color:"marble",label:"Awaiting Email Send"},denied:{color:"warning",label:"Denied"},canceled:{color:"marble",label:"Canceled"},error:{color:"error",label:"Error"},in_processing:{color:"caution",label:"In Progress"},paused:{color:"marble",label:"Paused"},pending:{color:"info",label:"New"},identity_unverified:{color:"marble",label:"Unverified"},requires_input:{color:"minos",label:"Requires Input"},requires_manual_finalization:{color:"minos",label:"Requires Finalization"}};t.Z=e=>{let{status:t}=e;return(0,s.jsx)(l.j8w,{color:i[t].color,className:"justify-center","data-testid":"request-status-badge",children:i[t].label})}},59676:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return y}});var s=r(24246),l=r(20595),i=r(16134),n=r(27378),a=r(812),o=r(17245),c=r(90867);let d=(0,l.Gpc)((e,t)=>{let{handleBlur:r,subjectRequest:d}=e,u=(0,i.T)(),[x,h]=(0,n.useState)(!1),{errorAlert:m,successAlert:p}=(0,o.VY)(),{errorRequests:j}=(0,i.C)(c.fe),[f]=(0,c.JD)(),[y]=(0,c.Fq)(),g=async()=>{h(!0);let e=await f(j);(0,a.D4)(e)?(u((0,c.uT)({checkAll:!1,errorRequests:[]})),m((0,a.e$)(e.error),"DSR batch automation has failed due to the following:",{duration:null})):(e.data.failed.length>0&&m((0,s.jsxs)(l.xuv,{children:["DSR automation has failed for"," ",(0,s.jsx)(l.xvT,{as:"span",fontWeight:"semibold",children:e.data.failed.length})," ","privacy request(s). Please review the event log for further details."]}),void 0,{containerStyle:{maxWidth:"max-content"},duration:null}),e.data.succeeded.length>0&&p("Privacy request(s) are now being reprocessed.")),h(!1)},v=async()=>{if(!d)return;h(!0);let e=await y(d);(0,a.D4)(e)?m((0,a.e$)(e.error),"DSR automation has failed for this privacy request due to the following:",{duration:null}):p("Privacy request is now being reprocessed."),h(!1),r&&r(t)};return(0,s.jsx)(l.wpx,{disabled:x,loading:x,onClick:d?v:g,ref:t,size:"small",icon:(0,s.jsx)(l.AyE,{}),children:"Reprocess"})});var u=r(34090),x=r(55484);let h=/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i,m=e=>h.test(e),p=(0,l.Gpc)((e,t)=>{let{isRequired:r=!1,...i}=e,{emails:a}=i.form.values,[o,c]=(0,n.useState)(""),d=e=>a.includes(e),u=e=>{e.map(e=>e.trim()).filter(e=>m(e)&&!d(e)).forEach(e=>i.push(e)),c("")};return(0,s.jsxs)(l.NIc,{alignItems:"baseline",display:"inline-flex",isInvalid:!!i.form.errors[i.name],isRequired:r,children:[(0,s.jsx)(l.lXp,{fontSize:"md",htmlFor:"email",children:"Email"}),(0,s.jsxs)(l.gCW,{align:"flex-start",w:"inherit",children:[(0,s.jsx)(l.IIB,{autoComplete:"off",placeholder:"Type or paste email addresses separated by commas and press `Enter` or `Tab`...",onChange:e=>{c(e.target.value)},onKeyDown:e=>{["Enter","Tab",","].includes(e.key)&&(e.preventDefault(),u([o]))},onPaste:e=>{e.preventDefault(),u(e.clipboardData.getData("text").split(","))},ref:t,size:"sm",type:"email",value:o}),(0,s.jsx)(l.J1D,{children:i.form.errors[i.name]}),a.length>0&&(0,s.jsx)(l.Eq9,{spacing:1,mb:3,pt:"8px",children:a.map((e,t)=>(0,s.jsxs)(l.Vp9,{borderRadius:"full",backgroundColor:"primary.400",color:"white",size:"sm",variant:"solid",children:[(0,s.jsx)(l.Sn0,{children:e}),(0,s.jsx)(l.SD9,{onClick:()=>{i.remove(t)}})]},e))})]})]})}),j=x.Ry().shape({emails:x.IX(x.Z_()).when(["notify"],{is:!0,then:()=>x.IX(x.Z_()).min(1,"Must enter at least one valid email").label("Email")}),notify:x.O7(),minErrorCount:x.Rx().required()});var f=()=>{let{isOpen:e,onOpen:t,onClose:r}=(0,l.qY0)(),[i,d]=(0,n.useState)({emails:[],notify:!1,minErrorCount:1}),x=(0,n.useRef)(null),{errorAlert:h,successAlert:m}=(0,o.VY)(),[f,y]=(0,n.useState)(!0),{data:g}=(0,c.tE)(void 0,{skip:f}),[v]=(0,c.SC)(),E=async(e,t)=>{t.setSubmitting(!0);let s=await v({email_addresses:e.emails,notify_after_failures:e.notify?e.minErrorCount:0});(0,a.D4)(s)?h((0,a.e$)(s.error),"Configure alerts and notifications has failed to save due to the following:"):m("Configure alerts and notifications saved successfully."),t.setSubmitting(!1),r()};return(0,n.useEffect)(()=>{e&&y(!1),g&&d({emails:g.email_addresses,notify:0!==g.notify_after_failures,minErrorCount:g.notify_after_failures})},[g,e]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l.wpx,{onClick:t,title:"Configure alerts","aria-label":"Configure alerts",icon:(0,s.jsx)(l.Dkj,{})}),(0,s.jsx)(u.J9,{enableReinitialize:!0,initialValues:i,onSubmit:E,validationSchema:j,children:t=>(0,s.jsxs)(l.dys,{isOpen:e,placement:"right",initialFocusRef:x,onClose:()=>{t.resetForm(),r()},size:"lg",children:[(0,s.jsx)(l.P1B,{}),(0,s.jsxs)(l.scA,{color:"gray.900",children:[(0,s.jsx)(l.cCv,{}),(0,s.jsxs)(l.OXI,{color:"gray.900",children:[(0,s.jsx)(l.xvT,{fontSize:"2xl",fontWeight:"normal",mb:4,children:"Configure alerts and notifications"}),(0,s.jsx)(l.xuv,{mt:"26px",children:(0,s.jsx)(l.xvT,{fontSize:"md",fontWeight:"normal",children:"Setup your alerts to send you a notification when there are any processing failures. You can also setup a threshold for connector failures for Fides to notify you after X amount of failures have occurred."})})]}),(0,s.jsx)(l.Ng0,{mt:"20px",children:(0,s.jsxs)(u.l0,{id:"configure-alerts-form",noValidate:!0,children:[(0,s.jsx)(l.xvT,{fontSize:"md",children:"Contact details"}),(0,s.jsxs)(l.gCW,{align:"stretch",gap:"29px",mt:"14px",children:[(0,s.jsx)(l.Ugi,{children:(0,s.jsx)(u.F2,{name:"emails",render:e=>(0,s.jsx)(p,{...e,isRequired:t.values.notify,ref:x})})}),(0,s.jsx)(l.Ugi,{children:(0,s.jsx)(u.gN,{id:"notify",name:"notify",children:e=>{let{field:r}=e;return(0,s.jsxs)(l.NIc,{alignItems:"center",display:"flex",mt:"45px",children:[(0,s.jsx)(l.lXp,{fontSize:"md",mb:"0",children:"Notify me immediately if there are any DSR processing errors"}),(0,s.jsx)(l.rAg,{checked:t.values.notify,onChange:(e,s)=>{r.onChange(s),t.setFieldValue(r.name,e),t.setFieldValue("minErrorCount",1),e||setTimeout(()=>{t.setFieldTouched("emails",!1)},0)}})]})}})})]}),(0,s.jsx)(l.xvT,{color:"#757575",fontSize:"sm",mt:"11px",children:"If selected, then Fides will notify you by your chosen method of communication every time the system encounters a data subject request processing error. You can turn this off anytime and setup a more suitable notification method below if you wish."}),t.values.notify&&(0,s.jsx)(l.Ugi,{mt:"34px",children:(0,s.jsx)(u.gN,{id:"minErrorCount",name:"minErrorCount",children:e=>{let{field:r,meta:i}=e;return(0,s.jsxs)(l.NIc,{alignItems:"center",display:"flex",isInvalid:!!(i.error&&i.touched),isRequired:!0,children:[(0,s.jsx)(l.xvT,{children:"Notify me after"}),(0,s.jsxs)(l.Y2U,{allowMouseWheel:!0,color:"gray.700",defaultValue:t.values.minErrorCount||1,min:1,ml:"8px",mr:"8px",onChange:(e,r)=>{t.setFieldValue("minErrorCount",r)},size:"sm",w:"80px",children:[(0,s.jsx)(l.zuI,{...r}),(0,s.jsxs)(l.FiK,{children:[(0,s.jsx)(l.WQu,{}),(0,s.jsx)(l.Y_d,{})]})]}),(0,s.jsx)(l.xvT,{children:"DSR processing errors "})]})}})})]})}),(0,s.jsx)(l.zeN,{justifyContent:"flex-start",children:(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(l.wpx,{onClick:()=>{t.resetForm(),r()},children:"Cancel"}),(0,s.jsx)(l.wpx,{form:"configure-alerts-form",disabled:t.isSubmitting,loading:t.isSubmitting,htmlType:"submit",children:"Save"})]})})]})]})})]})},y=()=>{let{errorRequests:e}=(0,i.C)(c.fe);return(0,s.jsxs)(l.kCb,{gap:4,children:[(null==e?void 0:e.length)>0&&(0,s.jsx)(d,{}),(0,s.jsx)(f,{})]})}},37776:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return en}});var s,l,i=r(24246),n=r(20595),a=r(27378),o=r(25980),c=r(35287),d=r(58754),u=r(19904),x=r(84764),h=r(59676),m=r(40431),p=r(16125);let{Text:j}=n.AntTypography,f=e=>{let{selectedIds:t,menuItems:r}=e,s=t.length>0;return(0,i.jsxs)(n.jqI,{gap:8,align:"center",children:[s&&(0,i.jsxs)(j,{type:"secondary","data-testid":"selected-count",children:[t.length," selected"]}),(0,i.jsx)(n.S0p,{menu:{items:r},disabled:!s,children:(0,i.jsxs)(n.wpx,{"data-testid":"bulk-actions-btn",disabled:!s,children:["Bulk actions",(0,i.jsx)(n.PJP._ME,{})]})})]})},y=()=>{let[e,t]=(0,a.useState)([]),r=(0,a.useCallback)(()=>{t([])},[]);return{selectedIds:e,setSelectedIds:t,clearSelectedIds:r}};var g=r(14048),v=r(47935),E=r(90867),b=r(36942),q=r(9270),w=r(49529),C=r(16394),I=r(65735);(s=l||(l={})).APPROVE="approve",s.DENY="deny",s.DELETE="delete";let _={[I.q2.PENDING]:["approve","deny","delete"],[I.q2.IDENTITY_UNVERIFIED]:["delete"],[I.q2.REQUIRES_INPUT]:["delete"],[I.q2.APPROVED]:["delete"],[I.q2.DENIED]:["delete"],[I.q2.IN_PROCESSING]:["delete"],[I.q2.COMPLETE]:["delete"],[I.q2.PAUSED]:["delete"],[I.q2.AWAITING_EMAIL_SEND]:["delete"],[I.q2.REQUIRES_MANUAL_FINALIZATION]:["delete"],[I.q2.CANCELED]:["delete"],[I.q2.ERROR]:["delete"]},D=e=>_[e.status],N=(e,t)=>t.some(t=>D(t).includes(e)),R={[l.APPROVE]:"approve",[l.DENY]:"deny",[l.DELETE]:"delete"},S=(e,t,r)=>r>0&&t>0?{type:"warning",message:"Successfully ".concat(e,"d ").concat(t," ").concat((0,C._6)(t,"request","requests"),". ").concat(r," ").concat((0,C._6)(r,"request","requests")," failed.")}:r>0?{type:"error",message:"Failed to ".concat(e," ").concat(r," ").concat((0,C._6)(r,"request","requests"),".")}:{type:"success",message:"Successfully ".concat(e,"d ").concat(t," privacy ").concat((0,C._6)(t,"request","requests"))},P=e=>{let{requests:t,selectedIds:r,clearSelectedIds:s,messageApi:o}=e,c=(0,a.useMemo)(()=>t.filter(e=>r.includes(e.id)),[t,r]);(0,a.useEffect)(()=>{s()},[t,s]);let[d]=(0,E.AG)(),[u]=(0,E.ZZ)(),[x]=(0,E.AL)(),h=(0,a.useCallback)(async e=>{let t;let r=c.filter(t=>D(t).includes(e)).map(e=>e.id),s=r.length,i=R[e],n=o.loading("Executing bulk action on ".concat(s," privacy ").concat((0,C._6)(s,"request","requests"),"..."),0);switch(e){case l.APPROVE:t=await d({request_ids:r});break;case l.DENY:t=await u({request_ids:r,reason:""});break;case l.DELETE:t=await x({request_ids:r});break;default:n();return}if(n(),"error"in t)o.error("Failed to ".concat(i," requests. Please try again."),5);else if("data"in t){var a,h;let{type:e,message:r}=S(i,(null===(a=t.data.succeeded)||void 0===a?void 0:a.length)||0,(null===(h=t.data.failed)||void 0===h?void 0:h.length)||0);o[e](r,5)}},[c,o,d,u,x]);return{bulkActionMenuItems:(0,a.useMemo)(()=>{let e=N(l.APPROVE,c),t=N(l.DENY,c),r=N(l.DELETE,c);return[{key:l.APPROVE,label:"Approve",icon:(0,i.jsx)(n.PJP.MCw,{}),onClick:()=>h(l.APPROVE),disabled:!e},{key:l.DENY,label:"Deny",icon:(0,i.jsx)(n.PJP.x8P,{}),onClick:()=>h(l.DENY),disabled:!t},{type:"divider"},{key:l.DELETE,label:"Delete",icon:(0,i.jsx)(n.PJP.ZNm,{}),danger:!0,onClick:()=>h(l.DELETE),disabled:!r}]},[c,h])}};var k=r(98855),A=r(27693),T=r.n(A);let F=[I.q2.COMPLETE,I.q2.CANCELED,I.q2.DENIED,I.q2.IDENTITY_UNVERIFIED],O=e=>{let{status:t,daysLeft:r,timeframe:s=45}=e;if(!F.includes(t)&&void 0!==r){let e=100*r/s,t="error";return t=e<25?"error":e>=75?"success":"warning",(0,i.jsx)("div",{children:(0,i.jsx)(n.j8w,{color:t,bordered:!1,children:(0,i.jsx)(n.esZ,{title:(0,C.p6)(T()().add(r,"day").toDate()),children:(0,i.jsxs)(i.Fragment,{children:[r," days left"]})})})})}return null};var z=r(86677),V=r(77830),Z=r(45259);let M=e=>{let{privacyRequest:t}=e,r=(0,z.useRouter)();return(0,i.jsxs)(n.jqI,{gap:16,wrap:!0,align:"center",children:[(0,i.jsx)("div",{className:"flex min-w-[100px] gap-2",children:(0,i.jsx)(n.AntTypography.Title,{level:3,children:(0,i.jsx)(n.AntTypography.Link,{href:"/privacy-requests/".concat(t.id),variant:"primary",onClick:e=>{e.preventDefault(),r.push({pathname:V.ld,query:{id:t.id}})},copyable:{text:t.id,icon:(0,i.jsx)(n.esZ,{title:"Copy request ID",children:(0,i.jsx)("div",{className:"mt-1",children:(0,i.jsx)(n.PJP.CKM,{})})}),tooltips:null},children:t.policy.name})})}),(0,i.jsx)(Z.Z,{status:t.status})]})},U=e=>{let{children:t}=e;return(0,i.jsx)(n.lKn,{type:"secondary",children:t})},L=e=>{let{label:t,children:r}=e;return(0,i.jsxs)(n.jqI,{gap:8,wrap:!0,children:[(0,i.jsxs)(U,{children:[t,":"]}),(0,i.jsx)(n.j8w,{children:r})]})},Y=e=>{let{label:t,children:r}=e;return(0,i.jsxs)(n.jqI,{gap:4,wrap:!0,children:[(0,i.jsxs)(U,{children:[t,":"]}),(0,i.jsx)(n.lKn,{children:r})]})},G=e=>{let{value:t}=e;return(null!=t?t:"").length>0?(0,i.jsx)(Y,{label:"Email",children:t}):null},J=e=>{let{identities:t}=e;return(0,i.jsx)(i.Fragment,{children:Object.entries(t).filter(e=>{let[t,r]=e;return r.value&&"email"!==t}).map(e=>{let[t,r]=e;return(0,i.jsx)(L,{label:r.label,children:r.value},t)})})};var K=r(79894),W=r.n(K);let X=e=>{let{id:t}=e;return(0,i.jsx)(W(),{legacyBehavior:!0,href:"/privacy-requests/".concat(encodeURIComponent(t)),children:(0,i.jsx)(n.esZ,{title:"View privacy request",children:(0,i.jsx)(n.wpx,{icon:(0,i.jsx)(n.PJP.G7x,{}),"aria-label":"View Request",size:"small",href:"/privacy-requests/".concat(encodeURIComponent(t))},"view")})},"view")};var Q=r(71784);let B=e=>Array.from(new Set(e.filter(e=>Object.values(I.Us).includes(e.action_type)).map(e=>e.action_type))),$=e=>{let{rules:t}=e;return(0,i.jsx)(i.Fragment,{children:B(t).map(e=>Q.rE.get(e)).map(e=>(0,i.jsx)(n.j8w,{children:e},e))})};var H=r(51980);let ee=e=>{let{createdAt:t}=e;return(0,i.jsx)(Y,{label:"Received",children:(0,i.jsx)(n.lKn,{type:"secondary",children:(0,C.G8)((0,H.B)(new Date(t),new Date,{addSuffix:!0}))})})},et=e=>{var t;let{item:r,checkbox:s}=e;return(0,i.jsxs)(n.krs.Item,{children:[(0,i.jsx)("div",{className:"pr-4",children:s}),(0,i.jsxs)("div",{className:"grow",children:[(0,i.jsx)(M,{privacyRequest:r}),(0,i.jsxs)(n.jqI,{vertical:!0,gap:16,wrap:!0,className:"pt-1",children:[(0,i.jsxs)(n.jqI,{gap:8,wrap:!0,children:[(0,i.jsx)(G,{value:null===(t=r.identity.email)||void 0===t?void 0:t.value}),(0,i.jsx)($,{rules:r.policy.rules}),(0,i.jsx)(n.j8w,{children:r.source})]}),(0,i.jsx)(n.jqI,{wrap:!0,gap:16,children:(0,i.jsx)(J,{identities:r.identity})})]})]}),(0,i.jsxs)(n.jqI,{gap:16,wrap:!0,className:"pr-2",children:[(0,i.jsx)(ee,{createdAt:r.created_at}),(0,i.jsx)(O,{daysLeft:r.days_left,status:r.status,timeframe:r.policy.execution_timeframe})]}),(0,i.jsxs)(n.jqI,{className:"min-w-[125px]",align:"center",justify:"end",gap:8,children:[(0,i.jsx)(X,{id:r.id},"view"),(0,i.jsx)(k.q,{subjectRequest:r},"other-actions")]})]})},er=()=>{let[e,t]=(0,m.v1)("search",m.Oi.withDefault("").withOptions({throttleMs:100})),r=(0,p.v9)(E.dp),[s,l]=n.Pg3.useMessage(),{selectedIds:o,setSelectedIds:c,clearSelectedIds:d}=y(),u=(0,q.S)(),{pageIndex:x,pageSize:h,resetPagination:j}=u,{isOpen:C,onOpen:I,onClose:_}=(0,n.qY0)(),{data:D,isLoading:N,isFetching:R}=(0,E.QA)({...r,page:x,size:h,fuzzy_search_str:e}),{items:S,total:k}=(0,a.useMemo)(()=>{let e=D||{items:[],total:0,pages:0},t=e.items.map(e=>({...e,key:e.id}));return{...e,items:t}},[D]),{downloadReport:A}=(0,w.Z)(),T=(0,a.useCallback)(e=>{t(null!=e?e:""),j()},[j,t]),F=async()=>{let e;try{await A(r)}catch(t){e=t instanceof Error?t.message:"Unknown error occurred"}e&&s.error(e,5e3)},{bulkActionMenuItems:O}=P({requests:S,selectedIds:o,clearSelectedIds:d,messageApi:s});return(0,i.jsxs)("div",{children:[(0,i.jsxs)(v.Q$,{children:[(0,i.jsx)(v.HO,{globalFilter:e,setGlobalFilter:T,placeholder:"Search by request ID or identity value"}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(f,{selectedIds:o,menuItems:O}),(0,i.jsx)(n.wpx,{"data-testid":"filter-btn",onClick:I,children:"Filter"}),(0,i.jsx)(n.wpx,{"aria-label":"Export report","data-testid":"export-btn",icon:(0,i.jsx)(g.nM,{ml:"1.5px"}),onClick:F})]}),(0,i.jsx)(n.h_i,{children:(0,i.jsx)(b.S,{isOpen:C,onClose:_,onFilterChange:j})})]}),N?(0,i.jsx)("div",{className:"border p-2",children:(0,i.jsx)(n.krs,{dataSource:Array(25).fill({}),renderItem:()=>(0,i.jsx)(n.krs.Item,{children:(0,i.jsx)(n.N_L,{})})})}):(0,i.jsxs)(n.jqI,{vertical:!0,gap:"middle",children:[(0,i.jsx)(n.ZJQ,{spinning:R,children:(0,i.jsx)(n.krs,{bordered:!0,dataSource:S,rowSelection:{selectedRowKeys:o,onChange:c},renderItem:(e,t,r)=>(0,i.jsx)(et,{item:e,checkbox:r})})}),(0,i.jsx)(n.B7X,{...u.paginationProps,showTotal:(e,t)=>"".concat(t[0],"-").concat(t[1]," of ").concat(e," items"),total:null!=k?k:0,align:"end"})]}),l]})};var es=r(88152),el=r(72281),ei=r(86291),en=()=>{let{processing:e}=(0,es.Y)(),{plus:t}=(0,o.hz)(),{activeTab:r,handleTabChange:s,availableTabs:l}=(0,el.d)();(0,a.useEffect)(()=>{e()},[e]);let m=(0,a.useMemo)(()=>{let e=[];return l.request&&e.push({key:el.G.REQUEST,label:"Request",children:(0,i.jsx)(er,{})}),l.manualTask&&e.push({key:el.G.MANUAL_TASK,label:"Manual tasks",children:(0,i.jsx)(x.m,{})}),e},[l.manualTask,l.request]);return(0,i.jsxs)(c.Z,{title:"Privacy Requests",children:[(0,i.jsx)(d.Z,{heading:"Privacy Requests",breadcrumbItems:[{title:"All requests"}],rightContent:(0,i.jsxs)(n.vyj,{children:[t&&(0,i.jsx)(u.ZP,{scopes:[I.Sh.PRIVACY_REQUEST_CREATE],children:(0,i.jsx)(ei.Z,{})}),(0,i.jsx)(h.default,{})]}),"data-testid":"privacy-requests"}),(0,i.jsx)(n.A5g,{activeKey:r,onChange:s,items:m})]})}}},function(e){e.O(0,[431,8765,2962,7245,8373,6468,2888,9774,179],function(){return e(e.s=89987)}),_N_E=e.O()}]);