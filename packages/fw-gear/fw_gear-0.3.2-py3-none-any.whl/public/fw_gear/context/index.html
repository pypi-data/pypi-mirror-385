<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=../specs/ rel=prev><link href=../utils/ rel=next><link rel=icon href=../../assets/images/trademark.svg><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.14"><title>Context - Flywheel Gears</title><link rel=stylesheet href=../../assets/stylesheets/main.342714a4.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../assets/_mkdocstrings.css><link rel=stylesheet href=https://cdn.flywheel.io/static/mkdocs/stylesheets/custom.css><link rel=stylesheet href=https://cdn.flywheel.io/static/mkdocs/stylesheets/asciinema-player.css><link rel=stylesheet href=https://cdn.flywheel.io/static/mkdocs/stylesheets/asciinema-theme.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=amber> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#gear-context class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Flywheel Gears" class="md-header__button md-logo" aria-label="Flywheel Gears" data-md-component=logo> <img src=../../assets/images/logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Flywheel Gears </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Context </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=amber aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=amber aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://gitlab.com/flywheel-io/scientific-solutions/lib/fw-gear.git title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> GitLab </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Flywheel Gears" class="md-nav__button md-logo" aria-label="Flywheel Gears" data-md-component=logo> <img src=../../assets/images/logo.svg alt=logo> </a> Flywheel Gears </label> <div class=md-nav__source> <a href=https://gitlab.com/flywheel-io/scientific-solutions/lib/fw-gear.git title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> GitLab </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=../specs/ class=md-nav__link> <span class=md-ellipsis> Specification </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Context </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Context </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#structure class=md-nav__link> <span class=md-ellipsis> Structure </span> </a> </li> <li class=md-nav__item> <a href=#basic-usage class=md-nav__link> <span class=md-ellipsis> Basic Usage </span> </a> </li> <li class=md-nav__item> <a href=#accessing-gear-runtime class=md-nav__link> <span class=md-ellipsis> Accessing gear runtime </span> </a> <nav class=md-nav aria-label="Accessing gear runtime"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#accessing-gear-runtime-configuration-options class=md-nav__link> <span class=md-ellipsis> Accessing gear runtime configuration options </span> </a> </li> <li class=md-nav__item> <a href=#accessing-inputs class=md-nav__link> <span class=md-ellipsis> Accessing Inputs </span> </a> </li> <li class=md-nav__item> <a href=#accessing-destination-container class=md-nav__link> <span class=md-ellipsis> Accessing Destination Container </span> </a> </li> <li class=md-nav__item> <a href=#accessing-the-sdk-client class=md-nav__link> <span class=md-ellipsis> Accessing the SDK Client </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#accessing-gear-metadata-aka-manifestjson class=md-nav__link> <span class=md-ellipsis> Accessing gear metadata (aka .manifest.json) </span> </a> </li> <li class=md-nav__item> <a href=#writing-outputs class=md-nav__link> <span class=md-ellipsis> Writing Outputs </span> </a> <nav class=md-nav aria-label="Writing Outputs"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#writing-output-file class=md-nav__link> <span class=md-ellipsis> Writing output file </span> </a> </li> <li class=md-nav__item> <a href=#writing-metadata class=md-nav__link> <span class=md-ellipsis> Writing metadata </span> </a> <nav class=md-nav aria-label="Writing metadata"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#overview class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=#non-sdk-enabled-method class=md-nav__link> <span class=md-ellipsis> NON-SDK enabled Method </span> </a> <nav class=md-nav aria-label="NON-SDK enabled Method"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#custom-container-metadata-update_container class=md-nav__link> <span class=md-ellipsis> Custom container metadata (update_container) </span> </a> </li> <li class=md-nav__item> <a href=#custom-file-metadata-update_file_metadata class=md-nav__link> <span class=md-ellipsis> Custom file metadata (update_file_metadata) </span> </a> </li> <li class=md-nav__item> <a href=#qc-result-for-file-add_qc_result class=md-nav__link> <span class=md-ellipsis> QC result for file (add_qc_result) </span> </a> </li> <li class=md-nav__item> <a href=#qc-result-for-analysis-add_qc_result_to_analysis class=md-nav__link> <span class=md-ellipsis> QC result for analysis (add_qc_result_to_analysis) </span> </a> </li> <li class=md-nav__item> <a href=#file-tags-add_file_tags class=md-nav__link> <span class=md-ellipsis> File tags (add_file_tags) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#sdk-enabled class=md-nav__link> <span class=md-ellipsis> SDK enabled </span> </a> <nav class=md-nav aria-label="SDK enabled"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#custom-container-metadata-modify_container_info class=md-nav__link> <span class=md-ellipsis> Custom container metadata (modify_container_info) </span> </a> </li> <li class=md-nav__item> <a href=#qc-result-add_qc_result_via_sdk class=md-nav__link> <span class=md-ellipsis> QC result (add_qc_result_via_sdk) </span> </a> <nav class=md-nav aria-label="QC result (add_qc_result_via_sdk)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#example class=md-nav__link> <span class=md-ellipsis> Example </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#logging class=md-nav__link> <span class=md-ellipsis> Logging </span> </a> </li> <li class=md-nav__item> <a href=#sdk-profiling class=md-nav__link> <span class=md-ellipsis> SDK Profiling </span> </a> </li> <li class=md-nav__item> <a href=#modify-file class=md-nav__link> <span class=md-ellipsis> Modify File </span> </a> <nav class=md-nav aria-label="Modify File"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#sanitize-filename-sanitize_label class=md-nav__link> <span class=md-ellipsis> Sanitize Filename (sanitize_label) </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../utils/ class=md-nav__link> <span class=md-ellipsis> Utils </span> </a> </li> <li class=md-nav__item> <a href=../reference/ class=md-nav__link> <span class=md-ellipsis> API </span> </a> </li> <li class=md-nav__item> <a href=../migrate-guide/how_to_migrate/ class=md-nav__link> <span class=md-ellipsis> Migration Guide </span> </a> </li> <li class=md-nav__item> <a href=../migrate-guide/general_feature_parity/ class=md-nav__link> <span class=md-ellipsis> Overall Parity </span> </a> </li> <li class=md-nav__item> <a href=../release_notes/ class=md-nav__link> <span class=md-ellipsis> Release Notes </span> </a> </li> <li class=md-nav__item> <a href=../migrate-guide/changelog/ class=md-nav__link> <span class=md-ellipsis> Changelog </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#structure class=md-nav__link> <span class=md-ellipsis> Structure </span> </a> </li> <li class=md-nav__item> <a href=#basic-usage class=md-nav__link> <span class=md-ellipsis> Basic Usage </span> </a> </li> <li class=md-nav__item> <a href=#accessing-gear-runtime class=md-nav__link> <span class=md-ellipsis> Accessing gear runtime </span> </a> <nav class=md-nav aria-label="Accessing gear runtime"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#accessing-gear-runtime-configuration-options class=md-nav__link> <span class=md-ellipsis> Accessing gear runtime configuration options </span> </a> </li> <li class=md-nav__item> <a href=#accessing-inputs class=md-nav__link> <span class=md-ellipsis> Accessing Inputs </span> </a> </li> <li class=md-nav__item> <a href=#accessing-destination-container class=md-nav__link> <span class=md-ellipsis> Accessing Destination Container </span> </a> </li> <li class=md-nav__item> <a href=#accessing-the-sdk-client class=md-nav__link> <span class=md-ellipsis> Accessing the SDK Client </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#accessing-gear-metadata-aka-manifestjson class=md-nav__link> <span class=md-ellipsis> Accessing gear metadata (aka .manifest.json) </span> </a> </li> <li class=md-nav__item> <a href=#writing-outputs class=md-nav__link> <span class=md-ellipsis> Writing Outputs </span> </a> <nav class=md-nav aria-label="Writing Outputs"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#writing-output-file class=md-nav__link> <span class=md-ellipsis> Writing output file </span> </a> </li> <li class=md-nav__item> <a href=#writing-metadata class=md-nav__link> <span class=md-ellipsis> Writing metadata </span> </a> <nav class=md-nav aria-label="Writing metadata"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#overview class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=#non-sdk-enabled-method class=md-nav__link> <span class=md-ellipsis> NON-SDK enabled Method </span> </a> <nav class=md-nav aria-label="NON-SDK enabled Method"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#custom-container-metadata-update_container class=md-nav__link> <span class=md-ellipsis> Custom container metadata (update_container) </span> </a> </li> <li class=md-nav__item> <a href=#custom-file-metadata-update_file_metadata class=md-nav__link> <span class=md-ellipsis> Custom file metadata (update_file_metadata) </span> </a> </li> <li class=md-nav__item> <a href=#qc-result-for-file-add_qc_result class=md-nav__link> <span class=md-ellipsis> QC result for file (add_qc_result) </span> </a> </li> <li class=md-nav__item> <a href=#qc-result-for-analysis-add_qc_result_to_analysis class=md-nav__link> <span class=md-ellipsis> QC result for analysis (add_qc_result_to_analysis) </span> </a> </li> <li class=md-nav__item> <a href=#file-tags-add_file_tags class=md-nav__link> <span class=md-ellipsis> File tags (add_file_tags) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#sdk-enabled class=md-nav__link> <span class=md-ellipsis> SDK enabled </span> </a> <nav class=md-nav aria-label="SDK enabled"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#custom-container-metadata-modify_container_info class=md-nav__link> <span class=md-ellipsis> Custom container metadata (modify_container_info) </span> </a> </li> <li class=md-nav__item> <a href=#qc-result-add_qc_result_via_sdk class=md-nav__link> <span class=md-ellipsis> QC result (add_qc_result_via_sdk) </span> </a> <nav class=md-nav aria-label="QC result (add_qc_result_via_sdk)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#example class=md-nav__link> <span class=md-ellipsis> Example </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#logging class=md-nav__link> <span class=md-ellipsis> Logging </span> </a> </li> <li class=md-nav__item> <a href=#sdk-profiling class=md-nav__link> <span class=md-ellipsis> SDK Profiling </span> </a> </li> <li class=md-nav__item> <a href=#modify-file class=md-nav__link> <span class=md-ellipsis> Modify File </span> </a> <nav class=md-nav aria-label="Modify File"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#sanitize-filename-sanitize_label class=md-nav__link> <span class=md-ellipsis> Sanitize Filename (sanitize_label) </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <!-- Disable annoying code fencing rule which gets triggered on admonitions --> <!-- markdownlint-disable MD046 MD007 MD013--> <h1 id=gear-context>Gear Context</h1> <p>The <code>fw_gear.context.GearContext</code> is an iteration on the Flywheel SDK's <code>GearContext</code> (<code>flywheel.GearContext</code>).</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>The <code>fw-gear</code> package is a reworked and enhanced version of the <code>flywheel_gear_toolkit</code> Python package. Please note that <code>flywheel_gear_toolkit</code> is scheduled for reaching end-of-life in 2026.</p> </div> <p>The <code>fw_gear.context.GearContext</code> class provides an interface for performing common tasks in the lifecycle of a gear, such as:</p> <ul> <li>Accessing input files, configuration values, and manifest properties and an SDK client</li> <li>Configuring logging</li> <li>Writing to output files and output metadata (.metadata.json)</li> </ul> <h2 id=structure>Structure</h2> <p>The <code>GearContext</code> class is composed of:</p> <ul> <li><code>fw_gear.config.Config</code> object, which represents the <code>config.json</code> within a gear run that holds all the gears <em>provided</em> runtime options (inputs, configuration values). See more at <a href=#accessing-gear-runtime>Accessing Gear Runtime</a>.</li> <li><code>fw_gear.manifest.Manifest</code> object, which represents the <code>manifest.json</code> that defines a gears metadata and <em>available</em> runtime options. See more at <a href=#accessing-gear-metadata-aka-manifestjson>Accessing Gear Metadata</a></li> <li><code>fw_gear.metadata.Metadata</code> object which represents the <code>.metadata.json</code> file. This file is a method of updating metadata on the Flywheel hierarchy <em>without</em> needing a credentialed SDK client. Therefore the <code>Metadata</code> class is only useful in a non-SDK enabled gear, or a read-only SDK enabled gear. See more at <a href=#writing-outputs>Writing Outputs</a></li> </ul> <h2 id=basic-usage>Basic Usage</h2> <p><code>GearContext</code> is intended to be used as a context manager to be passed around. For example, your python script entrypoint (e.g. <code>run.py</code>) could look something like:</p> <div class=highlight><pre><span></span><code><span class=kn>from</span><span class=w> </span><span class=nn>fw_gear.context</span><span class=w> </span><span class=kn>import</span> <span class=n>GearContext</span>
<span class=kn>from</span><span class=w> </span><span class=nn>my_awesome_module</span><span class=w> </span><span class=kn>import</span> <span class=n>do_something</span>

<span class=k>def</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>context</span><span class=p>):</span>
    <span class=c1># Do something with your input dicom file</span>
    <span class=n>do_something</span><span class=p>(</span>
        <span class=n>dicom</span><span class=o>=</span><span class=n>context</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>get_input_path</span><span class=p>(</span><span class=s1>&#39;dicom&#39;</span><span class=p>),</span>
        <span class=n>output_dir</span><span class=o>=</span><span class=n>context</span><span class=o>.</span><span class=n>output_dir</span>
    <span class=p>)</span>
<span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&quot;__main__&quot;</span><span class=p>:</span>
    <span class=k>with</span> <span class=n>GearContext</span><span class=p>()</span> <span class=k>as</span> <span class=n>context</span><span class=p>:</span>
        <span class=c1># Setup basic logging</span>
        <span class=n>context</span><span class=o>.</span><span class=n>init_logging</span><span class=p>()</span>
        <span class=c1># Call my main function</span>
        <span class=n>main</span><span class=p>(</span><span class=n>context</span><span class=p>)</span>
</code></pre></div> <h2 id=accessing-gear-runtime>Accessing gear runtime</h2> <p>All <em>provided</em> runtime configuration can be accessed via the <code>config</code> attribute, which provides access to the <a href=./config.md><code>Config</code></a> object that parses the system-provided <code>config.json</code> file.</p> <p>Example:</p> <div class=highlight><pre><span></span><code><span class=k>with</span> <span class=n>GearContext</span><span class=p>()</span> <span class=k>as</span> <span class=n>context</span>
    <span class=c1># Get provided input object for input named `my-input`</span>
    <span class=n>input1</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>get_input</span><span class=p>(</span><span class=s1>&#39;my-input&#39;</span><span class=p>)</span>

    <span class=c1># Get path to input for input named `my-input2`</span>
    <span class=n>input2_path</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>get_input_path</span><span class=p>(</span><span class=s1>&#39;my-input-2&#39;</span><span class=p>)</span>

    <span class=c1># Get provided configuration option value for `my-config`</span>
    <span class=n>cfg</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>opts</span><span class=p>[</span><span class=s1>&#39;my-config&#39;</span><span class=p>]</span>
</code></pre></div> <h3 id=accessing-gear-runtime-configuration-options>Accessing gear runtime configuration options</h3> <p>You can the get the gear runtime configuration options from the <code>context.config.opts</code> dictionary.</p> <div class=highlight><pre><span></span><code><span class=c1># Get the speed option value</span>
<span class=n>my_speed</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>opts</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;speed&quot;</span><span class=p>)</span>
</code></pre></div> <h3 id=accessing-inputs>Accessing Inputs</h3> <p>You can get the full path to a named input file, or open the file directly:</p> <div class=highlight><pre><span></span><code><span class=c1># Get the path to the input file named &#39;dicom&#39;</span>
<span class=n>dicom_path</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>get_input_path</span><span class=p>(</span><span class=s2>&quot;dicom&quot;</span><span class=p>)</span>
<span class=c1># Get the input filename</span>
<span class=n>dicom_filename</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>get_input_filename</span><span class=p>(</span><span class=s2>&quot;dicom&quot;</span><span class=p>)</span>
<span class=c1># Open the dicom file for reading</span>
<span class=k>with</span> <span class=n>context</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>open_input</span><span class=p>(</span><span class=s2>&quot;dicom&quot;</span><span class=p>,</span> <span class=s2>&quot;rb&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>dicom_file</span><span class=p>:</span>
  <span class=n>dicom_data</span> <span class=o>=</span> <span class=n>dicom_file</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</code></pre></div> <h3 id=accessing-destination-container>Accessing Destination Container</h3> <p>You can get the destination container and the parent of the destination container (e.g. to check at which level your analysis gear has been launched) using <code>get_destination_container</code> and <code>get_destination_parent</code> methods. Example:</p> <div class=highlight><pre><span></span><code><span class=n>destination</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>get_destination</span><span class=p>()</span>
<span class=n>destination_parent</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>get_destination_parent</span><span class=p>()</span>
</code></pre></div> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>If your gear is not at least read-only SDK enabled, this will fail. See <a href=../specs/#api-key-input>API key input</a> for an example.</p> </div> <h3 id=accessing-the-sdk-client>Accessing the SDK Client</h3> <p>If your gear is an SDK gear (e.g. has an api-key input), you can easily access an instance of the Flywheel SDK Client. Example:</p> <div class=highlight><pre><span></span><code><span class=c1># Lookup a project using the client</span>
<span class=n>project</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>lookup</span><span class=p>(</span><span class=s2>&quot;my_group/Project 1&quot;</span><span class=p>)</span>
</code></pre></div> <h2 id=accessing-gear-metadata-aka-manifestjson>Accessing gear metadata (aka <code>.manifest.json</code>)</h2> <p>When the <code>manifest.json</code> is available in the gear at <code>/flywheel/v0</code>, the <code>GearContext</code> provides an easy access to it. Example:</p> <div class=highlight><pre><span></span><code><span class=n>gear_name</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>manifest</span><span class=o>.</span><span class=n>name</span>
<span class=n>gear_version</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>manifest</span><span class=o>.</span><span class=n>version</span>
</code></pre></div> <div class="admonition info"> <p class=admonition-title>Info</p> <p>The path <code>context.output_dir</code> is cleaned when the context manager exits with an exception. To disable this and retain files for inspection on error, enable debug mode using the <a href=#logging>logger</a>.</p> </div> <div class="admonition note"> <p class=admonition-title>Note</p> <p><code>manifest.json</code> is provided to the gear by the <em>user</em> at build-time, i.e. as a step in the Dockerfile, whereas the <code>config.json</code> is provided to gear by the <em>system</em> at run-time, i.e. mounted to the container.</p> <p>As such, the <code>GearContext</code> will only look in the <code>/flywheel/v0</code> folder as that is where the manifest is placed by convention (next to where the config is mounted at--<code>/flywheel/v0/config.json</code>)</p> </div> <h2 id=writing-outputs>Writing Outputs</h2> <h3 id=writing-output-file>Writing output file</h3> <p>The path to the output directory is available as an attribute on the <code>context</code>, and helper methods exist for opening an output file for writing. By default, this output directory will point to <code>/flywheel/v0/output</code>. Example:</p> <div class=highlight><pre><span></span><code><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Output path: </span><span class=si>{}</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>context</span><span class=o>.</span><span class=n>output_dir</span><span class=p>))</span>
<span class=c1># prints &quot;Output path: /flywheel/v0/output&quot;</span>

<span class=c1># Open an output file for writing</span>
<span class=k>with</span> <span class=n>context</span><span class=o>.</span><span class=n>open_output</span><span class=p>(</span><span class=s1>&#39;out-file.dcm&#39;</span><span class=p>,</span> <span class=s1>&#39;wb&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
  <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>dicom_data</span><span class=p>)</span>
</code></pre></div> <div class="admonition note"> <p class=admonition-title>Note</p> <p>The path <code>context.output_dir</code> is cleaned when the context manager exits with an exception. To disable this and retain files for inspection on error, enable debug mode using the <a href=#logging>logger</a>.</p> </div> <h3 id=writing-metadata>Writing metadata</h3> <h4 id=overview>Overview</h4> <p>Gears support writing metadata upon job completion back to Flywheel containers <em>without</em> using the SDK. If a special file <code>.metadata.json</code> exists in the output container, the json object inside will be uploaded as metadata. With this feature, you can edit the destination container of the job runtime and the parent containers of the destination container <em>without</em> needing to delve into the details of the SDK.</p> <p>If you need to write metadata outside of the destination container and its parent containers, <code>fw_gear</code> provides several methods to do so.</p> <div class="admonition info"> <p class=admonition-title>Info</p> <p>To learn more how <code>.metadata.json</code> works, you can review the <a href=../specs/#output-metadata>.metadata.json spec</a></p> </div> <h4 id=non-sdk-enabled-method>NON-SDK enabled Method</h4> <!-- TODO figure out to link to the API page for each method --> <h5 id=custom-container-metadata-update_container><strong>Custom container metadata (<code>update_container</code>)</strong></h5> <p>This method can be utilized to add free-form metadata on the specified container, within the hierarchy.</p> <ul> <li>Arguments:<ul> <li><code>container_type</code> (<code>str</code>): The container type.</li> <li><code>deep</code> (<code>bool</code>): If <code>True</code>, perform a deep (recursive) update on subdictionaries.</li> <li><code>**kwargs</code> (<code>dict</code>): Additional keyword arguments for update operations.</li> </ul> </li> </ul> <div class="admonition info"> <p class=admonition-title>Usage</p> <div class=highlight><pre><span></span><code>    <span class=k>with</span> <span class=n>fw_gear</span><span class=o>.</span><span class=n>GearContext</span><span class=p>()</span> <span class=k>as</span> <span class=n>context</span><span class=p>:</span>
        <span class=c1># Update the destination container information</span>
        <span class=n>info</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;my-metric&quot;</span><span class=p>:</span> <span class=s2>&quot;my-value&quot;</span><span class=p>}</span>
        <span class=k>assert</span> <span class=n>context</span><span class=o>.</span><span class=n>destination</span><span class=o>.</span><span class=n>type</span> <span class=o>==</span> <span class=s1>&#39;analysis&#39;</span>
        <span class=n>context</span><span class=o>.</span><span class=n>metadata</span><span class=o>.</span><span class=n>update_container</span><span class=p>(</span><span class=n>context</span><span class=o>.</span><span class=n>destination</span><span class=o>.</span><span class=n>type</span><span class=p>,</span> <span class=n>info</span><span class=o>=</span><span class=n>info</span><span class=p>)</span>

        <span class=c1># Update the parent session of the destination analysis</span>
        <span class=n>info</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;my-metric&quot;</span><span class=p>:</span> <span class=s2>&quot;my-other-value&quot;</span><span class=p>}</span>
        <span class=n>context</span><span class=o>.</span><span class=n>metadata</span><span class=o>.</span><span class=n>update_container</span><span class=p>(</span><span class=s2>&quot;session&quot;</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s2>&quot;Session 1&quot;</span><span class=p>,</span> <span class=n>info</span><span class=o>=</span><span class=n>info</span><span class=p>)</span>
</code></pre></div> </div> <h5 id=custom-file-metadata-update_file_metadata><strong>Custom file metadata (<code>update_file_metadata</code>)</strong></h5> <p>This method can be utilized to add free-form metadata to an input/output or sibling file within the hierarchy.</p> <ul> <li>Arguments:<ul> <li><code>file_</code> (<code>Any</code>): This can be the file name (a <code>str</code>), a SDK file object (<code>file.FileEntry</code>), or a dictionary representing the file that comes from <code>config.json</code>.</li> <li><code>deep</code> (<code>bool</code>): If <code>True</code>, perform a deep (recursive) update on subdictionaries.</li> <li><code>container_type</code> (<em>optional</em>, <code>str</code>): Type of the parent container.</li> <li><code>kwargs</code> (<code>dict</code>): Additional keyword arguments for update operations.</li> </ul> </li> </ul> <div class="admonition info"> <p class=admonition-title>Usage</p> <div class=highlight><pre><span></span><code>    <span class=k>with</span> <span class=n>fw_gear</span><span class=o>.</span><span class=n>GearContext</span><span class=p>()</span> <span class=k>as</span> <span class=n>context</span><span class=p>:</span>
        <span class=c1># Set the modality and classification of an output file</span>
        <span class=n>context</span><span class=o>.</span><span class=n>metadata</span><span class=o>.</span><span class=n>update_file_metadata</span><span class=p>(</span>
            <span class=n>file_</span> <span class=o>=</span> <span class=s2>&quot;out-file.dcm&quot;</span><span class=p>,</span>  <span class=c1># NOTE: File must exist in output directory for this to work</span>
            <span class=n>container_type</span><span class=o>=</span><span class=s2>&quot;acquisition&quot;</span><span class=p>,</span>
            <span class=n>modality</span><span class=o>=</span><span class=s2>&quot;MR&quot;</span><span class=p>,</span>
            <span class=n>classification</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;Measurement&quot;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&quot;T1&quot;</span><span class=p>]}</span>
        <span class=p>)</span>
</code></pre></div> </div> <h5 id=qc-result-for-file-add_qc_result><strong>QC result for file (<code>add_qc_result</code>)</strong></h5> <p>This method can be utilized to add <em>qc</em> result to an input/output or sibling file within the hierarchy.</p> <ul> <li>Arguments:<ul> <li><code>file_</code> (<code>Any</code>): This can be the file name (a <code>str</code>), a SDK file object (<code>file.FileEntry</code>), or a dictionary representing the file that comes from <code>config.json</code>.</li> <li><code>name</code> (<code>str</code>): The QC result name.</li> <li><code>state</code> (<code>str</code>): The state of the QC result. Can only set to <code>pass</code>, <code>fail</code> or <code>na</code></li> <li><code>**data</code> (<code>dict</code>): Additional data/keyword arguments for the QC result.</li> </ul> </li> </ul> <div class="admonition info"> <p class=admonition-title>Usage</p> <div class=highlight><pre><span></span><code>    <span class=n>add_info</span> <span class=o>=</span> <span class=p>{</span>
        <span class=s2>&quot;parameter1&quot;</span><span class=p>:</span> <span class=s2>&quot;value1&quot;</span><span class=p>,</span>
        <span class=s2>&quot;parameter2&quot;</span><span class=p>:</span> <span class=s2>&quot;value2&quot;</span>
     <span class=p>}</span>

    <span class=k>with</span> <span class=n>fw_gear</span><span class=o>.</span><span class=n>GearContext</span><span class=p>()</span> <span class=k>as</span> <span class=n>context</span><span class=p>:</span>
        <span class=n>file_obj</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>get_input</span><span class=p>(</span><span class=s2>&quot;&lt;name-of-the-input-file&gt;&quot;</span><span class=p>)</span>

        <span class=n>context</span><span class=o>.</span><span class=n>metadata</span><span class=o>.</span><span class=n>add_qc_result</span><span class=p>(</span>
            <span class=n>file_obj</span><span class=p>,</span>
            <span class=s2>&quot;qc&quot;</span><span class=p>,</span>
            <span class=s2>&quot;pass&quot;</span><span class=p>,</span>
            <span class=o>**</span><span class=n>add_info</span>
        <span class=p>)</span>
</code></pre></div> <p>Doing this on a utility gear with an acquisition destination will produce metadata that looks like the following, with <code>&lt;val&gt;</code> replaced with the values from the specific gear</p> <div class=highlight><pre><span></span><code><span class=p>{</span>
<span class=w>    </span><span class=nt>&quot;acquisition&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nt>&quot;files&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>            </span><span class=p>{</span>
<span class=w>                </span><span class=nt>&quot;name&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;out_file.dcm&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nt>&quot;info&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>                    </span><span class=nt>&quot;qc&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>                        </span><span class=nt>&quot;&lt;gear-name&gt;&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>                            </span><span class=nt>&quot;job_info&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>                                </span><span class=nt>&quot;version&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;&lt;gear-version&gt;&quot;</span><span class=p>,</span>
<span class=w>                                </span><span class=nt>&quot;job_id&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;62bc8cbcd98b86a919d60ead&quot;</span><span class=p>,</span>
<span class=w>                                </span><span class=nt>&quot;inputs&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=err>&lt;gear</span><span class=mi>-</span><span class=err>i</span><span class=kc>n</span><span class=err>pu</span><span class=kc>ts</span><span class=err>&gt;</span><span class=p>},</span>
<span class=w>                                </span><span class=nt>&quot;config&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=err>&lt;gear</span><span class=mi>-</span><span class=err>co</span><span class=kc>nf</span><span class=err>ig&gt;</span><span class=p>}</span>
<span class=w>                            </span><span class=p>},</span>
<span class=w>                            </span><span class=nt>&quot;my_qc&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>                                </span><span class=nt>&quot;state&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;PASS&quot;</span><span class=p>,</span>
<span class=w>                                </span><span class=nt>&quot;parameter1&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;value1&quot;</span><span class=p>,</span>
<span class=w>                                </span><span class=nt>&quot;parameter2&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;value2&quot;</span>
<span class=w>                            </span><span class=p>}</span>
<span class=w>                        </span><span class=p>}</span>
<span class=w>                    </span><span class=p>}</span>
<span class=w>                </span><span class=p>}</span>
<span class=w>            </span><span class=p>}</span>
<span class=w>        </span><span class=p>]</span>
<span class=w>    </span><span class=p>}</span>
<span class=p>}</span>
</code></pre></div> </div> <div class="admonition note"> <p class=admonition-title>Note</p> <ul> <li>The <code>.metadata.json</code> is cleaned (e.g invalid JSON value), validated and written when the context manager exits.</li> <li>The value written to the log will truncate long lists.</li> <li>By default the metadata will be validated against the schema linked above and will mark the gear as failed if its invalid. But you can turn that off by passing <code>fail_on_validation=False</code> to the <code>GearToolkitContext</code> initiator.</li> <li>By using <code>.metadata.json</code> it only allows to update metadata that is stored under the destination container. In order to update metadata for file outside of the destination container, please use the SDK method (see below) instead.</li> </ul> </div> <h5 id=qc-result-for-analysis-add_qc_result_to_analysis><strong>QC result for analysis (<code>add_qc_result_to_analysis</code>)</strong></h5> <p>This method can be utilized to add <em>qc</em> result to the analysis container during the job runtime.</p> <ul> <li>Arguments:<ul> <li><code>name</code> (<code>str</code>): The QC result name.</li> <li><code>state</code> (<code>str</code>): The state of the QC result. Can only set to <code>pass</code>, <code>fail</code> or <code>na</code></li> <li><code>**data</code> (<code>dict</code>): Additional data/keyword arguments for the QC result.</li> </ul> </li> </ul> <div class="admonition info"> <p class=admonition-title>Usage</p> <div class=highlight><pre><span></span><code>    <span class=n>add_info</span> <span class=o>=</span> <span class=p>{</span>
        <span class=s2>&quot;parameter1&quot;</span><span class=p>:</span> <span class=s2>&quot;value1&quot;</span><span class=p>,</span>
        <span class=s2>&quot;parameter2&quot;</span><span class=p>:</span> <span class=s2>&quot;value2&quot;</span>
     <span class=p>}</span>

    <span class=k>with</span> <span class=n>fw_gear</span><span class=o>.</span><span class=n>GearContext</span><span class=p>()</span> <span class=k>as</span> <span class=n>context</span><span class=p>:</span>

        <span class=n>context</span><span class=o>.</span><span class=n>metadata</span><span class=o>.</span><span class=n>add_qc_result</span><span class=p>(</span>
            <span class=s2>&quot;analysis-qc&quot;</span><span class=p>,</span>
            <span class=s2>&quot;pass&quot;</span><span class=p>,</span>
            <span class=o>**</span><span class=n>add_info</span>
        <span class=p>)</span>
</code></pre></div> </div> <h5 id=file-tags-add_file_tags><strong>File tags (<code>add_file_tags</code>)</strong></h5> <p>This method can be utilized to add tag(s) to an input/output or sibling.</p> <ul> <li>Arguments:<ul> <li><code>file_</code> (<code>Any</code>): This can be the file name (a <code>str</code>), a SDK file object (<code>file.FileEntry</code>), or a dictionary representing the file that comes from <code>config.json</code>.</li> <li><code>tags</code> (<code>str</code>, Iterable[<code>str</code>]): Tag or list of tags to add to the specified file.</li> </ul> </li> </ul> <div class="admonition info"> <p class=admonition-title>Usage</p> <div class=highlight><pre><span></span><code>    <span class=k>with</span> <span class=n>fw_gear</span><span class=o>.</span><span class=n>GearContext</span><span class=p>()</span> <span class=k>as</span> <span class=n>context</span><span class=p>:</span>
        <span class=n>file_obj</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>get_input</span><span class=p>(</span><span class=s2>&quot;&lt;name-of-the-input-file&gt;&quot;</span><span class=p>)</span>

        <span class=n>context</span><span class=o>.</span><span class=n>metadata</span><span class=o>.</span><span class=n>add_file_tags</span><span class=p>(</span>
            <span class=n>file_obj</span><span class=p>,</span>
            <span class=s2>&quot;tag-01&quot;</span>
        <span class=p>)</span>
</code></pre></div> </div> <h4 id=sdk-enabled>SDK enabled</h4> <h5 id=custom-container-metadata-modify_container_info><strong>Custom container metadata (<code>modify_container_info</code>)</strong></h5> <p>This is a wrapper method for <code>flywheel.modify_container_info</code> SDK method call. Using this method will update (which is the <code>set</code> method) metadata of the specified container in Flywheel.</p> <ul> <li>Arguments:<ul> <li><code>cont_id</code> (<code>str</code>): The container ID for the updated metadata.</li> <li><code>**data</code> (<code>dict</code>): Additional data/keyword arguments for the QC result.</li> </ul> </li> </ul> <div class="admonition info"> <p class=admonition-title>Usage</p> <div class=highlight><pre><span></span><code>    <span class=n>new_info</span> <span class=o>=</span> <span class=p>{</span>
        <span class=s2>&quot;infoA&quot;</span><span class=p>:</span> <span class=s2>&quot;value1&quot;</span><span class=p>,</span>
        <span class=s2>&quot;infoB&quot;</span><span class=p>:</span> <span class=s2>&quot;value2&quot;</span>
     <span class=p>}</span>

    <span class=k>with</span> <span class=n>fw_gear</span><span class=o>.</span><span class=n>GearContext</span><span class=p>()</span> <span class=k>as</span> <span class=n>context</span><span class=p>:</span>

        <span class=n>context</span><span class=o>.</span><span class=n>metadata</span><span class=o>.</span><span class=n>modify_container_info</span><span class=p>(</span>
            <span class=s2>&quot;&lt;container-id&gt;&quot;</span><span class=p>,</span>
            <span class=n>new_info</span>
        <span class=p>)</span>
</code></pre></div> </div> <h5 id=qc-result-add_qc_result_via_sdk><strong>QC result (<code>add_qc_result_via_sdk</code>)</strong></h5> <p>This method can be used to add QC results or gear info for file that is not stored under the destination container or within the job runtime hierarchy.</p> <ul> <li>Arguments:<ul> <li><code>cont_</code> (<code>Any</code>): Flywheel container object</li> <li><code>name</code> (<code>str</code>): The QC result name.</li> <li><code>state</code> (<code>str</code>): The state of the QC result. Can only set to <code>pass</code>, <code>fail</code> or <code>na</code></li> <li><code>**data</code> (<code>dict</code>): Additional data/keyword arguments for the QC result.</li> </ul> </li> </ul> <div class="admonition info"> <p class=admonition-title>Usage</p> <ul> <li> <p><strong>Add QC result for file that was used to trigger the gear.</strong></p> <div class=highlight><pre><span></span><code><span class=k>with</span> <span class=n>fw_gear</span><span class=o>.</span><span class=n>GearContext</span><span class=p>()</span> <span class=k>as</span> <span class=n>context</span><span class=p>:</span>

    <span class=n>context</span><span class=o>.</span><span class=n>metadata</span><span class=o>.</span><span class=n>add_qc_result_via_sdk</span><span class=p>(</span><span class=n>cont_</span><span class=o>=</span><span class=s1>&#39;input_file.dcm&#39;</span><span class=p>,</span> <span class=s2>&quot;input_qc&quot;</span><span class=p>,</span> <span class=n>state</span><span class=o>=</span><span class=s2>&quot;PASS&quot;</span><span class=p>,</span> <span class=p>{</span><span class=s1>&#39;my-result&#39;</span><span class=p>:</span> <span class=s1>&#39;test&#39;</span><span class=p>})</span>
</code></pre></div> </li> <li> <p><strong>Add qc result to specified Flywheel container info.</strong></p> <div class=highlight><pre><span></span><code><span class=c1># Get an acquisition container</span>
<span class=n>acquisition_cont</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>get_acquisition</span><span class=p>(</span><span class=s2>&quot;&lt;acquisition-id&gt;&quot;</span><span class=p>)</span>

<span class=k>with</span> <span class=n>fw_gear</span><span class=o>.</span><span class=n>GearContext</span><span class=p>()</span> <span class=k>as</span> <span class=n>context</span><span class=p>:</span>
    <span class=n>context</span><span class=o>.</span><span class=n>metadata</span><span class=o>.</span><span class=n>add_qc_result_via_sdk</span><span class=p>(</span><span class=n>cont_</span><span class=o>=</span><span class=n>acquisition_cont</span><span class=p>,</span> <span class=s2>&quot;input_qc&quot;</span><span class=p>,</span> <span class=n>state</span><span class=o>=</span><span class=s2>&quot;PASS&quot;</span><span class=p>,{</span><span class=s1>&#39;my-result&#39;</span><span class=p>:</span> <span class=s1>&#39;test&#39;</span><span class=p>})</span>
</code></pre></div> </li> </ul> </div> <h6 id=example>Example</h6> <p>Below is an example code that do the following actions:</p> <ul> <li>Update destination container custom information</li> <li>Update the output file <code>out-file.dcm</code> modality and classification</li> <li>Update the <code>session</code> container label and custom information</li> </ul> <div class=highlight><pre><span></span><code><span class=k>with</span> <span class=n>fw_gear</span><span class=o>.</span><span class=n>GearContext</span><span class=p>()</span> <span class=k>as</span> <span class=n>context</span><span class=p>:</span>
    <span class=c1># Update the destination container custom information</span>
    <span class=n>info</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;my-metric&quot;</span><span class=p>:</span> <span class=s2>&quot;my-value&quot;</span><span class=p>}</span>
    <span class=n>context</span><span class=o>.</span><span class=n>metadata</span><span class=o>.</span><span class=n>update_container</span><span class=p>(</span><span class=n>context</span><span class=o>.</span><span class=n>destination</span><span class=o>.</span><span class=n>type</span><span class=p>,</span> <span class=n>info</span><span class=o>=</span><span class=n>info</span><span class=p>)</span>
    <span class=c1># Set the modality and classification of an output file</span>
    <span class=n>context</span><span class=o>.</span><span class=n>metadata</span><span class=o>.</span><span class=n>update_file_metadata</span><span class=p>(</span>
        <span class=s2>&quot;out-file.dcm&quot;</span><span class=p>,</span>  <span class=c1># NOTE: File must exist in output directory fo this to work</span>
        <span class=n>modality</span><span class=o>=</span><span class=s2>&quot;MR&quot;</span><span class=p>,</span>
        <span class=n>classification</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;Measurement&quot;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&quot;T1&quot;</span><span class=p>]}</span>
    <span class=p>)</span>
    <span class=c1># Update the any parent container. Example:</span>
    <span class=n>info</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;my-metric&quot;</span><span class=p>:</span> <span class=s2>&quot;my-other-value&quot;</span><span class=p>}</span>
    <span class=n>context</span><span class=o>.</span><span class=n>metadata</span><span class=o>.</span><span class=n>update_container</span><span class=p>(</span><span class=s2>&quot;session&quot;</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s2>&quot;Session 1&quot;</span><span class=p>,</span> <span class=n>info</span><span class=o>=</span><span class=n>info</span><span class=p>)</span>
</code></pre></div> <p>After running the code above, a <code>.metadata.json</code> file will be generated.</p> <p><em>Note</em>: In this example, it is being run in an <strong>analysis</strong> gear</p> <div class=highlight><pre><span></span><code><span class=p>{</span>
<span class=w>    </span><span class=err>&#39;a</span><span class=kc>nal</span><span class=err>ysis&#39;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=err>&#39;i</span><span class=kc>nf</span><span class=err>o&#39;</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=err>&#39;my</span><span class=mi>-</span><span class=err>me</span><span class=kc>tr</span><span class=err>ic&#39;</span><span class=p>:</span><span class=w> </span><span class=err>&#39;my</span><span class=mi>-</span><span class=err>value&#39;</span><span class=p>},</span>
<span class=w>        </span><span class=err>&#39;</span><span class=kc>f</span><span class=err>iles&#39;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>            </span><span class=err>&#39;ou</span><span class=kc>t</span><span class=mi>-</span><span class=kc>f</span><span class=err>ile.dcm&#39;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>                </span><span class=err>&#39;modali</span><span class=kc>t</span><span class=err>y&#39;</span><span class=p>:</span><span class=w> </span><span class=err>&#39;MR&#39;</span><span class=p>,</span>
<span class=w>                </span><span class=err>&#39;classi</span><span class=kc>f</span><span class=err>ica</span><span class=kc>t</span><span class=err>io</span><span class=kc>n</span><span class=err>&#39;</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=err>&#39;Measureme</span><span class=kc>nt</span><span class=err>&#39;</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=err>&#39;T</span><span class=mi>1</span><span class=err>&#39;</span><span class=p>]}</span>
<span class=w>            </span><span class=p>}</span>
<span class=w>        </span><span class=p>]</span>
<span class=w>    </span><span class=p>},</span>
<span class=w>    </span><span class=err>&#39;sessio</span><span class=kc>n</span><span class=err>&#39;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=err>&#39;i</span><span class=kc>nf</span><span class=err>o&#39;</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=nt>&quot;my-metric&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;my-other-value&quot;</span><span class=p>},</span>
<span class=w>        </span><span class=err>&#39;label&#39;</span><span class=p>:</span><span class=w> </span><span class=err>&#39;Sessio</span><span class=kc>n</span><span class=w> </span><span class=mi>1</span><span class=err>&#39;</span>
<span class=w>    </span><span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <h2 id=logging>Logging</h2> <p>Calling <code>context.init_logging()</code> will configure python logger to log message at INFO level. If your <code>manifest.json</code> defines a boolean <code>debug</code> option, then it <code>init_logging()</code> will use this value to set the logging level to DEBUG when <code>debug</code> is <code>True</code>.</p> <div class=highlight><pre><span></span><code><span class=k>with</span> <span class=n>GearToolkitContext</span><span class=p>()</span> <span class=k>as</span> <span class=n>context</span><span class=p>:</span>
    <span class=c1># Setup basic logging</span>
    <span class=n>context</span><span class=o>.</span><span class=n>init_logging</span><span class=p>()</span>
</code></pre></div> <h2 id=sdk-profiling>SDK Profiling</h2> <p>With <code>flywheel-sdk</code> &gt;= 16.0.0, the <code>GearContext</code> context manager will automatically report out API usage of your gear when <code>debug</code> config option is enabled in the <code>config.json</code>. Example:</p> <div class=highlight><pre><span></span><code><span class=kn>import</span><span class=w> </span><span class=nn>logging</span>
<span class=n>log</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
<span class=kn>from</span><span class=w> </span><span class=nn>flywheel_gear_toolkit</span><span class=w> </span><span class=kn>import</span> <span class=n>GearToolkitContext</span>
<span class=k>with</span> <span class=n>GearToolkitContext</span><span class=p>()</span> <span class=k>as</span> <span class=n>context</span><span class=p>:</span>
  <span class=n>context</span><span class=o>.</span><span class=n>init_logging</span><span class=p>()</span>
  <span class=n>proj</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>lookup</span><span class=p>(</span><span class=s1>&#39;&lt;group&gt;/&lt;project.label&gt;&#39;</span><span class=p>)</span>
  <span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Found project: </span><span class=si>{</span><span class=n>proj</span><span class=o>.</span><span class=n>id</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</code></pre></div> <p>will log</p> <div class=highlight><pre><span></span><code><span class=p>[</span> <span class=mi>20210701</span> <span class=mi>12</span><span class=p>:</span><span class=mi>52</span><span class=p>:</span><span class=mi>06</span>     <span class=n>INFO</span> <span class=n>flywheel_gear_toolkit</span><span class=o>.</span><span class=n>logging</span><span class=p>:</span> <span class=mi>219</span> <span class=o>-</span> <span class=n>configure_logging</span><span class=p>()</span>  <span class=p>]</span> <span class=n>Log</span> <span class=n>level</span> <span class=ow>is</span> <span class=n>DEBUG</span>
<span class=p>[</span> <span class=mi>20210701</span> <span class=mi>12</span><span class=p>:</span><span class=mi>52</span><span class=p>:</span><span class=mi>07</span>     <span class=n>INFO</span> <span class=n>__main__</span><span class=p>:</span> <span class=mi>4</span> <span class=o>-</span> <span class=o>&lt;</span><span class=n>module</span><span class=o>&gt;</span><span class=p>()</span>  <span class=p>]</span> <span class=n>Found</span> <span class=n>project</span><span class=p>:</span> <span class=mi>603413543321</span><span class=n>ab021ef0a0a7</span>
<span class=p>[</span> <span class=mi>20210701</span> <span class=mi>12</span><span class=p>:</span><span class=mi>52</span><span class=p>:</span><span class=mi>07</span>    <span class=n>DEBUG</span> <span class=n>flywheel_gear_toolkit</span><span class=o>.</span><span class=n>context</span><span class=o>.</span><span class=n>context</span><span class=p>:</span> <span class=mi>618</span> <span class=o>-</span> <span class=fm>__exit__</span><span class=p>()</span>  <span class=p>]</span> <span class=n>SDK</span> <span class=n>usage</span><span class=p>:</span>
<span class=p>{</span><span class=s1>&#39;GET&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;https://ga.ce.flywheel.io:443/api/version&#39;</span><span class=p>:</span> <span class=mi>1</span><span class=p>},</span>
<span class=s1>&#39;POST&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;https://ga.ce.flywheel.io:443/api/lookup&#39;</span><span class=p>:</span> <span class=mi>1</span><span class=p>}}</span>
</code></pre></div> <h2 id=modify-file>Modify File</h2> <h3 id=sanitize-filename-sanitize_label>Sanitize Filename (<code>sanitize_label</code>)</h3> <p>This method can be used to sanitize and truncate strings to ensure it is compatible with the filesystem directory or filename requirements. It replaces invalid characters and ensures the length does not exceed 255 characters.</p> <p>Heres what the function does:</p> <ul> <li>Replaces any asterisks (*) with the word "star".</li> <li>Invalid characters (e.g.,*, /, \, and other non-printable characters) are substituted with underscores (_).</li> <li>Truncates the string to a maximum of 255 characters.</li> </ul> <div class="admonition info"> <p class=admonition-title>Usage</p> </div> <ul> <li> <p>Arguments:</p> <ul> <li><code>value</code> (<code>str</code>): The input string that represents the filename or directory label to be sanitized.</li> </ul> </li> <li> <p>Returns:</p> <ul> <li>A cleaned and shortened version of the input string, with invalid characters replaced and the string limited to 255 characters.</li> </ul> </li> </ul> <div class="admonition info"> <p class=admonition-title>Usage</p> <ul> <li> <p><strong>Sanitize a filename.</strong></p> <div class=highlight><pre><span></span><code><span class=kn>from</span><span class=w> </span><span class=nn>fw_gear.utils</span><span class=w> </span><span class=kn>import</span> <span class=n>sanitize_label</span>

<span class=n>sanitize_filename</span> <span class=o>=</span> <span class=n>sanitize_label</span><span class=p>(</span><span class=s2>&quot;Invalid*Label/With:Forbidden</span><span class=se>\\</span><span class=s2>Characters&quot;</span><span class=p>)</span>
<span class=nb>print</span><span class=p>(</span><span class=n>filename</span><span class=p>)</span>

<span class=c1># Output: &quot;InvalidstarLabel_With_Forbidden_Characters&quot;</span>
</code></pre></div> </li> </ul> </div> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <!--
Extend original footer template to get page title from page.meta keep it sync with the original:
https://github.com/squidfunk/mkdocs-material/blob/master/src/partials/footer.html
--> <footer class=md-footer> <!-- Link to previous and/or next page --> <nav class="md-footer__inner md-grid" aria-label=footer.title> <!-- Link to previous page --> <a href=../specs/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Specification" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> <!-- CUSTOM PART --> Specification <!-- CUSTOM PART ENDS --> </div> </div> </a> <!-- Link to next page --> <a href=../utils/ class="md-footer__link md-footer__link--next" aria-label="Next: Utils" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> <!-- CUSTOM PART --> Utils <!-- CUSTOM PART ENDS --> </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <!-- Further information --> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <!-- Social links --> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.indexes", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../assets/javascripts/bundle.13a4f30d.min.js></script> <script src=https://cdn.jsdelivr.net/npm/ansi_up@5.1.0/ansi_up.min.js></script> <script src=https://cdn.flywheel.io/static/mkdocs/javascripts/ansi-renderer.js></script> <script src=https://cdn.flywheel.io/static/mkdocs/javascripts/asciinema-player.js></script> </body> </html>