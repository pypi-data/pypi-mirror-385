{% extends "layout.html" %}

<!-- HTMX example -->

{% block content %}

    <div class="d-flex align-items-center mb-2">
        {{ macros.backBtn(url_for('printers.view') if editing else url_for('printers.add_printer_view')) }}

        <h3 class="mb-0">
            {% if editing %}
                <strong>Edit printer</strong>
            {% else %}
                <strong>Add printer</strong>
            {% endif %}
        </h3>
    </div>

    <p class="text-small text-muted">
        {% if access_code_only %}
            To finish the setup, we need the access code of your printer.
        {% else %}
            To link your Bambu Lab printer to SimplyPrint, we need to be able to communicate with it.
            To do so, we need a bit of information about your printer.
            All information required can be found <b>on the screen of your printer</b>.
        {% endif %}
        <br>
        If you're having trouble finding the information, please refer to the
        {{ macros.externalLink('help article', 'https://help.simplyprint.io/en/article/xqlhtd') }}.
    </p>

    <form hx-post="/api/printer" hx-target="#response" class="mb-3">
        <div class="form-group mb-3"
             {% if access_code_only or (printer and printer.cloud_account) %}style="display: none;"{% endif %}>
            <label for="model">
                Printer Model
                {{ macros.tooltipHelp('Choose your printers model. This will help us to determine how to communicate with
            your printer.') }}
            </label>
            <select class="form-control" id="model" name="model">
                <option value="" selected disabled hidden>Select printer model</option>
                {% for key, name in models %}
                    <option value="{{ key }}" {% if printer and printer.device_type.value==key %}selected{% endif %}>
                        {{ name }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <!-- X1 guide accordion -->
        <div class="accordion mb-3 d-none" id="guide-x1">
            <div class="accordion-item">
                <h2 class="accordion-header" id="guide-x1-finding-ip-ac">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                            data-bs-target="#guide-x1-finding-ip-ac-collapse" aria-expanded="false"
                            aria-controls="guide-x1-finding-ip-ac-collapse">
                        <span><strong>Guide:</strong> Finding the IP address and access code of your printer</span>
                    </button>
                </h2>
                <div id="guide-x1-finding-ip-ac-collapse" class="accordion-collapse collapse"
                     aria-labelledby="guide-x1-finding-ip-ac" data-bs-parent="#guide-x1">
                    <div class="accordion-body">
                        <p>
                            <strong>To find the IP address and access code of your printer, follow these steps:</strong>
                        </p>

                        <p><strong>1. </strong> First go into network settings:</p>

                        <div class="d-flex justify-content-center mb-3">
                            <div class="col-12 col-md-8 col-lg-6">
                                <img loading="lazy"
                                     src="{{ url_for('static', filename='img/setup/x1/home-network.webp') }}"
                                     class="img-fluid" alt="Step 1">
                            </div>
                        </div>

                        <p><strong>2. </strong> Here you can find the IP address and access code of your printer:</p>

                        <div class="d-flex justify-content-center">
                            <div class="col-12 col-md-8 col-lg-6">
                                <img loading="lazy" src="{{ url_for('static', filename='img/setup/x1/ip-ac.webp') }}"
                                     class="img-fluid" alt="Step 2">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% if not access_code_only %}
                <div class="accordion-item">
                    <h2 class="accordion-header" id="guide-x1-finding-sn">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                data-bs-target="#guide-x1-finding-sn-collapse" aria-expanded="false"
                                aria-controls="guide-x1-finding-sn-collapse">
                            <span><strong>Guide:</strong> Finding the serial number of your printer</span>
                        </button>
                    </h2>
                    <div id="guide-x1-finding-sn-collapse" class="accordion-collapse collapse"
                         aria-labelledby="guide-x1-finding-sn" data-bs-parent="#guide-x1">
                        <div class="accordion-body">
                            <p>
                                <strong>To find the serial number of your printer, follow these steps:</strong>
                            </p>

                            <p><strong>1. </strong> First go into settings:</p>

                            <div class="d-flex justify-content-center mb-3">
                                <div class="col-12 col-md-8 col-lg-6">
                                    <img loading="lazy"
                                         src="{{ url_for('static', filename='img/setup/x1/home-settings.webp') }}"
                                         class="img-fluid" alt="Step 1">
                                </div>
                            </div>

                            <p><strong>2. </strong> Here you can find the serial number of your printer:</p>

                            <div class="d-flex justify-content-center">
                                <div class="col-12 col-md-8 col-lg-6">
                                    <img loading="lazy"
                                         src="{{ url_for('static', filename='img/setup/x1/settings.webp') }}"
                                         class="img-fluid" alt="Step 2">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>
        <!-- /X1 guide accordion -->

        <!-- P1 guide accordion -->
        <div class="accordion mb-3 d-none" id="guide-p1">
            <div class="accordion-item">
                <h2 class="accordion-header" id="guide-p1-finding-ip-ac">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                            data-bs-target="#guide-p1-finding-ip-ac-collapse" aria-expanded="false"
                            aria-controls="guide-p1-finding-ip-ac-collapse">
                        <span><strong>Guide:</strong> Finding the IP address and access code of your printer</span>
                    </button>
                </h2>
                <div id="guide-p1-finding-ip-ac-collapse" class="accordion-collapse collapse"
                     aria-labelledby="guide-p1-finding-ip-ac" data-bs-parent="#guide-p1">
                    <div class="accordion-body">
                        <p>
                            <strong>To find the IP address and access code of your printer, follow these steps:</strong>
                        </p>

                        <p><strong>1. </strong> First go into settings:</p>

                        <div class="d-flex justify-content-center mb-3">
                            <div class="col-12 col-md-8 col-lg-6">
                                <img loading="lazy" src="{{ url_for('static', filename='img/setup/p1/home.webp') }}"
                                     class="img-fluid" alt="Step 1">
                            </div>
                        </div>

                        <p><strong>2. </strong> Then go into the network settings submenu:</p>

                        <div class="d-flex justify-content-center mb-3">
                            <div class="col-12 col-md-8 col-lg-6">
                                <img loading="lazy" src="{{ url_for('static', filename='img/setup/p1/settings.webp') }}"
                                     class="img-fluid" alt="Step 2">
                            </div>
                        </div>

                        <p><strong>3. </strong> Here you can find the IP address and access code of your printer:</p>

                        <div class="d-flex justify-content-center">
                            <div class="col-12 col-md-8 col-lg-6">
                                <img loading="lazy" src="{{ url_for('static', filename='img/setup/p1/ip-ac.webp') }}"
                                     class="img-fluid" alt="Step 3">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% if not access_code_only %}
                <div class="accordion-item">
                    <h2 class="accordion-header" id="guide-p1-finding-sn">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                data-bs-target="#guide-p1-finding-sn-collapse" aria-expanded="false"
                                aria-controls="guide-p1-finding-sn-collapse">
                            <span><strong>Guide:</strong> Finding the serial number of your printer</span>
                        </button>
                    </h2>
                    <div id="guide-p1-finding-sn-collapse" class="accordion-collapse collapse"
                         aria-labelledby="guide-p1-finding-sn" data-bs-parent="#guide-p1">
                        <div class="accordion-body">
                            <p>
                                <strong>To find the serial number of your printer, follow these steps:</strong>
                            </p>

                            <p><strong>1. </strong> First go into settings:</p>

                            <div class="d-flex justify-content-center mb-3">
                                <div class="col-12 col-md-8 col-lg-6">
                                    <img loading="lazy" src="{{ url_for('static', filename='img/setup/p1/home.webp') }}"
                                         class="img-fluid" alt="Step 1">
                                </div>
                            </div>

                            <p>
                                <strong>2. </strong>
                                Then press down until you reach the serial number at the bottom of the settings:
                            </p>

                            <div class="d-flex justify-content-center">
                                <div class="col-12 col-md-8 col-lg-6">
                                    <img loading="lazy" src="{{ url_for('static', filename='img/setup/p1/sn.webp') }}"
                                         class="img-fluid" alt="Step 2">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>
        <!-- /P1 guide accordion -->

        <!-- A1 guide accordion -->
        <div class="accordion mb-3 d-none" id="guide-a1">
            <div class="accordion-item">
                <h2 class="accordion-header" id="guide-a1-finding-ip-ac">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                            data-bs-target="#guide-a1-finding-ip-ac-collapse" aria-expanded="false"
                            aria-controls="guide-a1-finding-ip-ac-collapse">
                        <span><strong>Guide:</strong> Finding the IP address and access code of your printer</span>
                    </button>
                </h2>
                <div id="guide-a1-finding-ip-ac-collapse" class="accordion-collapse collapse"
                     aria-labelledby="guide-a1-finding-ip-ac" data-bs-parent="#guide-a1">
                    <div class="accordion-body">
                        <p>
                            <strong>To find the IP address and access code of your printer, follow these steps:</strong>
                        </p>

                        <p><strong>1. </strong> Navigate to the settings page from the home screen:</p>

                        <div class="d-flex justify-content-center mb-3">
                            <div class="col-12 col-md-8 col-lg-6">
                                <img loading="lazy" src="{{ url_for('static', filename='img/setup/a1/home.webp') }}"
                                     class="img-fluid" alt="Step 1">
                            </div>
                        </div>

                        <p><strong>2. </strong> Navigate to page 3 and press "LAN Only Mode":</p>

                        <div class="d-flex justify-content-center mb-3">
                            <div class="col-12 col-md-8 col-lg-6">
                                <img loading="lazy"
                                     src="{{ url_for('static', filename='img/setup/a1/settings-lan-only.webp') }}"
                                     class="img-fluid" alt="Step 2">
                            </div>
                        </div>

                        <p><strong>3. </strong> You should now see both your printer's IP as well as the access code:
                        </p>

                        <div class="alert alert-warning" role="alert">
                            If there is no Access Code, please enable LAN Only Mode first.
                        </div>

                        <div class="d-flex justify-content-center">
                            <div class="col-12 col-md-8 col-lg-6">
                                <img loading="lazy" src="{{ url_for('static', filename='img/setup/a1/ip-ac.webp') }}"
                                     class="img-fluid" alt="Step 3">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% if not access_code_only %}
                <div class="accordion-item">
                    <h2 class="accordion-header" id="guide-a1-finding-sn">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                data-bs-target="#guide-a1-finding-sn-collapse" aria-expanded="false"
                                aria-controls="guide-a1-finding-sn-collapse">
                            <span><strong>Guide:</strong> Finding the serial number of your printer</span>
                        </button>
                    </h2>
                    <div id="guide-a1-finding-sn-collapse" class="accordion-collapse collapse"
                         aria-labelledby="guide-a1-finding-sn" data-bs-parent="#guide-a1">
                        <div class="accordion-body">
                            <p>
                                <strong>To find the serial number of your printer, follow these steps:</strong>
                            </p>

                            <p><strong>1. </strong> First go into settings:</p>

                            <div class="d-flex justify-content-center mb-3">
                                <div class="col-12 col-md-8 col-lg-6">
                                    <img loading="lazy" src="{{ url_for('static', filename='img/setup/a1/home.webp') }}"
                                         class="img-fluid" alt="Step 1">
                                </div>
                            </div>

                            <p>
                                <strong>2. </strong> Navigate to page 2 and press "Device":
                            </p>

                            <div class="d-flex justify-content-center">
                                <div class="col-12 col-md-8 col-lg-6">
                                    <img loading="lazy"
                                         src="{{ url_for('static', filename='img/setup/a1/settings-device.webp') }}"
                                         class="img-fluid" alt="Step 2">
                                </div>
                            </div>

                            <p>
                                <strong>3. </strong> You should now see your printer's serial number:
                            </p>

                            <div class="d-flex justify-content-center">
                                <div class="col-12 col-md-8 col-lg-6">
                                    <img loading="lazy" src="{{ url_for('static', filename='img/setup/a1/sn.webp') }}"
                                         class="img-fluid" alt="Step 3">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>
        <!-- /A1 guide accordion -->

        <div class="form-group mb-3" {% if access_code_only %}style="display: none;"{% endif %}>
            <label for="ip">Printer IP address
                {{ macros.tooltipHelp('The IP address of the printer. Can be found in the network settings.') }}</label>
            <input type="text" class="form-control" id="ip" name="ip" placeholder="Enter IP address"
                   value="{{ (printer.host if printer) or '' }}">
        </div>

        <div class="form-group mb-3"
             {% if access_code_only or (printer and printer.cloud_account) %}style="display: none;"{% endif %}>
            <label for="sn">Printer Serial Number {{ macros.tooltipHelp('The serial number of the printer') }}</label>
            <input type="text" class="form-control" id="sn" name="sn" placeholder="Enter serial number"
                   value="{{ (printer.serial if printer) or '' }}">
        </div>

        <div class="form-group mb-3">
            <label for="access_code">Printer Access code
                {{ macros.tooltipHelp('The access code of the printer. Can be found in the network settings.') }}</label>
            <input type="text" class="form-control" id="access_code" name="access_code" placeholder="Enter access code"
                   value="{{ (printer.access_code if printer) or '' }}">
        </div>

        <div id="response" class="mb-3"></div>

        {% if editing %}
            <input type="hidden" name="unique_id" value="{{ printer.unique_id }}">
            <button type="submit" class="btn btn-primary">Save printer</button>
        {% else %}
            <button type="submit" class="real btn btn-primary">Add printer</button>
            <button onclick="void(0);" class="fake btn btn-primary">Add printer</button>
        {% endif %}
    </form>

    <script src="{{ url_for('static', filename='js/add_printer.js') }}"></script>
{% endblock %}
