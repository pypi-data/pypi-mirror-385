import{j as e}from"./ui-DNQDtwue.js";import{j as F,r as x}from"./vendor-HYqqWE7B.js";import{u as T,e as $,n as g,D as b,B as c}from"./index-CIKZHYu_.js";import{C as k}from"./circle-x-kLEJeam9.js";import{C as L}from"./circle-check-big-BYCA3xfh.js";import{E as B}from"./external-link-DmBYznHe.js";const N=({className:s,children:t,...r})=>e.jsx("div",{className:`rounded-lg border bg-white/10 backdrop-blur-lg border-white/20 shadow-sm ${s||""}`,...r,children:t}),A=({className:s,children:t,...r})=>e.jsx("div",{className:`flex flex-col space-y-1.5 p-6 ${s||""}`,...r,children:t}),S=({className:s,children:t,...r})=>e.jsx("h3",{className:`text-2xl font-semibold leading-none tracking-tight text-white ${s||""}`,...r,children:t}),E=({className:s,children:t,...r})=>e.jsx("p",{className:`text-sm text-gray-300 ${s||""}`,...r,children:t}),w=({className:s,children:t,...r})=>e.jsx("div",{className:`p-6 pt-0 ${s||""}`,...r,children:t});function X(){const s=T(),[t]=F(),{isAuthenticated:r}=$(),[n,P]=x.useState(null),[f,h]=x.useState(!0),[j,o]=x.useState(null),[i,l]=x.useState("pending"),d=t.get("server_name"),p=t.get("return_url")||"/servers";x.useEffect(()=>{if(!r){s.push("/login");return}if(!d){o("Server name is required"),h(!1);return}v()},[r,d,s]);const v=async()=>{try{h(!0),o(null);const a=localStorage.getItem("access_token");if(!a)throw new Error("No access token available");const m=await g.initiateMCPServerAuth(d,a);if(m.success&&m.data)P(m.data),l("pending");else throw new Error(m.error||"Failed to initiate authorization")}catch(a){console.error("Authorization initiation error:",a),o(a instanceof Error?a.message:"Failed to initiate authorization"),l("error")}finally{h(!1)}},R=()=>{n?.authorization_url&&window.open(n.authorization_url,"_blank")},_=async()=>{try{h(!0),await new Promise(u=>setTimeout(u,2e3));const a=localStorage.getItem("access_token");if(!a)throw new Error("No access token available");if((await g.connectMCPServer(d,a)).success)l("success"),setTimeout(()=>{s.push(p)},2e3);else{const u=await g.listMCPServers(a);if(u.success&&u.data){const z=(u.data.servers||u.data).find(D=>D.name===d);if(z&&z.status==="connected"){l("success"),setTimeout(()=>{s.push(p)},2e3);return}}l("error"),o("Authorization may not have completed successfully. Please try again.")}}catch(a){console.error("Authorization completion error:",a),l("error"),o("Failed to verify authorization completion")}finally{h(!1)}},y=()=>{o(null),l("pending"),v()},C=()=>{s.push(p)};return f&&!n?e.jsx("div",{className:"min-h-screen bg-linear-to-br from-slate-900 via-purple-900 to-slate-900 flex items-center justify-center p-4",children:e.jsx(N,{className:"w-full max-w-md bg-white/10 backdrop-blur-lg border-white/20",children:e.jsx(w,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx(b,{className:"h-6 w-6 animate-spin text-blue-400"}),e.jsx("span",{className:"text-white",children:"Initializing authorization..."})]})})})}):j&&!n?e.jsx("div",{className:"min-h-screen bg-linear-to-br from-slate-900 via-purple-900 to-slate-900 flex items-center justify-center p-4",children:e.jsxs(N,{className:"w-full max-w-md bg-white/10 backdrop-blur-lg border-white/20",children:[e.jsxs(A,{children:[e.jsxs(S,{className:"text-white flex items-center space-x-2",children:[e.jsx(k,{className:"h-6 w-6 text-red-400"}),e.jsx("span",{children:"Authorization Error"})]}),e.jsx(E,{className:"text-red-200",children:j})]}),e.jsx(w,{className:"space-y-4",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(c,{onClick:y,className:"flex-1",children:"Retry"}),e.jsx(c,{onClick:C,variant:"outline",className:"flex-1",children:"Cancel"})]})})]})}):e.jsx("div",{className:"min-h-screen bg-linear-to-br from-slate-900 via-purple-900 to-slate-900 flex items-center justify-center p-4",children:e.jsxs(N,{className:"w-full max-w-lg bg-white/10 backdrop-blur-lg border-white/20",children:[e.jsxs(A,{children:[e.jsxs(S,{className:"text-white flex items-center space-x-2",children:[i==="success"&&e.jsx(L,{className:"h-6 w-6 text-green-400"}),i==="error"&&e.jsx(k,{className:"h-6 w-6 text-red-400"}),i==="pending"&&e.jsx(b,{className:"h-6 w-6 animate-spin text-blue-400"}),e.jsxs("span",{children:[i==="success"&&"Authorization Successful",i==="error"&&"Authorization Failed",i==="pending"&&`Authorize ${d}`]})]}),e.jsx(E,{className:"text-gray-300",children:n?.message||"Complete the authorization process"})]}),e.jsxs(w,{className:"space-y-6",children:[i==="pending"&&n&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-blue-200 text-sm mb-3",children:n.instructions}),e.jsxs("div",{className:"bg-black/20 rounded p-3",children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"Authorization URL:"}),e.jsx("p",{className:"text-xs text-blue-300 break-all",children:n.authorization_url})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(c,{onClick:R,className:"w-full bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Open Authorization Page"]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-400 mb-2",children:"After completing authorization in the new window, click the button below:"}),e.jsx(c,{onClick:_,disabled:f,variant:"outline",className:"w-full",children:f?e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"h-4 w-4 mr-2 animate-spin"}),"Verifying Authorization..."]}):"Complete Authorization"})]})]})]}),i==="success"&&e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"bg-green-500/10 border border-green-500/20 rounded-lg p-4",children:e.jsx("p",{className:"text-green-200",children:"Authorization completed successfully! Redirecting back to servers..."})}),e.jsx(c,{onClick:()=>s.push(p),className:"w-full",children:"Go to Servers"})]}),i==="error"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-red-500/10 border border-red-500/20 rounded-lg p-4",children:e.jsx("p",{className:"text-red-200",children:j||"Authorization failed. Please try again."})}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(c,{onClick:y,className:"flex-1",children:"Retry"}),e.jsx(c,{onClick:C,variant:"outline",className:"flex-1",children:"Cancel"})]})]})]})]})})}export{X as default};
//# sourceMappingURL=OAuthAuthorizePage-CQDKK2Hu.js.map
