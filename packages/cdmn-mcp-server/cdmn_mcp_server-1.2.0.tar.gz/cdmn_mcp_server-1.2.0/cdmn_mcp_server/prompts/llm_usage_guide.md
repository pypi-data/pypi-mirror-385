# CDMN MCP Server ì‚¬ìš© ê°€ì´ë“œ (í˜¸ì¶œì¸¡ LLMìš©)

## ê°œìš”

CDMN MCP ServerëŠ” ì™„ì „íˆ ì œë„¤ë¦­í•œ ë°©ì‹ìœ¼ë¡œ ì˜ì‚¬ê²°ì • ê·œì¹™ì„ ì‹¤í–‰í•˜ëŠ” ì„œë²„ì…ë‹ˆë‹¤. ì´ ê°€ì´ë“œëŠ” í˜¸ì¶œì¸¡ LLMì´ ì´ ì„œë²„ë¥¼ íš¨ê³¼ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ ì„¤ëª…í•©ë‹ˆë‹¤.

## ì£¼ìš” íŠ¹ì§•

- **ì œë„¤ë¦­ ì…ë ¥**: ê³ ì •ëœ ìŠ¤í‚¤ë§ˆ ëŒ€ì‹  key-value í˜•íƒœì˜ ìœ ì—°í•œ ì…ë ¥
- **ê·œì¹™ ê¸°ë°˜**: ë‹¤ì–‘í•œ ì˜ì‚¬ê²°ì • ê·œì¹™ì„ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬
- **ìŠ¤í‚¤ë§ˆ ì¡°íšŒ**: ê° ê·œì¹™ì˜ ì…ë ¥ ìš”êµ¬ì‚¬í•­ì„ ë™ì ìœ¼ë¡œ í™•ì¸ ê°€ëŠ¥
- **ì¶”ì  ê°€ëŠ¥**: ì˜ì‚¬ê²°ì • ê³¼ì •ì„ ë‹¨ê³„ë³„ë¡œ ì¶”ì 

## ì‚¬ìš© ê°€ëŠ¥í•œ ë„êµ¬

### 1. `list_rules()` -> List[str]
ì‚¬ìš© ê°€ëŠ¥í•œ ê·œì¹™ ëª©ë¡ì„ ì¡°íšŒí•©ë‹ˆë‹¤.

### 2. `get_rule_schema(rule_name: str)` -> Dict[str, Any]
íŠ¹ì • ê·œì¹™ì˜ ì…ë ¥ ìŠ¤í‚¤ë§ˆë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.

### 3. `infer_decision(rule_name: str, context_input: Union[str, Dict[str, Any]])` -> Dict[str, Any]
ì˜ì‚¬ê²°ì •ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.

### 4. `parse_natural_language(text: str)` -> Dict[str, Any]
ìì—°ì–´ë¥¼ êµ¬ì¡°í™”ëœ ë°ì´í„°ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.

## ì‚¬ìš© íŒ¨í„´

### íŒ¨í„´ 1: ê·œì¹™ ì¡°íšŒ í›„ ì‹¤í–‰

```python
# 1. ì‚¬ìš© ê°€ëŠ¥í•œ ê·œì¹™ ì¡°íšŒ
rules = await list_rules()
print(f"Available rules: {rules}")

# 2. íŠ¹ì • ê·œì¹™ì˜ ìŠ¤í‚¤ë§ˆ ì¡°íšŒ
schema = await get_rule_schema("insurance_premium")
print(f"Schema: {schema}")

# 3. ì˜ì‚¬ê²°ì • ì‹¤í–‰
result = await infer_decision("insurance_premium", {
    "age": 30,
    "gender": "male",
    "smoker": True,
    "health_score": 75
})
```

### íŒ¨í„´ 2: ìì—°ì–´ ì…ë ¥ ì²˜ë¦¬

```python
# ìì—°ì–´ ì…ë ¥ì„ êµ¬ì¡°í™”ëœ ë°ì´í„°ë¡œ ë³€í™˜
parsed = await parse_natural_language("30ì„¸ ë‚¨ìì´ê³  í¡ì—°ìì•¼. ê±´ê°• ì ìˆ˜ëŠ” 75ì•¼.")

# ë³€í™˜ëœ ë°ì´í„°ë¡œ ì˜ì‚¬ê²°ì • ì‹¤í–‰
result = await infer_decision("insurance_premium", parsed)
```

## ê²°ê³¼ ë°ì´í„° êµ¬ì¡°

```json
{
    "result": {
        "total_score": 65,
        "category": "Medium",
        "premium": 75000,
        "rule_name": "insurance_premium"
    },
    "trace": [
        {
            "step": 1,
            "rule": "ë‚˜ì´ ìœ„í—˜ë„ (ì¤‘ê°„)",
            "condition": {"age": {"min": 40, "max": 59}},
            "result": "+15",
            "matched": true
        },
        {
            "step": 2,
            "rule": "í¡ì—° ìœ„í—˜ë„",
            "condition": {"smoker": true},
            "result": "+40",
            "matched": true
        }
    ],
    "input_context": {
        "age": 30,
        "gender": "male",
        "smoker": true,
        "health_score": 75
    },
    "rule_name": "insurance_premium",
    "execution_time": 0.001,
    "rule_schema": {
        "description": "ë³´í—˜ë£Œ ê³„ì‚° ê·œì¹™",
        "required_fields": ["age", "gender", "smoker"],
        "optional_fields": ["health_score", "income", "vehicle_age", "credit_score"]
    }
}
```

## ë§ˆí¬ë‹¤ìš´ ìƒì„± ê°€ì´ë“œ

í˜¸ì¶œì¸¡ LLMì€ ë‹¤ìŒê³¼ ê°™ì€ êµ¬ì¡°ë¡œ ë§ˆí¬ë‹¤ìš´ì„ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤:

### ê¸°ë³¸ êµ¬ì¡°

```markdown
## ğŸ§  Decision Path: [ê·œì¹™ëª…]

### ì…ë ¥ ì •ë³´
| í•­ëª© | ê°’ |
|------|-----|
| [í•„ë“œëª…] | [ê°’] |

### ì˜ì‚¬ê²°ì • ê³¼ì •
1. **[ê·œì¹™ëª…]**: [ì¡°ê±´] â†’ [ê²°ê³¼]
2. **[ê·œì¹™ëª…]**: [ì¡°ê±´] â†’ [ê²°ê³¼]

### ìµœì¢… ê²°ê³¼
- **[ê²°ê³¼í‚¤]**: [ê°’]
- **[ê²°ê³¼í‚¤]**: [ê°’]

---
âœ… **Final Decision**: [ìµœì¢…ê²°ê³¼]
```

### ì˜ˆì‹œ: ë³´í—˜ë£Œ ê³„ì‚°

```markdown
## ğŸ§  Decision Path: ë³´í—˜ë£Œ ì‚°ì •

### ì…ë ¥ ì •ë³´
| í•­ëª© | ê°’ |
|------|-----|
| ë‚˜ì´ | 30ì„¸ |
| ì„±ë³„ | ë‚¨ì„± |
| í¡ì—°ì—¬ë¶€ | ì˜ˆ |
| ê±´ê°•ì ìˆ˜ | 75ì  |

### ì˜ì‚¬ê²°ì • ê³¼ì •
1. **ë‚˜ì´ ìœ„í—˜ë„ (ì¤‘ê°„)**: 40-59ì„¸ â†’ +15ì 
2. **í¡ì—° ìœ„í—˜ë„**: í¡ì—°ì â†’ +40ì 
3. **ê±´ê°• ìœ„í—˜ë„**: 75ì  (ì–‘í˜¸) â†’ +0ì 

### ìµœì¢… ê²°ê³¼
- **ì´ ì ìˆ˜**: 55ì 
- **ìœ„í—˜ë„ ë¶„ë¥˜**: Medium
- **ê³„ì‚°ëœ ë³´í—˜ë£Œ**: â‚©75,000

---
âœ… **Final Decision**: Medium Risk, â‚©75,000
```

## ì—ëŸ¬ ì²˜ë¦¬

ì„œë²„ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì—ëŸ¬ ìƒí™©ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤:

- **ê·œì¹™ ì—†ìŒ**: `{"error": "Rule 'unknown_rule' not configured"}`
- **ì‹¤í–‰ ì‹¤íŒ¨**: `{"error": "Rule execution failed: [ìƒì„¸ì˜¤ë¥˜]"}`
- **íŒŒì‹± ì‹¤íŒ¨**: `{"error": "Error parsing natural language: [ìƒì„¸ì˜¤ë¥˜]"}`

## ëª¨ë²” ì‚¬ë¡€

1. **í•­ìƒ ìŠ¤í‚¤ë§ˆë¥¼ ë¨¼ì € í™•ì¸**: `get_rule_schema()`ë¡œ ì…ë ¥ ìš”êµ¬ì‚¬í•­ í™•ì¸
2. **ìì—°ì–´ ì²˜ë¦¬ í™œìš©**: ë³µì¡í•œ ì…ë ¥ì€ `parse_natural_language()` ì‚¬ìš©
3. **ê²°ê³¼ ê²€ì¦**: `trace` ë°°ì—´ë¡œ ì˜ì‚¬ê²°ì • ê³¼ì • ê²€ì¦
4. **ì—ëŸ¬ ì²˜ë¦¬**: `error` í•„ë“œ í™•ì¸ í›„ ì ì ˆí•œ ë©”ì‹œì§€ ì œê³µ
5. **ë§ˆí¬ë‹¤ìš´ ìƒì„±**: ì¼ê´€ëœ êµ¬ì¡°ì™€ ì´ëª¨ì§€ ì‚¬ìš©

## í™•ì¥ ê°€ëŠ¥ì„±

ìƒˆë¡œìš´ ê·œì¹™ì„ ì¶”ê°€í•˜ë ¤ë©´:

1. `register_rule()` ë„êµ¬ ì‚¬ìš©
2. ê·œì¹™ ì„¤ì •ì— `type`, `schema`, `rules`, `thresholds` í¬í•¨
3. ì œë„¤ë¦­ ê·œì¹™ ì—”ì§„ì´ ìë™ìœ¼ë¡œ ì²˜ë¦¬

ì´ëŸ¬í•œ ë°©ì‹ìœ¼ë¡œ MCP ì„œë²„ëŠ” ì™„ì „íˆ ì œë„¤ë¦­í•˜ê³  í™•ì¥ ê°€ëŠ¥í•œ ì˜ì‚¬ê²°ì • í”Œë«í¼ì´ ë©ë‹ˆë‹¤.
