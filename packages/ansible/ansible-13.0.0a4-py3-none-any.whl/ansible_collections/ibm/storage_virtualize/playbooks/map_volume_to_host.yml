---
- name: Testing the IBM Storage Virtualize collection ibm_svc_vol_map
  hosts: localhost
  vars:
    clustername: 'clustername'
    username: 'username'
    password: 'password'
    domain: 'domain'
    test_vdisk: 'vdisk_name'
    pool: 'pool'
    test_host: 'host_name'
    fcwwpn1: 'fcwwpn'

  gather_facts: false
  connection: local
  tasks:
    - name: Fetch cluster auth token
      register: auth
      no_log: true
      ibm.storage_virtualize.ibm_svc_auth:
        clustername: "{{ clustername }}"
        username: "{{ username }}"
        password: "{{ password }}"

    - name: Create volume
      ibm.storage_virtualize.ibm_svc_manage_volume:
        clustername: "{{ clustername }}"
        token: "{{ auth.token }}"
        name: "{{ test_vdisk }}"
        state: present
        pool: "{{ pool }}"
        size: "1024"
        unit: "mb"
    - name: Creating Host
      ibm.storage_virtualize.ibm_svc_host:
        clustername: "{{ clustername }}"
        token: "{{ auth.token }}"
        name: "{{ test_host }}"
        state: present
        fcwwpn: "{{ fcwwpn1 }}"
    - name: Map Host to Vdisk
      ibm.storage_virtualize.ibm_svc_vol_map:
        clustername: "{{ clustername }}"
        token: "{{ auth.token }}"
        volname: "{{ test_vdisk }}"
        host: "{{ test_host }}"
        state: present
        scsi: 0
