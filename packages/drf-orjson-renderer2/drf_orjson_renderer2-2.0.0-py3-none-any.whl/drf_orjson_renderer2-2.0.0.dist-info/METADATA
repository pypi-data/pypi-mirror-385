Metadata-Version: 2.4
Name: drf-orjson-renderer2
Version: 2.0.0
Summary: "Django RestFramework JSON Renderer Backed by orjson"
Keywords: drf_orjson_renderer,rest_framework,orjson
Author-email: brianjbuck <brian@thebuckpasser.com>
Maintainer-email: Jonathan Dekhtiar <jonathan@dekhtiar.com>
Requires-Python: >=3.10
Description-Content-Type: text/markdown
Classifier: Intended Audience :: Developers
Classifier: Intended Audience :: Science/Research
Classifier: Intended Audience :: Information Technology
Classifier: Topic :: Software Development :: Build Tools
Classifier: Topic :: Scientific/Engineering
Classifier: Topic :: Software Development :: Libraries
Classifier: Topic :: Utilities
Classifier: License :: OSI Approved :: MIT License
Classifier: Operating System :: OS Independent
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3 :: Only
License-File: LICENSE
Requires-Dist: django>=3.2
Requires-Dist: djangorestframework
Requires-Dist: orjson>=3.3.0
Requires-Dist: jsondiff>=2.2,<2.3 ; extra == "test"
Requires-Dist: numpy>=2.0.0 ; extra == "test"
Requires-Dist: pytest>=8.0.0,<9.0.0 ; extra == "test"
Requires-Dist: pytest-cov>=5.0.0,<8.0.0 ; extra == "test"
Requires-Dist: pytest-dotenv>=0.5.0,<1.0.0 ; extra == "test"
Requires-Dist: pytest-env>=1.1.3,<2.0.0 ; extra == "test"
Requires-Dist: pytest-runner>=6.0.0,<7.0.0 ; extra == "test"
Requires-Dist: pytest-ordering>=0.6,<1.0.0 ; extra == "test"
Requires-Dist: pytest-xdist>=3.6.0,<3.9.0 ; extra == "test"
Requires-Dist: parameterized>=0.9.0,<0.10 ; extra == "test"
Project-URL: Bug Reports, https://github.com/OpenSpeleo/drf-orjson-renderer2/issues
Project-URL: Homepage, https://pypi.org/project/drf-orjson-renderer2/
Project-URL: Source, https://github.com/OpenSpeleo/drf-orjson-renderer2
Provides-Extra: test

Django Rest Framework ORJSON Renderer
=====================================

[![DRF ORJSON Renderer Tests](https://github.com/brianjbuck/drf_orjson_renderer/actions/workflows/main.yml/badge.svg)](https://github.com/brianjbuck/drf_orjson_renderer/actions/workflows/main.yml)

`drf_orjson_renderer2` is JSON renderer and parser for Django Rest Framework
using the [orjson](https://github.com/ijl/orjson) library. Backed by
[Rust](https://www.rust-lang.org/), orjson is safe, correct and _fast_. ⚡️

In addition, unlike some performance optimized DRF renderers, It also renders
pretty printed JSON when requests are made via RestFramework's BrowsableAPI.

You get:
- The safety of Rust
- The speed of orjson when requests are made with `Accept: appliation/json` HTTP
  header or when requests are made with an unspecified `Accept` header.
- The convenience of formatted output when requested with `Accept: text/html`.
- The ability to pass your own `default` function definition.


## Installation

`pip install drf-orjson-renderer2`

You can then set the `ORJSONRenderer` class as your default renderer in your `settings.py`

```Python
REST_FRAMEWORK = {
    "DEFAULT_RENDERER_CLASSES": (
        "drf_orjson_renderer2.renderers.ORJSONRenderer",
        "rest_framework.renderers.BrowsableAPIRenderer",
    ),
}
```
To modify how data is serialized, specify options in your `settings.py`
```Python
REST_FRAMEWORK = {
    "ORJSON_RENDERER_OPTIONS": (
        orjson.OPT_NON_STR_KEYS,
        orjson.OPT_SERIALIZE_DATACLASS,
        orjson.OPT_SERIALIZE_NUMPY,
    ),
}
```

Also you can set the `ORJSONParser` class as your default parser in your `settings.py`

```Python
REST_FRAMEWORK = {
    "DEFAULT_PARSER_CLASSES": (
        "drf_orjson_renderer2.parsers.ORJSONParser",
    ),
}
```

## Passing Your Own `default` Function

By default, the `ORJSONRenderer` will pass a `default` function as a helper for
serializing objects that orjson doesn't recognize. That should cover the most
common cases found in a Django web application. If you find you have an object
it doesn't recognize you can pass your own default function by overriding the
`get_renderer_context()` method of your view:

```Python
from rest_framework.views import APIView
from rest_framework.response import Response


class MyView(APIView):
    def default(self, obj):
        if isinstance(obj, MyComplexData):
            return dict(obj)

    def get_renderer_context(self):
        renderer_context = super().get_renderer_context()
        renderer_context["default_function"] = self.default
        return renderer_context

    def get(self, request, *args, **kwargs):
        my_complex_data = MyComplexData()
        return Response(data=my_complex_data)
```

If you know your data is already in a format orjson natively
[recognizes](https://github.com/ijl/orjson/#types) you can get a small
performance boost by passing `None` to the `renderer_context`:

```Python
def get_renderer_context(self):
    renderer_context = super().get_renderer_context()
    renderer_context["default_function"] = None
    return renderer_context
```

As of ORJSON version 3, 2-space indenting is supported in serialization. In
order to take advantage of the RestFramework Browsable API, when the
requested media type is not `application/json`, the ORJSON renderer will add
`orjson.OPT_INDENT_2` to the options mask to pretty print your output.

## Benchmarks
See the [orjson Benchmarks](https://github.com/ijl/orjson#performance) for more information

