[project]
authors = [
    {name = "Konrad Komorowski"},
]
classifiers = [
    "Development Status :: 3 - Alpha",
    "Intended Audience :: Developers",
    "License :: OSI Approved :: MIT License",
    "Programming Language :: Python",
    "Programming Language :: Python :: 3",
    "Programming Language :: Python :: 3.12",
    "Programming Language :: Python :: 3.13",
]
dynamic = ["version"]
license = {file = "LICENSE"}
name = "kstd"
readme = "README.md"
requires-python = ">=3.12"

[dependency-groups]
dev = [
    "more-itertools==10.7.0", # TODO: Add import linter to not use this package in production code
    "poethepoet==0.37.0",
    "pytest==8.3.5",
    "pytest-asyncio==1.0.0",
    "ruff==0.11.7",
    "toml-sort==0.24.3",
]

[tool.hatch.version]
source = "versioningit"

[tool.versioningit]
default-version = "0.0.0+unknown"

[tool.versioningit.vcs]
default-tag = "0.0.0"
method = "git"

[tool.versioningit.format]
dirty = "{committer_date:%Y.%m.%d}.post{committer_date:%H%M}"
distance = "{committer_date:%Y.%m.%d}.post{committer_date:%H%M}"
distance-dirty = "{committer_date:%Y.%m.%d}.post{committer_date:%H%M}"

[tool.poe.tasks]
check_format_python = "ruff format --check"
check_format_toml = "toml-sort --check *.toml"
check_lint = "ruff check"
check_tests = "pytest"
check_types = "npx pyright"
format_python = "ruff format"
format_toml = "toml-sort --in-place *.toml"
install_pnpm = "pnpm install"
install_uv = "uv sync"

[tool.poe.tasks.check]
sequence = [
    "check_types",
    "check_lint",
    "check_tests",
    "check_format",
]

[tool.poe.tasks.check_format]
sequence = [
    "check_format_python",
    "check_format_toml",
]

[tool.poe.tasks.format]
sequence = [
    "format_python",
    "format_toml",
]

[tool.poe.tasks.install]
sequence = [
    "install_pnpm",
    "install_uv",
]

[tool.ruff]
extend = "src/kstd/configs/ruff.toml"
target-version = "py312"

[tool.ruff.lint]
extend-select = [
    "D", # We want the package to be documented
]
ignore = [
    "D203", # Incompatible with D211
    "D212", # Incompatible with D213
]

[tool.ruff.lint.pydocstyle]
convention = "google"

[tool.ruff.lint.per-file-ignores]
"tests/**" = [
    "D1", # Less stringent documentation requirements in tests
    "S101", # Asserts are expected in tests
]

[tool.tomlsort]
no_sort_tables = true
sort_inline_tables = true
sort_table_keys = true
spaces_indent_inline_array = 4
trailing_comma_inline_array = true

[tool.pyright]
extends = "src/kstd/configs/pyrightconfig.json"
pythonVersion = "3.12"
reportUnknownArgumentType = true
reportUnknownMemberType = true
reportUnknownVariableType = true

[tool.pytest.ini_options]
asyncio_mode = "auto"

[build-system]
build-backend = "hatchling.build"
requires = ["hatchling", "versioningit"]
