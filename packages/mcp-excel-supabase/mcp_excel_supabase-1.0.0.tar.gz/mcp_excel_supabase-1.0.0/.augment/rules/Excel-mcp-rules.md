---
type: "always_apply"
---

# Excel MCP 项目阶段性开发工作流程规则

## 1. 新对话初始化流程

每次开始新对话时，必须按以下顺序执行：

1. **读取项目进度文档**：
   - 读取 `step-report/development-plan.md` 了解整体开发计划和当前进度
   - 读取所有已完成阶段的报告文件：`step-report/stage-X-task-completion-report.md`（X为阶段编号：0, 1, 2...），所有阶段编号的完成报告都要读取
   - 特别关注历史bug记录，学习已解决的问题及其解决方案，避免重复犯错

2. **确认当前状态**：
   - 识别哪些阶段已完成（在 development-plan.md 中标记为"已完成"）
   - 确定下一个待开发的阶段

## 2. 新阶段开发启动流程

在开始任何新阶段的开发前，必须：

1. **任务分析与规划**：
   - 详细分析本阶段的开发任务细节
   - 理清技术实现逻辑和依赖关系
   - 列出具体的开发步骤和交付物

2. **用户确认**：
   - 向用户清晰展示本阶段的任务分析和开发计划
   - **等待用户明确确认后才能继续**

3. **创建任务列表**：
   - 使用 `add_tasks` 工具将本阶段的开发步骤写入任务列表
   - 逐一执行任务，及时更新任务状态（IN_PROGRESS、COMPLETE）

## 3. 阶段开发完成后的流程

### 3.1 初步完成汇报

开发完成后：
1. 向用户汇报本阶段的完成情况（包括实现的功能、创建的文件、代码统计等）
2. **等待用户确认后才能进入测试阶段**

### 3.2 测试阶段

用户确认后，必须执行全面测试：

**测试内容包括**：
- 运行所有单元测试（`pytest`）
- 检查代码覆盖率（目标 ≥ 80%）
- 执行代码质量检查（Black、Ruff、mypy）
- 进行功能验证测试
- 必要时进行安全审计（pip-audit）

**测试结果处理**：

- **如果测试全部通过，无bug**：
  - 直接进入报告生成阶段（见3.3节）

- **如果测试中发现bug**：
  1. 向用户详细汇报bug信息：
     - Bug的具体表现
     - Bug出现的根本原因
     - 提出的解决方案
  2. **等待用户确认后开始debug工作**
  3. 修复bug后重新运行测试
  4. 重复此流程直到所有测试通过

### 3.3 生成阶段完成报告

所有测试通过后：

1. **创建报告文件**：
   - 文件路径：`step-report/stage-X-task-completion-report.md`（X为当前阶段编号）
   - 文件格式：Markdown

2. **报告必须包含的内容**：
   - 阶段概述（目标、完成时间、状态）
   - 已完成的任务清单（详细列出每个任务的实现情况）
   - 测试结果汇总（单元测试、覆盖率、代码质量检查）
   - **Bug修复记录**（如果本阶段出现过bug）：
     - 每个bug的详细描述
     - Bug出现的根本原因分析
     - 具体的解决方案和修复代码
   - 创建的文件清单
   - 验收标准达成情况
   - 经验总结和注意事项

3. **更新开发计划**：
   - 在 `step-report/development-plan.md` 中将当前阶段标记为"已完成"
   - 更新所有相关的任务复选框为 `[x]`

## 4. 阶段收尾工作

生成报告后，必须清理测试产物：

**需要删除的文件/目录**：
- 所有临时测试脚本（如 `tests/manual_test.py`、`tests/temp_*.py` 等）
- 测试日志目录（`logs/`）
- 覆盖率报告目录（`htmlcov/`）
- pytest缓存（`.pytest_cache/`）
- 覆盖率数据文件（`.coverage`）

**保留的文件**：
- 正式的单元测试文件（`tests/test_*.py`）
- 测试配置文件（`tests/conftest.py`）

## 5. 阶段完成标志

一个阶段被视为"已完成"的唯一标志是：
- ✅ `step-report/stage-X-task-completion-report.md` 文件已创建
- ✅ `step-report/development-plan.md` 中该阶段已标记为"已完成"

## 6. 特别注意事项

1. **学习历史经验**：
   - 在开始新阶段前，仔细阅读之前阶段报告中的"Bug修复记录"
   - 了解已解决问题的解决方案，避免重复犯错
   - 特别关注代码质量问题（类型注解、格式化、linting等）

2. **测试文件管理**：
   - 区分"正式单元测试"和"临时测试脚本"
   - 每个阶段完成后只保留正式单元测试
   - 删除所有临时测试文件和测试产物

3. **用户确认节点**：
   - 开始新阶段前需要用户确认开发计划
   - 开发完成后需要用户确认才能开始测试
   - 发现bug后需要用户确认解决方案才能开始修复

4. **报告质量要求**：
   - 报告必须详实、结构清晰
   - Bug修复记录必须包含原因分析和解决方案
   - 使用Markdown格式，包含适当的标题、列表、代码块、表格等