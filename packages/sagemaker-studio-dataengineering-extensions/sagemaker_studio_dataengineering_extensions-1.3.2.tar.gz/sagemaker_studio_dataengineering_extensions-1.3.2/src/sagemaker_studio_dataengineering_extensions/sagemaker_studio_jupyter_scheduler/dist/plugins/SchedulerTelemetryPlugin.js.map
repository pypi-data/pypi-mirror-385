{"version":3,"file":"SchedulerTelemetryPlugin.js","sourceRoot":"","sources":["../../src/plugins/SchedulerTelemetryPlugin.tsx"],"names":[],"mappings":"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","sourcesContent":["import { JupyterFrontEnd, JupyterFrontEndPlugin } from '@jupyterlab/application';\nimport { Scheduler } from '@jupyterlab/scheduler';\nimport { pluginIds } from '../constants';\n\ninterface IEventLog {\n    body: {\n        name: string,\n        detail?: string\n    };\n    timestamp: Date;\n}\n\n// extend window to support panorama telemetry function\ndeclare global {\n    export interface Window {\n        panorama: (methodName: string, eventData: {\n            eventType: string,\n            eventDetail: string,\n            eventContext: string,\n            timestamp: number\n        }) => void;\n    }\n}\n\nenum PanoramaDataAnalyticsType {\n    eventDetail = 'eventDetail'\n}\n\nconst NB_JOBS_PANORAMA_FEATURE = 'NotebookJobs';\n\nconst EVENT_MAPPING: Record<string, string> = {\n    'org.jupyter.jupyter-scheduler.notebook-header.create-job': `${NB_JOBS_PANORAMA_FEATURE}-CreateJob-FromNotebookHeader`,\n    'org.jupyter.jupyter-scheduler.file-browser.create-job': `${NB_JOBS_PANORAMA_FEATURE}-CreateJob-FromFileBrowser`,\n    'org.jupyter.jupyter-scheduler.launcher.show-jobs': `${NB_JOBS_PANORAMA_FEATURE}-JobsList-OpenFromLauncher`,\n    'org.jupyter.jupyter-scheduler.create-job.options.package_input_folder.check': `${NB_JOBS_PANORAMA_FEATURE}-CreateJob-InputFolderCheck`,\n    'org.jupyter.jupyter-scheduler.create-job.options.package_input_folder.uncheck': `${NB_JOBS_PANORAMA_FEATURE}-CreateJob-InputFolderUncheck`,\n    'org.jupyter.jupyter-scheduler.create-job.create-job': `${NB_JOBS_PANORAMA_FEATURE}-CreateJob-Create`,\n    'org.jupyter.jupyter-scheduler.create-job.cancel': `${NB_JOBS_PANORAMA_FEATURE}-CreateJob-Cancel`,\n    'org.jupyter.jupyter-scheduler.create-job.create-job.success': `${NB_JOBS_PANORAMA_FEATURE}-CreateJob-Success`,\n    'org.jupyter.jupyter-scheduler.create-job.create-job.failure': `${NB_JOBS_PANORAMA_FEATURE}-CreateJob-Failure`,\n    'org.jupyter.jupyter-scheduler.create-job.create-job-definition': `${NB_JOBS_PANORAMA_FEATURE}-CreateJob-CreateJobDefinition`,\n    'org.jupyter.jupyter-scheduler.create-job.create-job-definition.success': `${NB_JOBS_PANORAMA_FEATURE}-CreateJobDefinition-Success`,\n    'org.jupyter.jupyter-scheduler.create-job.create-job-definition.failure': `${NB_JOBS_PANORAMA_FEATURE}-CreateJobDefinition-Failure`,\n    'org.jupyter.jupyter-scheduler.create-job-from-definition.create-job': `${NB_JOBS_PANORAMA_FEATURE}-CreateJobFromDefinition-Create`,\n    'org.jupyter.jupyter-scheduler.create-job-from-definition.create-job.success': `${NB_JOBS_PANORAMA_FEATURE}-CreateJobFromDefinition-Success`,\n    'org.jupyter.jupyter-scheduler.create-job-from-definition.create-job.failure': `${NB_JOBS_PANORAMA_FEATURE}-CreateJobFromDefinition-Failure`,\n    'org.jupyter.jupyter-scheduler.create-job-from-definition.cancel': `${NB_JOBS_PANORAMA_FEATURE}-CreateJobFromDefinition-Cancel`,\n    'org.jupyter.jupyter-scheduler.create-job.job-type.run-now': `${NB_JOBS_PANORAMA_FEATURE}-CreateJobType-RunNow`,\n    'org.jupyter.jupyter-scheduler.create-job.job-type.run-on-schedule': `${NB_JOBS_PANORAMA_FEATURE}-CreateJobType-RunOnSchedule`,\n    'org.jupyter.jupyter-scheduler.create-job.advanced-options.expand': `${NB_JOBS_PANORAMA_FEATURE}-CreateJob-ExpandAdvancedOptions`,\n    'org.jupyter.jupyter-scheduler.create-job.advanced-options.collapse': `${NB_JOBS_PANORAMA_FEATURE}-CreateJob-CollapseAdvancedOptions`,\n    'org.jupyter.jupyter-scheduler.jobs-list.reload': `${NB_JOBS_PANORAMA_FEATURE}-JobsList-Reload`,\n    'org.jupyter.jupyter-scheduler.jobs-definition-list.reload': `${NB_JOBS_PANORAMA_FEATURE}-JobsDefinitionList-Reload`,\n    'org.jupyter.jupyter-scheduler.jobs-list.open-input-file': `${NB_JOBS_PANORAMA_FEATURE}-JobsList-OpenInputFile`,\n    'org.jupyter.jupyter-scheduler.jobs-list.open-output-file': `${NB_JOBS_PANORAMA_FEATURE}-JobsList-OpenOutputFile`,\n    'org.jupyter.jupyter-scheduler.job-list.stop-confirm': `${NB_JOBS_PANORAMA_FEATURE}-JobsList-StopConfirm`,\n    'org.jupyter.jupyter-scheduler.jobs-list.download': `${NB_JOBS_PANORAMA_FEATURE}-JobsList-Download`,\n    'org.jupyter.jupyter-scheduler.jobs-list.open-detail': `${NB_JOBS_PANORAMA_FEATURE}-JobsList-OpenDetail`,\n    'org.jupyter.jupyter-scheduler.jobs-list.delete': `${NB_JOBS_PANORAMA_FEATURE}-JobsList-Delete`,\n    'org.jupyter.jupyter-scheduler.jobs-list.stop': `${NB_JOBS_PANORAMA_FEATURE}-JobsList-Stop`,\n    'org.jupyter.jupyter-scheduler.job-definition-list.open-detail': `${NB_JOBS_PANORAMA_FEATURE}-JobsDefinitionList-OpenDetail`,\n    'org.jupyter.jupyter-scheduler.job-definition-list.pause': `${NB_JOBS_PANORAMA_FEATURE}-JobsDefinitionList-Pause`,\n    'org.jupyter.jupyter-scheduler.job-definition-list.resume': `${NB_JOBS_PANORAMA_FEATURE}-JobsDefinitionList-Resume`,\n    'org.jupyter.jupyter-scheduler.job-definition-list.delete': `${NB_JOBS_PANORAMA_FEATURE}-JobsDefinitionList-Delete`,\n    'org.jupyter.jupyter-scheduler.job-detail.open-input-file': `${NB_JOBS_PANORAMA_FEATURE}-JobsDefinitionList-OpenInputFile`,\n    'org.jupyter.jupyter-scheduler.job-detail.open-output-file': `${NB_JOBS_PANORAMA_FEATURE}-JobsDefinitionList-OpenOutputFile`,\n    'org.jupyter.jupyter-scheduler.job-detail.delete': `${NB_JOBS_PANORAMA_FEATURE}-JobDetail-Delete`,\n    'org.jupyter.jupyter-scheduler.job-detail.stop': `${NB_JOBS_PANORAMA_FEATURE}-JobDetail-Stop`,\n    'org.jupyter.jupyter-scheduler.job-detail.download': `${NB_JOBS_PANORAMA_FEATURE}-JobDetail-Download`,\n    'org.jupyter.jupyter-scheduler.job-detail.reload': `${NB_JOBS_PANORAMA_FEATURE}-JobDetail-Reload`,\n    'org.jupyter.jupyter-scheduler.job-definition-detail.reload': `${NB_JOBS_PANORAMA_FEATURE}-JobDefinitonDetail-Reload`,\n    'org.jupyter.jupyter-scheduler.job-definition-detail.run': `${NB_JOBS_PANORAMA_FEATURE}-JobDefinitonDetail-Run`,\n    'org.jupyter.jupyter-scheduler.job-definition-detail.pause': `${NB_JOBS_PANORAMA_FEATURE}-JobDefinitonDetail-Pause`,\n    'org.jupyter.jupyter-scheduler.job-definition-detail.resume': `${NB_JOBS_PANORAMA_FEATURE}-JobDefinitonDetail-Resume`,\n    'org.jupyter.jupyter-scheduler.job-definition-detail.edit': `${NB_JOBS_PANORAMA_FEATURE}-JobDefinitonDetail-Edit`,\n    'org.jupyter.jupyter-scheduler.job-definition-detail.delete': `${NB_JOBS_PANORAMA_FEATURE}-JobDefinitonDetail-Delete`,\n    'org.jupyter.jupyter-scheduler.job-definition-edit.save': `${NB_JOBS_PANORAMA_FEATURE}-JobDefinitonDetail-Save`,\n    'org.jupyter.jupyter-scheduler.job-definition-edit.cancel': `${NB_JOBS_PANORAMA_FEATURE}-JobDefinitonEdit-Cancel`\n};\n\nconst schedulerTelemetryHandler: (\n    eventLog: IEventLog\n) => Promise<void> = async (eventLog) => {\n\n    let eventDetail: string;\n    const eventMapping = EVENT_MAPPING[eventLog.body.name] ?? eventLog.body.name;\n    if (eventLog.body.detail) {\n        eventDetail = JSON.stringify({\n            name: eventMapping,\n            error: eventLog.body.detail  \n        });\n    }\n    else {\n        eventDetail = eventMapping;\n    }\n\n    if (window && window.panorama) {\n        window.panorama('trackCustomEvent', {\n            eventType: PanoramaDataAnalyticsType.eventDetail,\n            eventDetail: eventDetail,\n            eventContext: NB_JOBS_PANORAMA_FEATURE,\n            timestamp: eventLog.timestamp.getTime()\n        });\n    }\n};\n\nconst SchedulerTelemetryPlugin: JupyterFrontEndPlugin<Scheduler.TelemetryHandler> =\n{\n    id: pluginIds.TelemetryPlugin,\n    autoStart: true,\n    provides: Scheduler.TelemetryHandler,\n    activate: (app: JupyterFrontEnd) => {\n        return schedulerTelemetryHandler;\n    }\n};\n\nexport { SchedulerTelemetryPlugin };\n"]}