var q=Object.defineProperty;var a=(m,_)=>q(m,"name",{value:_,configurable:!0});import{ref as A,defineComponent as F,computed as T,resolveDirective as H,openBlock as u,createElementBlock as x,createVNode as r,unref as s,withCtx as g,createTextVNode as L,toDisplayString as i,createBlock as S,createElementVNode as d,createCommentVNode as B,withDirectives as V,watch as z,normalizeClass as G}from"vue";import k from"primevue/button";import D from"primevue/column";import M from"primevue/datatable";import R from"primevue/divider";import j from"primevue/skeleton";import J from"primevue/tabpanel";import{aP as N,aQ as K,dc as O,aR as Q,r as Y,H as W,a as X,I as Z,dd as ee}from"./index-BI8HSLID.js";import te from"primevue/badge";import oe from"primevue/message";import se from"primevue/progressspinner";import{useI18n as ae}from"vue-i18n";import"@primevue/themes";import"@primevue/themes/aura";import"primevue/config";import"primevue/confirmationservice";import"primevue/toastservice";import"primevue/tooltip";import"primevue/blockui";import"primevue/dialog";import"primevue/checkbox";import"primevue/scrollpanel";import"primevue/usetoast";import"primevue/card";import"primevue/listbox";import"primevue/progressbar";import"primevue/floatlabel";import"primevue/inputtext";import"@primevue/forms";import"@primevue/forms/resolvers/zod";import"primevue/password";import"primevue/tag";import"primevue/inputnumber";import"primevue/tabpanels";import"primevue/tabs";import"primevue/iconfield";import"primevue/inputicon";import"primevue/chip";import"primevue/select";import"primevue/toggleswitch";import"primevue/colorpicker";import"primevue/radiobutton";import"primevue/knob";import"primevue/slider";import"primevue/panel";import"primevue/tabmenu";import"primevue/popover";import"primevue/tab";import"primevue/tablist";import"primevue";import"primevue/multiselect";import"primevue/contextmenu";import"primevue/tree";import"primevue/toolbar";import"primevue/tieredmenu";import"primevue/chart";import"primevue/galleria";import"primevue/imagecompare";import"primevue/textarea";import"primevue/treeselect";import"primevue/selectbutton";import"primevue/confirmpopup";import"primevue/useconfirm";import"primevue/confirmdialog";import"primevue/autocomplete";import"primevue/dropdown";var I=(m=>(m.CREDIT_ADDED="credit_added",m.ACCOUNT_CREATED="account_created",m.API_USAGE_STARTED="api_usage_started",m.API_USAGE_COMPLETED="api_usage_completed",m))(I||{});const re=N.create({baseURL:K,headers:{"Content-Type":"application/json"}}),ie=a(()=>{const m=A(!1),_=A(null),{d:v}=ae(),C=a((e,t,l)=>{if(Q(e))return;let h;if(!N.isAxiosError(e))h=`${t} failed: ${e instanceof Error?e.message:String(e)}`;else{const f=e,w=f.response?.status;w&&l?.[w]?h=l[w]:h=f.response?.data?.message??`${t} failed with status ${w}`}_.value=h},"handleRequestError"),y=a(async(e,t)=>{const{errorContext:l,routeSpecificErrors:h}=t;m.value=!0,_.value=null;try{return(await e()).data}catch(f){return C(f,l,h),null}finally{m.value=!1}},"executeRequest");function c(e){switch(e){case"credit_added":return"Credits Added";case"account_created":return"Account Created";case"api_usage_completed":return"API Usage";default:return e}}a(c,"formatEventType");function n(e){const t=new Date(e);return v(t,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}a(n,"formatDate");function b(e){return e.split("_").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}a(b,"formatJsonKey");function E(e){return typeof e=="number"?e.toLocaleString():typeof e=="string"&&e.match(/^\d{4}-\d{2}-\d{2}/)?new Date(e).toLocaleString():e}a(E,"formatJsonValue");function $(e){switch(e){case"credit_added":return"success";case"account_created":return"info";case"api_usage_completed":return"warning";default:return"info"}}a($,"getEventSeverity");function P(e){const{amount:t,api_name:l,model:h,...f}=e.params||{};return Object.keys(f).length>0}a(P,"hasAdditionalInfo");function U(e){const{...t}=e.params||{};return Object.entries(t).map(([l,h])=>{const f=b(l),w=E(h);return`<strong>${f}:</strong> ${w}`}).join("<br>")}a(U,"getTooltipContent");function o(e){return e?(e/100).toFixed(2):"0.00"}a(o,"formatAmount");async function p({page:e=1,limit:t=10}={}){const l="Fetching customer events",h={400:"Invalid input, object invalid",404:"Not found"},f=await O().getAuthHeader();return f?y(()=>re.get("/customers/events",{params:{page:e,limit:t},headers:f}),{errorContext:l,routeSpecificErrors:h}):(_.value="Authentication header is missing",null)}return a(p,"getMyEvents"),{isLoading:m,error:_,getMyEvents:p,formatEventType:c,getEventSeverity:$,formatAmount:o,hasAdditionalInfo:P,formatDate:n,formatJsonKey:b,formatJsonValue:E,getTooltipContent:U}},"useCustomerEventsService"),ne={key:0,class:"flex items-center justify-center p-8"},le={key:1,class:"p-4"},ce={class:"event-details"},de={key:0,class:"font-semibold text-green-500"},ue={key:1},me={key:2,class:"flex flex-col gap-1"},pe={class:"font-semibold"},fe={class:"text-sm text-gray-400"},ve=F({__name:"UsageLogsTable",setup(m,{expose:_}){const v=A([]),C=A(!0),y=A(null),c=ie(),n=A({page:1,limit:7,total:0,totalPages:0}),b=T(()=>(n.value.page-1)*n.value.limit),E=T(()=>{const o=new Map;return v.value.forEach(p=>{c.hasAdditionalInfo(p)&&p.event_id&&o.set(p.event_id,c.getTooltipContent(p))}),o}),$=a(async()=>{C.value=!0,y.value=null;try{const o=await c.getMyEvents({page:n.value.page,limit:n.value.limit});o?(o.events&&(v.value=o.events),o.page&&(n.value.page=o.page),o.limit&&(n.value.limit=o.limit),o.total&&(n.value.total=o.total),o.totalPages&&(n.value.totalPages=o.totalPages)):y.value=c.error.value||"Failed to load events"}catch(o){y.value=o instanceof Error?o.message:"Unknown error",console.error("Error loading events:",o)}finally{C.value=!1}},"loadEvents"),P=a(o=>{n.value.page=o.page+1,$().catch(p=>{console.error("Error loading events:",p)})},"onPageChange");return _({refresh:a(async()=>{n.value.page=1,await $()},"refresh")}),(o,p)=>{const e=H("tooltip");return u(),x("div",null,[C.value?(u(),x("div",ne,[r(s(se))])):y.value?(u(),x("div",le,[r(s(oe),{severity:"error",closable:!1},{default:g(()=>[L(i(y.value),1)]),_:1})])):(u(),S(s(M),{key:2,value:v.value,paginator:!0,rows:n.value.limit,"total-records":n.value.total,first:b.value,lazy:!0,class:"p-datatable-sm custom-datatable",onPage:P},{default:g(()=>[r(s(D),{field:"event_type",header:o.$t("credits.eventType")},{body:g(({data:t})=>[r(s(te),{value:s(c).formatEventType(t.event_type),severity:s(c).getEventSeverity(t.event_type)},null,8,["value","severity"])]),_:1},8,["header"]),r(s(D),{field:"details",header:o.$t("credits.details")},{body:g(({data:t})=>[d("div",ce,[t.event_type===s(I).CREDIT_ADDED?(u(),x("div",de,i(o.$t("credits.added"))+" $"+i(s(c).formatAmount(t.params?.amount)),1)):t.event_type===s(I).ACCOUNT_CREATED?(u(),x("div",ue,i(o.$t("credits.accountInitialized")),1)):t.event_type===s(I).API_USAGE_COMPLETED?(u(),x("div",me,[d("div",pe,i(t.params?.api_name||"API"),1),d("div",fe,i(o.$t("credits.model"))+": "+i(t.params?.model||"-"),1)])):B("",!0)])]),_:1},8,["header"]),r(s(D),{field:"createdAt",header:o.$t("credits.time")},{body:g(({data:t})=>[L(i(s(c).formatDate(t.createdAt)),1)]),_:1},8,["header"]),r(s(D),{field:"params",header:o.$t("credits.additionalInfo")},{body:g(({data:t})=>[s(c).hasAdditionalInfo(t)?V((u(),S(s(k),{key:0,icon:"pi pi-info-circle",class:"p-button-text p-button-sm"},null,512)),[[e,{escape:!1,value:E.value.get(t.event_id)||"",pt:{text:{style:{width:"max-content !important"}}}},void 0,{top:!0}]]):B("",!0)]),_:1},8,["header"])]),_:1},8,["value","rows","total-records","first"]))])}}}),he={class:"flex h-full flex-col"},_e={class:"mb-2 text-2xl font-bold"},ge={class:"flex flex-col gap-2"},ye={class:"text-sm font-medium text-muted"},Ce={class:"flex items-center justify-between"},be={class:"flex flex-row items-center"},xe={key:1,class:"text-xs text-muted"},Ae={class:"flex items-center justify-between"},Ee={key:0,class:"grow"},$e={class:"text-sm font-medium"},we={class:"text-xs text-muted"},ke={class:"flex flex-row gap-2"},Ot=F({__name:"CreditsPanel",setup(m){const _=Y(),v=O(),C=W(),y=X(),c=T(()=>v.loading),n=T(()=>v.isFetchingBalance),b=A(null),E=T(()=>v.lastBalanceUpdateTime?v.lastBalanceUpdateTime.toLocaleString():"");z(()=>v.lastBalanceUpdateTime,(e,t)=>{e&&e!==t&&b.value&&b.value.refresh()});const $=a(()=>{_.showTopUpCreditsDialog()},"handlePurchaseCreditsClick"),P=a(async()=>{await C.accessBillingPortal()},"handleCreditsHistoryClick"),U=a(async()=>{await y.execute("Comfy.ContactSupport")},"handleMessageSupport"),o=a(()=>{window.open("https://docs.comfy.org/tutorials/api-nodes/faq","_blank")},"handleFaqClick"),p=A([]);return(e,t)=>(u(),S(s(J),{value:"Credits",class:"credits-container h-full"},{default:g(()=>[d("div",he,[d("h2",_e,i(e.$t("credits.credits")),1),r(s(R)),d("div",ge,[d("h3",ye,i(e.$t("credits.yourCreditBalance")),1),d("div",Ce,[r(Z,{"text-class":"text-3xl font-bold"}),c.value?(u(),S(s(j),{key:0,width:"2rem",height:"2rem"})):(u(),S(s(k),{key:1,label:e.$t("credits.purchaseCredits"),loading:c.value,onClick:$},null,8,["label","loading"]))]),d("div",be,[n.value?(u(),S(s(j),{key:0,width:"12rem",height:"1rem",class:"text-xs"})):E.value?(u(),x("div",xe,i(e.$t("credits.lastUpdated"))+": "+i(E.value),1)):B("",!0),r(s(k),{icon:"pi pi-refresh",text:"",size:"small",severity:"secondary",onClick:t[0]||(t[0]=()=>s(C).fetchBalance())})])]),d("div",Ae,[d("h3",null,i(e.$t("credits.activity")),1),r(s(k),{label:e.$t("credits.invoiceHistory"),text:"",severity:"secondary",icon:"pi pi-arrow-up-right",loading:c.value,onClick:P},null,8,["label","loading"])]),p.value.length>0?(u(),x("div",Ee,[r(s(M),{value:p.value,"show-headers":!1},{default:g(()=>[r(s(D),{field:"title",header:e.$t("g.name")},{body:g(({data:l})=>[d("div",$e,i(l.title),1),d("div",we,i(l.timestamp),1)]),_:1},8,["header"]),r(s(D),{field:"amount",header:e.$t("g.amount")},{body:g(({data:l})=>[d("div",{class:G(["text-center text-base font-medium",l.isPositive?"text-sky-500":"text-red-400"])},i(l.isPositive?"+":"-")+"$"+i(s(ee)(l.amount,"usd")),3)]),_:1},8,["header"])]),_:1},8,["value"])])):B("",!0),r(s(R)),r(ve,{ref_key:"usageLogsTableRef",ref:b},null,512),d("div",ke,[r(s(k),{label:e.$t("credits.faqs"),text:"",severity:"secondary",icon:"pi pi-question-circle",onClick:o},null,8,["label"]),r(s(k),{label:e.$t("credits.messageSupport"),text:"",severity:"secondary",icon:"pi pi-comments",onClick:U},null,8,["label"])])])]),_:1}))}});export{Ot as default};
//# sourceMappingURL=CreditsPanel-BooDQmdU.js.map
